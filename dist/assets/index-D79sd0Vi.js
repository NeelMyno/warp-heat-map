(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();function Bv(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var ih={exports:{}},Ja={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ry;function M1(){if(ry)return Ja;ry=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(i,s,o){var c=null;if(o!==void 0&&(c=""+o),s.key!==void 0&&(c=""+s.key),"key"in s){o={};for(var u in s)u!=="key"&&(o[u]=s[u])}else o=s;return s=o.ref,{$$typeof:n,type:i,key:c,ref:s!==void 0?s:null,props:o}}return Ja.Fragment=e,Ja.jsx=t,Ja.jsxs=t,Ja}var ay;function O1(){return ay||(ay=1,ih.exports=M1()),ih.exports}var ce=O1(),sh={exports:{}},Ce={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var oy;function I1(){if(oy)return Ce;oy=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),c=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),m=Symbol.iterator;function y(M){return M===null||typeof M!="object"?null:(M=m&&M[m]||M["@@iterator"],typeof M=="function"?M:null)}var T={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},w=Object.assign,C={};function N(M,q,se){this.props=M,this.context=q,this.refs=C,this.updater=se||T}N.prototype.isReactComponent={},N.prototype.setState=function(M,q){if(typeof M!="object"&&typeof M!="function"&&M!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,M,q,"setState")},N.prototype.forceUpdate=function(M){this.updater.enqueueForceUpdate(this,M,"forceUpdate")};function V(){}V.prototype=N.prototype;function $(M,q,se){this.props=M,this.context=q,this.refs=C,this.updater=se||T}var O=$.prototype=new V;O.constructor=$,w(O,N.prototype),O.isPureReactComponent=!0;var F=Array.isArray,H={H:null,A:null,T:null,S:null,V:null},te=Object.prototype.hasOwnProperty;function oe(M,q,se,Z,de,ve){return se=ve.ref,{$$typeof:n,type:M,key:q,ref:se!==void 0?se:null,props:ve}}function E(M,q){return oe(M.type,q,void 0,void 0,void 0,M.props)}function R(M){return typeof M=="object"&&M!==null&&M.$$typeof===n}function Y(M){var q={"=":"=0",":":"=2"};return"$"+M.replace(/[=:]/g,function(se){return q[se]})}var ie=/\/+/g;function re(M,q){return typeof M=="object"&&M!==null&&M.key!=null?Y(""+M.key):q.toString(36)}function pe(){}function be(M){switch(M.status){case"fulfilled":return M.value;case"rejected":throw M.reason;default:switch(typeof M.status=="string"?M.then(pe,pe):(M.status="pending",M.then(function(q){M.status==="pending"&&(M.status="fulfilled",M.value=q)},function(q){M.status==="pending"&&(M.status="rejected",M.reason=q)})),M.status){case"fulfilled":return M.value;case"rejected":throw M.reason}}throw M}function Ie(M,q,se,Z,de){var ve=typeof M;(ve==="undefined"||ve==="boolean")&&(M=null);var _e=!1;if(M===null)_e=!0;else switch(ve){case"bigint":case"string":case"number":_e=!0;break;case"object":switch(M.$$typeof){case n:case e:_e=!0;break;case g:return _e=M._init,Ie(_e(M._payload),q,se,Z,de)}}if(_e)return de=de(M),_e=Z===""?"."+re(M,0):Z,F(de)?(se="",_e!=null&&(se=_e.replace(ie,"$&/")+"/"),Ie(de,q,se,"",function(Me){return Me})):de!=null&&(R(de)&&(de=E(de,se+(de.key==null||M&&M.key===de.key?"":(""+de.key).replace(ie,"$&/")+"/")+_e)),q.push(de)),1;_e=0;var tt=Z===""?".":Z+":";if(F(M))for(var me=0;me<M.length;me++)Z=M[me],ve=tt+re(Z,me),_e+=Ie(Z,q,se,ve,de);else if(me=y(M),typeof me=="function")for(M=me.call(M),me=0;!(Z=M.next()).done;)Z=Z.value,ve=tt+re(Z,me++),_e+=Ie(Z,q,se,ve,de);else if(ve==="object"){if(typeof M.then=="function")return Ie(be(M),q,se,Z,de);throw q=String(M),Error("Objects are not valid as a React child (found: "+(q==="[object Object]"?"object with keys {"+Object.keys(M).join(", ")+"}":q)+"). If you meant to render a collection of children, use an array instead.")}return _e}function K(M,q,se){if(M==null)return M;var Z=[],de=0;return Ie(M,Z,"","",function(ve){return q.call(se,ve,de++)}),Z}function ne(M){if(M._status===-1){var q=M._result;q=q(),q.then(function(se){(M._status===0||M._status===-1)&&(M._status=1,M._result=se)},function(se){(M._status===0||M._status===-1)&&(M._status=2,M._result=se)}),M._status===-1&&(M._status=0,M._result=q)}if(M._status===1)return M._result.default;throw M._result}var fe=typeof reportError=="function"?reportError:function(M){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var q=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof M=="object"&&M!==null&&typeof M.message=="string"?String(M.message):String(M),error:M});if(!window.dispatchEvent(q))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",M);return}console.error(M)};function he(){}return Ce.Children={map:K,forEach:function(M,q,se){K(M,function(){q.apply(this,arguments)},se)},count:function(M){var q=0;return K(M,function(){q++}),q},toArray:function(M){return K(M,function(q){return q})||[]},only:function(M){if(!R(M))throw Error("React.Children.only expected to receive a single React element child.");return M}},Ce.Component=N,Ce.Fragment=t,Ce.Profiler=s,Ce.PureComponent=$,Ce.StrictMode=i,Ce.Suspense=h,Ce.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=H,Ce.__COMPILER_RUNTIME={__proto__:null,c:function(M){return H.H.useMemoCache(M)}},Ce.cache=function(M){return function(){return M.apply(null,arguments)}},Ce.cloneElement=function(M,q,se){if(M==null)throw Error("The argument must be a React element, but you passed "+M+".");var Z=w({},M.props),de=M.key,ve=void 0;if(q!=null)for(_e in q.ref!==void 0&&(ve=void 0),q.key!==void 0&&(de=""+q.key),q)!te.call(q,_e)||_e==="key"||_e==="__self"||_e==="__source"||_e==="ref"&&q.ref===void 0||(Z[_e]=q[_e]);var _e=arguments.length-2;if(_e===1)Z.children=se;else if(1<_e){for(var tt=Array(_e),me=0;me<_e;me++)tt[me]=arguments[me+2];Z.children=tt}return oe(M.type,de,void 0,void 0,ve,Z)},Ce.createContext=function(M){return M={$$typeof:c,_currentValue:M,_currentValue2:M,_threadCount:0,Provider:null,Consumer:null},M.Provider=M,M.Consumer={$$typeof:o,_context:M},M},Ce.createElement=function(M,q,se){var Z,de={},ve=null;if(q!=null)for(Z in q.key!==void 0&&(ve=""+q.key),q)te.call(q,Z)&&Z!=="key"&&Z!=="__self"&&Z!=="__source"&&(de[Z]=q[Z]);var _e=arguments.length-2;if(_e===1)de.children=se;else if(1<_e){for(var tt=Array(_e),me=0;me<_e;me++)tt[me]=arguments[me+2];de.children=tt}if(M&&M.defaultProps)for(Z in _e=M.defaultProps,_e)de[Z]===void 0&&(de[Z]=_e[Z]);return oe(M,ve,void 0,void 0,null,de)},Ce.createRef=function(){return{current:null}},Ce.forwardRef=function(M){return{$$typeof:u,render:M}},Ce.isValidElement=R,Ce.lazy=function(M){return{$$typeof:g,_payload:{_status:-1,_result:M},_init:ne}},Ce.memo=function(M,q){return{$$typeof:d,type:M,compare:q===void 0?null:q}},Ce.startTransition=function(M){var q=H.T,se={};H.T=se;try{var Z=M(),de=H.S;de!==null&&de(se,Z),typeof Z=="object"&&Z!==null&&typeof Z.then=="function"&&Z.then(he,fe)}catch(ve){fe(ve)}finally{H.T=q}},Ce.unstable_useCacheRefresh=function(){return H.H.useCacheRefresh()},Ce.use=function(M){return H.H.use(M)},Ce.useActionState=function(M,q,se){return H.H.useActionState(M,q,se)},Ce.useCallback=function(M,q){return H.H.useCallback(M,q)},Ce.useContext=function(M){return H.H.useContext(M)},Ce.useDebugValue=function(){},Ce.useDeferredValue=function(M,q){return H.H.useDeferredValue(M,q)},Ce.useEffect=function(M,q,se){var Z=H.H;if(typeof se=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return Z.useEffect(M,q)},Ce.useId=function(){return H.H.useId()},Ce.useImperativeHandle=function(M,q,se){return H.H.useImperativeHandle(M,q,se)},Ce.useInsertionEffect=function(M,q){return H.H.useInsertionEffect(M,q)},Ce.useLayoutEffect=function(M,q){return H.H.useLayoutEffect(M,q)},Ce.useMemo=function(M,q){return H.H.useMemo(M,q)},Ce.useOptimistic=function(M,q){return H.H.useOptimistic(M,q)},Ce.useReducer=function(M,q,se){return H.H.useReducer(M,q,se)},Ce.useRef=function(M){return H.H.useRef(M)},Ce.useState=function(M){return H.H.useState(M)},Ce.useSyncExternalStore=function(M,q,se){return H.H.useSyncExternalStore(M,q,se)},Ce.useTransition=function(){return H.H.useTransition()},Ce.version="19.1.1",Ce}var ly;function Ad(){return ly||(ly=1,sh.exports=I1()),sh.exports}var le=Ad();const zl=Bv(le);var rh={exports:{}},eo={},ah={exports:{}},oh={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var cy;function N1(){return cy||(cy=1,(function(n){function e(K,ne){var fe=K.length;K.push(ne);e:for(;0<fe;){var he=fe-1>>>1,M=K[he];if(0<s(M,ne))K[he]=ne,K[fe]=M,fe=he;else break e}}function t(K){return K.length===0?null:K[0]}function i(K){if(K.length===0)return null;var ne=K[0],fe=K.pop();if(fe!==ne){K[0]=fe;e:for(var he=0,M=K.length,q=M>>>1;he<q;){var se=2*(he+1)-1,Z=K[se],de=se+1,ve=K[de];if(0>s(Z,fe))de<M&&0>s(ve,Z)?(K[he]=ve,K[de]=fe,he=de):(K[he]=Z,K[se]=fe,he=se);else if(de<M&&0>s(ve,fe))K[he]=ve,K[de]=fe,he=de;else break e}}return ne}function s(K,ne){var fe=K.sortIndex-ne.sortIndex;return fe!==0?fe:K.id-ne.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var o=performance;n.unstable_now=function(){return o.now()}}else{var c=Date,u=c.now();n.unstable_now=function(){return c.now()-u}}var h=[],d=[],g=1,m=null,y=3,T=!1,w=!1,C=!1,N=!1,V=typeof setTimeout=="function"?setTimeout:null,$=typeof clearTimeout=="function"?clearTimeout:null,O=typeof setImmediate<"u"?setImmediate:null;function F(K){for(var ne=t(d);ne!==null;){if(ne.callback===null)i(d);else if(ne.startTime<=K)i(d),ne.sortIndex=ne.expirationTime,e(h,ne);else break;ne=t(d)}}function H(K){if(C=!1,F(K),!w)if(t(h)!==null)w=!0,te||(te=!0,re());else{var ne=t(d);ne!==null&&Ie(H,ne.startTime-K)}}var te=!1,oe=-1,E=5,R=-1;function Y(){return N?!0:!(n.unstable_now()-R<E)}function ie(){if(N=!1,te){var K=n.unstable_now();R=K;var ne=!0;try{e:{w=!1,C&&(C=!1,$(oe),oe=-1),T=!0;var fe=y;try{t:{for(F(K),m=t(h);m!==null&&!(m.expirationTime>K&&Y());){var he=m.callback;if(typeof he=="function"){m.callback=null,y=m.priorityLevel;var M=he(m.expirationTime<=K);if(K=n.unstable_now(),typeof M=="function"){m.callback=M,F(K),ne=!0;break t}m===t(h)&&i(h),F(K)}else i(h);m=t(h)}if(m!==null)ne=!0;else{var q=t(d);q!==null&&Ie(H,q.startTime-K),ne=!1}}break e}finally{m=null,y=fe,T=!1}ne=void 0}}finally{ne?re():te=!1}}}var re;if(typeof O=="function")re=function(){O(ie)};else if(typeof MessageChannel<"u"){var pe=new MessageChannel,be=pe.port2;pe.port1.onmessage=ie,re=function(){be.postMessage(null)}}else re=function(){V(ie,0)};function Ie(K,ne){oe=V(function(){K(n.unstable_now())},ne)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(K){K.callback=null},n.unstable_forceFrameRate=function(K){0>K||125<K?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):E=0<K?Math.floor(1e3/K):5},n.unstable_getCurrentPriorityLevel=function(){return y},n.unstable_next=function(K){switch(y){case 1:case 2:case 3:var ne=3;break;default:ne=y}var fe=y;y=ne;try{return K()}finally{y=fe}},n.unstable_requestPaint=function(){N=!0},n.unstable_runWithPriority=function(K,ne){switch(K){case 1:case 2:case 3:case 4:case 5:break;default:K=3}var fe=y;y=K;try{return ne()}finally{y=fe}},n.unstable_scheduleCallback=function(K,ne,fe){var he=n.unstable_now();switch(typeof fe=="object"&&fe!==null?(fe=fe.delay,fe=typeof fe=="number"&&0<fe?he+fe:he):fe=he,K){case 1:var M=-1;break;case 2:M=250;break;case 5:M=1073741823;break;case 4:M=1e4;break;default:M=5e3}return M=fe+M,K={id:g++,callback:ne,priorityLevel:K,startTime:fe,expirationTime:M,sortIndex:-1},fe>he?(K.sortIndex=fe,e(d,K),t(h)===null&&K===t(d)&&(C?($(oe),oe=-1):C=!0,Ie(H,fe-he))):(K.sortIndex=M,e(h,K),w||T||(w=!0,te||(te=!0,re()))),K},n.unstable_shouldYield=Y,n.unstable_wrapCallback=function(K){var ne=y;return function(){var fe=y;y=ne;try{return K.apply(this,arguments)}finally{y=fe}}}})(oh)),oh}var uy;function P1(){return uy||(uy=1,ah.exports=N1()),ah.exports}var lh={exports:{}},Vt={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fy;function k1(){if(fy)return Vt;fy=1;var n=Ad();function e(h){var d="https://react.dev/errors/"+h;if(1<arguments.length){d+="?args[]="+encodeURIComponent(arguments[1]);for(var g=2;g<arguments.length;g++)d+="&args[]="+encodeURIComponent(arguments[g])}return"Minified React error #"+h+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var i={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},s=Symbol.for("react.portal");function o(h,d,g){var m=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:s,key:m==null?null:""+m,children:h,containerInfo:d,implementation:g}}var c=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function u(h,d){if(h==="font")return"";if(typeof d=="string")return d==="use-credentials"?d:""}return Vt.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=i,Vt.createPortal=function(h,d){var g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)throw Error(e(299));return o(h,d,null,g)},Vt.flushSync=function(h){var d=c.T,g=i.p;try{if(c.T=null,i.p=2,h)return h()}finally{c.T=d,i.p=g,i.d.f()}},Vt.preconnect=function(h,d){typeof h=="string"&&(d?(d=d.crossOrigin,d=typeof d=="string"?d==="use-credentials"?d:"":void 0):d=null,i.d.C(h,d))},Vt.prefetchDNS=function(h){typeof h=="string"&&i.d.D(h)},Vt.preinit=function(h,d){if(typeof h=="string"&&d&&typeof d.as=="string"){var g=d.as,m=u(g,d.crossOrigin),y=typeof d.integrity=="string"?d.integrity:void 0,T=typeof d.fetchPriority=="string"?d.fetchPriority:void 0;g==="style"?i.d.S(h,typeof d.precedence=="string"?d.precedence:void 0,{crossOrigin:m,integrity:y,fetchPriority:T}):g==="script"&&i.d.X(h,{crossOrigin:m,integrity:y,fetchPriority:T,nonce:typeof d.nonce=="string"?d.nonce:void 0})}},Vt.preinitModule=function(h,d){if(typeof h=="string")if(typeof d=="object"&&d!==null){if(d.as==null||d.as==="script"){var g=u(d.as,d.crossOrigin);i.d.M(h,{crossOrigin:g,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0})}}else d==null&&i.d.M(h)},Vt.preload=function(h,d){if(typeof h=="string"&&typeof d=="object"&&d!==null&&typeof d.as=="string"){var g=d.as,m=u(g,d.crossOrigin);i.d.L(h,g,{crossOrigin:m,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0,type:typeof d.type=="string"?d.type:void 0,fetchPriority:typeof d.fetchPriority=="string"?d.fetchPriority:void 0,referrerPolicy:typeof d.referrerPolicy=="string"?d.referrerPolicy:void 0,imageSrcSet:typeof d.imageSrcSet=="string"?d.imageSrcSet:void 0,imageSizes:typeof d.imageSizes=="string"?d.imageSizes:void 0,media:typeof d.media=="string"?d.media:void 0})}},Vt.preloadModule=function(h,d){if(typeof h=="string")if(d){var g=u(d.as,d.crossOrigin);i.d.m(h,{as:typeof d.as=="string"&&d.as!=="script"?d.as:void 0,crossOrigin:g,integrity:typeof d.integrity=="string"?d.integrity:void 0})}else i.d.m(h)},Vt.requestFormReset=function(h){i.d.r(h)},Vt.unstable_batchedUpdates=function(h,d){return h(d)},Vt.useFormState=function(h,d,g){return c.H.useFormState(h,d,g)},Vt.useFormStatus=function(){return c.H.useHostTransitionStatus()},Vt.version="19.1.1",Vt}var hy;function Fv(){if(hy)return lh.exports;hy=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),lh.exports=k1(),lh.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var dy;function D1(){if(dy)return eo;dy=1;var n=P1(),e=Ad(),t=Fv();function i(r){var a="https://react.dev/errors/"+r;if(1<arguments.length){a+="?args[]="+encodeURIComponent(arguments[1]);for(var l=2;l<arguments.length;l++)a+="&args[]="+encodeURIComponent(arguments[l])}return"Minified React error #"+r+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function o(r){var a=r,l=r;if(r.alternate)for(;a.return;)a=a.return;else{r=a;do a=r,(a.flags&4098)!==0&&(l=a.return),r=a.return;while(r)}return a.tag===3?l:null}function c(r){if(r.tag===13){var a=r.memoizedState;if(a===null&&(r=r.alternate,r!==null&&(a=r.memoizedState)),a!==null)return a.dehydrated}return null}function u(r){if(o(r)!==r)throw Error(i(188))}function h(r){var a=r.alternate;if(!a){if(a=o(r),a===null)throw Error(i(188));return a!==r?null:r}for(var l=r,f=a;;){var p=l.return;if(p===null)break;var _=p.alternate;if(_===null){if(f=p.return,f!==null){l=f;continue}break}if(p.child===_.child){for(_=p.child;_;){if(_===l)return u(p),r;if(_===f)return u(p),a;_=_.sibling}throw Error(i(188))}if(l.return!==f.return)l=p,f=_;else{for(var b=!1,v=p.child;v;){if(v===l){b=!0,l=p,f=_;break}if(v===f){b=!0,f=p,l=_;break}v=v.sibling}if(!b){for(v=_.child;v;){if(v===l){b=!0,l=_,f=p;break}if(v===f){b=!0,f=_,l=p;break}v=v.sibling}if(!b)throw Error(i(189))}}if(l.alternate!==f)throw Error(i(190))}if(l.tag!==3)throw Error(i(188));return l.stateNode.current===l?r:a}function d(r){var a=r.tag;if(a===5||a===26||a===27||a===6)return r;for(r=r.child;r!==null;){if(a=d(r),a!==null)return a;r=r.sibling}return null}var g=Object.assign,m=Symbol.for("react.element"),y=Symbol.for("react.transitional.element"),T=Symbol.for("react.portal"),w=Symbol.for("react.fragment"),C=Symbol.for("react.strict_mode"),N=Symbol.for("react.profiler"),V=Symbol.for("react.provider"),$=Symbol.for("react.consumer"),O=Symbol.for("react.context"),F=Symbol.for("react.forward_ref"),H=Symbol.for("react.suspense"),te=Symbol.for("react.suspense_list"),oe=Symbol.for("react.memo"),E=Symbol.for("react.lazy"),R=Symbol.for("react.activity"),Y=Symbol.for("react.memo_cache_sentinel"),ie=Symbol.iterator;function re(r){return r===null||typeof r!="object"?null:(r=ie&&r[ie]||r["@@iterator"],typeof r=="function"?r:null)}var pe=Symbol.for("react.client.reference");function be(r){if(r==null)return null;if(typeof r=="function")return r.$$typeof===pe?null:r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case w:return"Fragment";case N:return"Profiler";case C:return"StrictMode";case H:return"Suspense";case te:return"SuspenseList";case R:return"Activity"}if(typeof r=="object")switch(r.$$typeof){case T:return"Portal";case O:return(r.displayName||"Context")+".Provider";case $:return(r._context.displayName||"Context")+".Consumer";case F:var a=r.render;return r=r.displayName,r||(r=a.displayName||a.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case oe:return a=r.displayName||null,a!==null?a:be(r.type)||"Memo";case E:a=r._payload,r=r._init;try{return be(r(a))}catch{}}return null}var Ie=Array.isArray,K=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ne=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,fe={pending:!1,data:null,method:null,action:null},he=[],M=-1;function q(r){return{current:r}}function se(r){0>M||(r.current=he[M],he[M]=null,M--)}function Z(r,a){M++,he[M]=r.current,r.current=a}var de=q(null),ve=q(null),_e=q(null),tt=q(null);function me(r,a){switch(Z(_e,a),Z(ve,r),Z(de,null),a.nodeType){case 9:case 11:r=(r=a.documentElement)&&(r=r.namespaceURI)?Pm(r):0;break;default:if(r=a.tagName,a=a.namespaceURI)a=Pm(a),r=km(a,r);else switch(r){case"svg":r=1;break;case"math":r=2;break;default:r=0}}se(de),Z(de,r)}function Me(){se(de),se(ve),se(_e)}function nt(r){r.memoizedState!==null&&Z(tt,r);var a=de.current,l=km(a,r.type);a!==l&&(Z(ve,r),Z(de,l))}function we(r){ve.current===r&&(se(de),se(ve)),tt.current===r&&(se(tt),qa._currentValue=fe)}var it=Object.prototype.hasOwnProperty,ut=n.unstable_scheduleCallback,Le=n.unstable_cancelCallback,$e=n.unstable_shouldYield,Pe=n.unstable_requestPaint,ht=n.unstable_now,Re=n.unstable_getCurrentPriorityLevel,st=n.unstable_ImmediatePriority,On=n.unstable_UserBlockingPriority,In=n.unstable_NormalPriority,hn=n.unstable_LowPriority,vi=n.unstable_IdlePriority,Ct=n.log,dn=n.unstable_setDisableYieldValue,ot=null,Xe=null;function Mt(r){if(typeof Ct=="function"&&dn(r),Xe&&typeof Xe.setStrictMode=="function")try{Xe.setStrictMode(ot,r)}catch{}}var Dt=Math.clz32?Math.clz32:pn,Co=Math.log,Ti=Math.LN2;function pn(r){return r>>>=0,r===0?32:31-(Co(r)/Ti|0)|0}var zn=256,rs=4194304;function as(r){var a=r&42;if(a!==0)return a;switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return r&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return r}}function Mo(r,a,l){var f=r.pendingLanes;if(f===0)return 0;var p=0,_=r.suspendedLanes,b=r.pingedLanes;r=r.warmLanes;var v=f&134217727;return v!==0?(f=v&~_,f!==0?p=as(f):(b&=v,b!==0?p=as(b):l||(l=v&~r,l!==0&&(p=as(l))))):(v=f&~_,v!==0?p=as(v):b!==0?p=as(b):l||(l=f&~r,l!==0&&(p=as(l)))),p===0?0:a!==0&&a!==p&&(a&_)===0&&(_=p&-p,l=a&-a,_>=l||_===32&&(l&4194048)!==0)?a:p}function ia(r,a){return(r.pendingLanes&~(r.suspendedLanes&~r.pingedLanes)&a)===0}function _T(r,a){switch(r){case 1:case 2:case 4:case 8:case 64:return a+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function _p(){var r=zn;return zn<<=1,(zn&4194048)===0&&(zn=256),r}function mp(){var r=rs;return rs<<=1,(rs&62914560)===0&&(rs=4194304),r}function $c(r){for(var a=[],l=0;31>l;l++)a.push(r);return a}function sa(r,a){r.pendingLanes|=a,a!==268435456&&(r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0)}function mT(r,a,l,f,p,_){var b=r.pendingLanes;r.pendingLanes=l,r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0,r.expiredLanes&=l,r.entangledLanes&=l,r.errorRecoveryDisabledLanes&=l,r.shellSuspendCounter=0;var v=r.entanglements,A=r.expirationTimes,j=r.hiddenUpdates;for(l=b&~l;0<l;){var Q=31-Dt(l),ee=1<<Q;v[Q]=0,A[Q]=-1;var W=j[Q];if(W!==null)for(j[Q]=null,Q=0;Q<W.length;Q++){var X=W[Q];X!==null&&(X.lane&=-536870913)}l&=~ee}f!==0&&yp(r,f,0),_!==0&&p===0&&r.tag!==0&&(r.suspendedLanes|=_&~(b&~a))}function yp(r,a,l){r.pendingLanes|=a,r.suspendedLanes&=~a;var f=31-Dt(a);r.entangledLanes|=a,r.entanglements[f]=r.entanglements[f]|1073741824|l&4194090}function bp(r,a){var l=r.entangledLanes|=a;for(r=r.entanglements;l;){var f=31-Dt(l),p=1<<f;p&a|r[f]&a&&(r[f]|=a),l&=~p}}function Xc(r){switch(r){case 2:r=1;break;case 8:r=4;break;case 32:r=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:r=128;break;case 268435456:r=134217728;break;default:r=0}return r}function Yc(r){return r&=-r,2<r?8<r?(r&134217727)!==0?32:268435456:8:2}function vp(){var r=ne.p;return r!==0?r:(r=window.event,r===void 0?32:Jm(r.type))}function yT(r,a){var l=ne.p;try{return ne.p=r,a()}finally{ne.p=l}}var xi=Math.random().toString(36).slice(2),Lt="__reactFiber$"+xi,Kt="__reactProps$"+xi,Hs="__reactContainer$"+xi,qc="__reactEvents$"+xi,bT="__reactListeners$"+xi,vT="__reactHandles$"+xi,Tp="__reactResources$"+xi,ra="__reactMarker$"+xi;function Kc(r){delete r[Lt],delete r[Kt],delete r[qc],delete r[bT],delete r[vT]}function Ws(r){var a=r[Lt];if(a)return a;for(var l=r.parentNode;l;){if(a=l[Hs]||l[Lt]){if(l=a.alternate,a.child!==null||l!==null&&l.child!==null)for(r=Fm(r);r!==null;){if(l=r[Lt])return l;r=Fm(r)}return a}r=l,l=r.parentNode}return null}function $s(r){if(r=r[Lt]||r[Hs]){var a=r.tag;if(a===5||a===6||a===13||a===26||a===27||a===3)return r}return null}function aa(r){var a=r.tag;if(a===5||a===26||a===27||a===6)return r.stateNode;throw Error(i(33))}function Xs(r){var a=r[Tp];return a||(a=r[Tp]={hoistableStyles:new Map,hoistableScripts:new Map}),a}function Ot(r){r[ra]=!0}var xp=new Set,Sp={};function os(r,a){Ys(r,a),Ys(r+"Capture",a)}function Ys(r,a){for(Sp[r]=a,r=0;r<a.length;r++)xp.add(a[r])}var TT=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),wp={},Ap={};function xT(r){return it.call(Ap,r)?!0:it.call(wp,r)?!1:TT.test(r)?Ap[r]=!0:(wp[r]=!0,!1)}function Oo(r,a,l){if(xT(a))if(l===null)r.removeAttribute(a);else{switch(typeof l){case"undefined":case"function":case"symbol":r.removeAttribute(a);return;case"boolean":var f=a.toLowerCase().slice(0,5);if(f!=="data-"&&f!=="aria-"){r.removeAttribute(a);return}}r.setAttribute(a,""+l)}}function Io(r,a,l){if(l===null)r.removeAttribute(a);else{switch(typeof l){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(a);return}r.setAttribute(a,""+l)}}function ei(r,a,l,f){if(f===null)r.removeAttribute(l);else{switch(typeof f){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(l);return}r.setAttributeNS(a,l,""+f)}}var Zc,Ep;function qs(r){if(Zc===void 0)try{throw Error()}catch(l){var a=l.stack.trim().match(/\n( *(at )?)/);Zc=a&&a[1]||"",Ep=-1<l.stack.indexOf(`
    at`)?" (<anonymous>)":-1<l.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Zc+r+Ep}var Qc=!1;function Gc(r,a){if(!r||Qc)return"";Qc=!0;var l=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var f={DetermineComponentFrameRoot:function(){try{if(a){var ee=function(){throw Error()};if(Object.defineProperty(ee.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ee,[])}catch(X){var W=X}Reflect.construct(r,[],ee)}else{try{ee.call()}catch(X){W=X}r.call(ee.prototype)}}else{try{throw Error()}catch(X){W=X}(ee=r())&&typeof ee.catch=="function"&&ee.catch(function(){})}}catch(X){if(X&&W&&typeof X.stack=="string")return[X.stack,W.stack]}return[null,null]}};f.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var p=Object.getOwnPropertyDescriptor(f.DetermineComponentFrameRoot,"name");p&&p.configurable&&Object.defineProperty(f.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var _=f.DetermineComponentFrameRoot(),b=_[0],v=_[1];if(b&&v){var A=b.split(`
`),j=v.split(`
`);for(p=f=0;f<A.length&&!A[f].includes("DetermineComponentFrameRoot");)f++;for(;p<j.length&&!j[p].includes("DetermineComponentFrameRoot");)p++;if(f===A.length||p===j.length)for(f=A.length-1,p=j.length-1;1<=f&&0<=p&&A[f]!==j[p];)p--;for(;1<=f&&0<=p;f--,p--)if(A[f]!==j[p]){if(f!==1||p!==1)do if(f--,p--,0>p||A[f]!==j[p]){var Q=`
`+A[f].replace(" at new "," at ");return r.displayName&&Q.includes("<anonymous>")&&(Q=Q.replace("<anonymous>",r.displayName)),Q}while(1<=f&&0<=p);break}}}finally{Qc=!1,Error.prepareStackTrace=l}return(l=r?r.displayName||r.name:"")?qs(l):""}function ST(r){switch(r.tag){case 26:case 27:case 5:return qs(r.type);case 16:return qs("Lazy");case 13:return qs("Suspense");case 19:return qs("SuspenseList");case 0:case 15:return Gc(r.type,!1);case 11:return Gc(r.type.render,!1);case 1:return Gc(r.type,!0);case 31:return qs("Activity");default:return""}}function Rp(r){try{var a="";do a+=ST(r),r=r.return;while(r);return a}catch(l){return`
Error generating stack: `+l.message+`
`+l.stack}}function gn(r){switch(typeof r){case"bigint":case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function Cp(r){var a=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function wT(r){var a=Cp(r)?"checked":"value",l=Object.getOwnPropertyDescriptor(r.constructor.prototype,a),f=""+r[a];if(!r.hasOwnProperty(a)&&typeof l<"u"&&typeof l.get=="function"&&typeof l.set=="function"){var p=l.get,_=l.set;return Object.defineProperty(r,a,{configurable:!0,get:function(){return p.call(this)},set:function(b){f=""+b,_.call(this,b)}}),Object.defineProperty(r,a,{enumerable:l.enumerable}),{getValue:function(){return f},setValue:function(b){f=""+b},stopTracking:function(){r._valueTracker=null,delete r[a]}}}}function No(r){r._valueTracker||(r._valueTracker=wT(r))}function Mp(r){if(!r)return!1;var a=r._valueTracker;if(!a)return!0;var l=a.getValue(),f="";return r&&(f=Cp(r)?r.checked?"true":"false":r.value),r=f,r!==l?(a.setValue(r),!0):!1}function Po(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}var AT=/[\n"\\]/g;function _n(r){return r.replace(AT,function(a){return"\\"+a.charCodeAt(0).toString(16)+" "})}function Jc(r,a,l,f,p,_,b,v){r.name="",b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"?r.type=b:r.removeAttribute("type"),a!=null?b==="number"?(a===0&&r.value===""||r.value!=a)&&(r.value=""+gn(a)):r.value!==""+gn(a)&&(r.value=""+gn(a)):b!=="submit"&&b!=="reset"||r.removeAttribute("value"),a!=null?eu(r,b,gn(a)):l!=null?eu(r,b,gn(l)):f!=null&&r.removeAttribute("value"),p==null&&_!=null&&(r.defaultChecked=!!_),p!=null&&(r.checked=p&&typeof p!="function"&&typeof p!="symbol"),v!=null&&typeof v!="function"&&typeof v!="symbol"&&typeof v!="boolean"?r.name=""+gn(v):r.removeAttribute("name")}function Op(r,a,l,f,p,_,b,v){if(_!=null&&typeof _!="function"&&typeof _!="symbol"&&typeof _!="boolean"&&(r.type=_),a!=null||l!=null){if(!(_!=="submit"&&_!=="reset"||a!=null))return;l=l!=null?""+gn(l):"",a=a!=null?""+gn(a):l,v||a===r.value||(r.value=a),r.defaultValue=a}f=f??p,f=typeof f!="function"&&typeof f!="symbol"&&!!f,r.checked=v?r.checked:!!f,r.defaultChecked=!!f,b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"&&(r.name=b)}function eu(r,a,l){a==="number"&&Po(r.ownerDocument)===r||r.defaultValue===""+l||(r.defaultValue=""+l)}function Ks(r,a,l,f){if(r=r.options,a){a={};for(var p=0;p<l.length;p++)a["$"+l[p]]=!0;for(l=0;l<r.length;l++)p=a.hasOwnProperty("$"+r[l].value),r[l].selected!==p&&(r[l].selected=p),p&&f&&(r[l].defaultSelected=!0)}else{for(l=""+gn(l),a=null,p=0;p<r.length;p++){if(r[p].value===l){r[p].selected=!0,f&&(r[p].defaultSelected=!0);return}a!==null||r[p].disabled||(a=r[p])}a!==null&&(a.selected=!0)}}function Ip(r,a,l){if(a!=null&&(a=""+gn(a),a!==r.value&&(r.value=a),l==null)){r.defaultValue!==a&&(r.defaultValue=a);return}r.defaultValue=l!=null?""+gn(l):""}function Np(r,a,l,f){if(a==null){if(f!=null){if(l!=null)throw Error(i(92));if(Ie(f)){if(1<f.length)throw Error(i(93));f=f[0]}l=f}l==null&&(l=""),a=l}l=gn(a),r.defaultValue=l,f=r.textContent,f===l&&f!==""&&f!==null&&(r.value=f)}function Zs(r,a){if(a){var l=r.firstChild;if(l&&l===r.lastChild&&l.nodeType===3){l.nodeValue=a;return}}r.textContent=a}var ET=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Pp(r,a,l){var f=a.indexOf("--")===0;l==null||typeof l=="boolean"||l===""?f?r.setProperty(a,""):a==="float"?r.cssFloat="":r[a]="":f?r.setProperty(a,l):typeof l!="number"||l===0||ET.has(a)?a==="float"?r.cssFloat=l:r[a]=(""+l).trim():r[a]=l+"px"}function kp(r,a,l){if(a!=null&&typeof a!="object")throw Error(i(62));if(r=r.style,l!=null){for(var f in l)!l.hasOwnProperty(f)||a!=null&&a.hasOwnProperty(f)||(f.indexOf("--")===0?r.setProperty(f,""):f==="float"?r.cssFloat="":r[f]="");for(var p in a)f=a[p],a.hasOwnProperty(p)&&l[p]!==f&&Pp(r,p,f)}else for(var _ in a)a.hasOwnProperty(_)&&Pp(r,_,a[_])}function tu(r){if(r.indexOf("-")===-1)return!1;switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var RT=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),CT=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function ko(r){return CT.test(""+r)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":r}var nu=null;function iu(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var Qs=null,Gs=null;function Dp(r){var a=$s(r);if(a&&(r=a.stateNode)){var l=r[Kt]||null;e:switch(r=a.stateNode,a.type){case"input":if(Jc(r,l.value,l.defaultValue,l.defaultValue,l.checked,l.defaultChecked,l.type,l.name),a=l.name,l.type==="radio"&&a!=null){for(l=r;l.parentNode;)l=l.parentNode;for(l=l.querySelectorAll('input[name="'+_n(""+a)+'"][type="radio"]'),a=0;a<l.length;a++){var f=l[a];if(f!==r&&f.form===r.form){var p=f[Kt]||null;if(!p)throw Error(i(90));Jc(f,p.value,p.defaultValue,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name)}}for(a=0;a<l.length;a++)f=l[a],f.form===r.form&&Mp(f)}break e;case"textarea":Ip(r,l.value,l.defaultValue);break e;case"select":a=l.value,a!=null&&Ks(r,!!l.multiple,a,!1)}}}var su=!1;function Up(r,a,l){if(su)return r(a,l);su=!0;try{var f=r(a);return f}finally{if(su=!1,(Qs!==null||Gs!==null)&&(bl(),Qs&&(a=Qs,r=Gs,Gs=Qs=null,Dp(a),r)))for(a=0;a<r.length;a++)Dp(r[a])}}function oa(r,a){var l=r.stateNode;if(l===null)return null;var f=l[Kt]||null;if(f===null)return null;l=f[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(f=!f.disabled)||(r=r.type,f=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!f;break e;default:r=!1}if(r)return null;if(l&&typeof l!="function")throw Error(i(231,a,typeof l));return l}var ti=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ru=!1;if(ti)try{var la={};Object.defineProperty(la,"passive",{get:function(){ru=!0}}),window.addEventListener("test",la,la),window.removeEventListener("test",la,la)}catch{ru=!1}var Si=null,au=null,Do=null;function Bp(){if(Do)return Do;var r,a=au,l=a.length,f,p="value"in Si?Si.value:Si.textContent,_=p.length;for(r=0;r<l&&a[r]===p[r];r++);var b=l-r;for(f=1;f<=b&&a[l-f]===p[_-f];f++);return Do=p.slice(r,1<f?1-f:void 0)}function Uo(r){var a=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&a===13&&(r=13)):r=a,r===10&&(r=13),32<=r||r===13?r:0}function Bo(){return!0}function Fp(){return!1}function Zt(r){function a(l,f,p,_,b){this._reactName=l,this._targetInst=p,this.type=f,this.nativeEvent=_,this.target=b,this.currentTarget=null;for(var v in r)r.hasOwnProperty(v)&&(l=r[v],this[v]=l?l(_):_[v]);return this.isDefaultPrevented=(_.defaultPrevented!=null?_.defaultPrevented:_.returnValue===!1)?Bo:Fp,this.isPropagationStopped=Fp,this}return g(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var l=this.nativeEvent;l&&(l.preventDefault?l.preventDefault():typeof l.returnValue!="unknown"&&(l.returnValue=!1),this.isDefaultPrevented=Bo)},stopPropagation:function(){var l=this.nativeEvent;l&&(l.stopPropagation?l.stopPropagation():typeof l.cancelBubble!="unknown"&&(l.cancelBubble=!0),this.isPropagationStopped=Bo)},persist:function(){},isPersistent:Bo}),a}var ls={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Fo=Zt(ls),ca=g({},ls,{view:0,detail:0}),MT=Zt(ca),ou,lu,ua,Lo=g({},ca,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:uu,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==ua&&(ua&&r.type==="mousemove"?(ou=r.screenX-ua.screenX,lu=r.screenY-ua.screenY):lu=ou=0,ua=r),ou)},movementY:function(r){return"movementY"in r?r.movementY:lu}}),Lp=Zt(Lo),OT=g({},Lo,{dataTransfer:0}),IT=Zt(OT),NT=g({},ca,{relatedTarget:0}),cu=Zt(NT),PT=g({},ls,{animationName:0,elapsedTime:0,pseudoElement:0}),kT=Zt(PT),DT=g({},ls,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),UT=Zt(DT),BT=g({},ls,{data:0}),zp=Zt(BT),FT={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},LT={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},zT={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function VT(r){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(r):(r=zT[r])?!!a[r]:!1}function uu(){return VT}var jT=g({},ca,{key:function(r){if(r.key){var a=FT[r.key]||r.key;if(a!=="Unidentified")return a}return r.type==="keypress"?(r=Uo(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?LT[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:uu,charCode:function(r){return r.type==="keypress"?Uo(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?Uo(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),HT=Zt(jT),WT=g({},Lo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Vp=Zt(WT),$T=g({},ca,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:uu}),XT=Zt($T),YT=g({},ls,{propertyName:0,elapsedTime:0,pseudoElement:0}),qT=Zt(YT),KT=g({},Lo,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),ZT=Zt(KT),QT=g({},ls,{newState:0,oldState:0}),GT=Zt(QT),JT=[9,13,27,32],fu=ti&&"CompositionEvent"in window,fa=null;ti&&"documentMode"in document&&(fa=document.documentMode);var e2=ti&&"TextEvent"in window&&!fa,jp=ti&&(!fu||fa&&8<fa&&11>=fa),Hp=" ",Wp=!1;function $p(r,a){switch(r){case"keyup":return JT.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Xp(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var Js=!1;function t2(r,a){switch(r){case"compositionend":return Xp(a);case"keypress":return a.which!==32?null:(Wp=!0,Hp);case"textInput":return r=a.data,r===Hp&&Wp?null:r;default:return null}}function n2(r,a){if(Js)return r==="compositionend"||!fu&&$p(r,a)?(r=Bp(),Do=au=Si=null,Js=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return jp&&a.locale!=="ko"?null:a.data;default:return null}}var i2={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Yp(r){var a=r&&r.nodeName&&r.nodeName.toLowerCase();return a==="input"?!!i2[r.type]:a==="textarea"}function qp(r,a,l,f){Qs?Gs?Gs.push(f):Gs=[f]:Qs=f,a=Al(a,"onChange"),0<a.length&&(l=new Fo("onChange","change",null,l,f),r.push({event:l,listeners:a}))}var ha=null,da=null;function s2(r){Cm(r,0)}function zo(r){var a=aa(r);if(Mp(a))return r}function Kp(r,a){if(r==="change")return a}var Zp=!1;if(ti){var hu;if(ti){var du="oninput"in document;if(!du){var Qp=document.createElement("div");Qp.setAttribute("oninput","return;"),du=typeof Qp.oninput=="function"}hu=du}else hu=!1;Zp=hu&&(!document.documentMode||9<document.documentMode)}function Gp(){ha&&(ha.detachEvent("onpropertychange",Jp),da=ha=null)}function Jp(r){if(r.propertyName==="value"&&zo(da)){var a=[];qp(a,da,r,iu(r)),Up(s2,a)}}function r2(r,a,l){r==="focusin"?(Gp(),ha=a,da=l,ha.attachEvent("onpropertychange",Jp)):r==="focusout"&&Gp()}function a2(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return zo(da)}function o2(r,a){if(r==="click")return zo(a)}function l2(r,a){if(r==="input"||r==="change")return zo(a)}function c2(r,a){return r===a&&(r!==0||1/r===1/a)||r!==r&&a!==a}var en=typeof Object.is=="function"?Object.is:c2;function pa(r,a){if(en(r,a))return!0;if(typeof r!="object"||r===null||typeof a!="object"||a===null)return!1;var l=Object.keys(r),f=Object.keys(a);if(l.length!==f.length)return!1;for(f=0;f<l.length;f++){var p=l[f];if(!it.call(a,p)||!en(r[p],a[p]))return!1}return!0}function eg(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function tg(r,a){var l=eg(r);r=0;for(var f;l;){if(l.nodeType===3){if(f=r+l.textContent.length,r<=a&&f>=a)return{node:l,offset:a-r};r=f}e:{for(;l;){if(l.nextSibling){l=l.nextSibling;break e}l=l.parentNode}l=void 0}l=eg(l)}}function ng(r,a){return r&&a?r===a?!0:r&&r.nodeType===3?!1:a&&a.nodeType===3?ng(r,a.parentNode):"contains"in r?r.contains(a):r.compareDocumentPosition?!!(r.compareDocumentPosition(a)&16):!1:!1}function ig(r){r=r!=null&&r.ownerDocument!=null&&r.ownerDocument.defaultView!=null?r.ownerDocument.defaultView:window;for(var a=Po(r.document);a instanceof r.HTMLIFrameElement;){try{var l=typeof a.contentWindow.location.href=="string"}catch{l=!1}if(l)r=a.contentWindow;else break;a=Po(r.document)}return a}function pu(r){var a=r&&r.nodeName&&r.nodeName.toLowerCase();return a&&(a==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||a==="textarea"||r.contentEditable==="true")}var u2=ti&&"documentMode"in document&&11>=document.documentMode,er=null,gu=null,ga=null,_u=!1;function sg(r,a,l){var f=l.window===l?l.document:l.nodeType===9?l:l.ownerDocument;_u||er==null||er!==Po(f)||(f=er,"selectionStart"in f&&pu(f)?f={start:f.selectionStart,end:f.selectionEnd}:(f=(f.ownerDocument&&f.ownerDocument.defaultView||window).getSelection(),f={anchorNode:f.anchorNode,anchorOffset:f.anchorOffset,focusNode:f.focusNode,focusOffset:f.focusOffset}),ga&&pa(ga,f)||(ga=f,f=Al(gu,"onSelect"),0<f.length&&(a=new Fo("onSelect","select",null,a,l),r.push({event:a,listeners:f}),a.target=er)))}function cs(r,a){var l={};return l[r.toLowerCase()]=a.toLowerCase(),l["Webkit"+r]="webkit"+a,l["Moz"+r]="moz"+a,l}var tr={animationend:cs("Animation","AnimationEnd"),animationiteration:cs("Animation","AnimationIteration"),animationstart:cs("Animation","AnimationStart"),transitionrun:cs("Transition","TransitionRun"),transitionstart:cs("Transition","TransitionStart"),transitioncancel:cs("Transition","TransitionCancel"),transitionend:cs("Transition","TransitionEnd")},mu={},rg={};ti&&(rg=document.createElement("div").style,"AnimationEvent"in window||(delete tr.animationend.animation,delete tr.animationiteration.animation,delete tr.animationstart.animation),"TransitionEvent"in window||delete tr.transitionend.transition);function us(r){if(mu[r])return mu[r];if(!tr[r])return r;var a=tr[r],l;for(l in a)if(a.hasOwnProperty(l)&&l in rg)return mu[r]=a[l];return r}var ag=us("animationend"),og=us("animationiteration"),lg=us("animationstart"),f2=us("transitionrun"),h2=us("transitionstart"),d2=us("transitioncancel"),cg=us("transitionend"),ug=new Map,yu="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");yu.push("scrollEnd");function Nn(r,a){ug.set(r,a),os(a,[r])}var fg=new WeakMap;function mn(r,a){if(typeof r=="object"&&r!==null){var l=fg.get(r);return l!==void 0?l:(a={value:r,source:a,stack:Rp(a)},fg.set(r,a),a)}return{value:r,source:a,stack:Rp(a)}}var yn=[],nr=0,bu=0;function Vo(){for(var r=nr,a=bu=nr=0;a<r;){var l=yn[a];yn[a++]=null;var f=yn[a];yn[a++]=null;var p=yn[a];yn[a++]=null;var _=yn[a];if(yn[a++]=null,f!==null&&p!==null){var b=f.pending;b===null?p.next=p:(p.next=b.next,b.next=p),f.pending=p}_!==0&&hg(l,p,_)}}function jo(r,a,l,f){yn[nr++]=r,yn[nr++]=a,yn[nr++]=l,yn[nr++]=f,bu|=f,r.lanes|=f,r=r.alternate,r!==null&&(r.lanes|=f)}function vu(r,a,l,f){return jo(r,a,l,f),Ho(r)}function ir(r,a){return jo(r,null,null,a),Ho(r)}function hg(r,a,l){r.lanes|=l;var f=r.alternate;f!==null&&(f.lanes|=l);for(var p=!1,_=r.return;_!==null;)_.childLanes|=l,f=_.alternate,f!==null&&(f.childLanes|=l),_.tag===22&&(r=_.stateNode,r===null||r._visibility&1||(p=!0)),r=_,_=_.return;return r.tag===3?(_=r.stateNode,p&&a!==null&&(p=31-Dt(l),r=_.hiddenUpdates,f=r[p],f===null?r[p]=[a]:f.push(a),a.lane=l|536870912),_):null}function Ho(r){if(50<za)throw za=0,Rf=null,Error(i(185));for(var a=r.return;a!==null;)r=a,a=r.return;return r.tag===3?r.stateNode:null}var sr={};function p2(r,a,l,f){this.tag=r,this.key=l,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=f,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function tn(r,a,l,f){return new p2(r,a,l,f)}function Tu(r){return r=r.prototype,!(!r||!r.isReactComponent)}function ni(r,a){var l=r.alternate;return l===null?(l=tn(r.tag,a,r.key,r.mode),l.elementType=r.elementType,l.type=r.type,l.stateNode=r.stateNode,l.alternate=r,r.alternate=l):(l.pendingProps=a,l.type=r.type,l.flags=0,l.subtreeFlags=0,l.deletions=null),l.flags=r.flags&65011712,l.childLanes=r.childLanes,l.lanes=r.lanes,l.child=r.child,l.memoizedProps=r.memoizedProps,l.memoizedState=r.memoizedState,l.updateQueue=r.updateQueue,a=r.dependencies,l.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},l.sibling=r.sibling,l.index=r.index,l.ref=r.ref,l.refCleanup=r.refCleanup,l}function dg(r,a){r.flags&=65011714;var l=r.alternate;return l===null?(r.childLanes=0,r.lanes=a,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=l.childLanes,r.lanes=l.lanes,r.child=l.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=l.memoizedProps,r.memoizedState=l.memoizedState,r.updateQueue=l.updateQueue,r.type=l.type,a=l.dependencies,r.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),r}function Wo(r,a,l,f,p,_){var b=0;if(f=r,typeof r=="function")Tu(r)&&(b=1);else if(typeof r=="string")b=_1(r,l,de.current)?26:r==="html"||r==="head"||r==="body"?27:5;else e:switch(r){case R:return r=tn(31,l,a,p),r.elementType=R,r.lanes=_,r;case w:return fs(l.children,p,_,a);case C:b=8,p|=24;break;case N:return r=tn(12,l,a,p|2),r.elementType=N,r.lanes=_,r;case H:return r=tn(13,l,a,p),r.elementType=H,r.lanes=_,r;case te:return r=tn(19,l,a,p),r.elementType=te,r.lanes=_,r;default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case V:case O:b=10;break e;case $:b=9;break e;case F:b=11;break e;case oe:b=14;break e;case E:b=16,f=null;break e}b=29,l=Error(i(130,r===null?"null":typeof r,"")),f=null}return a=tn(b,l,a,p),a.elementType=r,a.type=f,a.lanes=_,a}function fs(r,a,l,f){return r=tn(7,r,f,a),r.lanes=l,r}function xu(r,a,l){return r=tn(6,r,null,a),r.lanes=l,r}function Su(r,a,l){return a=tn(4,r.children!==null?r.children:[],r.key,a),a.lanes=l,a.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},a}var rr=[],ar=0,$o=null,Xo=0,bn=[],vn=0,hs=null,ii=1,si="";function ds(r,a){rr[ar++]=Xo,rr[ar++]=$o,$o=r,Xo=a}function pg(r,a,l){bn[vn++]=ii,bn[vn++]=si,bn[vn++]=hs,hs=r;var f=ii;r=si;var p=32-Dt(f)-1;f&=~(1<<p),l+=1;var _=32-Dt(a)+p;if(30<_){var b=p-p%5;_=(f&(1<<b)-1).toString(32),f>>=b,p-=b,ii=1<<32-Dt(a)+p|l<<p|f,si=_+r}else ii=1<<_|l<<p|f,si=r}function wu(r){r.return!==null&&(ds(r,1),pg(r,1,0))}function Au(r){for(;r===$o;)$o=rr[--ar],rr[ar]=null,Xo=rr[--ar],rr[ar]=null;for(;r===hs;)hs=bn[--vn],bn[vn]=null,si=bn[--vn],bn[vn]=null,ii=bn[--vn],bn[vn]=null}var Yt=null,dt=null,ze=!1,ps=null,Vn=!1,Eu=Error(i(519));function gs(r){var a=Error(i(418,""));throw ya(mn(a,r)),Eu}function gg(r){var a=r.stateNode,l=r.type,f=r.memoizedProps;switch(a[Lt]=r,a[Kt]=f,l){case"dialog":De("cancel",a),De("close",a);break;case"iframe":case"object":case"embed":De("load",a);break;case"video":case"audio":for(l=0;l<ja.length;l++)De(ja[l],a);break;case"source":De("error",a);break;case"img":case"image":case"link":De("error",a),De("load",a);break;case"details":De("toggle",a);break;case"input":De("invalid",a),Op(a,f.value,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name,!0),No(a);break;case"select":De("invalid",a);break;case"textarea":De("invalid",a),Np(a,f.value,f.defaultValue,f.children),No(a)}l=f.children,typeof l!="string"&&typeof l!="number"&&typeof l!="bigint"||a.textContent===""+l||f.suppressHydrationWarning===!0||Nm(a.textContent,l)?(f.popover!=null&&(De("beforetoggle",a),De("toggle",a)),f.onScroll!=null&&De("scroll",a),f.onScrollEnd!=null&&De("scrollend",a),f.onClick!=null&&(a.onclick=El),a=!0):a=!1,a||gs(r)}function _g(r){for(Yt=r.return;Yt;)switch(Yt.tag){case 5:case 13:Vn=!1;return;case 27:case 3:Vn=!0;return;default:Yt=Yt.return}}function _a(r){if(r!==Yt)return!1;if(!ze)return _g(r),ze=!0,!1;var a=r.tag,l;if((l=a!==3&&a!==27)&&((l=a===5)&&(l=r.type,l=!(l!=="form"&&l!=="button")||Hf(r.type,r.memoizedProps)),l=!l),l&&dt&&gs(r),_g(r),a===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(i(317));e:{for(r=r.nextSibling,a=0;r;){if(r.nodeType===8)if(l=r.data,l==="/$"){if(a===0){dt=kn(r.nextSibling);break e}a--}else l!=="$"&&l!=="$!"&&l!=="$?"||a++;r=r.nextSibling}dt=null}}else a===27?(a=dt,Li(r.type)?(r=Yf,Yf=null,dt=r):dt=a):dt=Yt?kn(r.stateNode.nextSibling):null;return!0}function ma(){dt=Yt=null,ze=!1}function mg(){var r=ps;return r!==null&&(Jt===null?Jt=r:Jt.push.apply(Jt,r),ps=null),r}function ya(r){ps===null?ps=[r]:ps.push(r)}var Ru=q(null),_s=null,ri=null;function wi(r,a,l){Z(Ru,a._currentValue),a._currentValue=l}function ai(r){r._currentValue=Ru.current,se(Ru)}function Cu(r,a,l){for(;r!==null;){var f=r.alternate;if((r.childLanes&a)!==a?(r.childLanes|=a,f!==null&&(f.childLanes|=a)):f!==null&&(f.childLanes&a)!==a&&(f.childLanes|=a),r===l)break;r=r.return}}function Mu(r,a,l,f){var p=r.child;for(p!==null&&(p.return=r);p!==null;){var _=p.dependencies;if(_!==null){var b=p.child;_=_.firstContext;e:for(;_!==null;){var v=_;_=p;for(var A=0;A<a.length;A++)if(v.context===a[A]){_.lanes|=l,v=_.alternate,v!==null&&(v.lanes|=l),Cu(_.return,l,r),f||(b=null);break e}_=v.next}}else if(p.tag===18){if(b=p.return,b===null)throw Error(i(341));b.lanes|=l,_=b.alternate,_!==null&&(_.lanes|=l),Cu(b,l,r),b=null}else b=p.child;if(b!==null)b.return=p;else for(b=p;b!==null;){if(b===r){b=null;break}if(p=b.sibling,p!==null){p.return=b.return,b=p;break}b=b.return}p=b}}function ba(r,a,l,f){r=null;for(var p=a,_=!1;p!==null;){if(!_){if((p.flags&524288)!==0)_=!0;else if((p.flags&262144)!==0)break}if(p.tag===10){var b=p.alternate;if(b===null)throw Error(i(387));if(b=b.memoizedProps,b!==null){var v=p.type;en(p.pendingProps.value,b.value)||(r!==null?r.push(v):r=[v])}}else if(p===tt.current){if(b=p.alternate,b===null)throw Error(i(387));b.memoizedState.memoizedState!==p.memoizedState.memoizedState&&(r!==null?r.push(qa):r=[qa])}p=p.return}r!==null&&Mu(a,r,l,f),a.flags|=262144}function Yo(r){for(r=r.firstContext;r!==null;){if(!en(r.context._currentValue,r.memoizedValue))return!0;r=r.next}return!1}function ms(r){_s=r,ri=null,r=r.dependencies,r!==null&&(r.firstContext=null)}function zt(r){return yg(_s,r)}function qo(r,a){return _s===null&&ms(r),yg(r,a)}function yg(r,a){var l=a._currentValue;if(a={context:a,memoizedValue:l,next:null},ri===null){if(r===null)throw Error(i(308));ri=a,r.dependencies={lanes:0,firstContext:a},r.flags|=524288}else ri=ri.next=a;return l}var g2=typeof AbortController<"u"?AbortController:function(){var r=[],a=this.signal={aborted:!1,addEventListener:function(l,f){r.push(f)}};this.abort=function(){a.aborted=!0,r.forEach(function(l){return l()})}},_2=n.unstable_scheduleCallback,m2=n.unstable_NormalPriority,wt={$$typeof:O,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Ou(){return{controller:new g2,data:new Map,refCount:0}}function va(r){r.refCount--,r.refCount===0&&_2(m2,function(){r.controller.abort()})}var Ta=null,Iu=0,or=0,lr=null;function y2(r,a){if(Ta===null){var l=Ta=[];Iu=0,or=kf(),lr={status:"pending",value:void 0,then:function(f){l.push(f)}}}return Iu++,a.then(bg,bg),a}function bg(){if(--Iu===0&&Ta!==null){lr!==null&&(lr.status="fulfilled");var r=Ta;Ta=null,or=0,lr=null;for(var a=0;a<r.length;a++)(0,r[a])()}}function b2(r,a){var l=[],f={status:"pending",value:null,reason:null,then:function(p){l.push(p)}};return r.then(function(){f.status="fulfilled",f.value=a;for(var p=0;p<l.length;p++)(0,l[p])(a)},function(p){for(f.status="rejected",f.reason=p,p=0;p<l.length;p++)(0,l[p])(void 0)}),f}var vg=K.S;K.S=function(r,a){typeof a=="object"&&a!==null&&typeof a.then=="function"&&y2(r,a),vg!==null&&vg(r,a)};var ys=q(null);function Nu(){var r=ys.current;return r!==null?r:rt.pooledCache}function Ko(r,a){a===null?Z(ys,ys.current):Z(ys,a.pool)}function Tg(){var r=Nu();return r===null?null:{parent:wt._currentValue,pool:r}}var xa=Error(i(460)),xg=Error(i(474)),Zo=Error(i(542)),Pu={then:function(){}};function Sg(r){return r=r.status,r==="fulfilled"||r==="rejected"}function Qo(){}function wg(r,a,l){switch(l=r[l],l===void 0?r.push(a):l!==a&&(a.then(Qo,Qo),a=l),a.status){case"fulfilled":return a.value;case"rejected":throw r=a.reason,Eg(r),r;default:if(typeof a.status=="string")a.then(Qo,Qo);else{if(r=rt,r!==null&&100<r.shellSuspendCounter)throw Error(i(482));r=a,r.status="pending",r.then(function(f){if(a.status==="pending"){var p=a;p.status="fulfilled",p.value=f}},function(f){if(a.status==="pending"){var p=a;p.status="rejected",p.reason=f}})}switch(a.status){case"fulfilled":return a.value;case"rejected":throw r=a.reason,Eg(r),r}throw Sa=a,xa}}var Sa=null;function Ag(){if(Sa===null)throw Error(i(459));var r=Sa;return Sa=null,r}function Eg(r){if(r===xa||r===Zo)throw Error(i(483))}var Ai=!1;function ku(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Du(r,a){r=r.updateQueue,a.updateQueue===r&&(a.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,callbacks:null})}function Ei(r){return{lane:r,tag:0,payload:null,callback:null,next:null}}function Ri(r,a,l){var f=r.updateQueue;if(f===null)return null;if(f=f.shared,(He&2)!==0){var p=f.pending;return p===null?a.next=a:(a.next=p.next,p.next=a),f.pending=a,a=Ho(r),hg(r,null,l),a}return jo(r,f,a,l),Ho(r)}function wa(r,a,l){if(a=a.updateQueue,a!==null&&(a=a.shared,(l&4194048)!==0)){var f=a.lanes;f&=r.pendingLanes,l|=f,a.lanes=l,bp(r,l)}}function Uu(r,a){var l=r.updateQueue,f=r.alternate;if(f!==null&&(f=f.updateQueue,l===f)){var p=null,_=null;if(l=l.firstBaseUpdate,l!==null){do{var b={lane:l.lane,tag:l.tag,payload:l.payload,callback:null,next:null};_===null?p=_=b:_=_.next=b,l=l.next}while(l!==null);_===null?p=_=a:_=_.next=a}else p=_=a;l={baseState:f.baseState,firstBaseUpdate:p,lastBaseUpdate:_,shared:f.shared,callbacks:f.callbacks},r.updateQueue=l;return}r=l.lastBaseUpdate,r===null?l.firstBaseUpdate=a:r.next=a,l.lastBaseUpdate=a}var Bu=!1;function Aa(){if(Bu){var r=lr;if(r!==null)throw r}}function Ea(r,a,l,f){Bu=!1;var p=r.updateQueue;Ai=!1;var _=p.firstBaseUpdate,b=p.lastBaseUpdate,v=p.shared.pending;if(v!==null){p.shared.pending=null;var A=v,j=A.next;A.next=null,b===null?_=j:b.next=j,b=A;var Q=r.alternate;Q!==null&&(Q=Q.updateQueue,v=Q.lastBaseUpdate,v!==b&&(v===null?Q.firstBaseUpdate=j:v.next=j,Q.lastBaseUpdate=A))}if(_!==null){var ee=p.baseState;b=0,Q=j=A=null,v=_;do{var W=v.lane&-536870913,X=W!==v.lane;if(X?(Be&W)===W:(f&W)===W){W!==0&&W===or&&(Bu=!0),Q!==null&&(Q=Q.next={lane:0,tag:v.tag,payload:v.payload,callback:null,next:null});e:{var Ae=r,Te=v;W=a;var Ke=l;switch(Te.tag){case 1:if(Ae=Te.payload,typeof Ae=="function"){ee=Ae.call(Ke,ee,W);break e}ee=Ae;break e;case 3:Ae.flags=Ae.flags&-65537|128;case 0:if(Ae=Te.payload,W=typeof Ae=="function"?Ae.call(Ke,ee,W):Ae,W==null)break e;ee=g({},ee,W);break e;case 2:Ai=!0}}W=v.callback,W!==null&&(r.flags|=64,X&&(r.flags|=8192),X=p.callbacks,X===null?p.callbacks=[W]:X.push(W))}else X={lane:W,tag:v.tag,payload:v.payload,callback:v.callback,next:null},Q===null?(j=Q=X,A=ee):Q=Q.next=X,b|=W;if(v=v.next,v===null){if(v=p.shared.pending,v===null)break;X=v,v=X.next,X.next=null,p.lastBaseUpdate=X,p.shared.pending=null}}while(!0);Q===null&&(A=ee),p.baseState=A,p.firstBaseUpdate=j,p.lastBaseUpdate=Q,_===null&&(p.shared.lanes=0),Di|=b,r.lanes=b,r.memoizedState=ee}}function Rg(r,a){if(typeof r!="function")throw Error(i(191,r));r.call(a)}function Cg(r,a){var l=r.callbacks;if(l!==null)for(r.callbacks=null,r=0;r<l.length;r++)Rg(l[r],a)}var cr=q(null),Go=q(0);function Mg(r,a){r=di,Z(Go,r),Z(cr,a),di=r|a.baseLanes}function Fu(){Z(Go,di),Z(cr,cr.current)}function Lu(){di=Go.current,se(cr),se(Go)}var Ci=0,Oe=null,Ye=null,bt=null,Jo=!1,ur=!1,bs=!1,el=0,Ra=0,fr=null,v2=0;function mt(){throw Error(i(321))}function zu(r,a){if(a===null)return!1;for(var l=0;l<a.length&&l<r.length;l++)if(!en(r[l],a[l]))return!1;return!0}function Vu(r,a,l,f,p,_){return Ci=_,Oe=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,K.H=r===null||r.memoizedState===null?h_:d_,bs=!1,_=l(f,p),bs=!1,ur&&(_=Ig(a,l,f,p)),Og(r),_}function Og(r){K.H=al;var a=Ye!==null&&Ye.next!==null;if(Ci=0,bt=Ye=Oe=null,Jo=!1,Ra=0,fr=null,a)throw Error(i(300));r===null||It||(r=r.dependencies,r!==null&&Yo(r)&&(It=!0))}function Ig(r,a,l,f){Oe=r;var p=0;do{if(ur&&(fr=null),Ra=0,ur=!1,25<=p)throw Error(i(301));if(p+=1,bt=Ye=null,r.updateQueue!=null){var _=r.updateQueue;_.lastEffect=null,_.events=null,_.stores=null,_.memoCache!=null&&(_.memoCache.index=0)}K.H=R2,_=a(l,f)}while(ur);return _}function T2(){var r=K.H,a=r.useState()[0];return a=typeof a.then=="function"?Ca(a):a,r=r.useState()[0],(Ye!==null?Ye.memoizedState:null)!==r&&(Oe.flags|=1024),a}function ju(){var r=el!==0;return el=0,r}function Hu(r,a,l){a.updateQueue=r.updateQueue,a.flags&=-2053,r.lanes&=~l}function Wu(r){if(Jo){for(r=r.memoizedState;r!==null;){var a=r.queue;a!==null&&(a.pending=null),r=r.next}Jo=!1}Ci=0,bt=Ye=Oe=null,ur=!1,Ra=el=0,fr=null}function Qt(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return bt===null?Oe.memoizedState=bt=r:bt=bt.next=r,bt}function vt(){if(Ye===null){var r=Oe.alternate;r=r!==null?r.memoizedState:null}else r=Ye.next;var a=bt===null?Oe.memoizedState:bt.next;if(a!==null)bt=a,Ye=r;else{if(r===null)throw Oe.alternate===null?Error(i(467)):Error(i(310));Ye=r,r={memoizedState:Ye.memoizedState,baseState:Ye.baseState,baseQueue:Ye.baseQueue,queue:Ye.queue,next:null},bt===null?Oe.memoizedState=bt=r:bt=bt.next=r}return bt}function $u(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Ca(r){var a=Ra;return Ra+=1,fr===null&&(fr=[]),r=wg(fr,r,a),a=Oe,(bt===null?a.memoizedState:bt.next)===null&&(a=a.alternate,K.H=a===null||a.memoizedState===null?h_:d_),r}function tl(r){if(r!==null&&typeof r=="object"){if(typeof r.then=="function")return Ca(r);if(r.$$typeof===O)return zt(r)}throw Error(i(438,String(r)))}function Xu(r){var a=null,l=Oe.updateQueue;if(l!==null&&(a=l.memoCache),a==null){var f=Oe.alternate;f!==null&&(f=f.updateQueue,f!==null&&(f=f.memoCache,f!=null&&(a={data:f.data.map(function(p){return p.slice()}),index:0})))}if(a==null&&(a={data:[],index:0}),l===null&&(l=$u(),Oe.updateQueue=l),l.memoCache=a,l=a.data[a.index],l===void 0)for(l=a.data[a.index]=Array(r),f=0;f<r;f++)l[f]=Y;return a.index++,l}function oi(r,a){return typeof a=="function"?a(r):a}function nl(r){var a=vt();return Yu(a,Ye,r)}function Yu(r,a,l){var f=r.queue;if(f===null)throw Error(i(311));f.lastRenderedReducer=l;var p=r.baseQueue,_=f.pending;if(_!==null){if(p!==null){var b=p.next;p.next=_.next,_.next=b}a.baseQueue=p=_,f.pending=null}if(_=r.baseState,p===null)r.memoizedState=_;else{a=p.next;var v=b=null,A=null,j=a,Q=!1;do{var ee=j.lane&-536870913;if(ee!==j.lane?(Be&ee)===ee:(Ci&ee)===ee){var W=j.revertLane;if(W===0)A!==null&&(A=A.next={lane:0,revertLane:0,action:j.action,hasEagerState:j.hasEagerState,eagerState:j.eagerState,next:null}),ee===or&&(Q=!0);else if((Ci&W)===W){j=j.next,W===or&&(Q=!0);continue}else ee={lane:0,revertLane:j.revertLane,action:j.action,hasEagerState:j.hasEagerState,eagerState:j.eagerState,next:null},A===null?(v=A=ee,b=_):A=A.next=ee,Oe.lanes|=W,Di|=W;ee=j.action,bs&&l(_,ee),_=j.hasEagerState?j.eagerState:l(_,ee)}else W={lane:ee,revertLane:j.revertLane,action:j.action,hasEagerState:j.hasEagerState,eagerState:j.eagerState,next:null},A===null?(v=A=W,b=_):A=A.next=W,Oe.lanes|=ee,Di|=ee;j=j.next}while(j!==null&&j!==a);if(A===null?b=_:A.next=v,!en(_,r.memoizedState)&&(It=!0,Q&&(l=lr,l!==null)))throw l;r.memoizedState=_,r.baseState=b,r.baseQueue=A,f.lastRenderedState=_}return p===null&&(f.lanes=0),[r.memoizedState,f.dispatch]}function qu(r){var a=vt(),l=a.queue;if(l===null)throw Error(i(311));l.lastRenderedReducer=r;var f=l.dispatch,p=l.pending,_=a.memoizedState;if(p!==null){l.pending=null;var b=p=p.next;do _=r(_,b.action),b=b.next;while(b!==p);en(_,a.memoizedState)||(It=!0),a.memoizedState=_,a.baseQueue===null&&(a.baseState=_),l.lastRenderedState=_}return[_,f]}function Ng(r,a,l){var f=Oe,p=vt(),_=ze;if(_){if(l===void 0)throw Error(i(407));l=l()}else l=a();var b=!en((Ye||p).memoizedState,l);b&&(p.memoizedState=l,It=!0),p=p.queue;var v=Dg.bind(null,f,p,r);if(Ma(2048,8,v,[r]),p.getSnapshot!==a||b||bt!==null&&bt.memoizedState.tag&1){if(f.flags|=2048,hr(9,il(),kg.bind(null,f,p,l,a),null),rt===null)throw Error(i(349));_||(Ci&124)!==0||Pg(f,a,l)}return l}function Pg(r,a,l){r.flags|=16384,r={getSnapshot:a,value:l},a=Oe.updateQueue,a===null?(a=$u(),Oe.updateQueue=a,a.stores=[r]):(l=a.stores,l===null?a.stores=[r]:l.push(r))}function kg(r,a,l,f){a.value=l,a.getSnapshot=f,Ug(a)&&Bg(r)}function Dg(r,a,l){return l(function(){Ug(a)&&Bg(r)})}function Ug(r){var a=r.getSnapshot;r=r.value;try{var l=a();return!en(r,l)}catch{return!0}}function Bg(r){var a=ir(r,2);a!==null&&on(a,r,2)}function Ku(r){var a=Qt();if(typeof r=="function"){var l=r;if(r=l(),bs){Mt(!0);try{l()}finally{Mt(!1)}}}return a.memoizedState=a.baseState=r,a.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:oi,lastRenderedState:r},a}function Fg(r,a,l,f){return r.baseState=l,Yu(r,Ye,typeof f=="function"?f:oi)}function x2(r,a,l,f,p){if(rl(r))throw Error(i(485));if(r=a.action,r!==null){var _={payload:p,action:r,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(b){_.listeners.push(b)}};K.T!==null?l(!0):_.isTransition=!1,f(_),l=a.pending,l===null?(_.next=a.pending=_,Lg(a,_)):(_.next=l.next,a.pending=l.next=_)}}function Lg(r,a){var l=a.action,f=a.payload,p=r.state;if(a.isTransition){var _=K.T,b={};K.T=b;try{var v=l(p,f),A=K.S;A!==null&&A(b,v),zg(r,a,v)}catch(j){Zu(r,a,j)}finally{K.T=_}}else try{_=l(p,f),zg(r,a,_)}catch(j){Zu(r,a,j)}}function zg(r,a,l){l!==null&&typeof l=="object"&&typeof l.then=="function"?l.then(function(f){Vg(r,a,f)},function(f){return Zu(r,a,f)}):Vg(r,a,l)}function Vg(r,a,l){a.status="fulfilled",a.value=l,jg(a),r.state=l,a=r.pending,a!==null&&(l=a.next,l===a?r.pending=null:(l=l.next,a.next=l,Lg(r,l)))}function Zu(r,a,l){var f=r.pending;if(r.pending=null,f!==null){f=f.next;do a.status="rejected",a.reason=l,jg(a),a=a.next;while(a!==f)}r.action=null}function jg(r){r=r.listeners;for(var a=0;a<r.length;a++)(0,r[a])()}function Hg(r,a){return a}function Wg(r,a){if(ze){var l=rt.formState;if(l!==null){e:{var f=Oe;if(ze){if(dt){t:{for(var p=dt,_=Vn;p.nodeType!==8;){if(!_){p=null;break t}if(p=kn(p.nextSibling),p===null){p=null;break t}}_=p.data,p=_==="F!"||_==="F"?p:null}if(p){dt=kn(p.nextSibling),f=p.data==="F!";break e}}gs(f)}f=!1}f&&(a=l[0])}}return l=Qt(),l.memoizedState=l.baseState=a,f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Hg,lastRenderedState:a},l.queue=f,l=c_.bind(null,Oe,f),f.dispatch=l,f=Ku(!1),_=tf.bind(null,Oe,!1,f.queue),f=Qt(),p={state:a,dispatch:null,action:r,pending:null},f.queue=p,l=x2.bind(null,Oe,p,_,l),p.dispatch=l,f.memoizedState=r,[a,l,!1]}function $g(r){var a=vt();return Xg(a,Ye,r)}function Xg(r,a,l){if(a=Yu(r,a,Hg)[0],r=nl(oi)[0],typeof a=="object"&&a!==null&&typeof a.then=="function")try{var f=Ca(a)}catch(b){throw b===xa?Zo:b}else f=a;a=vt();var p=a.queue,_=p.dispatch;return l!==a.memoizedState&&(Oe.flags|=2048,hr(9,il(),S2.bind(null,p,l),null)),[f,_,r]}function S2(r,a){r.action=a}function Yg(r){var a=vt(),l=Ye;if(l!==null)return Xg(a,l,r);vt(),a=a.memoizedState,l=vt();var f=l.queue.dispatch;return l.memoizedState=r,[a,f,!1]}function hr(r,a,l,f){return r={tag:r,create:l,deps:f,inst:a,next:null},a=Oe.updateQueue,a===null&&(a=$u(),Oe.updateQueue=a),l=a.lastEffect,l===null?a.lastEffect=r.next=r:(f=l.next,l.next=r,r.next=f,a.lastEffect=r),r}function il(){return{destroy:void 0,resource:void 0}}function qg(){return vt().memoizedState}function sl(r,a,l,f){var p=Qt();f=f===void 0?null:f,Oe.flags|=r,p.memoizedState=hr(1|a,il(),l,f)}function Ma(r,a,l,f){var p=vt();f=f===void 0?null:f;var _=p.memoizedState.inst;Ye!==null&&f!==null&&zu(f,Ye.memoizedState.deps)?p.memoizedState=hr(a,_,l,f):(Oe.flags|=r,p.memoizedState=hr(1|a,_,l,f))}function Kg(r,a){sl(8390656,8,r,a)}function Zg(r,a){Ma(2048,8,r,a)}function Qg(r,a){return Ma(4,2,r,a)}function Gg(r,a){return Ma(4,4,r,a)}function Jg(r,a){if(typeof a=="function"){r=r();var l=a(r);return function(){typeof l=="function"?l():a(null)}}if(a!=null)return r=r(),a.current=r,function(){a.current=null}}function e_(r,a,l){l=l!=null?l.concat([r]):null,Ma(4,4,Jg.bind(null,a,r),l)}function Qu(){}function t_(r,a){var l=vt();a=a===void 0?null:a;var f=l.memoizedState;return a!==null&&zu(a,f[1])?f[0]:(l.memoizedState=[r,a],r)}function n_(r,a){var l=vt();a=a===void 0?null:a;var f=l.memoizedState;if(a!==null&&zu(a,f[1]))return f[0];if(f=r(),bs){Mt(!0);try{r()}finally{Mt(!1)}}return l.memoizedState=[f,a],f}function Gu(r,a,l){return l===void 0||(Ci&1073741824)!==0?r.memoizedState=a:(r.memoizedState=l,r=rm(),Oe.lanes|=r,Di|=r,l)}function i_(r,a,l,f){return en(l,a)?l:cr.current!==null?(r=Gu(r,l,f),en(r,a)||(It=!0),r):(Ci&42)===0?(It=!0,r.memoizedState=l):(r=rm(),Oe.lanes|=r,Di|=r,a)}function s_(r,a,l,f,p){var _=ne.p;ne.p=_!==0&&8>_?_:8;var b=K.T,v={};K.T=v,tf(r,!1,a,l);try{var A=p(),j=K.S;if(j!==null&&j(v,A),A!==null&&typeof A=="object"&&typeof A.then=="function"){var Q=b2(A,f);Oa(r,a,Q,an(r))}else Oa(r,a,f,an(r))}catch(ee){Oa(r,a,{then:function(){},status:"rejected",reason:ee},an())}finally{ne.p=_,K.T=b}}function w2(){}function Ju(r,a,l,f){if(r.tag!==5)throw Error(i(476));var p=r_(r).queue;s_(r,p,a,fe,l===null?w2:function(){return a_(r),l(f)})}function r_(r){var a=r.memoizedState;if(a!==null)return a;a={memoizedState:fe,baseState:fe,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:oi,lastRenderedState:fe},next:null};var l={};return a.next={memoizedState:l,baseState:l,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:oi,lastRenderedState:l},next:null},r.memoizedState=a,r=r.alternate,r!==null&&(r.memoizedState=a),a}function a_(r){var a=r_(r).next.queue;Oa(r,a,{},an())}function ef(){return zt(qa)}function o_(){return vt().memoizedState}function l_(){return vt().memoizedState}function A2(r){for(var a=r.return;a!==null;){switch(a.tag){case 24:case 3:var l=an();r=Ei(l);var f=Ri(a,r,l);f!==null&&(on(f,a,l),wa(f,a,l)),a={cache:Ou()},r.payload=a;return}a=a.return}}function E2(r,a,l){var f=an();l={lane:f,revertLane:0,action:l,hasEagerState:!1,eagerState:null,next:null},rl(r)?u_(a,l):(l=vu(r,a,l,f),l!==null&&(on(l,r,f),f_(l,a,f)))}function c_(r,a,l){var f=an();Oa(r,a,l,f)}function Oa(r,a,l,f){var p={lane:f,revertLane:0,action:l,hasEagerState:!1,eagerState:null,next:null};if(rl(r))u_(a,p);else{var _=r.alternate;if(r.lanes===0&&(_===null||_.lanes===0)&&(_=a.lastRenderedReducer,_!==null))try{var b=a.lastRenderedState,v=_(b,l);if(p.hasEagerState=!0,p.eagerState=v,en(v,b))return jo(r,a,p,0),rt===null&&Vo(),!1}catch{}finally{}if(l=vu(r,a,p,f),l!==null)return on(l,r,f),f_(l,a,f),!0}return!1}function tf(r,a,l,f){if(f={lane:2,revertLane:kf(),action:f,hasEagerState:!1,eagerState:null,next:null},rl(r)){if(a)throw Error(i(479))}else a=vu(r,l,f,2),a!==null&&on(a,r,2)}function rl(r){var a=r.alternate;return r===Oe||a!==null&&a===Oe}function u_(r,a){ur=Jo=!0;var l=r.pending;l===null?a.next=a:(a.next=l.next,l.next=a),r.pending=a}function f_(r,a,l){if((l&4194048)!==0){var f=a.lanes;f&=r.pendingLanes,l|=f,a.lanes=l,bp(r,l)}}var al={readContext:zt,use:tl,useCallback:mt,useContext:mt,useEffect:mt,useImperativeHandle:mt,useLayoutEffect:mt,useInsertionEffect:mt,useMemo:mt,useReducer:mt,useRef:mt,useState:mt,useDebugValue:mt,useDeferredValue:mt,useTransition:mt,useSyncExternalStore:mt,useId:mt,useHostTransitionStatus:mt,useFormState:mt,useActionState:mt,useOptimistic:mt,useMemoCache:mt,useCacheRefresh:mt},h_={readContext:zt,use:tl,useCallback:function(r,a){return Qt().memoizedState=[r,a===void 0?null:a],r},useContext:zt,useEffect:Kg,useImperativeHandle:function(r,a,l){l=l!=null?l.concat([r]):null,sl(4194308,4,Jg.bind(null,a,r),l)},useLayoutEffect:function(r,a){return sl(4194308,4,r,a)},useInsertionEffect:function(r,a){sl(4,2,r,a)},useMemo:function(r,a){var l=Qt();a=a===void 0?null:a;var f=r();if(bs){Mt(!0);try{r()}finally{Mt(!1)}}return l.memoizedState=[f,a],f},useReducer:function(r,a,l){var f=Qt();if(l!==void 0){var p=l(a);if(bs){Mt(!0);try{l(a)}finally{Mt(!1)}}}else p=a;return f.memoizedState=f.baseState=p,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:p},f.queue=r,r=r.dispatch=E2.bind(null,Oe,r),[f.memoizedState,r]},useRef:function(r){var a=Qt();return r={current:r},a.memoizedState=r},useState:function(r){r=Ku(r);var a=r.queue,l=c_.bind(null,Oe,a);return a.dispatch=l,[r.memoizedState,l]},useDebugValue:Qu,useDeferredValue:function(r,a){var l=Qt();return Gu(l,r,a)},useTransition:function(){var r=Ku(!1);return r=s_.bind(null,Oe,r.queue,!0,!1),Qt().memoizedState=r,[!1,r]},useSyncExternalStore:function(r,a,l){var f=Oe,p=Qt();if(ze){if(l===void 0)throw Error(i(407));l=l()}else{if(l=a(),rt===null)throw Error(i(349));(Be&124)!==0||Pg(f,a,l)}p.memoizedState=l;var _={value:l,getSnapshot:a};return p.queue=_,Kg(Dg.bind(null,f,_,r),[r]),f.flags|=2048,hr(9,il(),kg.bind(null,f,_,l,a),null),l},useId:function(){var r=Qt(),a=rt.identifierPrefix;if(ze){var l=si,f=ii;l=(f&~(1<<32-Dt(f)-1)).toString(32)+l,a="«"+a+"R"+l,l=el++,0<l&&(a+="H"+l.toString(32)),a+="»"}else l=v2++,a="«"+a+"r"+l.toString(32)+"»";return r.memoizedState=a},useHostTransitionStatus:ef,useFormState:Wg,useActionState:Wg,useOptimistic:function(r){var a=Qt();a.memoizedState=a.baseState=r;var l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return a.queue=l,a=tf.bind(null,Oe,!0,l),l.dispatch=a,[r,a]},useMemoCache:Xu,useCacheRefresh:function(){return Qt().memoizedState=A2.bind(null,Oe)}},d_={readContext:zt,use:tl,useCallback:t_,useContext:zt,useEffect:Zg,useImperativeHandle:e_,useInsertionEffect:Qg,useLayoutEffect:Gg,useMemo:n_,useReducer:nl,useRef:qg,useState:function(){return nl(oi)},useDebugValue:Qu,useDeferredValue:function(r,a){var l=vt();return i_(l,Ye.memoizedState,r,a)},useTransition:function(){var r=nl(oi)[0],a=vt().memoizedState;return[typeof r=="boolean"?r:Ca(r),a]},useSyncExternalStore:Ng,useId:o_,useHostTransitionStatus:ef,useFormState:$g,useActionState:$g,useOptimistic:function(r,a){var l=vt();return Fg(l,Ye,r,a)},useMemoCache:Xu,useCacheRefresh:l_},R2={readContext:zt,use:tl,useCallback:t_,useContext:zt,useEffect:Zg,useImperativeHandle:e_,useInsertionEffect:Qg,useLayoutEffect:Gg,useMemo:n_,useReducer:qu,useRef:qg,useState:function(){return qu(oi)},useDebugValue:Qu,useDeferredValue:function(r,a){var l=vt();return Ye===null?Gu(l,r,a):i_(l,Ye.memoizedState,r,a)},useTransition:function(){var r=qu(oi)[0],a=vt().memoizedState;return[typeof r=="boolean"?r:Ca(r),a]},useSyncExternalStore:Ng,useId:o_,useHostTransitionStatus:ef,useFormState:Yg,useActionState:Yg,useOptimistic:function(r,a){var l=vt();return Ye!==null?Fg(l,Ye,r,a):(l.baseState=r,[r,l.queue.dispatch])},useMemoCache:Xu,useCacheRefresh:l_},dr=null,Ia=0;function ol(r){var a=Ia;return Ia+=1,dr===null&&(dr=[]),wg(dr,r,a)}function Na(r,a){a=a.props.ref,r.ref=a!==void 0?a:null}function ll(r,a){throw a.$$typeof===m?Error(i(525)):(r=Object.prototype.toString.call(a),Error(i(31,r==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":r)))}function p_(r){var a=r._init;return a(r._payload)}function g_(r){function a(U,I){if(r){var z=U.deletions;z===null?(U.deletions=[I],U.flags|=16):z.push(I)}}function l(U,I){if(!r)return null;for(;I!==null;)a(U,I),I=I.sibling;return null}function f(U){for(var I=new Map;U!==null;)U.key!==null?I.set(U.key,U):I.set(U.index,U),U=U.sibling;return I}function p(U,I){return U=ni(U,I),U.index=0,U.sibling=null,U}function _(U,I,z){return U.index=z,r?(z=U.alternate,z!==null?(z=z.index,z<I?(U.flags|=67108866,I):z):(U.flags|=67108866,I)):(U.flags|=1048576,I)}function b(U){return r&&U.alternate===null&&(U.flags|=67108866),U}function v(U,I,z,G){return I===null||I.tag!==6?(I=xu(z,U.mode,G),I.return=U,I):(I=p(I,z),I.return=U,I)}function A(U,I,z,G){var ge=z.type;return ge===w?Q(U,I,z.props.children,G,z.key):I!==null&&(I.elementType===ge||typeof ge=="object"&&ge!==null&&ge.$$typeof===E&&p_(ge)===I.type)?(I=p(I,z.props),Na(I,z),I.return=U,I):(I=Wo(z.type,z.key,z.props,null,U.mode,G),Na(I,z),I.return=U,I)}function j(U,I,z,G){return I===null||I.tag!==4||I.stateNode.containerInfo!==z.containerInfo||I.stateNode.implementation!==z.implementation?(I=Su(z,U.mode,G),I.return=U,I):(I=p(I,z.children||[]),I.return=U,I)}function Q(U,I,z,G,ge){return I===null||I.tag!==7?(I=fs(z,U.mode,G,ge),I.return=U,I):(I=p(I,z),I.return=U,I)}function ee(U,I,z){if(typeof I=="string"&&I!==""||typeof I=="number"||typeof I=="bigint")return I=xu(""+I,U.mode,z),I.return=U,I;if(typeof I=="object"&&I!==null){switch(I.$$typeof){case y:return z=Wo(I.type,I.key,I.props,null,U.mode,z),Na(z,I),z.return=U,z;case T:return I=Su(I,U.mode,z),I.return=U,I;case E:var G=I._init;return I=G(I._payload),ee(U,I,z)}if(Ie(I)||re(I))return I=fs(I,U.mode,z,null),I.return=U,I;if(typeof I.then=="function")return ee(U,ol(I),z);if(I.$$typeof===O)return ee(U,qo(U,I),z);ll(U,I)}return null}function W(U,I,z,G){var ge=I!==null?I.key:null;if(typeof z=="string"&&z!==""||typeof z=="number"||typeof z=="bigint")return ge!==null?null:v(U,I,""+z,G);if(typeof z=="object"&&z!==null){switch(z.$$typeof){case y:return z.key===ge?A(U,I,z,G):null;case T:return z.key===ge?j(U,I,z,G):null;case E:return ge=z._init,z=ge(z._payload),W(U,I,z,G)}if(Ie(z)||re(z))return ge!==null?null:Q(U,I,z,G,null);if(typeof z.then=="function")return W(U,I,ol(z),G);if(z.$$typeof===O)return W(U,I,qo(U,z),G);ll(U,z)}return null}function X(U,I,z,G,ge){if(typeof G=="string"&&G!==""||typeof G=="number"||typeof G=="bigint")return U=U.get(z)||null,v(I,U,""+G,ge);if(typeof G=="object"&&G!==null){switch(G.$$typeof){case y:return U=U.get(G.key===null?z:G.key)||null,A(I,U,G,ge);case T:return U=U.get(G.key===null?z:G.key)||null,j(I,U,G,ge);case E:var Ne=G._init;return G=Ne(G._payload),X(U,I,z,G,ge)}if(Ie(G)||re(G))return U=U.get(z)||null,Q(I,U,G,ge,null);if(typeof G.then=="function")return X(U,I,z,ol(G),ge);if(G.$$typeof===O)return X(U,I,z,qo(I,G),ge);ll(I,G)}return null}function Ae(U,I,z,G){for(var ge=null,Ne=null,ye=I,xe=I=0,Pt=null;ye!==null&&xe<z.length;xe++){ye.index>xe?(Pt=ye,ye=null):Pt=ye.sibling;var Fe=W(U,ye,z[xe],G);if(Fe===null){ye===null&&(ye=Pt);break}r&&ye&&Fe.alternate===null&&a(U,ye),I=_(Fe,I,xe),Ne===null?ge=Fe:Ne.sibling=Fe,Ne=Fe,ye=Pt}if(xe===z.length)return l(U,ye),ze&&ds(U,xe),ge;if(ye===null){for(;xe<z.length;xe++)ye=ee(U,z[xe],G),ye!==null&&(I=_(ye,I,xe),Ne===null?ge=ye:Ne.sibling=ye,Ne=ye);return ze&&ds(U,xe),ge}for(ye=f(ye);xe<z.length;xe++)Pt=X(ye,U,xe,z[xe],G),Pt!==null&&(r&&Pt.alternate!==null&&ye.delete(Pt.key===null?xe:Pt.key),I=_(Pt,I,xe),Ne===null?ge=Pt:Ne.sibling=Pt,Ne=Pt);return r&&ye.forEach(function(Wi){return a(U,Wi)}),ze&&ds(U,xe),ge}function Te(U,I,z,G){if(z==null)throw Error(i(151));for(var ge=null,Ne=null,ye=I,xe=I=0,Pt=null,Fe=z.next();ye!==null&&!Fe.done;xe++,Fe=z.next()){ye.index>xe?(Pt=ye,ye=null):Pt=ye.sibling;var Wi=W(U,ye,Fe.value,G);if(Wi===null){ye===null&&(ye=Pt);break}r&&ye&&Wi.alternate===null&&a(U,ye),I=_(Wi,I,xe),Ne===null?ge=Wi:Ne.sibling=Wi,Ne=Wi,ye=Pt}if(Fe.done)return l(U,ye),ze&&ds(U,xe),ge;if(ye===null){for(;!Fe.done;xe++,Fe=z.next())Fe=ee(U,Fe.value,G),Fe!==null&&(I=_(Fe,I,xe),Ne===null?ge=Fe:Ne.sibling=Fe,Ne=Fe);return ze&&ds(U,xe),ge}for(ye=f(ye);!Fe.done;xe++,Fe=z.next())Fe=X(ye,U,xe,Fe.value,G),Fe!==null&&(r&&Fe.alternate!==null&&ye.delete(Fe.key===null?xe:Fe.key),I=_(Fe,I,xe),Ne===null?ge=Fe:Ne.sibling=Fe,Ne=Fe);return r&&ye.forEach(function(C1){return a(U,C1)}),ze&&ds(U,xe),ge}function Ke(U,I,z,G){if(typeof z=="object"&&z!==null&&z.type===w&&z.key===null&&(z=z.props.children),typeof z=="object"&&z!==null){switch(z.$$typeof){case y:e:{for(var ge=z.key;I!==null;){if(I.key===ge){if(ge=z.type,ge===w){if(I.tag===7){l(U,I.sibling),G=p(I,z.props.children),G.return=U,U=G;break e}}else if(I.elementType===ge||typeof ge=="object"&&ge!==null&&ge.$$typeof===E&&p_(ge)===I.type){l(U,I.sibling),G=p(I,z.props),Na(G,z),G.return=U,U=G;break e}l(U,I);break}else a(U,I);I=I.sibling}z.type===w?(G=fs(z.props.children,U.mode,G,z.key),G.return=U,U=G):(G=Wo(z.type,z.key,z.props,null,U.mode,G),Na(G,z),G.return=U,U=G)}return b(U);case T:e:{for(ge=z.key;I!==null;){if(I.key===ge)if(I.tag===4&&I.stateNode.containerInfo===z.containerInfo&&I.stateNode.implementation===z.implementation){l(U,I.sibling),G=p(I,z.children||[]),G.return=U,U=G;break e}else{l(U,I);break}else a(U,I);I=I.sibling}G=Su(z,U.mode,G),G.return=U,U=G}return b(U);case E:return ge=z._init,z=ge(z._payload),Ke(U,I,z,G)}if(Ie(z))return Ae(U,I,z,G);if(re(z)){if(ge=re(z),typeof ge!="function")throw Error(i(150));return z=ge.call(z),Te(U,I,z,G)}if(typeof z.then=="function")return Ke(U,I,ol(z),G);if(z.$$typeof===O)return Ke(U,I,qo(U,z),G);ll(U,z)}return typeof z=="string"&&z!==""||typeof z=="number"||typeof z=="bigint"?(z=""+z,I!==null&&I.tag===6?(l(U,I.sibling),G=p(I,z),G.return=U,U=G):(l(U,I),G=xu(z,U.mode,G),G.return=U,U=G),b(U)):l(U,I)}return function(U,I,z,G){try{Ia=0;var ge=Ke(U,I,z,G);return dr=null,ge}catch(ye){if(ye===xa||ye===Zo)throw ye;var Ne=tn(29,ye,null,U.mode);return Ne.lanes=G,Ne.return=U,Ne}finally{}}}var pr=g_(!0),__=g_(!1),Tn=q(null),jn=null;function Mi(r){var a=r.alternate;Z(At,At.current&1),Z(Tn,r),jn===null&&(a===null||cr.current!==null||a.memoizedState!==null)&&(jn=r)}function m_(r){if(r.tag===22){if(Z(At,At.current),Z(Tn,r),jn===null){var a=r.alternate;a!==null&&a.memoizedState!==null&&(jn=r)}}else Oi()}function Oi(){Z(At,At.current),Z(Tn,Tn.current)}function li(r){se(Tn),jn===r&&(jn=null),se(At)}var At=q(0);function cl(r){for(var a=r;a!==null;){if(a.tag===13){var l=a.memoizedState;if(l!==null&&(l=l.dehydrated,l===null||l.data==="$?"||Xf(l)))return a}else if(a.tag===19&&a.memoizedProps.revealOrder!==void 0){if((a.flags&128)!==0)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===r)break;for(;a.sibling===null;){if(a.return===null||a.return===r)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}function nf(r,a,l,f){a=r.memoizedState,l=l(f,a),l=l==null?a:g({},a,l),r.memoizedState=l,r.lanes===0&&(r.updateQueue.baseState=l)}var sf={enqueueSetState:function(r,a,l){r=r._reactInternals;var f=an(),p=Ei(f);p.payload=a,l!=null&&(p.callback=l),a=Ri(r,p,f),a!==null&&(on(a,r,f),wa(a,r,f))},enqueueReplaceState:function(r,a,l){r=r._reactInternals;var f=an(),p=Ei(f);p.tag=1,p.payload=a,l!=null&&(p.callback=l),a=Ri(r,p,f),a!==null&&(on(a,r,f),wa(a,r,f))},enqueueForceUpdate:function(r,a){r=r._reactInternals;var l=an(),f=Ei(l);f.tag=2,a!=null&&(f.callback=a),a=Ri(r,f,l),a!==null&&(on(a,r,l),wa(a,r,l))}};function y_(r,a,l,f,p,_,b){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(f,_,b):a.prototype&&a.prototype.isPureReactComponent?!pa(l,f)||!pa(p,_):!0}function b_(r,a,l,f){r=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(l,f),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(l,f),a.state!==r&&sf.enqueueReplaceState(a,a.state,null)}function vs(r,a){var l=a;if("ref"in a){l={};for(var f in a)f!=="ref"&&(l[f]=a[f])}if(r=r.defaultProps){l===a&&(l=g({},l));for(var p in r)l[p]===void 0&&(l[p]=r[p])}return l}var ul=typeof reportError=="function"?reportError:function(r){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var a=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof r=="object"&&r!==null&&typeof r.message=="string"?String(r.message):String(r),error:r});if(!window.dispatchEvent(a))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",r);return}console.error(r)};function v_(r){ul(r)}function T_(r){console.error(r)}function x_(r){ul(r)}function fl(r,a){try{var l=r.onUncaughtError;l(a.value,{componentStack:a.stack})}catch(f){setTimeout(function(){throw f})}}function S_(r,a,l){try{var f=r.onCaughtError;f(l.value,{componentStack:l.stack,errorBoundary:a.tag===1?a.stateNode:null})}catch(p){setTimeout(function(){throw p})}}function rf(r,a,l){return l=Ei(l),l.tag=3,l.payload={element:null},l.callback=function(){fl(r,a)},l}function w_(r){return r=Ei(r),r.tag=3,r}function A_(r,a,l,f){var p=l.type.getDerivedStateFromError;if(typeof p=="function"){var _=f.value;r.payload=function(){return p(_)},r.callback=function(){S_(a,l,f)}}var b=l.stateNode;b!==null&&typeof b.componentDidCatch=="function"&&(r.callback=function(){S_(a,l,f),typeof p!="function"&&(Ui===null?Ui=new Set([this]):Ui.add(this));var v=f.stack;this.componentDidCatch(f.value,{componentStack:v!==null?v:""})})}function C2(r,a,l,f,p){if(l.flags|=32768,f!==null&&typeof f=="object"&&typeof f.then=="function"){if(a=l.alternate,a!==null&&ba(a,l,p,!0),l=Tn.current,l!==null){switch(l.tag){case 13:return jn===null?Mf():l.alternate===null&&pt===0&&(pt=3),l.flags&=-257,l.flags|=65536,l.lanes=p,f===Pu?l.flags|=16384:(a=l.updateQueue,a===null?l.updateQueue=new Set([f]):a.add(f),If(r,f,p)),!1;case 22:return l.flags|=65536,f===Pu?l.flags|=16384:(a=l.updateQueue,a===null?(a={transitions:null,markerInstances:null,retryQueue:new Set([f])},l.updateQueue=a):(l=a.retryQueue,l===null?a.retryQueue=new Set([f]):l.add(f)),If(r,f,p)),!1}throw Error(i(435,l.tag))}return If(r,f,p),Mf(),!1}if(ze)return a=Tn.current,a!==null?((a.flags&65536)===0&&(a.flags|=256),a.flags|=65536,a.lanes=p,f!==Eu&&(r=Error(i(422),{cause:f}),ya(mn(r,l)))):(f!==Eu&&(a=Error(i(423),{cause:f}),ya(mn(a,l))),r=r.current.alternate,r.flags|=65536,p&=-p,r.lanes|=p,f=mn(f,l),p=rf(r.stateNode,f,p),Uu(r,p),pt!==4&&(pt=2)),!1;var _=Error(i(520),{cause:f});if(_=mn(_,l),La===null?La=[_]:La.push(_),pt!==4&&(pt=2),a===null)return!0;f=mn(f,l),l=a;do{switch(l.tag){case 3:return l.flags|=65536,r=p&-p,l.lanes|=r,r=rf(l.stateNode,f,r),Uu(l,r),!1;case 1:if(a=l.type,_=l.stateNode,(l.flags&128)===0&&(typeof a.getDerivedStateFromError=="function"||_!==null&&typeof _.componentDidCatch=="function"&&(Ui===null||!Ui.has(_))))return l.flags|=65536,p&=-p,l.lanes|=p,p=w_(p),A_(p,r,l,f),Uu(l,p),!1}l=l.return}while(l!==null);return!1}var E_=Error(i(461)),It=!1;function Ut(r,a,l,f){a.child=r===null?__(a,null,l,f):pr(a,r.child,l,f)}function R_(r,a,l,f,p){l=l.render;var _=a.ref;if("ref"in f){var b={};for(var v in f)v!=="ref"&&(b[v]=f[v])}else b=f;return ms(a),f=Vu(r,a,l,b,_,p),v=ju(),r!==null&&!It?(Hu(r,a,p),ci(r,a,p)):(ze&&v&&wu(a),a.flags|=1,Ut(r,a,f,p),a.child)}function C_(r,a,l,f,p){if(r===null){var _=l.type;return typeof _=="function"&&!Tu(_)&&_.defaultProps===void 0&&l.compare===null?(a.tag=15,a.type=_,M_(r,a,_,f,p)):(r=Wo(l.type,null,f,a,a.mode,p),r.ref=a.ref,r.return=a,a.child=r)}if(_=r.child,!df(r,p)){var b=_.memoizedProps;if(l=l.compare,l=l!==null?l:pa,l(b,f)&&r.ref===a.ref)return ci(r,a,p)}return a.flags|=1,r=ni(_,f),r.ref=a.ref,r.return=a,a.child=r}function M_(r,a,l,f,p){if(r!==null){var _=r.memoizedProps;if(pa(_,f)&&r.ref===a.ref)if(It=!1,a.pendingProps=f=_,df(r,p))(r.flags&131072)!==0&&(It=!0);else return a.lanes=r.lanes,ci(r,a,p)}return af(r,a,l,f,p)}function O_(r,a,l){var f=a.pendingProps,p=f.children,_=r!==null?r.memoizedState:null;if(f.mode==="hidden"){if((a.flags&128)!==0){if(f=_!==null?_.baseLanes|l:l,r!==null){for(p=a.child=r.child,_=0;p!==null;)_=_|p.lanes|p.childLanes,p=p.sibling;a.childLanes=_&~f}else a.childLanes=0,a.child=null;return I_(r,a,f,l)}if((l&536870912)!==0)a.memoizedState={baseLanes:0,cachePool:null},r!==null&&Ko(a,_!==null?_.cachePool:null),_!==null?Mg(a,_):Fu(),m_(a);else return a.lanes=a.childLanes=536870912,I_(r,a,_!==null?_.baseLanes|l:l,l)}else _!==null?(Ko(a,_.cachePool),Mg(a,_),Oi(),a.memoizedState=null):(r!==null&&Ko(a,null),Fu(),Oi());return Ut(r,a,p,l),a.child}function I_(r,a,l,f){var p=Nu();return p=p===null?null:{parent:wt._currentValue,pool:p},a.memoizedState={baseLanes:l,cachePool:p},r!==null&&Ko(a,null),Fu(),m_(a),r!==null&&ba(r,a,f,!0),null}function hl(r,a){var l=a.ref;if(l===null)r!==null&&r.ref!==null&&(a.flags|=4194816);else{if(typeof l!="function"&&typeof l!="object")throw Error(i(284));(r===null||r.ref!==l)&&(a.flags|=4194816)}}function af(r,a,l,f,p){return ms(a),l=Vu(r,a,l,f,void 0,p),f=ju(),r!==null&&!It?(Hu(r,a,p),ci(r,a,p)):(ze&&f&&wu(a),a.flags|=1,Ut(r,a,l,p),a.child)}function N_(r,a,l,f,p,_){return ms(a),a.updateQueue=null,l=Ig(a,f,l,p),Og(r),f=ju(),r!==null&&!It?(Hu(r,a,_),ci(r,a,_)):(ze&&f&&wu(a),a.flags|=1,Ut(r,a,l,_),a.child)}function P_(r,a,l,f,p){if(ms(a),a.stateNode===null){var _=sr,b=l.contextType;typeof b=="object"&&b!==null&&(_=zt(b)),_=new l(f,_),a.memoizedState=_.state!==null&&_.state!==void 0?_.state:null,_.updater=sf,a.stateNode=_,_._reactInternals=a,_=a.stateNode,_.props=f,_.state=a.memoizedState,_.refs={},ku(a),b=l.contextType,_.context=typeof b=="object"&&b!==null?zt(b):sr,_.state=a.memoizedState,b=l.getDerivedStateFromProps,typeof b=="function"&&(nf(a,l,b,f),_.state=a.memoizedState),typeof l.getDerivedStateFromProps=="function"||typeof _.getSnapshotBeforeUpdate=="function"||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(b=_.state,typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount(),b!==_.state&&sf.enqueueReplaceState(_,_.state,null),Ea(a,f,_,p),Aa(),_.state=a.memoizedState),typeof _.componentDidMount=="function"&&(a.flags|=4194308),f=!0}else if(r===null){_=a.stateNode;var v=a.memoizedProps,A=vs(l,v);_.props=A;var j=_.context,Q=l.contextType;b=sr,typeof Q=="object"&&Q!==null&&(b=zt(Q));var ee=l.getDerivedStateFromProps;Q=typeof ee=="function"||typeof _.getSnapshotBeforeUpdate=="function",v=a.pendingProps!==v,Q||typeof _.UNSAFE_componentWillReceiveProps!="function"&&typeof _.componentWillReceiveProps!="function"||(v||j!==b)&&b_(a,_,f,b),Ai=!1;var W=a.memoizedState;_.state=W,Ea(a,f,_,p),Aa(),j=a.memoizedState,v||W!==j||Ai?(typeof ee=="function"&&(nf(a,l,ee,f),j=a.memoizedState),(A=Ai||y_(a,l,A,f,W,j,b))?(Q||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount()),typeof _.componentDidMount=="function"&&(a.flags|=4194308)):(typeof _.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=f,a.memoizedState=j),_.props=f,_.state=j,_.context=b,f=A):(typeof _.componentDidMount=="function"&&(a.flags|=4194308),f=!1)}else{_=a.stateNode,Du(r,a),b=a.memoizedProps,Q=vs(l,b),_.props=Q,ee=a.pendingProps,W=_.context,j=l.contextType,A=sr,typeof j=="object"&&j!==null&&(A=zt(j)),v=l.getDerivedStateFromProps,(j=typeof v=="function"||typeof _.getSnapshotBeforeUpdate=="function")||typeof _.UNSAFE_componentWillReceiveProps!="function"&&typeof _.componentWillReceiveProps!="function"||(b!==ee||W!==A)&&b_(a,_,f,A),Ai=!1,W=a.memoizedState,_.state=W,Ea(a,f,_,p),Aa();var X=a.memoizedState;b!==ee||W!==X||Ai||r!==null&&r.dependencies!==null&&Yo(r.dependencies)?(typeof v=="function"&&(nf(a,l,v,f),X=a.memoizedState),(Q=Ai||y_(a,l,Q,f,W,X,A)||r!==null&&r.dependencies!==null&&Yo(r.dependencies))?(j||typeof _.UNSAFE_componentWillUpdate!="function"&&typeof _.componentWillUpdate!="function"||(typeof _.componentWillUpdate=="function"&&_.componentWillUpdate(f,X,A),typeof _.UNSAFE_componentWillUpdate=="function"&&_.UNSAFE_componentWillUpdate(f,X,A)),typeof _.componentDidUpdate=="function"&&(a.flags|=4),typeof _.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof _.componentDidUpdate!="function"||b===r.memoizedProps&&W===r.memoizedState||(a.flags|=4),typeof _.getSnapshotBeforeUpdate!="function"||b===r.memoizedProps&&W===r.memoizedState||(a.flags|=1024),a.memoizedProps=f,a.memoizedState=X),_.props=f,_.state=X,_.context=A,f=Q):(typeof _.componentDidUpdate!="function"||b===r.memoizedProps&&W===r.memoizedState||(a.flags|=4),typeof _.getSnapshotBeforeUpdate!="function"||b===r.memoizedProps&&W===r.memoizedState||(a.flags|=1024),f=!1)}return _=f,hl(r,a),f=(a.flags&128)!==0,_||f?(_=a.stateNode,l=f&&typeof l.getDerivedStateFromError!="function"?null:_.render(),a.flags|=1,r!==null&&f?(a.child=pr(a,r.child,null,p),a.child=pr(a,null,l,p)):Ut(r,a,l,p),a.memoizedState=_.state,r=a.child):r=ci(r,a,p),r}function k_(r,a,l,f){return ma(),a.flags|=256,Ut(r,a,l,f),a.child}var of={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function lf(r){return{baseLanes:r,cachePool:Tg()}}function cf(r,a,l){return r=r!==null?r.childLanes&~l:0,a&&(r|=xn),r}function D_(r,a,l){var f=a.pendingProps,p=!1,_=(a.flags&128)!==0,b;if((b=_)||(b=r!==null&&r.memoizedState===null?!1:(At.current&2)!==0),b&&(p=!0,a.flags&=-129),b=(a.flags&32)!==0,a.flags&=-33,r===null){if(ze){if(p?Mi(a):Oi(),ze){var v=dt,A;if(A=v){e:{for(A=v,v=Vn;A.nodeType!==8;){if(!v){v=null;break e}if(A=kn(A.nextSibling),A===null){v=null;break e}}v=A}v!==null?(a.memoizedState={dehydrated:v,treeContext:hs!==null?{id:ii,overflow:si}:null,retryLane:536870912,hydrationErrors:null},A=tn(18,null,null,0),A.stateNode=v,A.return=a,a.child=A,Yt=a,dt=null,A=!0):A=!1}A||gs(a)}if(v=a.memoizedState,v!==null&&(v=v.dehydrated,v!==null))return Xf(v)?a.lanes=32:a.lanes=536870912,null;li(a)}return v=f.children,f=f.fallback,p?(Oi(),p=a.mode,v=dl({mode:"hidden",children:v},p),f=fs(f,p,l,null),v.return=a,f.return=a,v.sibling=f,a.child=v,p=a.child,p.memoizedState=lf(l),p.childLanes=cf(r,b,l),a.memoizedState=of,f):(Mi(a),uf(a,v))}if(A=r.memoizedState,A!==null&&(v=A.dehydrated,v!==null)){if(_)a.flags&256?(Mi(a),a.flags&=-257,a=ff(r,a,l)):a.memoizedState!==null?(Oi(),a.child=r.child,a.flags|=128,a=null):(Oi(),p=f.fallback,v=a.mode,f=dl({mode:"visible",children:f.children},v),p=fs(p,v,l,null),p.flags|=2,f.return=a,p.return=a,f.sibling=p,a.child=f,pr(a,r.child,null,l),f=a.child,f.memoizedState=lf(l),f.childLanes=cf(r,b,l),a.memoizedState=of,a=p);else if(Mi(a),Xf(v)){if(b=v.nextSibling&&v.nextSibling.dataset,b)var j=b.dgst;b=j,f=Error(i(419)),f.stack="",f.digest=b,ya({value:f,source:null,stack:null}),a=ff(r,a,l)}else if(It||ba(r,a,l,!1),b=(l&r.childLanes)!==0,It||b){if(b=rt,b!==null&&(f=l&-l,f=(f&42)!==0?1:Xc(f),f=(f&(b.suspendedLanes|l))!==0?0:f,f!==0&&f!==A.retryLane))throw A.retryLane=f,ir(r,f),on(b,r,f),E_;v.data==="$?"||Mf(),a=ff(r,a,l)}else v.data==="$?"?(a.flags|=192,a.child=r.child,a=null):(r=A.treeContext,dt=kn(v.nextSibling),Yt=a,ze=!0,ps=null,Vn=!1,r!==null&&(bn[vn++]=ii,bn[vn++]=si,bn[vn++]=hs,ii=r.id,si=r.overflow,hs=a),a=uf(a,f.children),a.flags|=4096);return a}return p?(Oi(),p=f.fallback,v=a.mode,A=r.child,j=A.sibling,f=ni(A,{mode:"hidden",children:f.children}),f.subtreeFlags=A.subtreeFlags&65011712,j!==null?p=ni(j,p):(p=fs(p,v,l,null),p.flags|=2),p.return=a,f.return=a,f.sibling=p,a.child=f,f=p,p=a.child,v=r.child.memoizedState,v===null?v=lf(l):(A=v.cachePool,A!==null?(j=wt._currentValue,A=A.parent!==j?{parent:j,pool:j}:A):A=Tg(),v={baseLanes:v.baseLanes|l,cachePool:A}),p.memoizedState=v,p.childLanes=cf(r,b,l),a.memoizedState=of,f):(Mi(a),l=r.child,r=l.sibling,l=ni(l,{mode:"visible",children:f.children}),l.return=a,l.sibling=null,r!==null&&(b=a.deletions,b===null?(a.deletions=[r],a.flags|=16):b.push(r)),a.child=l,a.memoizedState=null,l)}function uf(r,a){return a=dl({mode:"visible",children:a},r.mode),a.return=r,r.child=a}function dl(r,a){return r=tn(22,r,null,a),r.lanes=0,r.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},r}function ff(r,a,l){return pr(a,r.child,null,l),r=uf(a,a.pendingProps.children),r.flags|=2,a.memoizedState=null,r}function U_(r,a,l){r.lanes|=a;var f=r.alternate;f!==null&&(f.lanes|=a),Cu(r.return,a,l)}function hf(r,a,l,f,p){var _=r.memoizedState;_===null?r.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:f,tail:l,tailMode:p}:(_.isBackwards=a,_.rendering=null,_.renderingStartTime=0,_.last=f,_.tail=l,_.tailMode=p)}function B_(r,a,l){var f=a.pendingProps,p=f.revealOrder,_=f.tail;if(Ut(r,a,f.children,l),f=At.current,(f&2)!==0)f=f&1|2,a.flags|=128;else{if(r!==null&&(r.flags&128)!==0)e:for(r=a.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&U_(r,l,a);else if(r.tag===19)U_(r,l,a);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===a)break e;for(;r.sibling===null;){if(r.return===null||r.return===a)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}f&=1}switch(Z(At,f),p){case"forwards":for(l=a.child,p=null;l!==null;)r=l.alternate,r!==null&&cl(r)===null&&(p=l),l=l.sibling;l=p,l===null?(p=a.child,a.child=null):(p=l.sibling,l.sibling=null),hf(a,!1,p,l,_);break;case"backwards":for(l=null,p=a.child,a.child=null;p!==null;){if(r=p.alternate,r!==null&&cl(r)===null){a.child=p;break}r=p.sibling,p.sibling=l,l=p,p=r}hf(a,!0,l,null,_);break;case"together":hf(a,!1,null,null,void 0);break;default:a.memoizedState=null}return a.child}function ci(r,a,l){if(r!==null&&(a.dependencies=r.dependencies),Di|=a.lanes,(l&a.childLanes)===0)if(r!==null){if(ba(r,a,l,!1),(l&a.childLanes)===0)return null}else return null;if(r!==null&&a.child!==r.child)throw Error(i(153));if(a.child!==null){for(r=a.child,l=ni(r,r.pendingProps),a.child=l,l.return=a;r.sibling!==null;)r=r.sibling,l=l.sibling=ni(r,r.pendingProps),l.return=a;l.sibling=null}return a.child}function df(r,a){return(r.lanes&a)!==0?!0:(r=r.dependencies,!!(r!==null&&Yo(r)))}function M2(r,a,l){switch(a.tag){case 3:me(a,a.stateNode.containerInfo),wi(a,wt,r.memoizedState.cache),ma();break;case 27:case 5:nt(a);break;case 4:me(a,a.stateNode.containerInfo);break;case 10:wi(a,a.type,a.memoizedProps.value);break;case 13:var f=a.memoizedState;if(f!==null)return f.dehydrated!==null?(Mi(a),a.flags|=128,null):(l&a.child.childLanes)!==0?D_(r,a,l):(Mi(a),r=ci(r,a,l),r!==null?r.sibling:null);Mi(a);break;case 19:var p=(r.flags&128)!==0;if(f=(l&a.childLanes)!==0,f||(ba(r,a,l,!1),f=(l&a.childLanes)!==0),p){if(f)return B_(r,a,l);a.flags|=128}if(p=a.memoizedState,p!==null&&(p.rendering=null,p.tail=null,p.lastEffect=null),Z(At,At.current),f)break;return null;case 22:case 23:return a.lanes=0,O_(r,a,l);case 24:wi(a,wt,r.memoizedState.cache)}return ci(r,a,l)}function F_(r,a,l){if(r!==null)if(r.memoizedProps!==a.pendingProps)It=!0;else{if(!df(r,l)&&(a.flags&128)===0)return It=!1,M2(r,a,l);It=(r.flags&131072)!==0}else It=!1,ze&&(a.flags&1048576)!==0&&pg(a,Xo,a.index);switch(a.lanes=0,a.tag){case 16:e:{r=a.pendingProps;var f=a.elementType,p=f._init;if(f=p(f._payload),a.type=f,typeof f=="function")Tu(f)?(r=vs(f,r),a.tag=1,a=P_(null,a,f,r,l)):(a.tag=0,a=af(null,a,f,r,l));else{if(f!=null){if(p=f.$$typeof,p===F){a.tag=11,a=R_(null,a,f,r,l);break e}else if(p===oe){a.tag=14,a=C_(null,a,f,r,l);break e}}throw a=be(f)||f,Error(i(306,a,""))}}return a;case 0:return af(r,a,a.type,a.pendingProps,l);case 1:return f=a.type,p=vs(f,a.pendingProps),P_(r,a,f,p,l);case 3:e:{if(me(a,a.stateNode.containerInfo),r===null)throw Error(i(387));f=a.pendingProps;var _=a.memoizedState;p=_.element,Du(r,a),Ea(a,f,null,l);var b=a.memoizedState;if(f=b.cache,wi(a,wt,f),f!==_.cache&&Mu(a,[wt],l,!0),Aa(),f=b.element,_.isDehydrated)if(_={element:f,isDehydrated:!1,cache:b.cache},a.updateQueue.baseState=_,a.memoizedState=_,a.flags&256){a=k_(r,a,f,l);break e}else if(f!==p){p=mn(Error(i(424)),a),ya(p),a=k_(r,a,f,l);break e}else{switch(r=a.stateNode.containerInfo,r.nodeType){case 9:r=r.body;break;default:r=r.nodeName==="HTML"?r.ownerDocument.body:r}for(dt=kn(r.firstChild),Yt=a,ze=!0,ps=null,Vn=!0,l=__(a,null,f,l),a.child=l;l;)l.flags=l.flags&-3|4096,l=l.sibling}else{if(ma(),f===p){a=ci(r,a,l);break e}Ut(r,a,f,l)}a=a.child}return a;case 26:return hl(r,a),r===null?(l=jm(a.type,null,a.pendingProps,null))?a.memoizedState=l:ze||(l=a.type,r=a.pendingProps,f=Rl(_e.current).createElement(l),f[Lt]=a,f[Kt]=r,Ft(f,l,r),Ot(f),a.stateNode=f):a.memoizedState=jm(a.type,r.memoizedProps,a.pendingProps,r.memoizedState),null;case 27:return nt(a),r===null&&ze&&(f=a.stateNode=Lm(a.type,a.pendingProps,_e.current),Yt=a,Vn=!0,p=dt,Li(a.type)?(Yf=p,dt=kn(f.firstChild)):dt=p),Ut(r,a,a.pendingProps.children,l),hl(r,a),r===null&&(a.flags|=4194304),a.child;case 5:return r===null&&ze&&((p=f=dt)&&(f=i1(f,a.type,a.pendingProps,Vn),f!==null?(a.stateNode=f,Yt=a,dt=kn(f.firstChild),Vn=!1,p=!0):p=!1),p||gs(a)),nt(a),p=a.type,_=a.pendingProps,b=r!==null?r.memoizedProps:null,f=_.children,Hf(p,_)?f=null:b!==null&&Hf(p,b)&&(a.flags|=32),a.memoizedState!==null&&(p=Vu(r,a,T2,null,null,l),qa._currentValue=p),hl(r,a),Ut(r,a,f,l),a.child;case 6:return r===null&&ze&&((r=l=dt)&&(l=s1(l,a.pendingProps,Vn),l!==null?(a.stateNode=l,Yt=a,dt=null,r=!0):r=!1),r||gs(a)),null;case 13:return D_(r,a,l);case 4:return me(a,a.stateNode.containerInfo),f=a.pendingProps,r===null?a.child=pr(a,null,f,l):Ut(r,a,f,l),a.child;case 11:return R_(r,a,a.type,a.pendingProps,l);case 7:return Ut(r,a,a.pendingProps,l),a.child;case 8:return Ut(r,a,a.pendingProps.children,l),a.child;case 12:return Ut(r,a,a.pendingProps.children,l),a.child;case 10:return f=a.pendingProps,wi(a,a.type,f.value),Ut(r,a,f.children,l),a.child;case 9:return p=a.type._context,f=a.pendingProps.children,ms(a),p=zt(p),f=f(p),a.flags|=1,Ut(r,a,f,l),a.child;case 14:return C_(r,a,a.type,a.pendingProps,l);case 15:return M_(r,a,a.type,a.pendingProps,l);case 19:return B_(r,a,l);case 31:return f=a.pendingProps,l=a.mode,f={mode:f.mode,children:f.children},r===null?(l=dl(f,l),l.ref=a.ref,a.child=l,l.return=a,a=l):(l=ni(r.child,f),l.ref=a.ref,a.child=l,l.return=a,a=l),a;case 22:return O_(r,a,l);case 24:return ms(a),f=zt(wt),r===null?(p=Nu(),p===null&&(p=rt,_=Ou(),p.pooledCache=_,_.refCount++,_!==null&&(p.pooledCacheLanes|=l),p=_),a.memoizedState={parent:f,cache:p},ku(a),wi(a,wt,p)):((r.lanes&l)!==0&&(Du(r,a),Ea(a,null,null,l),Aa()),p=r.memoizedState,_=a.memoizedState,p.parent!==f?(p={parent:f,cache:f},a.memoizedState=p,a.lanes===0&&(a.memoizedState=a.updateQueue.baseState=p),wi(a,wt,f)):(f=_.cache,wi(a,wt,f),f!==p.cache&&Mu(a,[wt],l,!0))),Ut(r,a,a.pendingProps.children,l),a.child;case 29:throw a.pendingProps}throw Error(i(156,a.tag))}function ui(r){r.flags|=4}function L_(r,a){if(a.type!=="stylesheet"||(a.state.loading&4)!==0)r.flags&=-16777217;else if(r.flags|=16777216,!Ym(a)){if(a=Tn.current,a!==null&&((Be&4194048)===Be?jn!==null:(Be&62914560)!==Be&&(Be&536870912)===0||a!==jn))throw Sa=Pu,xg;r.flags|=8192}}function pl(r,a){a!==null&&(r.flags|=4),r.flags&16384&&(a=r.tag!==22?mp():536870912,r.lanes|=a,yr|=a)}function Pa(r,a){if(!ze)switch(r.tailMode){case"hidden":a=r.tail;for(var l=null;a!==null;)a.alternate!==null&&(l=a),a=a.sibling;l===null?r.tail=null:l.sibling=null;break;case"collapsed":l=r.tail;for(var f=null;l!==null;)l.alternate!==null&&(f=l),l=l.sibling;f===null?a||r.tail===null?r.tail=null:r.tail.sibling=null:f.sibling=null}}function ft(r){var a=r.alternate!==null&&r.alternate.child===r.child,l=0,f=0;if(a)for(var p=r.child;p!==null;)l|=p.lanes|p.childLanes,f|=p.subtreeFlags&65011712,f|=p.flags&65011712,p.return=r,p=p.sibling;else for(p=r.child;p!==null;)l|=p.lanes|p.childLanes,f|=p.subtreeFlags,f|=p.flags,p.return=r,p=p.sibling;return r.subtreeFlags|=f,r.childLanes=l,a}function O2(r,a,l){var f=a.pendingProps;switch(Au(a),a.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ft(a),null;case 1:return ft(a),null;case 3:return l=a.stateNode,f=null,r!==null&&(f=r.memoizedState.cache),a.memoizedState.cache!==f&&(a.flags|=2048),ai(wt),Me(),l.pendingContext&&(l.context=l.pendingContext,l.pendingContext=null),(r===null||r.child===null)&&(_a(a)?ui(a):r===null||r.memoizedState.isDehydrated&&(a.flags&256)===0||(a.flags|=1024,mg())),ft(a),null;case 26:return l=a.memoizedState,r===null?(ui(a),l!==null?(ft(a),L_(a,l)):(ft(a),a.flags&=-16777217)):l?l!==r.memoizedState?(ui(a),ft(a),L_(a,l)):(ft(a),a.flags&=-16777217):(r.memoizedProps!==f&&ui(a),ft(a),a.flags&=-16777217),null;case 27:we(a),l=_e.current;var p=a.type;if(r!==null&&a.stateNode!=null)r.memoizedProps!==f&&ui(a);else{if(!f){if(a.stateNode===null)throw Error(i(166));return ft(a),null}r=de.current,_a(a)?gg(a):(r=Lm(p,f,l),a.stateNode=r,ui(a))}return ft(a),null;case 5:if(we(a),l=a.type,r!==null&&a.stateNode!=null)r.memoizedProps!==f&&ui(a);else{if(!f){if(a.stateNode===null)throw Error(i(166));return ft(a),null}if(r=de.current,_a(a))gg(a);else{switch(p=Rl(_e.current),r){case 1:r=p.createElementNS("http://www.w3.org/2000/svg",l);break;case 2:r=p.createElementNS("http://www.w3.org/1998/Math/MathML",l);break;default:switch(l){case"svg":r=p.createElementNS("http://www.w3.org/2000/svg",l);break;case"math":r=p.createElementNS("http://www.w3.org/1998/Math/MathML",l);break;case"script":r=p.createElement("div"),r.innerHTML="<script><\/script>",r=r.removeChild(r.firstChild);break;case"select":r=typeof f.is=="string"?p.createElement("select",{is:f.is}):p.createElement("select"),f.multiple?r.multiple=!0:f.size&&(r.size=f.size);break;default:r=typeof f.is=="string"?p.createElement(l,{is:f.is}):p.createElement(l)}}r[Lt]=a,r[Kt]=f;e:for(p=a.child;p!==null;){if(p.tag===5||p.tag===6)r.appendChild(p.stateNode);else if(p.tag!==4&&p.tag!==27&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===a)break e;for(;p.sibling===null;){if(p.return===null||p.return===a)break e;p=p.return}p.sibling.return=p.return,p=p.sibling}a.stateNode=r;e:switch(Ft(r,l,f),l){case"button":case"input":case"select":case"textarea":r=!!f.autoFocus;break e;case"img":r=!0;break e;default:r=!1}r&&ui(a)}}return ft(a),a.flags&=-16777217,null;case 6:if(r&&a.stateNode!=null)r.memoizedProps!==f&&ui(a);else{if(typeof f!="string"&&a.stateNode===null)throw Error(i(166));if(r=_e.current,_a(a)){if(r=a.stateNode,l=a.memoizedProps,f=null,p=Yt,p!==null)switch(p.tag){case 27:case 5:f=p.memoizedProps}r[Lt]=a,r=!!(r.nodeValue===l||f!==null&&f.suppressHydrationWarning===!0||Nm(r.nodeValue,l)),r||gs(a)}else r=Rl(r).createTextNode(f),r[Lt]=a,a.stateNode=r}return ft(a),null;case 13:if(f=a.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(p=_a(a),f!==null&&f.dehydrated!==null){if(r===null){if(!p)throw Error(i(318));if(p=a.memoizedState,p=p!==null?p.dehydrated:null,!p)throw Error(i(317));p[Lt]=a}else ma(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;ft(a),p=!1}else p=mg(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=p),p=!0;if(!p)return a.flags&256?(li(a),a):(li(a),null)}if(li(a),(a.flags&128)!==0)return a.lanes=l,a;if(l=f!==null,r=r!==null&&r.memoizedState!==null,l){f=a.child,p=null,f.alternate!==null&&f.alternate.memoizedState!==null&&f.alternate.memoizedState.cachePool!==null&&(p=f.alternate.memoizedState.cachePool.pool);var _=null;f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(_=f.memoizedState.cachePool.pool),_!==p&&(f.flags|=2048)}return l!==r&&l&&(a.child.flags|=8192),pl(a,a.updateQueue),ft(a),null;case 4:return Me(),r===null&&Ff(a.stateNode.containerInfo),ft(a),null;case 10:return ai(a.type),ft(a),null;case 19:if(se(At),p=a.memoizedState,p===null)return ft(a),null;if(f=(a.flags&128)!==0,_=p.rendering,_===null)if(f)Pa(p,!1);else{if(pt!==0||r!==null&&(r.flags&128)!==0)for(r=a.child;r!==null;){if(_=cl(r),_!==null){for(a.flags|=128,Pa(p,!1),r=_.updateQueue,a.updateQueue=r,pl(a,r),a.subtreeFlags=0,r=l,l=a.child;l!==null;)dg(l,r),l=l.sibling;return Z(At,At.current&1|2),a.child}r=r.sibling}p.tail!==null&&ht()>ml&&(a.flags|=128,f=!0,Pa(p,!1),a.lanes=4194304)}else{if(!f)if(r=cl(_),r!==null){if(a.flags|=128,f=!0,r=r.updateQueue,a.updateQueue=r,pl(a,r),Pa(p,!0),p.tail===null&&p.tailMode==="hidden"&&!_.alternate&&!ze)return ft(a),null}else 2*ht()-p.renderingStartTime>ml&&l!==536870912&&(a.flags|=128,f=!0,Pa(p,!1),a.lanes=4194304);p.isBackwards?(_.sibling=a.child,a.child=_):(r=p.last,r!==null?r.sibling=_:a.child=_,p.last=_)}return p.tail!==null?(a=p.tail,p.rendering=a,p.tail=a.sibling,p.renderingStartTime=ht(),a.sibling=null,r=At.current,Z(At,f?r&1|2:r&1),a):(ft(a),null);case 22:case 23:return li(a),Lu(),f=a.memoizedState!==null,r!==null?r.memoizedState!==null!==f&&(a.flags|=8192):f&&(a.flags|=8192),f?(l&536870912)!==0&&(a.flags&128)===0&&(ft(a),a.subtreeFlags&6&&(a.flags|=8192)):ft(a),l=a.updateQueue,l!==null&&pl(a,l.retryQueue),l=null,r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(l=r.memoizedState.cachePool.pool),f=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(f=a.memoizedState.cachePool.pool),f!==l&&(a.flags|=2048),r!==null&&se(ys),null;case 24:return l=null,r!==null&&(l=r.memoizedState.cache),a.memoizedState.cache!==l&&(a.flags|=2048),ai(wt),ft(a),null;case 25:return null;case 30:return null}throw Error(i(156,a.tag))}function I2(r,a){switch(Au(a),a.tag){case 1:return r=a.flags,r&65536?(a.flags=r&-65537|128,a):null;case 3:return ai(wt),Me(),r=a.flags,(r&65536)!==0&&(r&128)===0?(a.flags=r&-65537|128,a):null;case 26:case 27:case 5:return we(a),null;case 13:if(li(a),r=a.memoizedState,r!==null&&r.dehydrated!==null){if(a.alternate===null)throw Error(i(340));ma()}return r=a.flags,r&65536?(a.flags=r&-65537|128,a):null;case 19:return se(At),null;case 4:return Me(),null;case 10:return ai(a.type),null;case 22:case 23:return li(a),Lu(),r!==null&&se(ys),r=a.flags,r&65536?(a.flags=r&-65537|128,a):null;case 24:return ai(wt),null;case 25:return null;default:return null}}function z_(r,a){switch(Au(a),a.tag){case 3:ai(wt),Me();break;case 26:case 27:case 5:we(a);break;case 4:Me();break;case 13:li(a);break;case 19:se(At);break;case 10:ai(a.type);break;case 22:case 23:li(a),Lu(),r!==null&&se(ys);break;case 24:ai(wt)}}function ka(r,a){try{var l=a.updateQueue,f=l!==null?l.lastEffect:null;if(f!==null){var p=f.next;l=p;do{if((l.tag&r)===r){f=void 0;var _=l.create,b=l.inst;f=_(),b.destroy=f}l=l.next}while(l!==p)}}catch(v){Je(a,a.return,v)}}function Ii(r,a,l){try{var f=a.updateQueue,p=f!==null?f.lastEffect:null;if(p!==null){var _=p.next;f=_;do{if((f.tag&r)===r){var b=f.inst,v=b.destroy;if(v!==void 0){b.destroy=void 0,p=a;var A=l,j=v;try{j()}catch(Q){Je(p,A,Q)}}}f=f.next}while(f!==_)}}catch(Q){Je(a,a.return,Q)}}function V_(r){var a=r.updateQueue;if(a!==null){var l=r.stateNode;try{Cg(a,l)}catch(f){Je(r,r.return,f)}}}function j_(r,a,l){l.props=vs(r.type,r.memoizedProps),l.state=r.memoizedState;try{l.componentWillUnmount()}catch(f){Je(r,a,f)}}function Da(r,a){try{var l=r.ref;if(l!==null){switch(r.tag){case 26:case 27:case 5:var f=r.stateNode;break;case 30:f=r.stateNode;break;default:f=r.stateNode}typeof l=="function"?r.refCleanup=l(f):l.current=f}}catch(p){Je(r,a,p)}}function Hn(r,a){var l=r.ref,f=r.refCleanup;if(l!==null)if(typeof f=="function")try{f()}catch(p){Je(r,a,p)}finally{r.refCleanup=null,r=r.alternate,r!=null&&(r.refCleanup=null)}else if(typeof l=="function")try{l(null)}catch(p){Je(r,a,p)}else l.current=null}function H_(r){var a=r.type,l=r.memoizedProps,f=r.stateNode;try{e:switch(a){case"button":case"input":case"select":case"textarea":l.autoFocus&&f.focus();break e;case"img":l.src?f.src=l.src:l.srcSet&&(f.srcset=l.srcSet)}}catch(p){Je(r,r.return,p)}}function pf(r,a,l){try{var f=r.stateNode;G2(f,r.type,l,a),f[Kt]=a}catch(p){Je(r,r.return,p)}}function W_(r){return r.tag===5||r.tag===3||r.tag===26||r.tag===27&&Li(r.type)||r.tag===4}function gf(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||W_(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.tag===27&&Li(r.type)||r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function _f(r,a,l){var f=r.tag;if(f===5||f===6)r=r.stateNode,a?(l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l).insertBefore(r,a):(a=l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l,a.appendChild(r),l=l._reactRootContainer,l!=null||a.onclick!==null||(a.onclick=El));else if(f!==4&&(f===27&&Li(r.type)&&(l=r.stateNode,a=null),r=r.child,r!==null))for(_f(r,a,l),r=r.sibling;r!==null;)_f(r,a,l),r=r.sibling}function gl(r,a,l){var f=r.tag;if(f===5||f===6)r=r.stateNode,a?l.insertBefore(r,a):l.appendChild(r);else if(f!==4&&(f===27&&Li(r.type)&&(l=r.stateNode),r=r.child,r!==null))for(gl(r,a,l),r=r.sibling;r!==null;)gl(r,a,l),r=r.sibling}function $_(r){var a=r.stateNode,l=r.memoizedProps;try{for(var f=r.type,p=a.attributes;p.length;)a.removeAttributeNode(p[0]);Ft(a,f,l),a[Lt]=r,a[Kt]=l}catch(_){Je(r,r.return,_)}}var fi=!1,yt=!1,mf=!1,X_=typeof WeakSet=="function"?WeakSet:Set,Nt=null;function N2(r,a){if(r=r.containerInfo,Vf=Pl,r=ig(r),pu(r)){if("selectionStart"in r)var l={start:r.selectionStart,end:r.selectionEnd};else e:{l=(l=r.ownerDocument)&&l.defaultView||window;var f=l.getSelection&&l.getSelection();if(f&&f.rangeCount!==0){l=f.anchorNode;var p=f.anchorOffset,_=f.focusNode;f=f.focusOffset;try{l.nodeType,_.nodeType}catch{l=null;break e}var b=0,v=-1,A=-1,j=0,Q=0,ee=r,W=null;t:for(;;){for(var X;ee!==l||p!==0&&ee.nodeType!==3||(v=b+p),ee!==_||f!==0&&ee.nodeType!==3||(A=b+f),ee.nodeType===3&&(b+=ee.nodeValue.length),(X=ee.firstChild)!==null;)W=ee,ee=X;for(;;){if(ee===r)break t;if(W===l&&++j===p&&(v=b),W===_&&++Q===f&&(A=b),(X=ee.nextSibling)!==null)break;ee=W,W=ee.parentNode}ee=X}l=v===-1||A===-1?null:{start:v,end:A}}else l=null}l=l||{start:0,end:0}}else l=null;for(jf={focusedElem:r,selectionRange:l},Pl=!1,Nt=a;Nt!==null;)if(a=Nt,r=a.child,(a.subtreeFlags&1024)!==0&&r!==null)r.return=a,Nt=r;else for(;Nt!==null;){switch(a=Nt,_=a.alternate,r=a.flags,a.tag){case 0:break;case 11:case 15:break;case 1:if((r&1024)!==0&&_!==null){r=void 0,l=a,p=_.memoizedProps,_=_.memoizedState,f=l.stateNode;try{var Ae=vs(l.type,p,l.elementType===l.type);r=f.getSnapshotBeforeUpdate(Ae,_),f.__reactInternalSnapshotBeforeUpdate=r}catch(Te){Je(l,l.return,Te)}}break;case 3:if((r&1024)!==0){if(r=a.stateNode.containerInfo,l=r.nodeType,l===9)$f(r);else if(l===1)switch(r.nodeName){case"HEAD":case"HTML":case"BODY":$f(r);break;default:r.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((r&1024)!==0)throw Error(i(163))}if(r=a.sibling,r!==null){r.return=a.return,Nt=r;break}Nt=a.return}}function Y_(r,a,l){var f=l.flags;switch(l.tag){case 0:case 11:case 15:Ni(r,l),f&4&&ka(5,l);break;case 1:if(Ni(r,l),f&4)if(r=l.stateNode,a===null)try{r.componentDidMount()}catch(b){Je(l,l.return,b)}else{var p=vs(l.type,a.memoizedProps);a=a.memoizedState;try{r.componentDidUpdate(p,a,r.__reactInternalSnapshotBeforeUpdate)}catch(b){Je(l,l.return,b)}}f&64&&V_(l),f&512&&Da(l,l.return);break;case 3:if(Ni(r,l),f&64&&(r=l.updateQueue,r!==null)){if(a=null,l.child!==null)switch(l.child.tag){case 27:case 5:a=l.child.stateNode;break;case 1:a=l.child.stateNode}try{Cg(r,a)}catch(b){Je(l,l.return,b)}}break;case 27:a===null&&f&4&&$_(l);case 26:case 5:Ni(r,l),a===null&&f&4&&H_(l),f&512&&Da(l,l.return);break;case 12:Ni(r,l);break;case 13:Ni(r,l),f&4&&Z_(r,l),f&64&&(r=l.memoizedState,r!==null&&(r=r.dehydrated,r!==null&&(l=V2.bind(null,l),r1(r,l))));break;case 22:if(f=l.memoizedState!==null||fi,!f){a=a!==null&&a.memoizedState!==null||yt,p=fi;var _=yt;fi=f,(yt=a)&&!_?Pi(r,l,(l.subtreeFlags&8772)!==0):Ni(r,l),fi=p,yt=_}break;case 30:break;default:Ni(r,l)}}function q_(r){var a=r.alternate;a!==null&&(r.alternate=null,q_(a)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(a=r.stateNode,a!==null&&Kc(a)),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}var lt=null,Gt=!1;function hi(r,a,l){for(l=l.child;l!==null;)K_(r,a,l),l=l.sibling}function K_(r,a,l){if(Xe&&typeof Xe.onCommitFiberUnmount=="function")try{Xe.onCommitFiberUnmount(ot,l)}catch{}switch(l.tag){case 26:yt||Hn(l,a),hi(r,a,l),l.memoizedState?l.memoizedState.count--:l.stateNode&&(l=l.stateNode,l.parentNode.removeChild(l));break;case 27:yt||Hn(l,a);var f=lt,p=Gt;Li(l.type)&&(lt=l.stateNode,Gt=!1),hi(r,a,l),Wa(l.stateNode),lt=f,Gt=p;break;case 5:yt||Hn(l,a);case 6:if(f=lt,p=Gt,lt=null,hi(r,a,l),lt=f,Gt=p,lt!==null)if(Gt)try{(lt.nodeType===9?lt.body:lt.nodeName==="HTML"?lt.ownerDocument.body:lt).removeChild(l.stateNode)}catch(_){Je(l,a,_)}else try{lt.removeChild(l.stateNode)}catch(_){Je(l,a,_)}break;case 18:lt!==null&&(Gt?(r=lt,Bm(r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r,l.stateNode),Ga(r)):Bm(lt,l.stateNode));break;case 4:f=lt,p=Gt,lt=l.stateNode.containerInfo,Gt=!0,hi(r,a,l),lt=f,Gt=p;break;case 0:case 11:case 14:case 15:yt||Ii(2,l,a),yt||Ii(4,l,a),hi(r,a,l);break;case 1:yt||(Hn(l,a),f=l.stateNode,typeof f.componentWillUnmount=="function"&&j_(l,a,f)),hi(r,a,l);break;case 21:hi(r,a,l);break;case 22:yt=(f=yt)||l.memoizedState!==null,hi(r,a,l),yt=f;break;default:hi(r,a,l)}}function Z_(r,a){if(a.memoizedState===null&&(r=a.alternate,r!==null&&(r=r.memoizedState,r!==null&&(r=r.dehydrated,r!==null))))try{Ga(r)}catch(l){Je(a,a.return,l)}}function P2(r){switch(r.tag){case 13:case 19:var a=r.stateNode;return a===null&&(a=r.stateNode=new X_),a;case 22:return r=r.stateNode,a=r._retryCache,a===null&&(a=r._retryCache=new X_),a;default:throw Error(i(435,r.tag))}}function yf(r,a){var l=P2(r);a.forEach(function(f){var p=j2.bind(null,r,f);l.has(f)||(l.add(f),f.then(p,p))})}function nn(r,a){var l=a.deletions;if(l!==null)for(var f=0;f<l.length;f++){var p=l[f],_=r,b=a,v=b;e:for(;v!==null;){switch(v.tag){case 27:if(Li(v.type)){lt=v.stateNode,Gt=!1;break e}break;case 5:lt=v.stateNode,Gt=!1;break e;case 3:case 4:lt=v.stateNode.containerInfo,Gt=!0;break e}v=v.return}if(lt===null)throw Error(i(160));K_(_,b,p),lt=null,Gt=!1,_=p.alternate,_!==null&&(_.return=null),p.return=null}if(a.subtreeFlags&13878)for(a=a.child;a!==null;)Q_(a,r),a=a.sibling}var Pn=null;function Q_(r,a){var l=r.alternate,f=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:nn(a,r),sn(r),f&4&&(Ii(3,r,r.return),ka(3,r),Ii(5,r,r.return));break;case 1:nn(a,r),sn(r),f&512&&(yt||l===null||Hn(l,l.return)),f&64&&fi&&(r=r.updateQueue,r!==null&&(f=r.callbacks,f!==null&&(l=r.shared.hiddenCallbacks,r.shared.hiddenCallbacks=l===null?f:l.concat(f))));break;case 26:var p=Pn;if(nn(a,r),sn(r),f&512&&(yt||l===null||Hn(l,l.return)),f&4){var _=l!==null?l.memoizedState:null;if(f=r.memoizedState,l===null)if(f===null)if(r.stateNode===null){e:{f=r.type,l=r.memoizedProps,p=p.ownerDocument||p;t:switch(f){case"title":_=p.getElementsByTagName("title")[0],(!_||_[ra]||_[Lt]||_.namespaceURI==="http://www.w3.org/2000/svg"||_.hasAttribute("itemprop"))&&(_=p.createElement(f),p.head.insertBefore(_,p.querySelector("head > title"))),Ft(_,f,l),_[Lt]=r,Ot(_),f=_;break e;case"link":var b=$m("link","href",p).get(f+(l.href||""));if(b){for(var v=0;v<b.length;v++)if(_=b[v],_.getAttribute("href")===(l.href==null||l.href===""?null:l.href)&&_.getAttribute("rel")===(l.rel==null?null:l.rel)&&_.getAttribute("title")===(l.title==null?null:l.title)&&_.getAttribute("crossorigin")===(l.crossOrigin==null?null:l.crossOrigin)){b.splice(v,1);break t}}_=p.createElement(f),Ft(_,f,l),p.head.appendChild(_);break;case"meta":if(b=$m("meta","content",p).get(f+(l.content||""))){for(v=0;v<b.length;v++)if(_=b[v],_.getAttribute("content")===(l.content==null?null:""+l.content)&&_.getAttribute("name")===(l.name==null?null:l.name)&&_.getAttribute("property")===(l.property==null?null:l.property)&&_.getAttribute("http-equiv")===(l.httpEquiv==null?null:l.httpEquiv)&&_.getAttribute("charset")===(l.charSet==null?null:l.charSet)){b.splice(v,1);break t}}_=p.createElement(f),Ft(_,f,l),p.head.appendChild(_);break;default:throw Error(i(468,f))}_[Lt]=r,Ot(_),f=_}r.stateNode=f}else Xm(p,r.type,r.stateNode);else r.stateNode=Wm(p,f,r.memoizedProps);else _!==f?(_===null?l.stateNode!==null&&(l=l.stateNode,l.parentNode.removeChild(l)):_.count--,f===null?Xm(p,r.type,r.stateNode):Wm(p,f,r.memoizedProps)):f===null&&r.stateNode!==null&&pf(r,r.memoizedProps,l.memoizedProps)}break;case 27:nn(a,r),sn(r),f&512&&(yt||l===null||Hn(l,l.return)),l!==null&&f&4&&pf(r,r.memoizedProps,l.memoizedProps);break;case 5:if(nn(a,r),sn(r),f&512&&(yt||l===null||Hn(l,l.return)),r.flags&32){p=r.stateNode;try{Zs(p,"")}catch(X){Je(r,r.return,X)}}f&4&&r.stateNode!=null&&(p=r.memoizedProps,pf(r,p,l!==null?l.memoizedProps:p)),f&1024&&(mf=!0);break;case 6:if(nn(a,r),sn(r),f&4){if(r.stateNode===null)throw Error(i(162));f=r.memoizedProps,l=r.stateNode;try{l.nodeValue=f}catch(X){Je(r,r.return,X)}}break;case 3:if(Ol=null,p=Pn,Pn=Cl(a.containerInfo),nn(a,r),Pn=p,sn(r),f&4&&l!==null&&l.memoizedState.isDehydrated)try{Ga(a.containerInfo)}catch(X){Je(r,r.return,X)}mf&&(mf=!1,G_(r));break;case 4:f=Pn,Pn=Cl(r.stateNode.containerInfo),nn(a,r),sn(r),Pn=f;break;case 12:nn(a,r),sn(r);break;case 13:nn(a,r),sn(r),r.child.flags&8192&&r.memoizedState!==null!=(l!==null&&l.memoizedState!==null)&&(wf=ht()),f&4&&(f=r.updateQueue,f!==null&&(r.updateQueue=null,yf(r,f)));break;case 22:p=r.memoizedState!==null;var A=l!==null&&l.memoizedState!==null,j=fi,Q=yt;if(fi=j||p,yt=Q||A,nn(a,r),yt=Q,fi=j,sn(r),f&8192)e:for(a=r.stateNode,a._visibility=p?a._visibility&-2:a._visibility|1,p&&(l===null||A||fi||yt||Ts(r)),l=null,a=r;;){if(a.tag===5||a.tag===26){if(l===null){A=l=a;try{if(_=A.stateNode,p)b=_.style,typeof b.setProperty=="function"?b.setProperty("display","none","important"):b.display="none";else{v=A.stateNode;var ee=A.memoizedProps.style,W=ee!=null&&ee.hasOwnProperty("display")?ee.display:null;v.style.display=W==null||typeof W=="boolean"?"":(""+W).trim()}}catch(X){Je(A,A.return,X)}}}else if(a.tag===6){if(l===null){A=a;try{A.stateNode.nodeValue=p?"":A.memoizedProps}catch(X){Je(A,A.return,X)}}}else if((a.tag!==22&&a.tag!==23||a.memoizedState===null||a===r)&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===r)break e;for(;a.sibling===null;){if(a.return===null||a.return===r)break e;l===a&&(l=null),a=a.return}l===a&&(l=null),a.sibling.return=a.return,a=a.sibling}f&4&&(f=r.updateQueue,f!==null&&(l=f.retryQueue,l!==null&&(f.retryQueue=null,yf(r,l))));break;case 19:nn(a,r),sn(r),f&4&&(f=r.updateQueue,f!==null&&(r.updateQueue=null,yf(r,f)));break;case 30:break;case 21:break;default:nn(a,r),sn(r)}}function sn(r){var a=r.flags;if(a&2){try{for(var l,f=r.return;f!==null;){if(W_(f)){l=f;break}f=f.return}if(l==null)throw Error(i(160));switch(l.tag){case 27:var p=l.stateNode,_=gf(r);gl(r,_,p);break;case 5:var b=l.stateNode;l.flags&32&&(Zs(b,""),l.flags&=-33);var v=gf(r);gl(r,v,b);break;case 3:case 4:var A=l.stateNode.containerInfo,j=gf(r);_f(r,j,A);break;default:throw Error(i(161))}}catch(Q){Je(r,r.return,Q)}r.flags&=-3}a&4096&&(r.flags&=-4097)}function G_(r){if(r.subtreeFlags&1024)for(r=r.child;r!==null;){var a=r;G_(a),a.tag===5&&a.flags&1024&&a.stateNode.reset(),r=r.sibling}}function Ni(r,a){if(a.subtreeFlags&8772)for(a=a.child;a!==null;)Y_(r,a.alternate,a),a=a.sibling}function Ts(r){for(r=r.child;r!==null;){var a=r;switch(a.tag){case 0:case 11:case 14:case 15:Ii(4,a,a.return),Ts(a);break;case 1:Hn(a,a.return);var l=a.stateNode;typeof l.componentWillUnmount=="function"&&j_(a,a.return,l),Ts(a);break;case 27:Wa(a.stateNode);case 26:case 5:Hn(a,a.return),Ts(a);break;case 22:a.memoizedState===null&&Ts(a);break;case 30:Ts(a);break;default:Ts(a)}r=r.sibling}}function Pi(r,a,l){for(l=l&&(a.subtreeFlags&8772)!==0,a=a.child;a!==null;){var f=a.alternate,p=r,_=a,b=_.flags;switch(_.tag){case 0:case 11:case 15:Pi(p,_,l),ka(4,_);break;case 1:if(Pi(p,_,l),f=_,p=f.stateNode,typeof p.componentDidMount=="function")try{p.componentDidMount()}catch(j){Je(f,f.return,j)}if(f=_,p=f.updateQueue,p!==null){var v=f.stateNode;try{var A=p.shared.hiddenCallbacks;if(A!==null)for(p.shared.hiddenCallbacks=null,p=0;p<A.length;p++)Rg(A[p],v)}catch(j){Je(f,f.return,j)}}l&&b&64&&V_(_),Da(_,_.return);break;case 27:$_(_);case 26:case 5:Pi(p,_,l),l&&f===null&&b&4&&H_(_),Da(_,_.return);break;case 12:Pi(p,_,l);break;case 13:Pi(p,_,l),l&&b&4&&Z_(p,_);break;case 22:_.memoizedState===null&&Pi(p,_,l),Da(_,_.return);break;case 30:break;default:Pi(p,_,l)}a=a.sibling}}function bf(r,a){var l=null;r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(l=r.memoizedState.cachePool.pool),r=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(r=a.memoizedState.cachePool.pool),r!==l&&(r!=null&&r.refCount++,l!=null&&va(l))}function vf(r,a){r=null,a.alternate!==null&&(r=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==r&&(a.refCount++,r!=null&&va(r))}function Wn(r,a,l,f){if(a.subtreeFlags&10256)for(a=a.child;a!==null;)J_(r,a,l,f),a=a.sibling}function J_(r,a,l,f){var p=a.flags;switch(a.tag){case 0:case 11:case 15:Wn(r,a,l,f),p&2048&&ka(9,a);break;case 1:Wn(r,a,l,f);break;case 3:Wn(r,a,l,f),p&2048&&(r=null,a.alternate!==null&&(r=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==r&&(a.refCount++,r!=null&&va(r)));break;case 12:if(p&2048){Wn(r,a,l,f),r=a.stateNode;try{var _=a.memoizedProps,b=_.id,v=_.onPostCommit;typeof v=="function"&&v(b,a.alternate===null?"mount":"update",r.passiveEffectDuration,-0)}catch(A){Je(a,a.return,A)}}else Wn(r,a,l,f);break;case 13:Wn(r,a,l,f);break;case 23:break;case 22:_=a.stateNode,b=a.alternate,a.memoizedState!==null?_._visibility&2?Wn(r,a,l,f):Ua(r,a):_._visibility&2?Wn(r,a,l,f):(_._visibility|=2,gr(r,a,l,f,(a.subtreeFlags&10256)!==0)),p&2048&&bf(b,a);break;case 24:Wn(r,a,l,f),p&2048&&vf(a.alternate,a);break;default:Wn(r,a,l,f)}}function gr(r,a,l,f,p){for(p=p&&(a.subtreeFlags&10256)!==0,a=a.child;a!==null;){var _=r,b=a,v=l,A=f,j=b.flags;switch(b.tag){case 0:case 11:case 15:gr(_,b,v,A,p),ka(8,b);break;case 23:break;case 22:var Q=b.stateNode;b.memoizedState!==null?Q._visibility&2?gr(_,b,v,A,p):Ua(_,b):(Q._visibility|=2,gr(_,b,v,A,p)),p&&j&2048&&bf(b.alternate,b);break;case 24:gr(_,b,v,A,p),p&&j&2048&&vf(b.alternate,b);break;default:gr(_,b,v,A,p)}a=a.sibling}}function Ua(r,a){if(a.subtreeFlags&10256)for(a=a.child;a!==null;){var l=r,f=a,p=f.flags;switch(f.tag){case 22:Ua(l,f),p&2048&&bf(f.alternate,f);break;case 24:Ua(l,f),p&2048&&vf(f.alternate,f);break;default:Ua(l,f)}a=a.sibling}}var Ba=8192;function _r(r){if(r.subtreeFlags&Ba)for(r=r.child;r!==null;)em(r),r=r.sibling}function em(r){switch(r.tag){case 26:_r(r),r.flags&Ba&&r.memoizedState!==null&&y1(Pn,r.memoizedState,r.memoizedProps);break;case 5:_r(r);break;case 3:case 4:var a=Pn;Pn=Cl(r.stateNode.containerInfo),_r(r),Pn=a;break;case 22:r.memoizedState===null&&(a=r.alternate,a!==null&&a.memoizedState!==null?(a=Ba,Ba=16777216,_r(r),Ba=a):_r(r));break;default:_r(r)}}function tm(r){var a=r.alternate;if(a!==null&&(r=a.child,r!==null)){a.child=null;do a=r.sibling,r.sibling=null,r=a;while(r!==null)}}function Fa(r){var a=r.deletions;if((r.flags&16)!==0){if(a!==null)for(var l=0;l<a.length;l++){var f=a[l];Nt=f,im(f,r)}tm(r)}if(r.subtreeFlags&10256)for(r=r.child;r!==null;)nm(r),r=r.sibling}function nm(r){switch(r.tag){case 0:case 11:case 15:Fa(r),r.flags&2048&&Ii(9,r,r.return);break;case 3:Fa(r);break;case 12:Fa(r);break;case 22:var a=r.stateNode;r.memoizedState!==null&&a._visibility&2&&(r.return===null||r.return.tag!==13)?(a._visibility&=-3,_l(r)):Fa(r);break;default:Fa(r)}}function _l(r){var a=r.deletions;if((r.flags&16)!==0){if(a!==null)for(var l=0;l<a.length;l++){var f=a[l];Nt=f,im(f,r)}tm(r)}for(r=r.child;r!==null;){switch(a=r,a.tag){case 0:case 11:case 15:Ii(8,a,a.return),_l(a);break;case 22:l=a.stateNode,l._visibility&2&&(l._visibility&=-3,_l(a));break;default:_l(a)}r=r.sibling}}function im(r,a){for(;Nt!==null;){var l=Nt;switch(l.tag){case 0:case 11:case 15:Ii(8,l,a);break;case 23:case 22:if(l.memoizedState!==null&&l.memoizedState.cachePool!==null){var f=l.memoizedState.cachePool.pool;f!=null&&f.refCount++}break;case 24:va(l.memoizedState.cache)}if(f=l.child,f!==null)f.return=l,Nt=f;else e:for(l=r;Nt!==null;){f=Nt;var p=f.sibling,_=f.return;if(q_(f),f===l){Nt=null;break e}if(p!==null){p.return=_,Nt=p;break e}Nt=_}}}var k2={getCacheForType:function(r){var a=zt(wt),l=a.data.get(r);return l===void 0&&(l=r(),a.data.set(r,l)),l}},D2=typeof WeakMap=="function"?WeakMap:Map,He=0,rt=null,ke=null,Be=0,We=0,rn=null,ki=!1,mr=!1,Tf=!1,di=0,pt=0,Di=0,xs=0,xf=0,xn=0,yr=0,La=null,Jt=null,Sf=!1,wf=0,ml=1/0,yl=null,Ui=null,Bt=0,Bi=null,br=null,vr=0,Af=0,Ef=null,sm=null,za=0,Rf=null;function an(){if((He&2)!==0&&Be!==0)return Be&-Be;if(K.T!==null){var r=or;return r!==0?r:kf()}return vp()}function rm(){xn===0&&(xn=(Be&536870912)===0||ze?_p():536870912);var r=Tn.current;return r!==null&&(r.flags|=32),xn}function on(r,a,l){(r===rt&&(We===2||We===9)||r.cancelPendingCommit!==null)&&(Tr(r,0),Fi(r,Be,xn,!1)),sa(r,l),((He&2)===0||r!==rt)&&(r===rt&&((He&2)===0&&(xs|=l),pt===4&&Fi(r,Be,xn,!1)),$n(r))}function am(r,a,l){if((He&6)!==0)throw Error(i(327));var f=!l&&(a&124)===0&&(a&r.expiredLanes)===0||ia(r,a),p=f?F2(r,a):Of(r,a,!0),_=f;do{if(p===0){mr&&!f&&Fi(r,a,0,!1);break}else{if(l=r.current.alternate,_&&!U2(l)){p=Of(r,a,!1),_=!1;continue}if(p===2){if(_=a,r.errorRecoveryDisabledLanes&_)var b=0;else b=r.pendingLanes&-536870913,b=b!==0?b:b&536870912?536870912:0;if(b!==0){a=b;e:{var v=r;p=La;var A=v.current.memoizedState.isDehydrated;if(A&&(Tr(v,b).flags|=256),b=Of(v,b,!1),b!==2){if(Tf&&!A){v.errorRecoveryDisabledLanes|=_,xs|=_,p=4;break e}_=Jt,Jt=p,_!==null&&(Jt===null?Jt=_:Jt.push.apply(Jt,_))}p=b}if(_=!1,p!==2)continue}}if(p===1){Tr(r,0),Fi(r,a,0,!0);break}e:{switch(f=r,_=p,_){case 0:case 1:throw Error(i(345));case 4:if((a&4194048)!==a)break;case 6:Fi(f,a,xn,!ki);break e;case 2:Jt=null;break;case 3:case 5:break;default:throw Error(i(329))}if((a&62914560)===a&&(p=wf+300-ht(),10<p)){if(Fi(f,a,xn,!ki),Mo(f,0,!0)!==0)break e;f.timeoutHandle=Dm(om.bind(null,f,l,Jt,yl,Sf,a,xn,xs,yr,ki,_,2,-0,0),p);break e}om(f,l,Jt,yl,Sf,a,xn,xs,yr,ki,_,0,-0,0)}}break}while(!0);$n(r)}function om(r,a,l,f,p,_,b,v,A,j,Q,ee,W,X){if(r.timeoutHandle=-1,ee=a.subtreeFlags,(ee&8192||(ee&16785408)===16785408)&&(Ya={stylesheets:null,count:0,unsuspend:m1},em(a),ee=b1(),ee!==null)){r.cancelPendingCommit=ee(pm.bind(null,r,a,_,l,f,p,b,v,A,Q,1,W,X)),Fi(r,_,b,!j);return}pm(r,a,_,l,f,p,b,v,A)}function U2(r){for(var a=r;;){var l=a.tag;if((l===0||l===11||l===15)&&a.flags&16384&&(l=a.updateQueue,l!==null&&(l=l.stores,l!==null)))for(var f=0;f<l.length;f++){var p=l[f],_=p.getSnapshot;p=p.value;try{if(!en(_(),p))return!1}catch{return!1}}if(l=a.child,a.subtreeFlags&16384&&l!==null)l.return=a,a=l;else{if(a===r)break;for(;a.sibling===null;){if(a.return===null||a.return===r)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function Fi(r,a,l,f){a&=~xf,a&=~xs,r.suspendedLanes|=a,r.pingedLanes&=~a,f&&(r.warmLanes|=a),f=r.expirationTimes;for(var p=a;0<p;){var _=31-Dt(p),b=1<<_;f[_]=-1,p&=~b}l!==0&&yp(r,l,a)}function bl(){return(He&6)===0?(Va(0),!1):!0}function Cf(){if(ke!==null){if(We===0)var r=ke.return;else r=ke,ri=_s=null,Wu(r),dr=null,Ia=0,r=ke;for(;r!==null;)z_(r.alternate,r),r=r.return;ke=null}}function Tr(r,a){var l=r.timeoutHandle;l!==-1&&(r.timeoutHandle=-1,e1(l)),l=r.cancelPendingCommit,l!==null&&(r.cancelPendingCommit=null,l()),Cf(),rt=r,ke=l=ni(r.current,null),Be=a,We=0,rn=null,ki=!1,mr=ia(r,a),Tf=!1,yr=xn=xf=xs=Di=pt=0,Jt=La=null,Sf=!1,(a&8)!==0&&(a|=a&32);var f=r.entangledLanes;if(f!==0)for(r=r.entanglements,f&=a;0<f;){var p=31-Dt(f),_=1<<p;a|=r[p],f&=~_}return di=a,Vo(),l}function lm(r,a){Oe=null,K.H=al,a===xa||a===Zo?(a=Ag(),We=3):a===xg?(a=Ag(),We=4):We=a===E_?8:a!==null&&typeof a=="object"&&typeof a.then=="function"?6:1,rn=a,ke===null&&(pt=1,fl(r,mn(a,r.current)))}function cm(){var r=K.H;return K.H=al,r===null?al:r}function um(){var r=K.A;return K.A=k2,r}function Mf(){pt=4,ki||(Be&4194048)!==Be&&Tn.current!==null||(mr=!0),(Di&134217727)===0&&(xs&134217727)===0||rt===null||Fi(rt,Be,xn,!1)}function Of(r,a,l){var f=He;He|=2;var p=cm(),_=um();(rt!==r||Be!==a)&&(yl=null,Tr(r,a)),a=!1;var b=pt;e:do try{if(We!==0&&ke!==null){var v=ke,A=rn;switch(We){case 8:Cf(),b=6;break e;case 3:case 2:case 9:case 6:Tn.current===null&&(a=!0);var j=We;if(We=0,rn=null,xr(r,v,A,j),l&&mr){b=0;break e}break;default:j=We,We=0,rn=null,xr(r,v,A,j)}}B2(),b=pt;break}catch(Q){lm(r,Q)}while(!0);return a&&r.shellSuspendCounter++,ri=_s=null,He=f,K.H=p,K.A=_,ke===null&&(rt=null,Be=0,Vo()),b}function B2(){for(;ke!==null;)fm(ke)}function F2(r,a){var l=He;He|=2;var f=cm(),p=um();rt!==r||Be!==a?(yl=null,ml=ht()+500,Tr(r,a)):mr=ia(r,a);e:do try{if(We!==0&&ke!==null){a=ke;var _=rn;t:switch(We){case 1:We=0,rn=null,xr(r,a,_,1);break;case 2:case 9:if(Sg(_)){We=0,rn=null,hm(a);break}a=function(){We!==2&&We!==9||rt!==r||(We=7),$n(r)},_.then(a,a);break e;case 3:We=7;break e;case 4:We=5;break e;case 7:Sg(_)?(We=0,rn=null,hm(a)):(We=0,rn=null,xr(r,a,_,7));break;case 5:var b=null;switch(ke.tag){case 26:b=ke.memoizedState;case 5:case 27:var v=ke;if(!b||Ym(b)){We=0,rn=null;var A=v.sibling;if(A!==null)ke=A;else{var j=v.return;j!==null?(ke=j,vl(j)):ke=null}break t}}We=0,rn=null,xr(r,a,_,5);break;case 6:We=0,rn=null,xr(r,a,_,6);break;case 8:Cf(),pt=6;break e;default:throw Error(i(462))}}L2();break}catch(Q){lm(r,Q)}while(!0);return ri=_s=null,K.H=f,K.A=p,He=l,ke!==null?0:(rt=null,Be=0,Vo(),pt)}function L2(){for(;ke!==null&&!$e();)fm(ke)}function fm(r){var a=F_(r.alternate,r,di);r.memoizedProps=r.pendingProps,a===null?vl(r):ke=a}function hm(r){var a=r,l=a.alternate;switch(a.tag){case 15:case 0:a=N_(l,a,a.pendingProps,a.type,void 0,Be);break;case 11:a=N_(l,a,a.pendingProps,a.type.render,a.ref,Be);break;case 5:Wu(a);default:z_(l,a),a=ke=dg(a,di),a=F_(l,a,di)}r.memoizedProps=r.pendingProps,a===null?vl(r):ke=a}function xr(r,a,l,f){ri=_s=null,Wu(a),dr=null,Ia=0;var p=a.return;try{if(C2(r,p,a,l,Be)){pt=1,fl(r,mn(l,r.current)),ke=null;return}}catch(_){if(p!==null)throw ke=p,_;pt=1,fl(r,mn(l,r.current)),ke=null;return}a.flags&32768?(ze||f===1?r=!0:mr||(Be&536870912)!==0?r=!1:(ki=r=!0,(f===2||f===9||f===3||f===6)&&(f=Tn.current,f!==null&&f.tag===13&&(f.flags|=16384))),dm(a,r)):vl(a)}function vl(r){var a=r;do{if((a.flags&32768)!==0){dm(a,ki);return}r=a.return;var l=O2(a.alternate,a,di);if(l!==null){ke=l;return}if(a=a.sibling,a!==null){ke=a;return}ke=a=r}while(a!==null);pt===0&&(pt=5)}function dm(r,a){do{var l=I2(r.alternate,r);if(l!==null){l.flags&=32767,ke=l;return}if(l=r.return,l!==null&&(l.flags|=32768,l.subtreeFlags=0,l.deletions=null),!a&&(r=r.sibling,r!==null)){ke=r;return}ke=r=l}while(r!==null);pt=6,ke=null}function pm(r,a,l,f,p,_,b,v,A){r.cancelPendingCommit=null;do Tl();while(Bt!==0);if((He&6)!==0)throw Error(i(327));if(a!==null){if(a===r.current)throw Error(i(177));if(_=a.lanes|a.childLanes,_|=bu,mT(r,l,_,b,v,A),r===rt&&(ke=rt=null,Be=0),br=a,Bi=r,vr=l,Af=_,Ef=p,sm=f,(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?(r.callbackNode=null,r.callbackPriority=0,H2(In,function(){return bm(),null})):(r.callbackNode=null,r.callbackPriority=0),f=(a.flags&13878)!==0,(a.subtreeFlags&13878)!==0||f){f=K.T,K.T=null,p=ne.p,ne.p=2,b=He,He|=4;try{N2(r,a,l)}finally{He=b,ne.p=p,K.T=f}}Bt=1,gm(),_m(),mm()}}function gm(){if(Bt===1){Bt=0;var r=Bi,a=br,l=(a.flags&13878)!==0;if((a.subtreeFlags&13878)!==0||l){l=K.T,K.T=null;var f=ne.p;ne.p=2;var p=He;He|=4;try{Q_(a,r);var _=jf,b=ig(r.containerInfo),v=_.focusedElem,A=_.selectionRange;if(b!==v&&v&&v.ownerDocument&&ng(v.ownerDocument.documentElement,v)){if(A!==null&&pu(v)){var j=A.start,Q=A.end;if(Q===void 0&&(Q=j),"selectionStart"in v)v.selectionStart=j,v.selectionEnd=Math.min(Q,v.value.length);else{var ee=v.ownerDocument||document,W=ee&&ee.defaultView||window;if(W.getSelection){var X=W.getSelection(),Ae=v.textContent.length,Te=Math.min(A.start,Ae),Ke=A.end===void 0?Te:Math.min(A.end,Ae);!X.extend&&Te>Ke&&(b=Ke,Ke=Te,Te=b);var U=tg(v,Te),I=tg(v,Ke);if(U&&I&&(X.rangeCount!==1||X.anchorNode!==U.node||X.anchorOffset!==U.offset||X.focusNode!==I.node||X.focusOffset!==I.offset)){var z=ee.createRange();z.setStart(U.node,U.offset),X.removeAllRanges(),Te>Ke?(X.addRange(z),X.extend(I.node,I.offset)):(z.setEnd(I.node,I.offset),X.addRange(z))}}}}for(ee=[],X=v;X=X.parentNode;)X.nodeType===1&&ee.push({element:X,left:X.scrollLeft,top:X.scrollTop});for(typeof v.focus=="function"&&v.focus(),v=0;v<ee.length;v++){var G=ee[v];G.element.scrollLeft=G.left,G.element.scrollTop=G.top}}Pl=!!Vf,jf=Vf=null}finally{He=p,ne.p=f,K.T=l}}r.current=a,Bt=2}}function _m(){if(Bt===2){Bt=0;var r=Bi,a=br,l=(a.flags&8772)!==0;if((a.subtreeFlags&8772)!==0||l){l=K.T,K.T=null;var f=ne.p;ne.p=2;var p=He;He|=4;try{Y_(r,a.alternate,a)}finally{He=p,ne.p=f,K.T=l}}Bt=3}}function mm(){if(Bt===4||Bt===3){Bt=0,Pe();var r=Bi,a=br,l=vr,f=sm;(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?Bt=5:(Bt=0,br=Bi=null,ym(r,r.pendingLanes));var p=r.pendingLanes;if(p===0&&(Ui=null),Yc(l),a=a.stateNode,Xe&&typeof Xe.onCommitFiberRoot=="function")try{Xe.onCommitFiberRoot(ot,a,void 0,(a.current.flags&128)===128)}catch{}if(f!==null){a=K.T,p=ne.p,ne.p=2,K.T=null;try{for(var _=r.onRecoverableError,b=0;b<f.length;b++){var v=f[b];_(v.value,{componentStack:v.stack})}}finally{K.T=a,ne.p=p}}(vr&3)!==0&&Tl(),$n(r),p=r.pendingLanes,(l&4194090)!==0&&(p&42)!==0?r===Rf?za++:(za=0,Rf=r):za=0,Va(0)}}function ym(r,a){(r.pooledCacheLanes&=a)===0&&(a=r.pooledCache,a!=null&&(r.pooledCache=null,va(a)))}function Tl(r){return gm(),_m(),mm(),bm()}function bm(){if(Bt!==5)return!1;var r=Bi,a=Af;Af=0;var l=Yc(vr),f=K.T,p=ne.p;try{ne.p=32>l?32:l,K.T=null,l=Ef,Ef=null;var _=Bi,b=vr;if(Bt=0,br=Bi=null,vr=0,(He&6)!==0)throw Error(i(331));var v=He;if(He|=4,nm(_.current),J_(_,_.current,b,l),He=v,Va(0,!1),Xe&&typeof Xe.onPostCommitFiberRoot=="function")try{Xe.onPostCommitFiberRoot(ot,_)}catch{}return!0}finally{ne.p=p,K.T=f,ym(r,a)}}function vm(r,a,l){a=mn(l,a),a=rf(r.stateNode,a,2),r=Ri(r,a,2),r!==null&&(sa(r,2),$n(r))}function Je(r,a,l){if(r.tag===3)vm(r,r,l);else for(;a!==null;){if(a.tag===3){vm(a,r,l);break}else if(a.tag===1){var f=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof f.componentDidCatch=="function"&&(Ui===null||!Ui.has(f))){r=mn(l,r),l=w_(2),f=Ri(a,l,2),f!==null&&(A_(l,f,a,r),sa(f,2),$n(f));break}}a=a.return}}function If(r,a,l){var f=r.pingCache;if(f===null){f=r.pingCache=new D2;var p=new Set;f.set(a,p)}else p=f.get(a),p===void 0&&(p=new Set,f.set(a,p));p.has(l)||(Tf=!0,p.add(l),r=z2.bind(null,r,a,l),a.then(r,r))}function z2(r,a,l){var f=r.pingCache;f!==null&&f.delete(a),r.pingedLanes|=r.suspendedLanes&l,r.warmLanes&=~l,rt===r&&(Be&l)===l&&(pt===4||pt===3&&(Be&62914560)===Be&&300>ht()-wf?(He&2)===0&&Tr(r,0):xf|=l,yr===Be&&(yr=0)),$n(r)}function Tm(r,a){a===0&&(a=mp()),r=ir(r,a),r!==null&&(sa(r,a),$n(r))}function V2(r){var a=r.memoizedState,l=0;a!==null&&(l=a.retryLane),Tm(r,l)}function j2(r,a){var l=0;switch(r.tag){case 13:var f=r.stateNode,p=r.memoizedState;p!==null&&(l=p.retryLane);break;case 19:f=r.stateNode;break;case 22:f=r.stateNode._retryCache;break;default:throw Error(i(314))}f!==null&&f.delete(a),Tm(r,l)}function H2(r,a){return ut(r,a)}var xl=null,Sr=null,Nf=!1,Sl=!1,Pf=!1,Ss=0;function $n(r){r!==Sr&&r.next===null&&(Sr===null?xl=Sr=r:Sr=Sr.next=r),Sl=!0,Nf||(Nf=!0,$2())}function Va(r,a){if(!Pf&&Sl){Pf=!0;do for(var l=!1,f=xl;f!==null;){if(r!==0){var p=f.pendingLanes;if(p===0)var _=0;else{var b=f.suspendedLanes,v=f.pingedLanes;_=(1<<31-Dt(42|r)+1)-1,_&=p&~(b&~v),_=_&201326741?_&201326741|1:_?_|2:0}_!==0&&(l=!0,Am(f,_))}else _=Be,_=Mo(f,f===rt?_:0,f.cancelPendingCommit!==null||f.timeoutHandle!==-1),(_&3)===0||ia(f,_)||(l=!0,Am(f,_));f=f.next}while(l);Pf=!1}}function W2(){xm()}function xm(){Sl=Nf=!1;var r=0;Ss!==0&&(J2()&&(r=Ss),Ss=0);for(var a=ht(),l=null,f=xl;f!==null;){var p=f.next,_=Sm(f,a);_===0?(f.next=null,l===null?xl=p:l.next=p,p===null&&(Sr=l)):(l=f,(r!==0||(_&3)!==0)&&(Sl=!0)),f=p}Va(r)}function Sm(r,a){for(var l=r.suspendedLanes,f=r.pingedLanes,p=r.expirationTimes,_=r.pendingLanes&-62914561;0<_;){var b=31-Dt(_),v=1<<b,A=p[b];A===-1?((v&l)===0||(v&f)!==0)&&(p[b]=_T(v,a)):A<=a&&(r.expiredLanes|=v),_&=~v}if(a=rt,l=Be,l=Mo(r,r===a?l:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),f=r.callbackNode,l===0||r===a&&(We===2||We===9)||r.cancelPendingCommit!==null)return f!==null&&f!==null&&Le(f),r.callbackNode=null,r.callbackPriority=0;if((l&3)===0||ia(r,l)){if(a=l&-l,a===r.callbackPriority)return a;switch(f!==null&&Le(f),Yc(l)){case 2:case 8:l=On;break;case 32:l=In;break;case 268435456:l=vi;break;default:l=In}return f=wm.bind(null,r),l=ut(l,f),r.callbackPriority=a,r.callbackNode=l,a}return f!==null&&f!==null&&Le(f),r.callbackPriority=2,r.callbackNode=null,2}function wm(r,a){if(Bt!==0&&Bt!==5)return r.callbackNode=null,r.callbackPriority=0,null;var l=r.callbackNode;if(Tl()&&r.callbackNode!==l)return null;var f=Be;return f=Mo(r,r===rt?f:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),f===0?null:(am(r,f,a),Sm(r,ht()),r.callbackNode!=null&&r.callbackNode===l?wm.bind(null,r):null)}function Am(r,a){if(Tl())return null;am(r,a,!0)}function $2(){t1(function(){(He&6)!==0?ut(st,W2):xm()})}function kf(){return Ss===0&&(Ss=_p()),Ss}function Em(r){return r==null||typeof r=="symbol"||typeof r=="boolean"?null:typeof r=="function"?r:ko(""+r)}function Rm(r,a){var l=a.ownerDocument.createElement("input");return l.name=a.name,l.value=a.value,r.id&&l.setAttribute("form",r.id),a.parentNode.insertBefore(l,a),r=new FormData(r),l.parentNode.removeChild(l),r}function X2(r,a,l,f,p){if(a==="submit"&&l&&l.stateNode===p){var _=Em((p[Kt]||null).action),b=f.submitter;b&&(a=(a=b[Kt]||null)?Em(a.formAction):b.getAttribute("formAction"),a!==null&&(_=a,b=null));var v=new Fo("action","action",null,f,p);r.push({event:v,listeners:[{instance:null,listener:function(){if(f.defaultPrevented){if(Ss!==0){var A=b?Rm(p,b):new FormData(p);Ju(l,{pending:!0,data:A,method:p.method,action:_},null,A)}}else typeof _=="function"&&(v.preventDefault(),A=b?Rm(p,b):new FormData(p),Ju(l,{pending:!0,data:A,method:p.method,action:_},_,A))},currentTarget:p}]})}}for(var Df=0;Df<yu.length;Df++){var Uf=yu[Df],Y2=Uf.toLowerCase(),q2=Uf[0].toUpperCase()+Uf.slice(1);Nn(Y2,"on"+q2)}Nn(ag,"onAnimationEnd"),Nn(og,"onAnimationIteration"),Nn(lg,"onAnimationStart"),Nn("dblclick","onDoubleClick"),Nn("focusin","onFocus"),Nn("focusout","onBlur"),Nn(f2,"onTransitionRun"),Nn(h2,"onTransitionStart"),Nn(d2,"onTransitionCancel"),Nn(cg,"onTransitionEnd"),Ys("onMouseEnter",["mouseout","mouseover"]),Ys("onMouseLeave",["mouseout","mouseover"]),Ys("onPointerEnter",["pointerout","pointerover"]),Ys("onPointerLeave",["pointerout","pointerover"]),os("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),os("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),os("onBeforeInput",["compositionend","keypress","textInput","paste"]),os("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),os("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),os("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ja="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),K2=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(ja));function Cm(r,a){a=(a&4)!==0;for(var l=0;l<r.length;l++){var f=r[l],p=f.event;f=f.listeners;e:{var _=void 0;if(a)for(var b=f.length-1;0<=b;b--){var v=f[b],A=v.instance,j=v.currentTarget;if(v=v.listener,A!==_&&p.isPropagationStopped())break e;_=v,p.currentTarget=j;try{_(p)}catch(Q){ul(Q)}p.currentTarget=null,_=A}else for(b=0;b<f.length;b++){if(v=f[b],A=v.instance,j=v.currentTarget,v=v.listener,A!==_&&p.isPropagationStopped())break e;_=v,p.currentTarget=j;try{_(p)}catch(Q){ul(Q)}p.currentTarget=null,_=A}}}}function De(r,a){var l=a[qc];l===void 0&&(l=a[qc]=new Set);var f=r+"__bubble";l.has(f)||(Mm(a,r,2,!1),l.add(f))}function Bf(r,a,l){var f=0;a&&(f|=4),Mm(l,r,f,a)}var wl="_reactListening"+Math.random().toString(36).slice(2);function Ff(r){if(!r[wl]){r[wl]=!0,xp.forEach(function(l){l!=="selectionchange"&&(K2.has(l)||Bf(l,!1,r),Bf(l,!0,r))});var a=r.nodeType===9?r:r.ownerDocument;a===null||a[wl]||(a[wl]=!0,Bf("selectionchange",!1,a))}}function Mm(r,a,l,f){switch(Jm(a)){case 2:var p=x1;break;case 8:p=S1;break;default:p=Gf}l=p.bind(null,a,l,r),p=void 0,!ru||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(p=!0),f?p!==void 0?r.addEventListener(a,l,{capture:!0,passive:p}):r.addEventListener(a,l,!0):p!==void 0?r.addEventListener(a,l,{passive:p}):r.addEventListener(a,l,!1)}function Lf(r,a,l,f,p){var _=f;if((a&1)===0&&(a&2)===0&&f!==null)e:for(;;){if(f===null)return;var b=f.tag;if(b===3||b===4){var v=f.stateNode.containerInfo;if(v===p)break;if(b===4)for(b=f.return;b!==null;){var A=b.tag;if((A===3||A===4)&&b.stateNode.containerInfo===p)return;b=b.return}for(;v!==null;){if(b=Ws(v),b===null)return;if(A=b.tag,A===5||A===6||A===26||A===27){f=_=b;continue e}v=v.parentNode}}f=f.return}Up(function(){var j=_,Q=iu(l),ee=[];e:{var W=ug.get(r);if(W!==void 0){var X=Fo,Ae=r;switch(r){case"keypress":if(Uo(l)===0)break e;case"keydown":case"keyup":X=HT;break;case"focusin":Ae="focus",X=cu;break;case"focusout":Ae="blur",X=cu;break;case"beforeblur":case"afterblur":X=cu;break;case"click":if(l.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":X=Lp;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":X=IT;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":X=XT;break;case ag:case og:case lg:X=kT;break;case cg:X=qT;break;case"scroll":case"scrollend":X=MT;break;case"wheel":X=ZT;break;case"copy":case"cut":case"paste":X=UT;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":X=Vp;break;case"toggle":case"beforetoggle":X=GT}var Te=(a&4)!==0,Ke=!Te&&(r==="scroll"||r==="scrollend"),U=Te?W!==null?W+"Capture":null:W;Te=[];for(var I=j,z;I!==null;){var G=I;if(z=G.stateNode,G=G.tag,G!==5&&G!==26&&G!==27||z===null||U===null||(G=oa(I,U),G!=null&&Te.push(Ha(I,G,z))),Ke)break;I=I.return}0<Te.length&&(W=new X(W,Ae,null,l,Q),ee.push({event:W,listeners:Te}))}}if((a&7)===0){e:{if(W=r==="mouseover"||r==="pointerover",X=r==="mouseout"||r==="pointerout",W&&l!==nu&&(Ae=l.relatedTarget||l.fromElement)&&(Ws(Ae)||Ae[Hs]))break e;if((X||W)&&(W=Q.window===Q?Q:(W=Q.ownerDocument)?W.defaultView||W.parentWindow:window,X?(Ae=l.relatedTarget||l.toElement,X=j,Ae=Ae?Ws(Ae):null,Ae!==null&&(Ke=o(Ae),Te=Ae.tag,Ae!==Ke||Te!==5&&Te!==27&&Te!==6)&&(Ae=null)):(X=null,Ae=j),X!==Ae)){if(Te=Lp,G="onMouseLeave",U="onMouseEnter",I="mouse",(r==="pointerout"||r==="pointerover")&&(Te=Vp,G="onPointerLeave",U="onPointerEnter",I="pointer"),Ke=X==null?W:aa(X),z=Ae==null?W:aa(Ae),W=new Te(G,I+"leave",X,l,Q),W.target=Ke,W.relatedTarget=z,G=null,Ws(Q)===j&&(Te=new Te(U,I+"enter",Ae,l,Q),Te.target=z,Te.relatedTarget=Ke,G=Te),Ke=G,X&&Ae)t:{for(Te=X,U=Ae,I=0,z=Te;z;z=wr(z))I++;for(z=0,G=U;G;G=wr(G))z++;for(;0<I-z;)Te=wr(Te),I--;for(;0<z-I;)U=wr(U),z--;for(;I--;){if(Te===U||U!==null&&Te===U.alternate)break t;Te=wr(Te),U=wr(U)}Te=null}else Te=null;X!==null&&Om(ee,W,X,Te,!1),Ae!==null&&Ke!==null&&Om(ee,Ke,Ae,Te,!0)}}e:{if(W=j?aa(j):window,X=W.nodeName&&W.nodeName.toLowerCase(),X==="select"||X==="input"&&W.type==="file")var ge=Kp;else if(Yp(W))if(Zp)ge=l2;else{ge=a2;var Ne=r2}else X=W.nodeName,!X||X.toLowerCase()!=="input"||W.type!=="checkbox"&&W.type!=="radio"?j&&tu(j.elementType)&&(ge=Kp):ge=o2;if(ge&&(ge=ge(r,j))){qp(ee,ge,l,Q);break e}Ne&&Ne(r,W,j),r==="focusout"&&j&&W.type==="number"&&j.memoizedProps.value!=null&&eu(W,"number",W.value)}switch(Ne=j?aa(j):window,r){case"focusin":(Yp(Ne)||Ne.contentEditable==="true")&&(er=Ne,gu=j,ga=null);break;case"focusout":ga=gu=er=null;break;case"mousedown":_u=!0;break;case"contextmenu":case"mouseup":case"dragend":_u=!1,sg(ee,l,Q);break;case"selectionchange":if(u2)break;case"keydown":case"keyup":sg(ee,l,Q)}var ye;if(fu)e:{switch(r){case"compositionstart":var xe="onCompositionStart";break e;case"compositionend":xe="onCompositionEnd";break e;case"compositionupdate":xe="onCompositionUpdate";break e}xe=void 0}else Js?$p(r,l)&&(xe="onCompositionEnd"):r==="keydown"&&l.keyCode===229&&(xe="onCompositionStart");xe&&(jp&&l.locale!=="ko"&&(Js||xe!=="onCompositionStart"?xe==="onCompositionEnd"&&Js&&(ye=Bp()):(Si=Q,au="value"in Si?Si.value:Si.textContent,Js=!0)),Ne=Al(j,xe),0<Ne.length&&(xe=new zp(xe,r,null,l,Q),ee.push({event:xe,listeners:Ne}),ye?xe.data=ye:(ye=Xp(l),ye!==null&&(xe.data=ye)))),(ye=e2?t2(r,l):n2(r,l))&&(xe=Al(j,"onBeforeInput"),0<xe.length&&(Ne=new zp("onBeforeInput","beforeinput",null,l,Q),ee.push({event:Ne,listeners:xe}),Ne.data=ye)),X2(ee,r,j,l,Q)}Cm(ee,a)})}function Ha(r,a,l){return{instance:r,listener:a,currentTarget:l}}function Al(r,a){for(var l=a+"Capture",f=[];r!==null;){var p=r,_=p.stateNode;if(p=p.tag,p!==5&&p!==26&&p!==27||_===null||(p=oa(r,l),p!=null&&f.unshift(Ha(r,p,_)),p=oa(r,a),p!=null&&f.push(Ha(r,p,_))),r.tag===3)return f;r=r.return}return[]}function wr(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5&&r.tag!==27);return r||null}function Om(r,a,l,f,p){for(var _=a._reactName,b=[];l!==null&&l!==f;){var v=l,A=v.alternate,j=v.stateNode;if(v=v.tag,A!==null&&A===f)break;v!==5&&v!==26&&v!==27||j===null||(A=j,p?(j=oa(l,_),j!=null&&b.unshift(Ha(l,j,A))):p||(j=oa(l,_),j!=null&&b.push(Ha(l,j,A)))),l=l.return}b.length!==0&&r.push({event:a,listeners:b})}var Z2=/\r\n?/g,Q2=/\u0000|\uFFFD/g;function Im(r){return(typeof r=="string"?r:""+r).replace(Z2,`
`).replace(Q2,"")}function Nm(r,a){return a=Im(a),Im(r)===a}function El(){}function qe(r,a,l,f,p,_){switch(l){case"children":typeof f=="string"?a==="body"||a==="textarea"&&f===""||Zs(r,f):(typeof f=="number"||typeof f=="bigint")&&a!=="body"&&Zs(r,""+f);break;case"className":Io(r,"class",f);break;case"tabIndex":Io(r,"tabindex",f);break;case"dir":case"role":case"viewBox":case"width":case"height":Io(r,l,f);break;case"style":kp(r,f,_);break;case"data":if(a!=="object"){Io(r,"data",f);break}case"src":case"href":if(f===""&&(a!=="a"||l!=="href")){r.removeAttribute(l);break}if(f==null||typeof f=="function"||typeof f=="symbol"||typeof f=="boolean"){r.removeAttribute(l);break}f=ko(""+f),r.setAttribute(l,f);break;case"action":case"formAction":if(typeof f=="function"){r.setAttribute(l,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof _=="function"&&(l==="formAction"?(a!=="input"&&qe(r,a,"name",p.name,p,null),qe(r,a,"formEncType",p.formEncType,p,null),qe(r,a,"formMethod",p.formMethod,p,null),qe(r,a,"formTarget",p.formTarget,p,null)):(qe(r,a,"encType",p.encType,p,null),qe(r,a,"method",p.method,p,null),qe(r,a,"target",p.target,p,null)));if(f==null||typeof f=="symbol"||typeof f=="boolean"){r.removeAttribute(l);break}f=ko(""+f),r.setAttribute(l,f);break;case"onClick":f!=null&&(r.onclick=El);break;case"onScroll":f!=null&&De("scroll",r);break;case"onScrollEnd":f!=null&&De("scrollend",r);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(i(61));if(l=f.__html,l!=null){if(p.children!=null)throw Error(i(60));r.innerHTML=l}}break;case"multiple":r.multiple=f&&typeof f!="function"&&typeof f!="symbol";break;case"muted":r.muted=f&&typeof f!="function"&&typeof f!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(f==null||typeof f=="function"||typeof f=="boolean"||typeof f=="symbol"){r.removeAttribute("xlink:href");break}l=ko(""+f),r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",l);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":f!=null&&typeof f!="function"&&typeof f!="symbol"?r.setAttribute(l,""+f):r.removeAttribute(l);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":f&&typeof f!="function"&&typeof f!="symbol"?r.setAttribute(l,""):r.removeAttribute(l);break;case"capture":case"download":f===!0?r.setAttribute(l,""):f!==!1&&f!=null&&typeof f!="function"&&typeof f!="symbol"?r.setAttribute(l,f):r.removeAttribute(l);break;case"cols":case"rows":case"size":case"span":f!=null&&typeof f!="function"&&typeof f!="symbol"&&!isNaN(f)&&1<=f?r.setAttribute(l,f):r.removeAttribute(l);break;case"rowSpan":case"start":f==null||typeof f=="function"||typeof f=="symbol"||isNaN(f)?r.removeAttribute(l):r.setAttribute(l,f);break;case"popover":De("beforetoggle",r),De("toggle",r),Oo(r,"popover",f);break;case"xlinkActuate":ei(r,"http://www.w3.org/1999/xlink","xlink:actuate",f);break;case"xlinkArcrole":ei(r,"http://www.w3.org/1999/xlink","xlink:arcrole",f);break;case"xlinkRole":ei(r,"http://www.w3.org/1999/xlink","xlink:role",f);break;case"xlinkShow":ei(r,"http://www.w3.org/1999/xlink","xlink:show",f);break;case"xlinkTitle":ei(r,"http://www.w3.org/1999/xlink","xlink:title",f);break;case"xlinkType":ei(r,"http://www.w3.org/1999/xlink","xlink:type",f);break;case"xmlBase":ei(r,"http://www.w3.org/XML/1998/namespace","xml:base",f);break;case"xmlLang":ei(r,"http://www.w3.org/XML/1998/namespace","xml:lang",f);break;case"xmlSpace":ei(r,"http://www.w3.org/XML/1998/namespace","xml:space",f);break;case"is":Oo(r,"is",f);break;case"innerText":case"textContent":break;default:(!(2<l.length)||l[0]!=="o"&&l[0]!=="O"||l[1]!=="n"&&l[1]!=="N")&&(l=RT.get(l)||l,Oo(r,l,f))}}function zf(r,a,l,f,p,_){switch(l){case"style":kp(r,f,_);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(i(61));if(l=f.__html,l!=null){if(p.children!=null)throw Error(i(60));r.innerHTML=l}}break;case"children":typeof f=="string"?Zs(r,f):(typeof f=="number"||typeof f=="bigint")&&Zs(r,""+f);break;case"onScroll":f!=null&&De("scroll",r);break;case"onScrollEnd":f!=null&&De("scrollend",r);break;case"onClick":f!=null&&(r.onclick=El);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Sp.hasOwnProperty(l))e:{if(l[0]==="o"&&l[1]==="n"&&(p=l.endsWith("Capture"),a=l.slice(2,p?l.length-7:void 0),_=r[Kt]||null,_=_!=null?_[l]:null,typeof _=="function"&&r.removeEventListener(a,_,p),typeof f=="function")){typeof _!="function"&&_!==null&&(l in r?r[l]=null:r.hasAttribute(l)&&r.removeAttribute(l)),r.addEventListener(a,f,p);break e}l in r?r[l]=f:f===!0?r.setAttribute(l,""):Oo(r,l,f)}}}function Ft(r,a,l){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":De("error",r),De("load",r);var f=!1,p=!1,_;for(_ in l)if(l.hasOwnProperty(_)){var b=l[_];if(b!=null)switch(_){case"src":f=!0;break;case"srcSet":p=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,a));default:qe(r,a,_,b,l,null)}}p&&qe(r,a,"srcSet",l.srcSet,l,null),f&&qe(r,a,"src",l.src,l,null);return;case"input":De("invalid",r);var v=_=b=p=null,A=null,j=null;for(f in l)if(l.hasOwnProperty(f)){var Q=l[f];if(Q!=null)switch(f){case"name":p=Q;break;case"type":b=Q;break;case"checked":A=Q;break;case"defaultChecked":j=Q;break;case"value":_=Q;break;case"defaultValue":v=Q;break;case"children":case"dangerouslySetInnerHTML":if(Q!=null)throw Error(i(137,a));break;default:qe(r,a,f,Q,l,null)}}Op(r,_,v,A,j,b,p,!1),No(r);return;case"select":De("invalid",r),f=b=_=null;for(p in l)if(l.hasOwnProperty(p)&&(v=l[p],v!=null))switch(p){case"value":_=v;break;case"defaultValue":b=v;break;case"multiple":f=v;default:qe(r,a,p,v,l,null)}a=_,l=b,r.multiple=!!f,a!=null?Ks(r,!!f,a,!1):l!=null&&Ks(r,!!f,l,!0);return;case"textarea":De("invalid",r),_=p=f=null;for(b in l)if(l.hasOwnProperty(b)&&(v=l[b],v!=null))switch(b){case"value":f=v;break;case"defaultValue":p=v;break;case"children":_=v;break;case"dangerouslySetInnerHTML":if(v!=null)throw Error(i(91));break;default:qe(r,a,b,v,l,null)}Np(r,f,p,_),No(r);return;case"option":for(A in l)if(l.hasOwnProperty(A)&&(f=l[A],f!=null))switch(A){case"selected":r.selected=f&&typeof f!="function"&&typeof f!="symbol";break;default:qe(r,a,A,f,l,null)}return;case"dialog":De("beforetoggle",r),De("toggle",r),De("cancel",r),De("close",r);break;case"iframe":case"object":De("load",r);break;case"video":case"audio":for(f=0;f<ja.length;f++)De(ja[f],r);break;case"image":De("error",r),De("load",r);break;case"details":De("toggle",r);break;case"embed":case"source":case"link":De("error",r),De("load",r);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(j in l)if(l.hasOwnProperty(j)&&(f=l[j],f!=null))switch(j){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,a));default:qe(r,a,j,f,l,null)}return;default:if(tu(a)){for(Q in l)l.hasOwnProperty(Q)&&(f=l[Q],f!==void 0&&zf(r,a,Q,f,l,void 0));return}}for(v in l)l.hasOwnProperty(v)&&(f=l[v],f!=null&&qe(r,a,v,f,l,null))}function G2(r,a,l,f){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var p=null,_=null,b=null,v=null,A=null,j=null,Q=null;for(X in l){var ee=l[X];if(l.hasOwnProperty(X)&&ee!=null)switch(X){case"checked":break;case"value":break;case"defaultValue":A=ee;default:f.hasOwnProperty(X)||qe(r,a,X,null,f,ee)}}for(var W in f){var X=f[W];if(ee=l[W],f.hasOwnProperty(W)&&(X!=null||ee!=null))switch(W){case"type":_=X;break;case"name":p=X;break;case"checked":j=X;break;case"defaultChecked":Q=X;break;case"value":b=X;break;case"defaultValue":v=X;break;case"children":case"dangerouslySetInnerHTML":if(X!=null)throw Error(i(137,a));break;default:X!==ee&&qe(r,a,W,X,f,ee)}}Jc(r,b,v,A,j,Q,_,p);return;case"select":X=b=v=W=null;for(_ in l)if(A=l[_],l.hasOwnProperty(_)&&A!=null)switch(_){case"value":break;case"multiple":X=A;default:f.hasOwnProperty(_)||qe(r,a,_,null,f,A)}for(p in f)if(_=f[p],A=l[p],f.hasOwnProperty(p)&&(_!=null||A!=null))switch(p){case"value":W=_;break;case"defaultValue":v=_;break;case"multiple":b=_;default:_!==A&&qe(r,a,p,_,f,A)}a=v,l=b,f=X,W!=null?Ks(r,!!l,W,!1):!!f!=!!l&&(a!=null?Ks(r,!!l,a,!0):Ks(r,!!l,l?[]:"",!1));return;case"textarea":X=W=null;for(v in l)if(p=l[v],l.hasOwnProperty(v)&&p!=null&&!f.hasOwnProperty(v))switch(v){case"value":break;case"children":break;default:qe(r,a,v,null,f,p)}for(b in f)if(p=f[b],_=l[b],f.hasOwnProperty(b)&&(p!=null||_!=null))switch(b){case"value":W=p;break;case"defaultValue":X=p;break;case"children":break;case"dangerouslySetInnerHTML":if(p!=null)throw Error(i(91));break;default:p!==_&&qe(r,a,b,p,f,_)}Ip(r,W,X);return;case"option":for(var Ae in l)if(W=l[Ae],l.hasOwnProperty(Ae)&&W!=null&&!f.hasOwnProperty(Ae))switch(Ae){case"selected":r.selected=!1;break;default:qe(r,a,Ae,null,f,W)}for(A in f)if(W=f[A],X=l[A],f.hasOwnProperty(A)&&W!==X&&(W!=null||X!=null))switch(A){case"selected":r.selected=W&&typeof W!="function"&&typeof W!="symbol";break;default:qe(r,a,A,W,f,X)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Te in l)W=l[Te],l.hasOwnProperty(Te)&&W!=null&&!f.hasOwnProperty(Te)&&qe(r,a,Te,null,f,W);for(j in f)if(W=f[j],X=l[j],f.hasOwnProperty(j)&&W!==X&&(W!=null||X!=null))switch(j){case"children":case"dangerouslySetInnerHTML":if(W!=null)throw Error(i(137,a));break;default:qe(r,a,j,W,f,X)}return;default:if(tu(a)){for(var Ke in l)W=l[Ke],l.hasOwnProperty(Ke)&&W!==void 0&&!f.hasOwnProperty(Ke)&&zf(r,a,Ke,void 0,f,W);for(Q in f)W=f[Q],X=l[Q],!f.hasOwnProperty(Q)||W===X||W===void 0&&X===void 0||zf(r,a,Q,W,f,X);return}}for(var U in l)W=l[U],l.hasOwnProperty(U)&&W!=null&&!f.hasOwnProperty(U)&&qe(r,a,U,null,f,W);for(ee in f)W=f[ee],X=l[ee],!f.hasOwnProperty(ee)||W===X||W==null&&X==null||qe(r,a,ee,W,f,X)}var Vf=null,jf=null;function Rl(r){return r.nodeType===9?r:r.ownerDocument}function Pm(r){switch(r){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function km(r,a){if(r===0)switch(a){case"svg":return 1;case"math":return 2;default:return 0}return r===1&&a==="foreignObject"?0:r}function Hf(r,a){return r==="textarea"||r==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.children=="bigint"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var Wf=null;function J2(){var r=window.event;return r&&r.type==="popstate"?r===Wf?!1:(Wf=r,!0):(Wf=null,!1)}var Dm=typeof setTimeout=="function"?setTimeout:void 0,e1=typeof clearTimeout=="function"?clearTimeout:void 0,Um=typeof Promise=="function"?Promise:void 0,t1=typeof queueMicrotask=="function"?queueMicrotask:typeof Um<"u"?function(r){return Um.resolve(null).then(r).catch(n1)}:Dm;function n1(r){setTimeout(function(){throw r})}function Li(r){return r==="head"}function Bm(r,a){var l=a,f=0,p=0;do{var _=l.nextSibling;if(r.removeChild(l),_&&_.nodeType===8)if(l=_.data,l==="/$"){if(0<f&&8>f){l=f;var b=r.ownerDocument;if(l&1&&Wa(b.documentElement),l&2&&Wa(b.body),l&4)for(l=b.head,Wa(l),b=l.firstChild;b;){var v=b.nextSibling,A=b.nodeName;b[ra]||A==="SCRIPT"||A==="STYLE"||A==="LINK"&&b.rel.toLowerCase()==="stylesheet"||l.removeChild(b),b=v}}if(p===0){r.removeChild(_),Ga(a);return}p--}else l==="$"||l==="$?"||l==="$!"?p++:f=l.charCodeAt(0)-48;else f=0;l=_}while(l);Ga(a)}function $f(r){var a=r.firstChild;for(a&&a.nodeType===10&&(a=a.nextSibling);a;){var l=a;switch(a=a.nextSibling,l.nodeName){case"HTML":case"HEAD":case"BODY":$f(l),Kc(l);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(l.rel.toLowerCase()==="stylesheet")continue}r.removeChild(l)}}function i1(r,a,l,f){for(;r.nodeType===1;){var p=l;if(r.nodeName.toLowerCase()!==a.toLowerCase()){if(!f&&(r.nodeName!=="INPUT"||r.type!=="hidden"))break}else if(f){if(!r[ra])switch(a){case"meta":if(!r.hasAttribute("itemprop"))break;return r;case"link":if(_=r.getAttribute("rel"),_==="stylesheet"&&r.hasAttribute("data-precedence"))break;if(_!==p.rel||r.getAttribute("href")!==(p.href==null||p.href===""?null:p.href)||r.getAttribute("crossorigin")!==(p.crossOrigin==null?null:p.crossOrigin)||r.getAttribute("title")!==(p.title==null?null:p.title))break;return r;case"style":if(r.hasAttribute("data-precedence"))break;return r;case"script":if(_=r.getAttribute("src"),(_!==(p.src==null?null:p.src)||r.getAttribute("type")!==(p.type==null?null:p.type)||r.getAttribute("crossorigin")!==(p.crossOrigin==null?null:p.crossOrigin))&&_&&r.hasAttribute("async")&&!r.hasAttribute("itemprop"))break;return r;default:return r}}else if(a==="input"&&r.type==="hidden"){var _=p.name==null?null:""+p.name;if(p.type==="hidden"&&r.getAttribute("name")===_)return r}else return r;if(r=kn(r.nextSibling),r===null)break}return null}function s1(r,a,l){if(a==="")return null;for(;r.nodeType!==3;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!l||(r=kn(r.nextSibling),r===null))return null;return r}function Xf(r){return r.data==="$!"||r.data==="$?"&&r.ownerDocument.readyState==="complete"}function r1(r,a){var l=r.ownerDocument;if(r.data!=="$?"||l.readyState==="complete")a();else{var f=function(){a(),l.removeEventListener("DOMContentLoaded",f)};l.addEventListener("DOMContentLoaded",f),r._reactRetry=f}}function kn(r){for(;r!=null;r=r.nextSibling){var a=r.nodeType;if(a===1||a===3)break;if(a===8){if(a=r.data,a==="$"||a==="$!"||a==="$?"||a==="F!"||a==="F")break;if(a==="/$")return null}}return r}var Yf=null;function Fm(r){r=r.previousSibling;for(var a=0;r;){if(r.nodeType===8){var l=r.data;if(l==="$"||l==="$!"||l==="$?"){if(a===0)return r;a--}else l==="/$"&&a++}r=r.previousSibling}return null}function Lm(r,a,l){switch(a=Rl(l),r){case"html":if(r=a.documentElement,!r)throw Error(i(452));return r;case"head":if(r=a.head,!r)throw Error(i(453));return r;case"body":if(r=a.body,!r)throw Error(i(454));return r;default:throw Error(i(451))}}function Wa(r){for(var a=r.attributes;a.length;)r.removeAttributeNode(a[0]);Kc(r)}var Sn=new Map,zm=new Set;function Cl(r){return typeof r.getRootNode=="function"?r.getRootNode():r.nodeType===9?r:r.ownerDocument}var pi=ne.d;ne.d={f:a1,r:o1,D:l1,C:c1,L:u1,m:f1,X:d1,S:h1,M:p1};function a1(){var r=pi.f(),a=bl();return r||a}function o1(r){var a=$s(r);a!==null&&a.tag===5&&a.type==="form"?a_(a):pi.r(r)}var Ar=typeof document>"u"?null:document;function Vm(r,a,l){var f=Ar;if(f&&typeof a=="string"&&a){var p=_n(a);p='link[rel="'+r+'"][href="'+p+'"]',typeof l=="string"&&(p+='[crossorigin="'+l+'"]'),zm.has(p)||(zm.add(p),r={rel:r,crossOrigin:l,href:a},f.querySelector(p)===null&&(a=f.createElement("link"),Ft(a,"link",r),Ot(a),f.head.appendChild(a)))}}function l1(r){pi.D(r),Vm("dns-prefetch",r,null)}function c1(r,a){pi.C(r,a),Vm("preconnect",r,a)}function u1(r,a,l){pi.L(r,a,l);var f=Ar;if(f&&r&&a){var p='link[rel="preload"][as="'+_n(a)+'"]';a==="image"&&l&&l.imageSrcSet?(p+='[imagesrcset="'+_n(l.imageSrcSet)+'"]',typeof l.imageSizes=="string"&&(p+='[imagesizes="'+_n(l.imageSizes)+'"]')):p+='[href="'+_n(r)+'"]';var _=p;switch(a){case"style":_=Er(r);break;case"script":_=Rr(r)}Sn.has(_)||(r=g({rel:"preload",href:a==="image"&&l&&l.imageSrcSet?void 0:r,as:a},l),Sn.set(_,r),f.querySelector(p)!==null||a==="style"&&f.querySelector($a(_))||a==="script"&&f.querySelector(Xa(_))||(a=f.createElement("link"),Ft(a,"link",r),Ot(a),f.head.appendChild(a)))}}function f1(r,a){pi.m(r,a);var l=Ar;if(l&&r){var f=a&&typeof a.as=="string"?a.as:"script",p='link[rel="modulepreload"][as="'+_n(f)+'"][href="'+_n(r)+'"]',_=p;switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":_=Rr(r)}if(!Sn.has(_)&&(r=g({rel:"modulepreload",href:r},a),Sn.set(_,r),l.querySelector(p)===null)){switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(l.querySelector(Xa(_)))return}f=l.createElement("link"),Ft(f,"link",r),Ot(f),l.head.appendChild(f)}}}function h1(r,a,l){pi.S(r,a,l);var f=Ar;if(f&&r){var p=Xs(f).hoistableStyles,_=Er(r);a=a||"default";var b=p.get(_);if(!b){var v={loading:0,preload:null};if(b=f.querySelector($a(_)))v.loading=5;else{r=g({rel:"stylesheet",href:r,"data-precedence":a},l),(l=Sn.get(_))&&qf(r,l);var A=b=f.createElement("link");Ot(A),Ft(A,"link",r),A._p=new Promise(function(j,Q){A.onload=j,A.onerror=Q}),A.addEventListener("load",function(){v.loading|=1}),A.addEventListener("error",function(){v.loading|=2}),v.loading|=4,Ml(b,a,f)}b={type:"stylesheet",instance:b,count:1,state:v},p.set(_,b)}}}function d1(r,a){pi.X(r,a);var l=Ar;if(l&&r){var f=Xs(l).hoistableScripts,p=Rr(r),_=f.get(p);_||(_=l.querySelector(Xa(p)),_||(r=g({src:r,async:!0},a),(a=Sn.get(p))&&Kf(r,a),_=l.createElement("script"),Ot(_),Ft(_,"link",r),l.head.appendChild(_)),_={type:"script",instance:_,count:1,state:null},f.set(p,_))}}function p1(r,a){pi.M(r,a);var l=Ar;if(l&&r){var f=Xs(l).hoistableScripts,p=Rr(r),_=f.get(p);_||(_=l.querySelector(Xa(p)),_||(r=g({src:r,async:!0,type:"module"},a),(a=Sn.get(p))&&Kf(r,a),_=l.createElement("script"),Ot(_),Ft(_,"link",r),l.head.appendChild(_)),_={type:"script",instance:_,count:1,state:null},f.set(p,_))}}function jm(r,a,l,f){var p=(p=_e.current)?Cl(p):null;if(!p)throw Error(i(446));switch(r){case"meta":case"title":return null;case"style":return typeof l.precedence=="string"&&typeof l.href=="string"?(a=Er(l.href),l=Xs(p).hoistableStyles,f=l.get(a),f||(f={type:"style",instance:null,count:0,state:null},l.set(a,f)),f):{type:"void",instance:null,count:0,state:null};case"link":if(l.rel==="stylesheet"&&typeof l.href=="string"&&typeof l.precedence=="string"){r=Er(l.href);var _=Xs(p).hoistableStyles,b=_.get(r);if(b||(p=p.ownerDocument||p,b={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},_.set(r,b),(_=p.querySelector($a(r)))&&!_._p&&(b.instance=_,b.state.loading=5),Sn.has(r)||(l={rel:"preload",as:"style",href:l.href,crossOrigin:l.crossOrigin,integrity:l.integrity,media:l.media,hrefLang:l.hrefLang,referrerPolicy:l.referrerPolicy},Sn.set(r,l),_||g1(p,r,l,b.state))),a&&f===null)throw Error(i(528,""));return b}if(a&&f!==null)throw Error(i(529,""));return null;case"script":return a=l.async,l=l.src,typeof l=="string"&&a&&typeof a!="function"&&typeof a!="symbol"?(a=Rr(l),l=Xs(p).hoistableScripts,f=l.get(a),f||(f={type:"script",instance:null,count:0,state:null},l.set(a,f)),f):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,r))}}function Er(r){return'href="'+_n(r)+'"'}function $a(r){return'link[rel="stylesheet"]['+r+"]"}function Hm(r){return g({},r,{"data-precedence":r.precedence,precedence:null})}function g1(r,a,l,f){r.querySelector('link[rel="preload"][as="style"]['+a+"]")?f.loading=1:(a=r.createElement("link"),f.preload=a,a.addEventListener("load",function(){return f.loading|=1}),a.addEventListener("error",function(){return f.loading|=2}),Ft(a,"link",l),Ot(a),r.head.appendChild(a))}function Rr(r){return'[src="'+_n(r)+'"]'}function Xa(r){return"script[async]"+r}function Wm(r,a,l){if(a.count++,a.instance===null)switch(a.type){case"style":var f=r.querySelector('style[data-href~="'+_n(l.href)+'"]');if(f)return a.instance=f,Ot(f),f;var p=g({},l,{"data-href":l.href,"data-precedence":l.precedence,href:null,precedence:null});return f=(r.ownerDocument||r).createElement("style"),Ot(f),Ft(f,"style",p),Ml(f,l.precedence,r),a.instance=f;case"stylesheet":p=Er(l.href);var _=r.querySelector($a(p));if(_)return a.state.loading|=4,a.instance=_,Ot(_),_;f=Hm(l),(p=Sn.get(p))&&qf(f,p),_=(r.ownerDocument||r).createElement("link"),Ot(_);var b=_;return b._p=new Promise(function(v,A){b.onload=v,b.onerror=A}),Ft(_,"link",f),a.state.loading|=4,Ml(_,l.precedence,r),a.instance=_;case"script":return _=Rr(l.src),(p=r.querySelector(Xa(_)))?(a.instance=p,Ot(p),p):(f=l,(p=Sn.get(_))&&(f=g({},l),Kf(f,p)),r=r.ownerDocument||r,p=r.createElement("script"),Ot(p),Ft(p,"link",f),r.head.appendChild(p),a.instance=p);case"void":return null;default:throw Error(i(443,a.type))}else a.type==="stylesheet"&&(a.state.loading&4)===0&&(f=a.instance,a.state.loading|=4,Ml(f,l.precedence,r));return a.instance}function Ml(r,a,l){for(var f=l.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),p=f.length?f[f.length-1]:null,_=p,b=0;b<f.length;b++){var v=f[b];if(v.dataset.precedence===a)_=v;else if(_!==p)break}_?_.parentNode.insertBefore(r,_.nextSibling):(a=l.nodeType===9?l.head:l,a.insertBefore(r,a.firstChild))}function qf(r,a){r.crossOrigin==null&&(r.crossOrigin=a.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=a.referrerPolicy),r.title==null&&(r.title=a.title)}function Kf(r,a){r.crossOrigin==null&&(r.crossOrigin=a.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=a.referrerPolicy),r.integrity==null&&(r.integrity=a.integrity)}var Ol=null;function $m(r,a,l){if(Ol===null){var f=new Map,p=Ol=new Map;p.set(l,f)}else p=Ol,f=p.get(l),f||(f=new Map,p.set(l,f));if(f.has(r))return f;for(f.set(r,null),l=l.getElementsByTagName(r),p=0;p<l.length;p++){var _=l[p];if(!(_[ra]||_[Lt]||r==="link"&&_.getAttribute("rel")==="stylesheet")&&_.namespaceURI!=="http://www.w3.org/2000/svg"){var b=_.getAttribute(a)||"";b=r+b;var v=f.get(b);v?v.push(_):f.set(b,[_])}}return f}function Xm(r,a,l){r=r.ownerDocument||r,r.head.insertBefore(l,a==="title"?r.querySelector("head > title"):null)}function _1(r,a,l){if(l===1||a.itemProp!=null)return!1;switch(r){case"meta":case"title":return!0;case"style":if(typeof a.precedence!="string"||typeof a.href!="string"||a.href==="")break;return!0;case"link":if(typeof a.rel!="string"||typeof a.href!="string"||a.href===""||a.onLoad||a.onError)break;switch(a.rel){case"stylesheet":return r=a.disabled,typeof a.precedence=="string"&&r==null;default:return!0}case"script":if(a.async&&typeof a.async!="function"&&typeof a.async!="symbol"&&!a.onLoad&&!a.onError&&a.src&&typeof a.src=="string")return!0}return!1}function Ym(r){return!(r.type==="stylesheet"&&(r.state.loading&3)===0)}var Ya=null;function m1(){}function y1(r,a,l){if(Ya===null)throw Error(i(475));var f=Ya;if(a.type==="stylesheet"&&(typeof l.media!="string"||matchMedia(l.media).matches!==!1)&&(a.state.loading&4)===0){if(a.instance===null){var p=Er(l.href),_=r.querySelector($a(p));if(_){r=_._p,r!==null&&typeof r=="object"&&typeof r.then=="function"&&(f.count++,f=Il.bind(f),r.then(f,f)),a.state.loading|=4,a.instance=_,Ot(_);return}_=r.ownerDocument||r,l=Hm(l),(p=Sn.get(p))&&qf(l,p),_=_.createElement("link"),Ot(_);var b=_;b._p=new Promise(function(v,A){b.onload=v,b.onerror=A}),Ft(_,"link",l),a.instance=_}f.stylesheets===null&&(f.stylesheets=new Map),f.stylesheets.set(a,r),(r=a.state.preload)&&(a.state.loading&3)===0&&(f.count++,a=Il.bind(f),r.addEventListener("load",a),r.addEventListener("error",a))}}function b1(){if(Ya===null)throw Error(i(475));var r=Ya;return r.stylesheets&&r.count===0&&Zf(r,r.stylesheets),0<r.count?function(a){var l=setTimeout(function(){if(r.stylesheets&&Zf(r,r.stylesheets),r.unsuspend){var f=r.unsuspend;r.unsuspend=null,f()}},6e4);return r.unsuspend=a,function(){r.unsuspend=null,clearTimeout(l)}}:null}function Il(){if(this.count--,this.count===0){if(this.stylesheets)Zf(this,this.stylesheets);else if(this.unsuspend){var r=this.unsuspend;this.unsuspend=null,r()}}}var Nl=null;function Zf(r,a){r.stylesheets=null,r.unsuspend!==null&&(r.count++,Nl=new Map,a.forEach(v1,r),Nl=null,Il.call(r))}function v1(r,a){if(!(a.state.loading&4)){var l=Nl.get(r);if(l)var f=l.get(null);else{l=new Map,Nl.set(r,l);for(var p=r.querySelectorAll("link[data-precedence],style[data-precedence]"),_=0;_<p.length;_++){var b=p[_];(b.nodeName==="LINK"||b.getAttribute("media")!=="not all")&&(l.set(b.dataset.precedence,b),f=b)}f&&l.set(null,f)}p=a.instance,b=p.getAttribute("data-precedence"),_=l.get(b)||f,_===f&&l.set(null,p),l.set(b,p),this.count++,f=Il.bind(this),p.addEventListener("load",f),p.addEventListener("error",f),_?_.parentNode.insertBefore(p,_.nextSibling):(r=r.nodeType===9?r.head:r,r.insertBefore(p,r.firstChild)),a.state.loading|=4}}var qa={$$typeof:O,Provider:null,Consumer:null,_currentValue:fe,_currentValue2:fe,_threadCount:0};function T1(r,a,l,f,p,_,b,v){this.tag=1,this.containerInfo=r,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=$c(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=$c(0),this.hiddenUpdates=$c(null),this.identifierPrefix=f,this.onUncaughtError=p,this.onCaughtError=_,this.onRecoverableError=b,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=v,this.incompleteTransitions=new Map}function qm(r,a,l,f,p,_,b,v,A,j,Q,ee){return r=new T1(r,a,l,b,v,A,j,ee),a=1,_===!0&&(a|=24),_=tn(3,null,null,a),r.current=_,_.stateNode=r,a=Ou(),a.refCount++,r.pooledCache=a,a.refCount++,_.memoizedState={element:f,isDehydrated:l,cache:a},ku(_),r}function Km(r){return r?(r=sr,r):sr}function Zm(r,a,l,f,p,_){p=Km(p),f.context===null?f.context=p:f.pendingContext=p,f=Ei(a),f.payload={element:l},_=_===void 0?null:_,_!==null&&(f.callback=_),l=Ri(r,f,a),l!==null&&(on(l,r,a),wa(l,r,a))}function Qm(r,a){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var l=r.retryLane;r.retryLane=l!==0&&l<a?l:a}}function Qf(r,a){Qm(r,a),(r=r.alternate)&&Qm(r,a)}function Gm(r){if(r.tag===13){var a=ir(r,67108864);a!==null&&on(a,r,67108864),Qf(r,67108864)}}var Pl=!0;function x1(r,a,l,f){var p=K.T;K.T=null;var _=ne.p;try{ne.p=2,Gf(r,a,l,f)}finally{ne.p=_,K.T=p}}function S1(r,a,l,f){var p=K.T;K.T=null;var _=ne.p;try{ne.p=8,Gf(r,a,l,f)}finally{ne.p=_,K.T=p}}function Gf(r,a,l,f){if(Pl){var p=Jf(f);if(p===null)Lf(r,a,f,kl,l),ey(r,f);else if(A1(p,r,a,l,f))f.stopPropagation();else if(ey(r,f),a&4&&-1<w1.indexOf(r)){for(;p!==null;){var _=$s(p);if(_!==null)switch(_.tag){case 3:if(_=_.stateNode,_.current.memoizedState.isDehydrated){var b=as(_.pendingLanes);if(b!==0){var v=_;for(v.pendingLanes|=2,v.entangledLanes|=2;b;){var A=1<<31-Dt(b);v.entanglements[1]|=A,b&=~A}$n(_),(He&6)===0&&(ml=ht()+500,Va(0))}}break;case 13:v=ir(_,2),v!==null&&on(v,_,2),bl(),Qf(_,2)}if(_=Jf(f),_===null&&Lf(r,a,f,kl,l),_===p)break;p=_}p!==null&&f.stopPropagation()}else Lf(r,a,f,null,l)}}function Jf(r){return r=iu(r),eh(r)}var kl=null;function eh(r){if(kl=null,r=Ws(r),r!==null){var a=o(r);if(a===null)r=null;else{var l=a.tag;if(l===13){if(r=c(a),r!==null)return r;r=null}else if(l===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;r=null}else a!==r&&(r=null)}}return kl=r,null}function Jm(r){switch(r){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Re()){case st:return 2;case On:return 8;case In:case hn:return 32;case vi:return 268435456;default:return 32}default:return 32}}var th=!1,zi=null,Vi=null,ji=null,Ka=new Map,Za=new Map,Hi=[],w1="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function ey(r,a){switch(r){case"focusin":case"focusout":zi=null;break;case"dragenter":case"dragleave":Vi=null;break;case"mouseover":case"mouseout":ji=null;break;case"pointerover":case"pointerout":Ka.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":Za.delete(a.pointerId)}}function Qa(r,a,l,f,p,_){return r===null||r.nativeEvent!==_?(r={blockedOn:a,domEventName:l,eventSystemFlags:f,nativeEvent:_,targetContainers:[p]},a!==null&&(a=$s(a),a!==null&&Gm(a)),r):(r.eventSystemFlags|=f,a=r.targetContainers,p!==null&&a.indexOf(p)===-1&&a.push(p),r)}function A1(r,a,l,f,p){switch(a){case"focusin":return zi=Qa(zi,r,a,l,f,p),!0;case"dragenter":return Vi=Qa(Vi,r,a,l,f,p),!0;case"mouseover":return ji=Qa(ji,r,a,l,f,p),!0;case"pointerover":var _=p.pointerId;return Ka.set(_,Qa(Ka.get(_)||null,r,a,l,f,p)),!0;case"gotpointercapture":return _=p.pointerId,Za.set(_,Qa(Za.get(_)||null,r,a,l,f,p)),!0}return!1}function ty(r){var a=Ws(r.target);if(a!==null){var l=o(a);if(l!==null){if(a=l.tag,a===13){if(a=c(l),a!==null){r.blockedOn=a,yT(r.priority,function(){if(l.tag===13){var f=an();f=Xc(f);var p=ir(l,f);p!==null&&on(p,l,f),Qf(l,f)}});return}}else if(a===3&&l.stateNode.current.memoizedState.isDehydrated){r.blockedOn=l.tag===3?l.stateNode.containerInfo:null;return}}}r.blockedOn=null}function Dl(r){if(r.blockedOn!==null)return!1;for(var a=r.targetContainers;0<a.length;){var l=Jf(r.nativeEvent);if(l===null){l=r.nativeEvent;var f=new l.constructor(l.type,l);nu=f,l.target.dispatchEvent(f),nu=null}else return a=$s(l),a!==null&&Gm(a),r.blockedOn=l,!1;a.shift()}return!0}function ny(r,a,l){Dl(r)&&l.delete(a)}function E1(){th=!1,zi!==null&&Dl(zi)&&(zi=null),Vi!==null&&Dl(Vi)&&(Vi=null),ji!==null&&Dl(ji)&&(ji=null),Ka.forEach(ny),Za.forEach(ny)}function Ul(r,a){r.blockedOn===a&&(r.blockedOn=null,th||(th=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,E1)))}var Bl=null;function iy(r){Bl!==r&&(Bl=r,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){Bl===r&&(Bl=null);for(var a=0;a<r.length;a+=3){var l=r[a],f=r[a+1],p=r[a+2];if(typeof f!="function"){if(eh(f||l)===null)continue;break}var _=$s(l);_!==null&&(r.splice(a,3),a-=3,Ju(_,{pending:!0,data:p,method:l.method,action:f},f,p))}}))}function Ga(r){function a(A){return Ul(A,r)}zi!==null&&Ul(zi,r),Vi!==null&&Ul(Vi,r),ji!==null&&Ul(ji,r),Ka.forEach(a),Za.forEach(a);for(var l=0;l<Hi.length;l++){var f=Hi[l];f.blockedOn===r&&(f.blockedOn=null)}for(;0<Hi.length&&(l=Hi[0],l.blockedOn===null);)ty(l),l.blockedOn===null&&Hi.shift();if(l=(r.ownerDocument||r).$$reactFormReplay,l!=null)for(f=0;f<l.length;f+=3){var p=l[f],_=l[f+1],b=p[Kt]||null;if(typeof _=="function")b||iy(l);else if(b){var v=null;if(_&&_.hasAttribute("formAction")){if(p=_,b=_[Kt]||null)v=b.formAction;else if(eh(p)!==null)continue}else v=b.action;typeof v=="function"?l[f+1]=v:(l.splice(f,3),f-=3),iy(l)}}}function nh(r){this._internalRoot=r}Fl.prototype.render=nh.prototype.render=function(r){var a=this._internalRoot;if(a===null)throw Error(i(409));var l=a.current,f=an();Zm(l,f,r,a,null,null)},Fl.prototype.unmount=nh.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var a=r.containerInfo;Zm(r.current,2,null,r,null,null),bl(),a[Hs]=null}};function Fl(r){this._internalRoot=r}Fl.prototype.unstable_scheduleHydration=function(r){if(r){var a=vp();r={blockedOn:null,target:r,priority:a};for(var l=0;l<Hi.length&&a!==0&&a<Hi[l].priority;l++);Hi.splice(l,0,r),l===0&&ty(r)}};var sy=e.version;if(sy!=="19.1.1")throw Error(i(527,sy,"19.1.1"));ne.findDOMNode=function(r){var a=r._reactInternals;if(a===void 0)throw typeof r.render=="function"?Error(i(188)):(r=Object.keys(r).join(","),Error(i(268,r)));return r=h(a),r=r!==null?d(r):null,r=r===null?null:r.stateNode,r};var R1={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:K,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ll=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ll.isDisabled&&Ll.supportsFiber)try{ot=Ll.inject(R1),Xe=Ll}catch{}}return eo.createRoot=function(r,a){if(!s(r))throw Error(i(299));var l=!1,f="",p=v_,_=T_,b=x_,v=null;return a!=null&&(a.unstable_strictMode===!0&&(l=!0),a.identifierPrefix!==void 0&&(f=a.identifierPrefix),a.onUncaughtError!==void 0&&(p=a.onUncaughtError),a.onCaughtError!==void 0&&(_=a.onCaughtError),a.onRecoverableError!==void 0&&(b=a.onRecoverableError),a.unstable_transitionCallbacks!==void 0&&(v=a.unstable_transitionCallbacks)),a=qm(r,1,!1,null,null,l,f,p,_,b,v,null),r[Hs]=a.current,Ff(r),new nh(a)},eo.hydrateRoot=function(r,a,l){if(!s(r))throw Error(i(299));var f=!1,p="",_=v_,b=T_,v=x_,A=null,j=null;return l!=null&&(l.unstable_strictMode===!0&&(f=!0),l.identifierPrefix!==void 0&&(p=l.identifierPrefix),l.onUncaughtError!==void 0&&(_=l.onUncaughtError),l.onCaughtError!==void 0&&(b=l.onCaughtError),l.onRecoverableError!==void 0&&(v=l.onRecoverableError),l.unstable_transitionCallbacks!==void 0&&(A=l.unstable_transitionCallbacks),l.formState!==void 0&&(j=l.formState)),a=qm(r,1,!0,a,l??null,f,p,_,b,v,A,j),a.context=Km(null),l=a.current,f=an(),f=Xc(f),p=Ei(f),p.callback=null,Ri(l,p,f),l=f,a.current.lanes=l,sa(a,l),$n(a),r[Hs]=a.current,Ff(r),new Fl(a)},eo.version="19.1.1",eo}var py;function U1(){if(py)return rh.exports;py=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),rh.exports=D1(),rh.exports}var B1=U1();const gy=n=>{let e;const t=new Set,i=(d,g)=>{const m=typeof d=="function"?d(e):d;if(!Object.is(m,e)){const y=e;e=g??(typeof m!="object"||m===null)?m:Object.assign({},e,m),t.forEach(T=>T(e,y))}},s=()=>e,u={setState:i,getState:s,getInitialState:()=>h,subscribe:d=>(t.add(d),()=>t.delete(d))},h=e=n(i,s,u);return u},F1=(n=>n?gy(n):gy),L1=n=>n;function z1(n,e=L1){const t=zl.useSyncExternalStore(n.subscribe,zl.useCallback(()=>e(n.getState()),[n,e]),zl.useCallback(()=>e(n.getInitialState()),[n,e]));return zl.useDebugValue(t),t}const _y=n=>{const e=F1(n),t=i=>z1(e,i);return Object.assign(t,e),t},V1=(n=>n?_y(n):_y),ta=V1((n,e)=>({lanes:[],lanesById:{},pointsAll:[],pointsOrigin:[],pointsDestination:[],originToCustomers:{},tab:"all",filters:{query:""},heatmap:{radiusPixels:100,intensity:1.1,enabled:!0},lanesVisible:!1,pointsVisible:!0,isLoading:!1,error:null,setLanes:t=>{const i=t.reduce((s,o)=>(s[o.id]=o,s),{});n({lanes:t,lanesById:i})},setPoints:(t,i,s)=>{n({pointsAll:t,pointsOrigin:i,pointsDestination:s})},setOriginToCustomers:t=>{n({originToCustomers:t})},toggleLane:t=>{n(i=>({lanesById:{...i.lanesById,[t]:{...i.lanesById[t],visible:!i.lanesById[t].visible}},lanes:i.lanes.map(s=>s.id===t?{...s,visible:!s.visible}:s)}))},setAllVisible:t=>{n(i=>({lanesById:Object.keys(i.lanesById).reduce((s,o)=>(s[o]={...i.lanesById[o],visible:t},s),{}),lanes:i.lanes.map(s=>({...s,visible:t}))}))},setTab:t=>n({tab:t}),setQuery:t=>n(i=>({filters:{...i.filters,query:t}})),setHeatmap:t=>n(i=>({heatmap:{...i.heatmap,...t}})),setLanesVisible:t=>n({lanesVisible:t}),setPointsVisible:t=>n({pointsVisible:t}),setLoading:t=>n({isLoading:t}),setError:t=>n({error:t}),getFilteredLanes:()=>{const{lanes:t,filters:i,originToCustomers:s}=e();if(!i.query.trim())return t;const o=i.query.toLowerCase();return t.filter(c=>{if(c.origin_zip.includes(o)||c.destination_zip.includes(o))return!0;const u=s[c.origin_zip];if(u){for(const h of u)if(h.toLowerCase().includes(o))return!0}return!1})},getVisibleLanes:()=>e().getFilteredLanes().filter(i=>i.visible),getHeatmapPoints:()=>{const{tab:t,pointsAll:i,pointsOrigin:s,pointsDestination:o}=e();switch(t){case"origin":return s;case"destination":return o;default:return i}}}));var tc={exports:{}};/* @license
Papa Parse
v5.5.3
https://github.com/mholt/PapaParse
License: MIT
*/var j1=tc.exports,my;function H1(){return my||(my=1,(function(n,e){((t,i)=>{n.exports=i()})(j1,function t(){var i=typeof self<"u"?self:typeof window<"u"?window:i!==void 0?i:{},s,o=!i.document&&!!i.postMessage,c=i.IS_PAPA_WORKER||!1,u={},h=0,d={};function g(E){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(R){var Y=H(R);Y.chunkSize=parseInt(Y.chunkSize),R.step||R.chunk||(Y.chunkSize=null),this._handle=new C(Y),(this._handle.streamer=this)._config=Y}).call(this,E),this.parseChunk=function(R,Y){var ie=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<ie){let pe=this._config.newline;pe||(re=this._config.quoteChar||'"',pe=this._handle.guessLineEndings(R,re)),R=[...R.split(pe).slice(ie)].join(pe)}this.isFirstChunk&&oe(this._config.beforeFirstChunk)&&(re=this._config.beforeFirstChunk(R))!==void 0&&(R=re),this.isFirstChunk=!1,this._halted=!1;var ie=this._partialLine+R,re=(this._partialLine="",this._handle.parse(ie,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(R=re.meta.cursor,ie=(this._finished||(this._partialLine=ie.substring(R-this._baseIndex),this._baseIndex=R),re&&re.data&&(this._rowCount+=re.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),c)i.postMessage({results:re,workerId:d.WORKER_ID,finished:ie});else if(oe(this._config.chunk)&&!Y){if(this._config.chunk(re,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=re=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(re.data),this._completeResults.errors=this._completeResults.errors.concat(re.errors),this._completeResults.meta=re.meta),this._completed||!ie||!oe(this._config.complete)||re&&re.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),ie||re&&re.meta.paused||this._nextChunk(),re}this._halted=!0},this._sendError=function(R){oe(this._config.error)?this._config.error(R):c&&this._config.error&&i.postMessage({workerId:d.WORKER_ID,error:R,finished:!1})}}function m(E){var R;(E=E||{}).chunkSize||(E.chunkSize=d.RemoteChunkSize),g.call(this,E),this._nextChunk=o?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(Y){this._input=Y,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(R=new XMLHttpRequest,this._config.withCredentials&&(R.withCredentials=this._config.withCredentials),o||(R.onload=te(this._chunkLoaded,this),R.onerror=te(this._chunkError,this)),R.open(this._config.downloadRequestBody?"POST":"GET",this._input,!o),this._config.downloadRequestHeaders){var Y,ie=this._config.downloadRequestHeaders;for(Y in ie)R.setRequestHeader(Y,ie[Y])}var re;this._config.chunkSize&&(re=this._start+this._config.chunkSize-1,R.setRequestHeader("Range","bytes="+this._start+"-"+re));try{R.send(this._config.downloadRequestBody)}catch(pe){this._chunkError(pe.message)}o&&R.status===0&&this._chunkError()}},this._chunkLoaded=function(){R.readyState===4&&(R.status<200||400<=R.status?this._chunkError():(this._start+=this._config.chunkSize||R.responseText.length,this._finished=!this._config.chunkSize||this._start>=(Y=>(Y=Y.getResponseHeader("Content-Range"))!==null?parseInt(Y.substring(Y.lastIndexOf("/")+1)):-1)(R),this.parseChunk(R.responseText)))},this._chunkError=function(Y){Y=R.statusText||Y,this._sendError(new Error(Y))}}function y(E){(E=E||{}).chunkSize||(E.chunkSize=d.LocalChunkSize),g.call(this,E);var R,Y,ie=typeof FileReader<"u";this.stream=function(re){this._input=re,Y=re.slice||re.webkitSlice||re.mozSlice,ie?((R=new FileReader).onload=te(this._chunkLoaded,this),R.onerror=te(this._chunkError,this)):R=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var re=this._input,pe=(this._config.chunkSize&&(pe=Math.min(this._start+this._config.chunkSize,this._input.size),re=Y.call(re,this._start,pe)),R.readAsText(re,this._config.encoding));ie||this._chunkLoaded({target:{result:pe}})},this._chunkLoaded=function(re){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(re.target.result)},this._chunkError=function(){this._sendError(R.error)}}function T(E){var R;g.call(this,E=E||{}),this.stream=function(Y){return R=Y,this._nextChunk()},this._nextChunk=function(){var Y,ie;if(!this._finished)return Y=this._config.chunkSize,R=Y?(ie=R.substring(0,Y),R.substring(Y)):(ie=R,""),this._finished=!R,this.parseChunk(ie)}}function w(E){g.call(this,E=E||{});var R=[],Y=!0,ie=!1;this.pause=function(){g.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){g.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(re){this._input=re,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){ie&&R.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),R.length?this.parseChunk(R.shift()):Y=!0},this._streamData=te(function(re){try{R.push(typeof re=="string"?re:re.toString(this._config.encoding)),Y&&(Y=!1,this._checkIsFinished(),this.parseChunk(R.shift()))}catch(pe){this._streamError(pe)}},this),this._streamError=te(function(re){this._streamCleanUp(),this._sendError(re)},this),this._streamEnd=te(function(){this._streamCleanUp(),ie=!0,this._streamData("")},this),this._streamCleanUp=te(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function C(E){var R,Y,ie,re,pe=Math.pow(2,53),be=-pe,Ie=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,K=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,ne=this,fe=0,he=0,M=!1,q=!1,se=[],Z={data:[],errors:[],meta:{}};function de(me){return E.skipEmptyLines==="greedy"?me.join("").trim()==="":me.length===1&&me[0].length===0}function ve(){if(Z&&ie&&(tt("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+d.DefaultDelimiter+"'"),ie=!1),E.skipEmptyLines&&(Z.data=Z.data.filter(function(we){return!de(we)})),_e()){let we=function(it,ut){oe(E.transformHeader)&&(it=E.transformHeader(it,ut)),se.push(it)};if(Z)if(Array.isArray(Z.data[0])){for(var me=0;_e()&&me<Z.data.length;me++)Z.data[me].forEach(we);Z.data.splice(0,1)}else Z.data.forEach(we)}function Me(we,it){for(var ut=E.header?{}:[],Le=0;Le<we.length;Le++){var $e=Le,Pe=we[Le],Pe=((ht,Re)=>(st=>(E.dynamicTypingFunction&&E.dynamicTyping[st]===void 0&&(E.dynamicTyping[st]=E.dynamicTypingFunction(st)),(E.dynamicTyping[st]||E.dynamicTyping)===!0))(ht)?Re==="true"||Re==="TRUE"||Re!=="false"&&Re!=="FALSE"&&((st=>{if(Ie.test(st)&&(st=parseFloat(st),be<st&&st<pe))return 1})(Re)?parseFloat(Re):K.test(Re)?new Date(Re):Re===""?null:Re):Re)($e=E.header?Le>=se.length?"__parsed_extra":se[Le]:$e,Pe=E.transform?E.transform(Pe,$e):Pe);$e==="__parsed_extra"?(ut[$e]=ut[$e]||[],ut[$e].push(Pe)):ut[$e]=Pe}return E.header&&(Le>se.length?tt("FieldMismatch","TooManyFields","Too many fields: expected "+se.length+" fields but parsed "+Le,he+it):Le<se.length&&tt("FieldMismatch","TooFewFields","Too few fields: expected "+se.length+" fields but parsed "+Le,he+it)),ut}var nt;Z&&(E.header||E.dynamicTyping||E.transform)&&(nt=1,!Z.data.length||Array.isArray(Z.data[0])?(Z.data=Z.data.map(Me),nt=Z.data.length):Z.data=Me(Z.data,0),E.header&&Z.meta&&(Z.meta.fields=se),he+=nt)}function _e(){return E.header&&se.length===0}function tt(me,Me,nt,we){me={type:me,code:Me,message:nt},we!==void 0&&(me.row=we),Z.errors.push(me)}oe(E.step)&&(re=E.step,E.step=function(me){Z=me,_e()?ve():(ve(),Z.data.length!==0&&(fe+=me.data.length,E.preview&&fe>E.preview?Y.abort():(Z.data=Z.data[0],re(Z,ne))))}),this.parse=function(me,Me,nt){var we=E.quoteChar||'"',we=(E.newline||(E.newline=this.guessLineEndings(me,we)),ie=!1,E.delimiter?oe(E.delimiter)&&(E.delimiter=E.delimiter(me),Z.meta.delimiter=E.delimiter):((we=((it,ut,Le,$e,Pe)=>{var ht,Re,st,On;Pe=Pe||[",","	","|",";",d.RECORD_SEP,d.UNIT_SEP];for(var In=0;In<Pe.length;In++){for(var hn,vi=Pe[In],Ct=0,dn=0,ot=0,Xe=(st=void 0,new V({comments:$e,delimiter:vi,newline:ut,preview:10}).parse(it)),Mt=0;Mt<Xe.data.length;Mt++)Le&&de(Xe.data[Mt])?ot++:(hn=Xe.data[Mt].length,dn+=hn,st===void 0?st=hn:0<hn&&(Ct+=Math.abs(hn-st),st=hn));0<Xe.data.length&&(dn/=Xe.data.length-ot),(Re===void 0||Ct<=Re)&&(On===void 0||On<dn)&&1.99<dn&&(Re=Ct,ht=vi,On=dn)}return{successful:!!(E.delimiter=ht),bestDelimiter:ht}})(me,E.newline,E.skipEmptyLines,E.comments,E.delimitersToGuess)).successful?E.delimiter=we.bestDelimiter:(ie=!0,E.delimiter=d.DefaultDelimiter),Z.meta.delimiter=E.delimiter),H(E));return E.preview&&E.header&&we.preview++,R=me,Y=new V(we),Z=Y.parse(R,Me,nt),ve(),M?{meta:{paused:!0}}:Z||{meta:{paused:!1}}},this.paused=function(){return M},this.pause=function(){M=!0,Y.abort(),R=oe(E.chunk)?"":R.substring(Y.getCharIndex())},this.resume=function(){ne.streamer._halted?(M=!1,ne.streamer.parseChunk(R,!0)):setTimeout(ne.resume,3)},this.aborted=function(){return q},this.abort=function(){q=!0,Y.abort(),Z.meta.aborted=!0,oe(E.complete)&&E.complete(Z),R=""},this.guessLineEndings=function(it,we){it=it.substring(0,1048576);var we=new RegExp(N(we)+"([^]*?)"+N(we),"gm"),nt=(it=it.replace(we,"")).split("\r"),we=it.split(`
`),it=1<we.length&&we[0].length<nt[0].length;if(nt.length===1||it)return`
`;for(var ut=0,Le=0;Le<nt.length;Le++)nt[Le][0]===`
`&&ut++;return ut>=nt.length/2?`\r
`:"\r"}}function N(E){return E.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function V(E){var R=(E=E||{}).delimiter,Y=E.newline,ie=E.comments,re=E.step,pe=E.preview,be=E.fastMode,Ie=null,K=!1,ne=E.quoteChar==null?'"':E.quoteChar,fe=ne;if(E.escapeChar!==void 0&&(fe=E.escapeChar),(typeof R!="string"||-1<d.BAD_DELIMITERS.indexOf(R))&&(R=","),ie===R)throw new Error("Comment character same as delimiter");ie===!0?ie="#":(typeof ie!="string"||-1<d.BAD_DELIMITERS.indexOf(ie))&&(ie=!1),Y!==`
`&&Y!=="\r"&&Y!==`\r
`&&(Y=`
`);var he=0,M=!1;this.parse=function(q,se,Z){if(typeof q!="string")throw new Error("Input must be a string");var de=q.length,ve=R.length,_e=Y.length,tt=ie.length,me=oe(re),Me=[],nt=[],we=[],it=he=0;if(!q)return Ct();if(be||be!==!1&&q.indexOf(ne)===-1){for(var ut=q.split(Y),Le=0;Le<ut.length;Le++){if(we=ut[Le],he+=we.length,Le!==ut.length-1)he+=Y.length;else if(Z)return Ct();if(!ie||we.substring(0,tt)!==ie){if(me){if(Me=[],On(we.split(R)),dn(),M)return Ct()}else On(we.split(R));if(pe&&pe<=Le)return Me=Me.slice(0,pe),Ct(!0)}}return Ct()}for(var $e=q.indexOf(R,he),Pe=q.indexOf(Y,he),ht=new RegExp(N(fe)+N(ne),"g"),Re=q.indexOf(ne,he);;)if(q[he]===ne)for(Re=he,he++;;){if((Re=q.indexOf(ne,Re+1))===-1)return Z||nt.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:Me.length,index:he}),hn();if(Re===de-1)return hn(q.substring(he,Re).replace(ht,ne));if(ne===fe&&q[Re+1]===fe)Re++;else if(ne===fe||Re===0||q[Re-1]!==fe){$e!==-1&&$e<Re+1&&($e=q.indexOf(R,Re+1));var st=In((Pe=Pe!==-1&&Pe<Re+1?q.indexOf(Y,Re+1):Pe)===-1?$e:Math.min($e,Pe));if(q.substr(Re+1+st,ve)===R){we.push(q.substring(he,Re).replace(ht,ne)),q[he=Re+1+st+ve]!==ne&&(Re=q.indexOf(ne,he)),$e=q.indexOf(R,he),Pe=q.indexOf(Y,he);break}if(st=In(Pe),q.substring(Re+1+st,Re+1+st+_e)===Y){if(we.push(q.substring(he,Re).replace(ht,ne)),vi(Re+1+st+_e),$e=q.indexOf(R,he),Re=q.indexOf(ne,he),me&&(dn(),M))return Ct();if(pe&&Me.length>=pe)return Ct(!0);break}nt.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:Me.length,index:he}),Re++}}else if(ie&&we.length===0&&q.substring(he,he+tt)===ie){if(Pe===-1)return Ct();he=Pe+_e,Pe=q.indexOf(Y,he),$e=q.indexOf(R,he)}else if($e!==-1&&($e<Pe||Pe===-1))we.push(q.substring(he,$e)),he=$e+ve,$e=q.indexOf(R,he);else{if(Pe===-1)break;if(we.push(q.substring(he,Pe)),vi(Pe+_e),me&&(dn(),M))return Ct();if(pe&&Me.length>=pe)return Ct(!0)}return hn();function On(ot){Me.push(ot),it=he}function In(ot){var Xe=0;return Xe=ot!==-1&&(ot=q.substring(Re+1,ot))&&ot.trim()===""?ot.length:Xe}function hn(ot){return Z||(ot===void 0&&(ot=q.substring(he)),we.push(ot),he=de,On(we),me&&dn()),Ct()}function vi(ot){he=ot,On(we),we=[],Pe=q.indexOf(Y,he)}function Ct(ot){if(E.header&&!se&&Me.length&&!K){var Xe=Me[0],Mt=Object.create(null),Dt=new Set(Xe);let Co=!1;for(let Ti=0;Ti<Xe.length;Ti++){let pn=Xe[Ti];if(Mt[pn=oe(E.transformHeader)?E.transformHeader(pn,Ti):pn]){let zn,rs=Mt[pn];for(;zn=pn+"_"+rs,rs++,Dt.has(zn););Dt.add(zn),Xe[Ti]=zn,Mt[pn]++,Co=!0,(Ie=Ie===null?{}:Ie)[zn]=pn}else Mt[pn]=1,Xe[Ti]=pn;Dt.add(pn)}Co&&console.warn("Duplicate headers found and renamed."),K=!0}return{data:Me,errors:nt,meta:{delimiter:R,linebreak:Y,aborted:M,truncated:!!ot,cursor:it+(se||0),renamedHeaders:Ie}}}function dn(){re(Ct()),Me=[],nt=[]}},this.abort=function(){M=!0},this.getCharIndex=function(){return he}}function $(E){var R=E.data,Y=u[R.workerId],ie=!1;if(R.error)Y.userError(R.error,R.file);else if(R.results&&R.results.data){var re={abort:function(){ie=!0,O(R.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:F,resume:F};if(oe(Y.userStep)){for(var pe=0;pe<R.results.data.length&&(Y.userStep({data:R.results.data[pe],errors:R.results.errors,meta:R.results.meta},re),!ie);pe++);delete R.results}else oe(Y.userChunk)&&(Y.userChunk(R.results,re,R.file),delete R.results)}R.finished&&!ie&&O(R.workerId,R.results)}function O(E,R){var Y=u[E];oe(Y.userComplete)&&Y.userComplete(R),Y.terminate(),delete u[E]}function F(){throw new Error("Not implemented.")}function H(E){if(typeof E!="object"||E===null)return E;var R,Y=Array.isArray(E)?[]:{};for(R in E)Y[R]=H(E[R]);return Y}function te(E,R){return function(){E.apply(R,arguments)}}function oe(E){return typeof E=="function"}return d.parse=function(E,R){var Y=(R=R||{}).dynamicTyping||!1;if(oe(Y)&&(R.dynamicTypingFunction=Y,Y={}),R.dynamicTyping=Y,R.transform=!!oe(R.transform)&&R.transform,!R.worker||!d.WORKERS_SUPPORTED)return Y=null,d.NODE_STREAM_INPUT,typeof E=="string"?(E=(ie=>ie.charCodeAt(0)!==65279?ie:ie.slice(1))(E),Y=new(R.download?m:T)(R)):E.readable===!0&&oe(E.read)&&oe(E.on)?Y=new w(R):(i.File&&E instanceof File||E instanceof Object)&&(Y=new y(R)),Y.stream(E);(Y=(()=>{var ie;return!!d.WORKERS_SUPPORTED&&(ie=(()=>{var re=i.URL||i.webkitURL||null,pe=t.toString();return d.BLOB_URL||(d.BLOB_URL=re.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",pe,")();"],{type:"text/javascript"})))})(),(ie=new i.Worker(ie)).onmessage=$,ie.id=h++,u[ie.id]=ie)})()).userStep=R.step,Y.userChunk=R.chunk,Y.userComplete=R.complete,Y.userError=R.error,R.step=oe(R.step),R.chunk=oe(R.chunk),R.complete=oe(R.complete),R.error=oe(R.error),delete R.worker,Y.postMessage({input:E,config:R,workerId:Y.id})},d.unparse=function(E,R){var Y=!1,ie=!0,re=",",pe=`\r
`,be='"',Ie=be+be,K=!1,ne=null,fe=!1,he=((()=>{if(typeof R=="object"){if(typeof R.delimiter!="string"||d.BAD_DELIMITERS.filter(function(se){return R.delimiter.indexOf(se)!==-1}).length||(re=R.delimiter),typeof R.quotes!="boolean"&&typeof R.quotes!="function"&&!Array.isArray(R.quotes)||(Y=R.quotes),typeof R.skipEmptyLines!="boolean"&&typeof R.skipEmptyLines!="string"||(K=R.skipEmptyLines),typeof R.newline=="string"&&(pe=R.newline),typeof R.quoteChar=="string"&&(be=R.quoteChar),typeof R.header=="boolean"&&(ie=R.header),Array.isArray(R.columns)){if(R.columns.length===0)throw new Error("Option columns is empty");ne=R.columns}R.escapeChar!==void 0&&(Ie=R.escapeChar+be),R.escapeFormulae instanceof RegExp?fe=R.escapeFormulae:typeof R.escapeFormulae=="boolean"&&R.escapeFormulae&&(fe=/^[=+\-@\t\r].*$/)}})(),new RegExp(N(be),"g"));if(typeof E=="string"&&(E=JSON.parse(E)),Array.isArray(E)){if(!E.length||Array.isArray(E[0]))return M(null,E,K);if(typeof E[0]=="object")return M(ne||Object.keys(E[0]),E,K)}else if(typeof E=="object")return typeof E.data=="string"&&(E.data=JSON.parse(E.data)),Array.isArray(E.data)&&(E.fields||(E.fields=E.meta&&E.meta.fields||ne),E.fields||(E.fields=Array.isArray(E.data[0])?E.fields:typeof E.data[0]=="object"?Object.keys(E.data[0]):[]),Array.isArray(E.data[0])||typeof E.data[0]=="object"||(E.data=[E.data])),M(E.fields||[],E.data||[],K);throw new Error("Unable to serialize unrecognized input");function M(se,Z,de){var ve="",_e=(typeof se=="string"&&(se=JSON.parse(se)),typeof Z=="string"&&(Z=JSON.parse(Z)),Array.isArray(se)&&0<se.length),tt=!Array.isArray(Z[0]);if(_e&&ie){for(var me=0;me<se.length;me++)0<me&&(ve+=re),ve+=q(se[me],me);0<Z.length&&(ve+=pe)}for(var Me=0;Me<Z.length;Me++){var nt=(_e?se:Z[Me]).length,we=!1,it=_e?Object.keys(Z[Me]).length===0:Z[Me].length===0;if(de&&!_e&&(we=de==="greedy"?Z[Me].join("").trim()==="":Z[Me].length===1&&Z[Me][0].length===0),de==="greedy"&&_e){for(var ut=[],Le=0;Le<nt;Le++){var $e=tt?se[Le]:Le;ut.push(Z[Me][$e])}we=ut.join("").trim()===""}if(!we){for(var Pe=0;Pe<nt;Pe++){0<Pe&&!it&&(ve+=re);var ht=_e&&tt?se[Pe]:Pe;ve+=q(Z[Me][ht],Pe)}Me<Z.length-1&&(!de||0<nt&&!it)&&(ve+=pe)}}return ve}function q(se,Z){var de,ve;return se==null?"":se.constructor===Date?JSON.stringify(se).slice(1,25):(ve=!1,fe&&typeof se=="string"&&fe.test(se)&&(se="'"+se,ve=!0),de=se.toString().replace(he,Ie),(ve=ve||Y===!0||typeof Y=="function"&&Y(se,Z)||Array.isArray(Y)&&Y[Z]||((_e,tt)=>{for(var me=0;me<tt.length;me++)if(-1<_e.indexOf(tt[me]))return!0;return!1})(de,d.BAD_DELIMITERS)||-1<de.indexOf(re)||de.charAt(0)===" "||de.charAt(de.length-1)===" ")?be+de+be:de)}},d.RECORD_SEP="",d.UNIT_SEP="",d.BYTE_ORDER_MARK="\uFEFF",d.BAD_DELIMITERS=["\r",`
`,'"',d.BYTE_ORDER_MARK],d.WORKERS_SUPPORTED=!o&&!!i.Worker,d.NODE_STREAM_INPUT=1,d.LocalChunkSize=10485760,d.RemoteChunkSize=5242880,d.DefaultDelimiter=",",d.Parser=V,d.ParserHandle=C,d.NetworkStreamer=m,d.FileStreamer=y,d.StringStreamer=T,d.ReadableStreamStreamer=w,i.jQuery&&((s=i.jQuery).fn.parse=function(E){var R=E.config||{},Y=[];return this.each(function(pe){if(!(s(this).prop("tagName").toUpperCase()==="INPUT"&&s(this).attr("type").toLowerCase()==="file"&&i.FileReader)||!this.files||this.files.length===0)return!0;for(var be=0;be<this.files.length;be++)Y.push({file:this.files[be],inputElem:this,instanceConfig:s.extend({},R)})}),ie(),this;function ie(){if(Y.length===0)oe(E.complete)&&E.complete();else{var pe,be,Ie,K,ne=Y[0];if(oe(E.before)){var fe=E.before(ne.file,ne.inputElem);if(typeof fe=="object"){if(fe.action==="abort")return pe="AbortError",be=ne.file,Ie=ne.inputElem,K=fe.reason,void(oe(E.error)&&E.error({name:pe},be,Ie,K));if(fe.action==="skip")return void re();typeof fe.config=="object"&&(ne.instanceConfig=s.extend(ne.instanceConfig,fe.config))}else if(fe==="skip")return void re()}var he=ne.instanceConfig.complete;ne.instanceConfig.complete=function(M){oe(he)&&he(M,ne.file,ne.inputElem),re()},d.parse(ne.file,ne.instanceConfig)}}function re(){Y.splice(0,1),ie()}}),c&&(i.onmessage=function(E){E=E.data,d.WORKER_ID===void 0&&E&&(d.WORKER_ID=E.workerId),typeof E.input=="string"?i.postMessage({workerId:d.WORKER_ID,results:d.parse(E.input,E.config),finished:!0}):(i.File&&E.input instanceof File||E.input instanceof Object)&&(E=d.parse(E.input,E.config))&&i.postMessage({workerId:d.WORKER_ID,results:E,finished:!0})}),(m.prototype=Object.create(g.prototype)).constructor=m,(y.prototype=Object.create(g.prototype)).constructor=y,(T.prototype=Object.create(T.prototype)).constructor=T,(w.prototype=Object.create(g.prototype)).constructor=w,d})})(tc)),tc.exports}var W1=H1();const Lv=Bv(W1);function Ps(n){const e=String(n??"").match(/[0-9]/g)?.join("")??"";return e.length>=5?e.slice(0,5):e.length===4?"0"+e:""}function yy(n){return Ps(n)||null}async function zv(){try{const n=await fetch("/assets/us-zips.json");if(!n.ok)throw new Error(`Failed to load ZIP data: ${n.statusText}`);return await n.json()}catch(n){throw console.error("Error loading ZIP data:",n),n}}function $1(n,e){const t=Ps(n);return t&&e[t]||null}const Vv="zipGeoCache_v1";function X1(){try{const n=localStorage.getItem(Vv);return n?JSON.parse(n):{}}catch{return{}}}function Y1(n){try{localStorage.setItem(Vv,JSON.stringify(n))}catch{}}async function q1(n){const e=Ps(n);if(!e)return null;const t=X1();if(t[e])return t[e];try{const i=`https://nominatim.openstreetmap.org/search?postalcode=${encodeURIComponent(e)}&country=US&format=json&addressdetails=1&limit=1`,s=await fetch(i,{headers:{Accept:"application/json"}});if(!s.ok)return null;const o=await s.json();if(!Array.isArray(o)||o.length===0)return null;const c=o[0],u=parseFloat(c.lat),h=parseFloat(c.lon),d=c.address||{},g=d.city||d.town||d.village||d.hamlet||"Unknown",m=d.state||d.region||"US",y={lat:u,lon:h,city:g,state:m};return t[e]=y,Y1(t),y}catch(i){return console.warn("Geocoding failed for ZIP",e,i),null}}async function K1(n,e){const t=Ps(n);if(!t)return null;const i=$1(t,e);if(i)return i;const s=await q1(t);return s?(e[t]=s,s):null}function Z1([n,e],[t,i]){const s=e*Math.PI/180,o=i*Math.PI/180,c=(t-n)*Math.PI/180,u=Math.sin(c)*Math.cos(o),h=Math.cos(s)*Math.sin(o)-Math.sin(s)*Math.cos(o)*Math.cos(c);return(Math.atan2(u,h)*180/Math.PI+360)%360}function Q1([n,e],[t,i]){return[(n+t)/2,(e+i)/2]}const G1=[[-125,24.5],[-66,49.5]];function J1(){const[[n,e],[t,i]]=G1;return{longitude:(n+t)/2,latitude:(e+i)/2,zoom:3.5,minZoom:3,maxZoom:10}}const jv=n=>n.trim().toLowerCase().replace(/[^a-z0-9]/g,""),ex=["origin","originzip","originzipcode","fromzip","pickupzip","shipperzip","orig","origzip","from","pickup","shipper"],tx=["destination","destinationzip","destinationzipcode","destzip","tozip","deliveryzip","consigneezip","dest","to","delivery","consignee"],nx=["companyname","customer","customername","name","account","company","client","business"];function ch(n,e){for(const t of e)if(n[t]!=null&&String(n[t]).trim()!=="")return String(n[t])}async function ix(n="/raw/sample.csv"){try{const e=await zv(),t=await fetch(n);if(!t.ok)throw new Error(`Failed to load CSV: ${t.statusText}`);const i=await t.text(),s=Lv.parse(i,{header:!0,skipEmptyLines:!0,transformHeader:jv});return s.errors.length>0&&console.warn("CSV parsing errors:",s.errors),await Hv(s.data,e)}catch(e){throw console.error("Error loading CSV data:",e),e}}async function sx(n){try{const e=await zv(),t=await n.text(),i=Lv.parse(t,{header:!0,skipEmptyLines:!0,transformHeader:jv});return i.errors.length>0&&console.warn("CSV parsing errors:",i.errors),await Hv(i.data,e)}catch(e){throw console.error("Error loading CSV file:",e),e}}async function Hv(n,e){const t=[],i=new Set,s=new Set,o=new Set,c={},u=new Set,h=[];for(let T=0;T<n.length;T++){const w=n[T],C=ch(w,ex),N=ch(w,tx),V=(ch(w,nx)??"Unknown").trim(),$=yy(C??""),O=yy(N??"");if(!$){C&&(console.warn(`Invalid origin ZIP format: "${C}" -> normalized: "${Ps(C)}"`),u.add(String(C)));continue}if(!O){N&&(console.warn(`Invalid destination ZIP format: "${N}" -> normalized: "${Ps(N)}"`),u.add(String(N)));continue}h.push({index:T,customerName:V,originZip:$,destinationZip:O}),i.add($),s.add(O),o.add($),o.add(O)}const d=await rx(Array.from(o),e,6);for(const{index:T,customerName:w,originZip:C,destinationZip:N}of h){const V=d[C],$=d[N];if(!V){u.add(C),console.warn(`Origin ZIP ${C} could not be resolved, skipping row ${T}`);continue}if(!$){u.add(N),console.warn(`Destination ZIP ${N} could not be resolved, skipping row ${T}`);continue}const O=[V.lon,V.lat],F=[$.lon,$.lat],H=`${C}-${N}-${T}`,te=Z1(O,F),oe=Q1(O,F);t.push({id:H,origin_zip:C,destination_zip:N,customer_name:w,o:O,d:F,bearing:te,midpoint:oe,visible:!0})}const g=uh(o,d),m=uh(i,d),y=uh(s,d);return u.size>0&&console.warn(`${u.size} ZIP codes could not be resolved:`,Array.from(u)),{lanes:t,pointsAll:g,pointsOrigin:m,pointsDestination:y,originToCustomers:c,invalidZips:Array.from(u)}}async function rx(n,e,t=6){const s=[...Array.from(new Set(n.map(h=>Ps(h))).values()).filter(Boolean)],o={},c=async()=>{for(;s.length;){const h=s.shift(),d=await K1(h,e);o[h]=d}},u=Array.from({length:Math.min(t,Math.max(1,s.length))},()=>c());return await Promise.all(u),o}function uh(n,e){const t=[];for(const i of n){const s=e[i];s&&t.push({zip:i,lon:s.lon,lat:s.lat,city:s.city,state:s.state})}return t}function ax(){const{lanesVisible:n,setLanesVisible:e}=ta();return ce.jsxs("div",{className:"tabs",children:[ce.jsx("button",{onClick:()=>e(!0),className:`tab ${n?"is-active":""}`,children:"Show"}),ce.jsx("button",{onClick:()=>e(!1),className:`tab ${n?"":"is-active"}`,children:"Hide"})]})}function ox(){const{tab:n,setTab:e,heatmap:t,setHeatmap:i,pointsVisible:s,setPointsVisible:o}=ta(),c=[{id:"all",label:"All"},{id:"origin",label:"Origin"},{id:"destination",label:"Destination"}];return ce.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[ce.jsx("div",{className:"tabs",children:c.map(u=>ce.jsx("button",{onClick:()=>e(u.id),className:`tab ${n===u.id?"is-active":""}`,children:u.label},u.id))}),ce.jsxs("div",{className:"tabs",children:[ce.jsx("button",{onClick:()=>i({enabled:!t.enabled}),className:`tab ${t.enabled?"is-active":""}`,children:"Heatmap"}),ce.jsx("button",{onClick:()=>o(!s),className:`tab ${s?"is-active":""}`,children:"Points"})]})]})}function lx(){const{heatmap:n,setHeatmap:e}=ta();return ce.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[ce.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[ce.jsx("label",{style:{color:"var(--text-1)",fontSize:"12px"},children:"Show Heatmap"}),ce.jsxs("label",{className:"switch",children:[ce.jsx("input",{type:"checkbox",checked:n.enabled,onChange:t=>e({enabled:t.target.checked})}),ce.jsx("div",{className:"track",children:ce.jsx("div",{className:"thumb"})})]})]}),ce.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[ce.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[ce.jsx("label",{style:{color:"var(--text-1)",fontSize:"12px"},children:"Radius"}),ce.jsxs("span",{style:{color:"var(--accent)",fontSize:"12px"},children:[n.radiusPixels,"px"]})]}),ce.jsx("input",{type:"range",min:"10",max:"200",value:n.radiusPixels,onChange:t=>e({radiusPixels:Number(t.target.value)}),className:"range"})]}),ce.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[ce.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[ce.jsx("label",{style:{color:"var(--text-1)",fontSize:"12px"},children:"Intensity"}),ce.jsx("span",{style:{color:"var(--accent)",fontSize:"12px"},children:n.intensity.toFixed(1)})]}),ce.jsx("input",{type:"range",min:"0.1",max:"3",step:"0.1",value:n.intensity,onChange:t=>e({intensity:Number(t.target.value)}),className:"range"})]})]})}function cx(){const{setLanes:n,setPoints:e,setOriginToCustomers:t,setLoading:i,setError:s}=ta(),o=async u=>{const h=u.target.files?.[0];if(h){if(!h.name.toLowerCase().endsWith(".csv")){s("Please select a CSV file");return}i(!0),s(null);try{const d=await sx(h);n(d.lanes),e(d.pointsAll,d.pointsOrigin,d.pointsDestination),t(d.originToCustomers),console.log(`Successfully loaded ${d.lanes.length} lanes from ${h.name}`)}catch(d){s(d instanceof Error?d.message:"Failed to load CSV file")}finally{i(!1)}}},c=()=>{window.location.reload()};return ce.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px",height:"100%"},children:[ce.jsxs("div",{className:"section",children:[ce.jsx("div",{className:"section-title",children:"Actions"}),ce.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[ce.jsx("input",{id:"sidebar-csv-upload",type:"file",accept:".csv",onChange:o,className:"hidden"}),ce.jsx("label",{htmlFor:"sidebar-csv-upload",className:"btn btn-ghost",style:{cursor:"pointer"},children:"Load CSV"}),ce.jsx("button",{onClick:c,className:"btn btn-ghost",children:"Reset View"})]})]}),ce.jsxs("div",{className:"section",children:[ce.jsx("div",{className:"section-title",children:"Lane Controls"}),ce.jsx(ax,{})]}),ce.jsxs("div",{className:"section",children:[ce.jsx("div",{className:"section-title",children:"Heatmap"}),ce.jsx(ox,{})]}),ce.jsxs("div",{className:"section",children:[ce.jsx("div",{className:"section-title",children:"Heatmap Settings"}),ce.jsx(lx,{})]})]})}const ux="modulepreload",fx=function(n){return"/"+n},by={},hx=function(e,t,i){let s=Promise.resolve();if(t&&t.length>0){let h=function(d){return Promise.all(d.map(g=>Promise.resolve(g).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),u=c?.nonce||c?.getAttribute("nonce");s=h(t.map(d=>{if(d=fx(d),d in by)return;by[d]=!0;const g=d.endsWith(".css"),m=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${m}`))return;const y=document.createElement("link");if(y.rel=g?"stylesheet":ux,g||(y.as="script"),y.crossOrigin="",y.href=d,u&&y.setAttribute("nonce",u),document.head.appendChild(y),g)return new Promise((T,w)=>{y.addEventListener("load",T),y.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${d}`)))})}))}function o(c){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=c,window.dispatchEvent(u),!u.defaultPrevented)throw c}return s.then(c=>{for(const u of c||[])u.status==="rejected"&&o(u.reason);return e().catch(o)})},dx=le.createContext(null);function px(n,e){const t=Array.isArray(n)?n[0]:n?n.x:0,i=Array.isArray(n)?n[1]:n?n.y:0,s=Array.isArray(e)?e[0]:e?e.x:0,o=Array.isArray(e)?e[1]:e?e.y:0;return t===s&&i===o}function Kn(n,e){if(n===e)return!0;if(!n||!e)return!1;if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(!Kn(n[t],e[t]))return!1;return!0}else if(Array.isArray(e))return!1;if(typeof n=="object"&&typeof e=="object"){const t=Object.keys(n),i=Object.keys(e);if(t.length!==i.length)return!1;for(const s of t)if(!e.hasOwnProperty(s)||!Kn(n[s],e[s]))return!1;return!0}return!1}function vy(n){return{longitude:n.center.lng,latitude:n.center.lat,zoom:n.zoom,pitch:n.pitch,bearing:n.bearing,padding:n.padding}}function Ty(n,e){const t=e.viewState||e,i={};if("longitude"in t&&"latitude"in t&&(t.longitude!==n.center.lng||t.latitude!==n.center.lat)){const s=n.center.constructor;i.center=new s(t.longitude,t.latitude)}return"zoom"in t&&t.zoom!==n.zoom&&(i.zoom=t.zoom),"bearing"in t&&t.bearing!==n.bearing&&(i.bearing=t.bearing),"pitch"in t&&t.pitch!==n.pitch&&(i.pitch=t.pitch),t.padding&&n.padding&&!Kn(t.padding,n.padding)&&(i.padding=t.padding),i}const gx=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function xy(n){if(!n)return null;if(typeof n=="string"||("toJS"in n&&(n=n.toJS()),!n.layers))return n;const e={};for(const i of n.layers)e[i.id]=i;const t=n.layers.map(i=>{let s=null;"interactive"in i&&(s=Object.assign({},i),delete s.interactive);const o=e[i.ref];if(o){s=s||Object.assign({},i),delete s.ref;for(const c of gx)c in o&&(s[c]=o[c])}return s||i});return{...n,layers:t}}const Sy={version:8,sources:{},layers:[]},wy={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},Ay={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},Ey={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},_x=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],mx=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class Wr{constructor(e,t,i){this._map=null,this._internalUpdate=!1,this._hoveredFeatures=null,this._propsedCameraUpdate=null,this._styleComponents={},this._onEvent=s=>{const o=this.props[Ey[s.type]];o?o(s):s.type==="error"&&console.error(s.error)},this._onCameraEvent=s=>{if(this._internalUpdate)return;s.viewState=this._propsedCameraUpdate||vy(this._map.transform);const o=this.props[Ay[s.type]];o&&o(s)},this._onCameraUpdate=s=>this._internalUpdate?s:(this._propsedCameraUpdate=vy(s),Ty(s,this.props)),this._onPointerEvent=s=>{(s.type==="mousemove"||s.type==="mouseout")&&this._updateHover(s);const o=this.props[wy[s.type]];o&&(this.props.interactiveLayerIds&&s.type!=="mouseover"&&s.type!=="mouseout"&&(s.features=this._hoveredFeatures||this._queryRenderedFeatures(s.point)),o(s),delete s.features)},this._MapClass=e,this.props=t,this._initialize(i)}get map(){return this._map}setProps(e){const t=this.props;this.props=e;const i=this._updateSettings(e,t),s=this._updateSize(e),o=this._updateViewState(e);this._updateStyle(e,t),this._updateStyleComponents(e),this._updateHandlers(e,t),(i||s||o&&!this._map.isMoving())&&this.redraw()}static reuse(e,t){const i=Wr.savedMaps.pop();if(!i)return null;const s=i.map,o=s.getContainer();for(t.className=o.className;o.childNodes.length>0;)t.appendChild(o.childNodes[0]);s._container=t;const c=s._resizeObserver;c&&(c.disconnect(),c.observe(t)),i.setProps({...e,styleDiffing:!1}),s.resize();const{initialViewState:u}=e;return u&&(u.bounds?s.fitBounds(u.bounds,{...u.fitBoundsOptions,duration:0}):i._updateViewState(u)),s.isStyleLoaded()?s.fire("load"):s.once("style.load",()=>s.fire("load")),s._update(),i}_initialize(e){const{props:t}=this,{mapStyle:i=Sy}=t,s={...t,...t.initialViewState,container:e,style:xy(i)},o=s.initialViewState||s.viewState||s;if(Object.assign(s,{center:[o.longitude||0,o.latitude||0],zoom:o.zoom||0,pitch:o.pitch||0,bearing:o.bearing||0}),t.gl){const u=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=u,t.gl)}const c=new this._MapClass(s);o.padding&&c.setPadding(o.padding),t.cursor&&(c.getCanvas().style.cursor=t.cursor),c.transformCameraUpdate=this._onCameraUpdate,c.on("style.load",()=>{this._styleComponents={light:c.getLight(),sky:c.getSky(),projection:c.getProjection?.(),terrain:c.getTerrain()},this._updateStyleComponents(this.props)}),c.on("sourcedata",()=>{this._updateStyleComponents(this.props)});for(const u in wy)c.on(u,this._onPointerEvent);for(const u in Ay)c.on(u,this._onCameraEvent);for(const u in Ey)c.on(u,this._onEvent);this._map=c}recycle(){this.map.getContainer().querySelector("[mapboxgl-children]")?.remove(),Wr.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const e=this._map;e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}_updateSize(e){const{viewState:t}=e;if(t){const i=this._map;if(t.width!==i.transform.width||t.height!==i.transform.height)return i.resize(),!0}return!1}_updateViewState(e){const t=this._map,i=t.transform;if(!t.isMoving()){const o=Ty(i,e);if(Object.keys(o).length>0)return this._internalUpdate=!0,t.jumpTo(o),this._internalUpdate=!1,!0}return!1}_updateSettings(e,t){const i=this._map;let s=!1;for(const o of _x)o in e&&!Kn(e[o],t[o])&&(s=!0,i[`set${o[0].toUpperCase()}${o.slice(1)}`]?.call(i,e[o]));return s}_updateStyle(e,t){if(e.cursor!==t.cursor&&(this._map.getCanvas().style.cursor=e.cursor||""),e.mapStyle!==t.mapStyle){const{mapStyle:i=Sy,styleDiffing:s=!0}=e,o={diff:s};"localIdeographFontFamily"in e&&(o.localIdeographFontFamily=e.localIdeographFontFamily),this._map.setStyle(xy(i),o)}}_updateStyleComponents({light:e,projection:t,sky:i,terrain:s}){const o=this._map,c=this._styleComponents;o.style._loaded&&(e&&!Kn(e,c.light)&&(c.light=e,o.setLight(e)),t&&!Kn(t,c.projection)&&t!==c.projection?.type&&(c.projection=typeof t=="string"?{type:t}:t,o.setProjection?.(c.projection)),i&&!Kn(i,c.sky)&&(c.sky=i,o.setSky(i)),s!==void 0&&!Kn(s,c.terrain)&&(!s||o.getSource(s.source))&&(c.terrain=s,o.setTerrain(s)))}_updateHandlers(e,t){const i=this._map;for(const s of mx){const o=e[s]??!0,c=t[s]??!0;Kn(o,c)||(o?i[s].enable(o):i[s].disable())}}_queryRenderedFeatures(e){const t=this._map,{interactiveLayerIds:i=[]}=this.props;try{return t.queryRenderedFeatures(e,{layers:i.filter(t.getLayer.bind(t))})}catch{return[]}}_updateHover(e){const{props:t}=this;if(t.interactiveLayerIds&&(t.onMouseMove||t.onMouseEnter||t.onMouseLeave)){const s=e.type,o=this._hoveredFeatures?.length>0,c=this._queryRenderedFeatures(e.point),u=c.length>0;!u&&o&&(e.type="mouseleave",this._onPointerEvent(e)),this._hoveredFeatures=c,u&&!o&&(e.type="mouseenter",this._onPointerEvent(e)),e.type=s}else this._hoveredFeatures=null}}Wr.savedMaps=[];const yx=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function bx(n){if(!n)return null;const e=n.map,t={getMap:()=>e};for(const i of vx(e))!(i in t)&&!yx.includes(i)&&(t[i]=e[i].bind(e));return t}function vx(n){const e=new Set;let t=n;for(;t;){for(const i of Object.getOwnPropertyNames(t))i[0]!=="_"&&typeof n[i]=="function"&&i!=="fire"&&i!=="setEventedParent"&&e.add(i);t=Object.getPrototypeOf(t)}return Array.from(e)}const Tx=typeof document<"u"?le.useLayoutEffect:le.useEffect;function xx(n,e){const{RTLTextPlugin:t,maxParallelImageRequests:i,workerCount:s,workerUrl:o}=e;if(t&&n.getRTLTextPluginStatus&&n.getRTLTextPluginStatus()==="unavailable"){const{pluginUrl:c,lazy:u=!0}=typeof t=="string"?{pluginUrl:t}:t;n.setRTLTextPlugin(c,h=>{h&&console.error(h)},u)}i!==void 0&&n.setMaxParallelImageRequests(i),s!==void 0&&n.setWorkerCount(s),o!==void 0&&n.setWorkerUrl(o)}const Ic=le.createContext(null);function Sx(n,e){const t=le.useContext(dx),[i,s]=le.useState(null),o=le.useRef(),{current:c}=le.useRef({mapLib:null,map:null});le.useEffect(()=>{const d=n.mapLib;let g=!0,m;return Promise.resolve(d||hx(()=>import("./maplibre-gl-BgNK8evU.js").then(y=>y.m),[])).then(y=>{if(!g)return;if(!y)throw new Error("Invalid mapLib");const T="Map"in y?y:y.default;if(!T.Map)throw new Error("Invalid mapLib");xx(T,n),n.reuseMaps&&(m=Wr.reuse(n,o.current)),m||(m=new Wr(T.Map,n,o.current)),c.map=bx(m),c.mapLib=T,s(m),t?.onMapMount(c.map,n.id)}).catch(y=>{const{onError:T}=n;T?T({type:"error",target:null,originalEvent:null,error:y}):console.error(y)}),()=>{g=!1,m&&(t?.onMapUnmount(n.id),n.reuseMaps?m.recycle():m.destroy())}},[]),Tx(()=>{i&&i.setProps(n)}),le.useImperativeHandle(e,()=>c.map,[i]);const u=le.useMemo(()=>({position:"relative",width:"100%",height:"100%",...n.style}),[n.style]),h={height:"100%"};return le.createElement("div",{id:n.id,ref:o,style:u},i&&le.createElement(Ic.Provider,{value:c},le.createElement("div",{"mapboxgl-children":"",style:h},n.children)))}const wx=le.forwardRef(Sx);var Wv=Fv();const Ax=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function bi(n,e){if(!n||!e)return;const t=n.style;for(const i in e){const s=e[i];Number.isFinite(s)&&!Ax.test(i)?t[i]=`${s}px`:t[i]=s}}function $v(n,e){if(n===e)return null;const t=Ry(n),i=Ry(e),s=[];for(const o of i)t.has(o)||s.push(o);for(const o of t)i.has(o)||s.push(o);return s.length===0?null:s}function Ry(n){return new Set(n?n.trim().split(/\s+/):[])}le.memo(le.forwardRef((n,e)=>{const{map:t,mapLib:i}=le.useContext(Ic),s=le.useRef({props:n}),o=le.useMemo(()=>{let V=!1;le.Children.forEach(n.children,F=>{F&&(V=!0)});const $={...n,element:V?document.createElement("div"):void 0},O=new i.Marker($);return O.setLngLat([n.longitude,n.latitude]),O.getElement().addEventListener("click",F=>{s.current.props.onClick?.({type:"click",target:O,originalEvent:F})}),O.on("dragstart",F=>{const H=F;H.lngLat=o.getLngLat(),s.current.props.onDragStart?.(H)}),O.on("drag",F=>{const H=F;H.lngLat=o.getLngLat(),s.current.props.onDrag?.(H)}),O.on("dragend",F=>{const H=F;H.lngLat=o.getLngLat(),s.current.props.onDragEnd?.(H)}),O},[]);le.useEffect(()=>(o.addTo(t.getMap()),()=>{o.remove()}),[]);const{longitude:c,latitude:u,offset:h,style:d,draggable:g=!1,popup:m=null,rotation:y=0,rotationAlignment:T="auto",pitchAlignment:w="auto"}=n;le.useEffect(()=>{bi(o.getElement(),d)},[d]),le.useImperativeHandle(e,()=>o,[]);const C=s.current.props;(o.getLngLat().lng!==c||o.getLngLat().lat!==u)&&o.setLngLat([c,u]),h&&!px(o.getOffset(),h)&&o.setOffset(h),o.isDraggable()!==g&&o.setDraggable(g),o.getRotation()!==y&&o.setRotation(y),o.getRotationAlignment()!==T&&o.setRotationAlignment(T),o.getPitchAlignment()!==w&&o.setPitchAlignment(w),o.getPopup()!==m&&o.setPopup(m);const N=$v(C.className,n.className);if(N)for(const V of N)o.toggleClassName(V);return s.current.props=n,Wv.createPortal(n.children,o.getElement())}));le.memo(le.forwardRef((n,e)=>{const{map:t,mapLib:i}=le.useContext(Ic),s=le.useMemo(()=>document.createElement("div"),[]),o=le.useRef({props:n}),c=le.useMemo(()=>{const u={...n},h=new i.Popup(u);return h.setLngLat([n.longitude,n.latitude]),h.once("open",d=>{o.current.props.onOpen?.(d)}),h},[]);if(le.useEffect(()=>{const u=h=>{o.current.props.onClose?.(h)};return c.on("close",u),c.setDOMContent(s).addTo(t.getMap()),()=>{c.off("close",u),c.isOpen()&&c.remove()}},[]),le.useEffect(()=>{bi(c.getElement(),n.style)},[n.style]),le.useImperativeHandle(e,()=>c,[]),c.isOpen()){const u=o.current.props;(c.getLngLat().lng!==n.longitude||c.getLngLat().lat!==n.latitude)&&c.setLngLat([n.longitude,n.latitude]),n.offset&&!Kn(u.offset,n.offset)&&c.setOffset(n.offset),(u.anchor!==n.anchor||u.maxWidth!==n.maxWidth)&&(c.options.anchor=n.anchor,c.setMaxWidth(n.maxWidth));const h=$v(u.className,n.className);if(h)for(const d of h)c.toggleClassName(d);o.current.props=n}return Wv.createPortal(n.children,s)}));function Fs(n,e,t,i){const s=le.useContext(Ic),o=le.useMemo(()=>n(s),[]);return le.useEffect(()=>{const c=e,u=null,h=typeof e=="function"?e:null,{map:d}=s;return d.hasControl(o)||(d.addControl(o,c?.position),u&&u(s)),()=>{h&&h(s),d.hasControl(o)&&d.removeControl(o)}},[]),o}function Ex(n){const e=Fs(({mapLib:t})=>new t.AttributionControl(n),{position:n.position});return le.useEffect(()=>{bi(e._container,n.style)},[n.style]),null}le.memo(Ex);function Rx(n){const e=Fs(({mapLib:t})=>new t.FullscreenControl({container:n.containerId&&document.getElementById(n.containerId)}),{position:n.position});return le.useEffect(()=>{bi(e._controlContainer,n.style)},[n.style]),null}le.memo(Rx);function Cx(n,e){const t=le.useRef({props:n}),i=Fs(({mapLib:s})=>{const o=new s.GeolocateControl(n),c=o._setupUI;return o._setupUI=()=>{o._container.hasChildNodes()||c()},o.on("geolocate",u=>{t.current.props.onGeolocate?.(u)}),o.on("error",u=>{t.current.props.onError?.(u)}),o.on("outofmaxbounds",u=>{t.current.props.onOutOfMaxBounds?.(u)}),o.on("trackuserlocationstart",u=>{t.current.props.onTrackUserLocationStart?.(u)}),o.on("trackuserlocationend",u=>{t.current.props.onTrackUserLocationEnd?.(u)}),o},{position:n.position});return t.current.props=n,le.useImperativeHandle(e,()=>i,[]),le.useEffect(()=>{bi(i._container,n.style)},[n.style]),null}le.memo(le.forwardRef(Cx));function Mx(n){const e=Fs(({mapLib:t})=>new t.NavigationControl(n),{position:n.position});return le.useEffect(()=>{bi(e._container,n.style)},[n.style]),null}le.memo(Mx);function Ox(n){const e=Fs(({mapLib:o})=>new o.ScaleControl(n),{position:n.position}),t=le.useRef(n),i=t.current;t.current=n;const{style:s}=n;return n.maxWidth!==void 0&&n.maxWidth!==i.maxWidth&&(e.options.maxWidth=n.maxWidth),n.unit!==void 0&&n.unit!==i.unit&&e.setUnit(n.unit),le.useEffect(()=>{bi(e._container,s)},[s]),null}le.memo(Ox);function Ix(n){const e=Fs(({mapLib:t})=>new t.TerrainControl(n),{position:n.position});return le.useEffect(()=>{bi(e._container,n.style)},[n.style]),null}le.memo(Ix);function Nx(n){const e=Fs(({mapLib:t})=>new t.LogoControl(n),{position:n.position});return le.useEffect(()=>{bi(e._container,n.style)},[n.style]),null}le.memo(Nx);function cc(n,e){if(!n)throw new Error(e||"loader assertion failed.")}const Ed=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),Cy=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Cy&&parseFloat(Cy[1]);const My=globalThis,Oy=globalThis.process||{},Px=globalThis.navigator||{};function Xv(n){if(typeof window<"u"&&window.process?.type==="renderer"||typeof process<"u"&&process.versions?.electron)return!0;const t=typeof navigator<"u"&&navigator.userAgent;return!!(t&&t.indexOf("Electron")>=0)}function Ls(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process?.browser)||Xv()}function kx(n){return Ls()?Xv()?"Electron":(Px.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const Yv="4.1.0";function Dx(n){try{const e=window[n],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch{return null}}class Ux{constructor(e,t,i="sessionStorage"){this.storage=Dx(i),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}function Bx(n){let e;return n<10?e=`${n.toFixed(2)}ms`:n<100?e=`${n.toFixed(1)}ms`:n<1e3?e=`${n.toFixed(0)}ms`:e=`${(n/1e3).toFixed(2)}s`,e}function Fx(n,e=8){const t=Math.max(e-n.length,0);return`${" ".repeat(t)}${n}`}var uc;(function(n){n[n.BLACK=30]="BLACK",n[n.RED=31]="RED",n[n.GREEN=32]="GREEN",n[n.YELLOW=33]="YELLOW",n[n.BLUE=34]="BLUE",n[n.MAGENTA=35]="MAGENTA",n[n.CYAN=36]="CYAN",n[n.WHITE=37]="WHITE",n[n.BRIGHT_BLACK=90]="BRIGHT_BLACK",n[n.BRIGHT_RED=91]="BRIGHT_RED",n[n.BRIGHT_GREEN=92]="BRIGHT_GREEN",n[n.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",n[n.BRIGHT_BLUE=94]="BRIGHT_BLUE",n[n.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",n[n.BRIGHT_CYAN=96]="BRIGHT_CYAN",n[n.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(uc||(uc={}));const Lx=10;function Iy(n){return typeof n!="string"?n:(n=n.toUpperCase(),uc[n]||uc.WHITE)}function zx(n,e,t){return!Ls&&typeof n=="string"&&(e&&(n=`\x1B[${Iy(e)}m${n}\x1B[39m`),t&&(n=`\x1B[${Iy(t)+Lx}m${n}\x1B[49m`)),n}function Vx(n,e=["constructor"]){const t=Object.getPrototypeOf(n),i=Object.getOwnPropertyNames(t),s=n;for(const o of i){const c=s[o];typeof c=="function"&&(e.find(u=>o===u)||(s[o]=c.bind(n)))}}function Rd(n,e){if(!n)throw new Error("Assertion failed")}function Cr(){let n;if(Ls()&&My.performance)n=My?.performance?.now?.();else if("hrtime"in Oy){const e=Oy?.hrtime?.();n=e[0]*1e3+e[1]/1e6}else n=Date.now();return n}const Mr={debug:Ls()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},jx={enabled:!0,level:0};function Or(){}const Ny={},Py={once:!0};class xo{constructor({id:e}={id:""}){this.VERSION=Yv,this._startTs=Cr(),this._deltaTs=Cr(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new Ux(`__probe-${this.id}__`,jx),this.timeStamp(`${this.id} started`),Vx(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Cr()-this._startTs).toPrecision(10))}getDelta(){return Number((Cr()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e){return this._getLogFunction(0,e,Mr.warn,arguments,Py)}error(e){return this._getLogFunction(0,e,Mr.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,Mr.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,Mr.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,Mr.debug||Mr.info,arguments,Py)}table(e,t,i){return t?this._getLogFunction(e,t,console.table||Or,i&&[i],{tag:Wx(t)}):Or}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||Or)}group(e,t,i={collapsed:!1}){const s=ky({logLevel:e,message:t,opts:i}),{collapsed:o}=i;return s.method=(o?console.groupCollapsed:console.group)||console.info,this._getLogFunction(s)}groupCollapsed(e,t,i={}){return this.group(e,t,Object.assign({},i,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Or)}withGroup(e,t,i){this.group(e,t)();try{i()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=qv(e)}_getLogFunction(e,t,i,s,o){if(this._shouldLog(e)){o=ky({logLevel:e,message:t,args:s,opts:o}),i=i||o.method,Rd(i),o.total=this.getTotal(),o.delta=this.getDelta(),this._deltaTs=Cr();const c=o.tag||o.message;if(o.once&&c)if(!Ny[c])Ny[c]=Cr();else return Or;return t=Hx(this.id,o.message,o),i.bind(console,t,...o.args)}return Or}}xo.VERSION=Yv;function qv(n){if(!n)return 0;let e;switch(typeof n){case"number":e=n;break;case"object":e=n.logLevel||n.priority||0;break;default:return 0}return Rd(Number.isFinite(e)&&e>=0),e}function ky(n){const{logLevel:e,message:t}=n;n.logLevel=qv(e);const i=n.args?Array.from(n.args):[];for(;i.length&&i.shift()!==t;);switch(typeof e){case"string":case"function":t!==void 0&&i.unshift(t),n.message=e;break;case"object":Object.assign(n,e);break}typeof n.message=="function"&&(n.message=n.message());const s=typeof n.message;return Rd(s==="string"||s==="object"),Object.assign(n,{args:i},n.opts)}function Hx(n,e,t){if(typeof e=="string"){const i=t.time?Fx(Bx(t.total)):"";e=t.time?`${n}: ${i}  ${e}`:`${n}: ${e}`,e=zx(e,t.color,t.background)}return e}function Wx(n){for(const e in n)for(const t in n[e])return t||"untitled";return"empty"}const fh="4.3.3",$x=fh[0]>="0"&&fh[0]<="9"?`v${fh}`:"";function Xx(){const n=new xo({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=n,globalThis.loaders.version=$x,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=n,n}const Yx=Xx();function qx(n,e){return Kv(n||{},e)}function Kv(n,e,t=0){if(t>3)return e;const i={...n};for(const[s,o]of Object.entries(e))o&&typeof o=="object"&&!Array.isArray(o)?i[s]=Kv(i[s]||{},e[s],t+1):i[s]=e[s];return i}const Kx="latest";function Zx(){return globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.3"),globalThis._loadersgl_.version}const Qx=Zx();function is(n,e){if(!n)throw new Error(e||"loaders.gl assertion failed.")}const Ms=typeof process!="object"||String(process)!=="[object process]"||process.browser,Gx=typeof window<"u"&&typeof window.orientation<"u",Dy=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Dy&&parseFloat(Dy[1]);class Jx{name;workerThread;isRunning=!0;result;_resolve=()=>{};_reject=()=>{};constructor(e,t){this.name=e,this.workerThread=t,this.result=new Promise((i,s)=>{this._resolve=i,this._reject=s})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){is(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){is(this.isRunning),this.isRunning=!1,this._reject(e)}}class hh{terminate(){}}const dh=new Map;function eS(n){is(n.source&&!n.url||!n.source&&n.url);let e=dh.get(n.source||n.url);return e||(n.url&&(e=tS(n.url),dh.set(n.url,e)),n.source&&(e=Zv(n.source),dh.set(n.source,e))),is(e),e}function tS(n){if(!n.startsWith("http"))return n;const e=nS(n);return Zv(e)}function Zv(n){const e=new Blob([n],{type:"application/javascript"});return URL.createObjectURL(e)}function nS(n){return`try {
  importScripts('${n}');
} catch (error) {
  console.error(error);
  throw error;
}`}function Qv(n,e=!0,t){const i=t||new Set;if(n){if(Uy(n))i.add(n);else if(Uy(n.buffer))i.add(n.buffer);else if(!ArrayBuffer.isView(n)){if(e&&typeof n=="object")for(const s in n)Qv(n[s],e,i)}}return t===void 0?Array.from(i):[]}function Uy(n){return n?n instanceof ArrayBuffer||typeof MessagePort<"u"&&n instanceof MessagePort||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas:!1}const ph=()=>{};class $h{name;source;url;terminated=!1;worker;onMessage;onError;_loadableURL="";static isSupported(){return typeof Worker<"u"&&Ms||typeof hh<"u"&&!Ms}constructor(e){const{name:t,source:i,url:s}=e;is(i||s),this.name=t,this.source=i,this.url=s,this.onMessage=ph,this.onError=o=>console.log(o),this.worker=Ms?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=ph,this.onError=ph,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,t){t=t||Qv(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+=`worker ${this.name} from ${this.url}. `,e.message&&(t+=`${e.message} in `),e.lineno&&(t+=`:${e.lineno}:${e.colno}`),new Error(t)}_createBrowserWorker(){this._loadableURL=eS({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},e.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},e.onmessageerror=t=>console.error(t),e}_createNodeWorker(){let e;if(this.url){const i=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new hh(i,{eval:!1})}else if(this.source)e=new hh(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",t=>{this.onMessage(t)}),e.on("error",t=>{this.onError(t)}),e.on("exit",t=>{}),e}}class iS{name="unnamed";source;url;maxConcurrency=1;maxMobileConcurrency=1;onDebug=()=>{};reuseWorkers=!0;props={};jobQueue=[];idleQueue=[];count=0;isDestroyed=!1;static isSupported(){return $h.isSupported()}constructor(e){this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,t=(s,o,c)=>s.done(c),i=(s,o)=>s.error(o)){const s=new Promise(o=>(this.jobQueue.push({name:e,onMessage:t,onError:i,onStart:o}),this));return this._startQueuedJob(),await s}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const i=new Jx(t.name,e);e.onMessage=s=>t.onMessage(i,s.type,s.payload),e.onError=s=>t.onError(i,s),t.onStart(i);try{await i.result}catch(s){console.error(`Worker exception: ${s}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!Ms||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new $h({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return Gx?this.maxMobileConcurrency:this.maxConcurrency}}const sS={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class Zi{props;workerPools=new Map;static _workerFarm;static isSupported(){return $h.isSupported()}static getWorkerFarm(e={}){return Zi._workerFarm=Zi._workerFarm||new Zi({}),Zi._workerFarm.setProps(e),Zi._workerFarm}constructor(e){this.props={...sS},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:i,url:s}=e;let o=this.workerPools.get(t);return o||(o=new iS({name:t,source:i,url:s}),o.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,o)),o}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}function rS(n,e={}){const t=e[n.id]||{},i=Ms?`${n.id}-worker.js`:`${n.id}-worker-node.js`;let s=t.workerUrl;if(!s&&n.id==="compression"&&(s=e.workerUrl),e._workerType==="test"&&(Ms?s=`modules/${n.module}/dist/${i}`:s=`modules/${n.module}/src/workers/${n.id}-worker-node.ts`),!s){let o=n.version;o==="latest"&&(o=Kx);const c=o?`@${o}`:"";s=`https://unpkg.com/@loaders.gl/${n.module}${c}/dist/${i}`}return is(s),s}function aS(n,e=Qx){is(n,"no worker provided");const t=n.version;return!(!e||!t)}function oS(n,e){return!Zi.isSupported()||!Ms&&!e?._nodeWorkers?!1:n.worker&&e?.worker}async function lS(n,e,t,i,s){const o=n.id,c=rS(n,t),h=Zi.getWorkerFarm(t).getWorkerPool({name:o,url:c});t=JSON.parse(JSON.stringify(t)),i=JSON.parse(JSON.stringify(i||{}));const d=await h.startJob("process-on-worker",cS.bind(null,s));return d.postMessage("process",{input:e,options:t,context:i}),await(await d.result).result}async function cS(n,e,t,i){switch(t){case"done":e.done(i);break;case"error":e.error(new Error(i.error));break;case"process":const{id:s,input:o,options:c}=i;try{const u=await n(o,c);e.postMessage("done",{id:s,result:u})}catch(u){const h=u instanceof Error?u.message:"unknown error";e.postMessage("error",{id:s,error:h})}break;default:console.warn(`parse-with-worker unknown message ${t}`)}}function uS(n,e,t){if(t=t||n.byteLength,n.byteLength<t||e.byteLength<t)return!1;const i=new Uint8Array(n),s=new Uint8Array(e);for(let o=0;o<i.length;++o)if(i[o]!==s[o])return!1;return!0}function fS(...n){return hS(n)}function hS(n){const e=n.map(o=>o instanceof ArrayBuffer?new Uint8Array(o):o),t=e.reduce((o,c)=>o+c.byteLength,0),i=new Uint8Array(t);let s=0;for(const o of e)i.set(o,s),s+=o.byteLength;return i.buffer}async function dS(n){const e=[];for await(const t of n)e.push(t);return fS(...e)}function By(){let n;if(typeof window<"u"&&window.performance)n=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();n=e[0]*1e3+e[1]/1e6}else n=Date.now();return n}class Fy{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=By(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(By()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Nc{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,t="count"){return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(t=>this._getOrCreate(t))}_getOrCreate(e){const{name:t,type:i}=e;let s=this.stats[t];return s||(e instanceof Fy?s=e:s=new Fy(t,i),this.stats[t]=s),s}}let pS="";const Ly={};function gS(n){for(const e in Ly)if(n.startsWith(e)){const t=Ly[e];n=n.replace(e,t)}return!n.startsWith("http://")&&!n.startsWith("https://")&&(n=`${pS}${n}`),n}function _S(n){return n&&typeof n=="object"&&n.isBuffer}function Gv(n){if(_S(n))return n;if(n instanceof ArrayBuffer)return n;if(ArrayBuffer.isView(n))return n.byteOffset===0&&n.byteLength===n.buffer.byteLength?n.buffer:n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength);if(typeof n=="string"){const e=n;return new TextEncoder().encode(e).buffer}if(n&&typeof n=="object"&&n._toArrayBuffer)return n._toArrayBuffer();throw new Error("toArrayBuffer")}function Jv(n){const e=n?n.lastIndexOf("/"):-1;return e>=0?n.substr(e+1):""}function mS(n){const e=n?n.lastIndexOf("/"):-1;return e>=0?n.substr(0,e):""}const yS=n=>typeof n=="boolean",uo=n=>typeof n=="function",So=n=>n!==null&&typeof n=="object",zy=n=>So(n)&&n.constructor==={}.constructor,bS=n=>!!n&&typeof n[Symbol.iterator]=="function",vS=n=>n&&typeof n[Symbol.asyncIterator]=="function",zs=n=>typeof Response<"u"&&n instanceof Response||n&&n.arrayBuffer&&n.text&&n.json,Vs=n=>typeof Blob<"u"&&n instanceof Blob,TS=n=>n&&typeof n=="object"&&n.isBuffer,xS=n=>typeof ReadableStream<"u"&&n instanceof ReadableStream||So(n)&&uo(n.tee)&&uo(n.cancel)&&uo(n.getReader),SS=n=>So(n)&&uo(n.read)&&uo(n.pipe)&&yS(n.readable),e0=n=>xS(n)||SS(n);class wS extends Error{constructor(e,t){super(e),this.reason=t.reason,this.url=t.url,this.response=t.response}reason;url;response}const AS=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,ES=/^([-\w.]+\/[-\w.+]+)/;function Vy(n,e){return n.toLowerCase()===e.toLowerCase()}function RS(n){const e=ES.exec(n);return e?e[1]:n}function jy(n){const e=AS.exec(n);return e?e[1]:""}const t0=/\?.*/;function CS(n){const e=n.match(t0);return e&&e[0]}function Cd(n){return n.replace(t0,"")}function MS(n){if(n.length<50)return n;const e=n.slice(n.length-15);return`${n.substr(0,32)}...${e}`}function Pc(n){return zs(n)?n.url:Vs(n)?n.name||"":typeof n=="string"?n:""}function Md(n){if(zs(n)){const e=n,t=e.headers.get("content-type")||"",i=Cd(e.url);return RS(t)||jy(i)}return Vs(n)?n.type||"":typeof n=="string"?jy(n):""}function OS(n){return zs(n)?n.headers["content-length"]||-1:Vs(n)?n.size:typeof n=="string"?n.length:n instanceof ArrayBuffer||ArrayBuffer.isView(n)?n.byteLength:-1}async function n0(n){if(zs(n))return n;const e={},t=OS(n);t>=0&&(e["content-length"]=String(t));const i=Pc(n),s=Md(n);s&&(e["content-type"]=s);const o=await PS(n);o&&(e["x-first-bytes"]=o),typeof n=="string"&&(n=new TextEncoder().encode(n));const c=new Response(n,{headers:e});return Object.defineProperty(c,"url",{value:i}),c}async function IS(n){if(!n.ok)throw await NS(n)}async function NS(n){const e=MS(n.url);let t=`Failed to fetch resource (${n.status}) ${n.statusText}: ${e}`;t=t.length>100?`${t.slice(0,100)}...`:t;const i={reason:n.statusText,url:n.url,response:n};try{const s=n.headers.get("Content-Type");i.reason=!n.bodyUsed&&s?.includes("application/json")?await n.json():await n.text()}catch{}return new wS(t,i)}async function PS(n){if(typeof n=="string")return`data:,${n.slice(0,5)}`;if(n instanceof Blob){const t=n.slice(0,5);return await new Promise(i=>{const s=new FileReader;s.onload=o=>i(o?.target?.result),s.readAsDataURL(t)})}if(n instanceof ArrayBuffer){const t=n.slice(0,5);return`data:base64,${kS(t)}`}return null}function kS(n){let e="";const t=new Uint8Array(n);for(let i=0;i<t.byteLength;i++)e+=String.fromCharCode(t[i]);return btoa(e)}function DS(n){return!US(n)&&!BS(n)}function US(n){return n.startsWith("http:")||n.startsWith("https:")}function BS(n){return n.startsWith("data:")}async function Hy(n,e){if(typeof n=="string"){const t=gS(n);return DS(t)&&globalThis.loaders?.fetchNode?globalThis.loaders?.fetchNode(t,e):await fetch(t,e)}return await n0(n)}const Wy=new xo({id:"loaders.gl"});class FS{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class LS{console;constructor(){this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const i0={fetch:null,mimeType:void 0,nothrow:!1,log:new LS,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Ed,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},zS={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function s0(){globalThis.loaders=globalThis.loaders||{};const{loaders:n}=globalThis;return n._state||(n._state={}),n._state}function r0(){const n=s0();return n.globalOptions=n.globalOptions||{...i0},n.globalOptions}function VS(n,e,t,i){return t=t||[],t=Array.isArray(t)?t:[t],jS(n,t),WS(e,n,i)}function jS(n,e){$y(n,null,i0,zS,e);for(const t of e){const i=n&&n[t.id]||{},s=t.options&&t.options[t.id]||{},o=t.deprecatedOptions&&t.deprecatedOptions[t.id]||{};$y(i,t.id,s,o,e)}}function $y(n,e,t,i,s){const o=e||"Top level",c=e?`${e}.`:"";for(const u in n){const h=!e&&So(n[u]),d=u==="baseUri"&&!e,g=u==="workerUrl"&&e;if(!(u in t)&&!d&&!g){if(u in i)Wy.warn(`${o} loader option '${c}${u}' no longer supported, use '${i[u]}'`)();else if(!h){const m=HS(u,s);Wy.warn(`${o} loader option '${c}${u}' not recognized. ${m}`)()}}}}function HS(n,e){const t=n.toLowerCase();let i="";for(const s of e)for(const o in s.options){if(n===o)return`Did you mean '${s.id}.${o}'?`;const c=o.toLowerCase();(t.startsWith(c)||c.startsWith(t))&&(i=i||`Did you mean '${s.id}.${o}'?`)}return i}function WS(n,e,t){const s={...n.options||{}};return $S(s,t),s.log===null&&(s.log=new FS),Xy(s,r0()),Xy(s,e),s}function Xy(n,e){for(const t in e)if(t in e){const i=e[t];zy(i)&&zy(n[t])?n[t]={...n[t],...e[t]}:n[t]=e[t]}}function $S(n,e){e&&!("baseUri"in n)&&(n.baseUri=e)}function Od(n){return n?(Array.isArray(n)&&(n=n[0]),Array.isArray(n?.extensions)):!1}function Id(n){cc(n,"null loader"),cc(Od(n),"invalid loader");let e;return Array.isArray(n)&&(e=n[1],n=n[0],n={...n,options:{...n.options,...e}}),(n?.parseTextSync||n?.parseText)&&(n.text=!0),n.text||(n.binary=!0),n}const a0=()=>{const n=s0();return n.loaderRegistry=n.loaderRegistry||[],n.loaderRegistry};function XS(n){const e=a0();n=Array.isArray(n)?n:[n];for(const t of n){const i=Id(t);e.find(s=>i===s)||e.unshift(i)}}function YS(){return a0()}const qS=/\.([^.]+)$/;async function KS(n,e=[],t,i){if(!o0(n))return null;let s=Yy(n,e,{...t,nothrow:!0},i);if(s)return s;if(Vs(n)&&(n=await n.slice(0,10).arrayBuffer(),s=Yy(n,e,t,i)),!s&&!t?.nothrow)throw new Error(l0(n));return s}function Yy(n,e=[],t,i){if(!o0(n))return null;if(e&&!Array.isArray(e))return Id(e);let s=[];e&&(s=s.concat(e)),t?.ignoreRegisteredLoaders||s.push(...YS()),QS(s);const o=ZS(n,s,t,i);if(!o&&!t?.nothrow)throw new Error(l0(n));return o}function ZS(n,e,t,i){const s=Pc(n),o=Md(n),c=Cd(s)||i?.url;let u=null,h="";return t?.mimeType&&(u=gh(e,t?.mimeType),h=`match forced by supplied MIME type ${t?.mimeType}`),u=u||GS(e,c),h=h||(u?`matched url ${c}`:""),u=u||gh(e,o),h=h||(u?`matched MIME type ${o}`:""),u=u||ew(e,n),h=h||(u?`matched initial data ${c0(n)}`:""),t?.fallbackMimeType&&(u=u||gh(e,t?.fallbackMimeType),h=h||(u?`matched fallback MIME type ${o}`:"")),h&&Yx.log(1,`selectLoader selected ${u?.name}: ${h}.`),u}function o0(n){return!(n instanceof Response&&n.status===204)}function l0(n){const e=Pc(n),t=Md(n);let i="No valid loader found (";i+=e?`${Jv(e)}, `:"no url provided, ",i+=`MIME type: ${t?`"${t}"`:"not provided"}, `;const s=n?c0(n):"";return i+=s?` first bytes: "${s}"`:"first bytes: not available",i+=")",i}function QS(n){for(const e of n)Id(e)}function GS(n,e){const t=e&&qS.exec(e),i=t&&t[1];return i?JS(n,i):null}function JS(n,e){e=e.toLowerCase();for(const t of n)for(const i of t.extensions)if(i.toLowerCase()===e)return t;return null}function gh(n,e){for(const t of n)if(t.mimeTypes?.some(i=>Vy(e,i))||Vy(e,`application/x.${t.id}`))return t;return null}function ew(n,e){if(!e)return null;for(const t of n)if(typeof e=="string"){if(tw(e,t))return t}else if(ArrayBuffer.isView(e)){if(qy(e.buffer,e.byteOffset,t))return t}else if(e instanceof ArrayBuffer&&qy(e,0,t))return t;return null}function tw(n,e){return e.testText?e.testText(n):(Array.isArray(e.tests)?e.tests:[e.tests]).some(i=>n.startsWith(i))}function qy(n,e,t){return(Array.isArray(t.tests)?t.tests:[t.tests]).some(s=>nw(n,e,t,s))}function nw(n,e,t,i){if(i instanceof ArrayBuffer)return uS(i,n,i.byteLength);switch(typeof i){case"function":return i(n);case"string":const s=Xh(n,e,i.length);return i===s;default:return!1}}function c0(n,e=5){return typeof n=="string"?n.slice(0,e):ArrayBuffer.isView(n)?Xh(n.buffer,n.byteOffset,e):n instanceof ArrayBuffer?Xh(n,0,e):""}function Xh(n,e,t){if(n.byteLength<e+t)return"";const i=new DataView(n);let s="";for(let o=0;o<t;o++)s+=String.fromCharCode(i.getUint8(e+o));return s}const iw=256*1024;function*sw(n,e){const t=e?.chunkSize||iw;let i=0;const s=new TextEncoder;for(;i<n.length;){const o=Math.min(n.length-i,t),c=n.slice(i,i+o);i+=o,yield s.encode(c)}}const rw=256*1024;function*aw(n,e={}){const{chunkSize:t=rw}=e;let i=0;for(;i<n.byteLength;){const s=Math.min(n.byteLength-i,t),o=new ArrayBuffer(s),c=new Uint8Array(n,i,s);new Uint8Array(o).set(c),i+=s,yield o}}const ow=1024*1024;async function*lw(n,e){const t=e?.chunkSize||ow;let i=0;for(;i<n.size;){const s=i+t,o=await n.slice(i,s).arrayBuffer();i=s,yield o}}function Ky(n,e){return Ed?cw(n,e):uw(n)}async function*cw(n,e){const t=n.getReader();let i;try{for(;;){const s=i||t.read();e?._streamReadAhead&&(i=t.read());const{done:o,value:c}=await s;if(o)return;yield Gv(c)}}catch{t.releaseLock()}}async function*uw(n,e){for await(const t of n)yield Gv(t)}function fw(n,e){if(typeof n=="string")return sw(n,e);if(n instanceof ArrayBuffer)return aw(n,e);if(Vs(n))return lw(n,e);if(e0(n))return Ky(n,e);if(zs(n))return Ky(n.body,e);throw new Error("makeIterator")}const u0="Cannot convert supplied data type";function hw(n,e,t){if(e.text&&typeof n=="string")return n;if(TS(n)&&(n=n.buffer),n instanceof ArrayBuffer){const i=n;return e.text&&!e.binary?new TextDecoder("utf8").decode(i):i}if(ArrayBuffer.isView(n)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(n);let i=n.buffer;const s=n.byteLength||n.length;return(n.byteOffset!==0||s!==i.byteLength)&&(i=i.slice(n.byteOffset,n.byteOffset+s)),i}throw new Error(u0)}async function dw(n,e,t){const i=n instanceof ArrayBuffer||ArrayBuffer.isView(n);if(typeof n=="string"||i)return hw(n,e);if(Vs(n)&&(n=await n0(n)),zs(n)){const s=n;return await IS(s),e.binary?await s.arrayBuffer():await s.text()}if(e0(n)&&(n=fw(n,t)),bS(n)||vS(n))return dS(n);throw new Error(u0)}function f0(n,e){const t=r0(),i=n||t;return typeof i.fetch=="function"?i.fetch:So(i.fetch)?s=>Hy(s,i.fetch):e?.fetch?e?.fetch:Hy}function pw(n,e,t){if(t)return t;const i={fetch:f0(e,n),...n};if(i.url){const s=Cd(i.url);i.baseUrl=s,i.queryString=CS(i.url),i.filename=Jv(s),i.baseUrl=mS(s)}return Array.isArray(i.loaders)||(i.loaders=null),i}function gw(n,e){if(n&&!Array.isArray(n))return n;let t;if(n&&(t=Array.isArray(n)?n:[n]),e&&e.loaders){const i=Array.isArray(e.loaders)?e.loaders:[e.loaders];t=t?[...t,...i]:i}return t&&t.length?t:void 0}async function fc(n,e,t,i){e&&!Array.isArray(e)&&!Od(e)&&(i=void 0,t=e,e=void 0),n=await n,t=t||{};const s=Pc(n),c=gw(e,i),u=await KS(n,c,t);return u?(t=VS(t,u,c,s),i=pw({url:s,_parse:fc,loaders:c},t,i||null),await _w(u,n,t,i)):null}async function _w(n,e,t,i){if(aS(n),t=qx(n.options,t),zs(e)){const o=e,{ok:c,redirected:u,status:h,statusText:d,type:g,url:m}=o,y=Object.fromEntries(o.headers.entries());i.response={headers:y,ok:c,redirected:u,status:h,statusText:d,type:g,url:m}}e=await dw(e,n,t);const s=n;if(s.parseTextSync&&typeof e=="string")return s.parseTextSync(e,t,i);if(oS(n,t))return await lS(n,e,t,i,fc);if(s.parseText&&typeof e=="string")return await s.parseText(e,t,i);if(s.parse)return await s.parse(e,t,i);throw is(!s.parseSync),new Error(`${n.id} loader - no parser found and worker is disabled`)}async function Yh(n,e,t,i){let s,o;!Array.isArray(e)&&!Od(e)?(s=[],o=e):(s=e,o=t);const c=f0(o);let u=n;return typeof n=="string"&&(u=await c(n)),Vs(n)&&(u=await c(n)),Array.isArray(s)?await fc(u,s,o):await fc(u,s,o)}const mw="4.3.3",yw=globalThis.loaders?.parseImageNode,qh=typeof Image<"u",Kh=typeof ImageBitmap<"u",bw=!!yw,Zh=Ed?!0:bw;function vw(n){switch(n){case"auto":return Kh||qh||Zh;case"imagebitmap":return Kh;case"image":return qh;case"data":return Zh;default:throw new Error(`@loaders.gl/images: image ${n} not supported in this environment`)}}function Tw(){if(Kh)return"imagebitmap";if(qh)return"image";if(Zh)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function xw(n){const e=ww(n);if(!e)throw new Error("Not an image");return e}function Sw(n){switch(xw(n)){case"data":return n;case"image":case"imagebitmap":const e=document.createElement("canvas"),t=e.getContext("2d");if(!t)throw new Error("getImageData");return e.width=n.width,e.height=n.height,t.drawImage(n,0,0),t.getImageData(0,0,n.width,n.height);default:throw new Error("getImageData")}}function ww(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&n instanceof Image?"image":n&&typeof n=="object"&&n.data&&n.width&&n.height?"data":null}const Aw=/^data:image\/svg\+xml/,Ew=/\.svg((\?|#).*)?$/;function Nd(n){return n&&(Aw.test(n)||Ew.test(n))}function Rw(n,e){if(Nd(e)){let i=new TextDecoder().decode(n);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(i=unescape(encodeURIComponent(i)))}catch(o){throw new Error(o.message)}return`data:image/svg+xml;base64,${btoa(i)}`}return h0(n,e)}function h0(n,e){if(Nd(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(n)])}async function d0(n,e,t){const i=Rw(n,t),s=self.URL||self.webkitURL,o=typeof i!="string"&&s.createObjectURL(i);try{return await Cw(o||i,e)}finally{o&&s.revokeObjectURL(o)}}async function Cw(n,e){const t=new Image;return t.src=n,e.image&&e.image.decode&&t.decode?(await t.decode(),t):await new Promise((i,s)=>{try{t.onload=()=>i(t),t.onerror=o=>{const c=o instanceof Error?o.message:"error";s(new Error(c))}}catch(o){s(o)}})}const Mw={};let Zy=!0;async function Ow(n,e,t){let i;Nd(t)?i=await d0(n,e,t):i=h0(n,t);const s=e&&e.imagebitmap;return await Iw(i,s)}async function Iw(n,e=null){if((Nw(e)||!Zy)&&(e=null),e)try{return await createImageBitmap(n,e)}catch(t){console.warn(t),Zy=!1}return await createImageBitmap(n)}function Nw(n){for(const e in n||Mw)return!1;return!0}function Pw(n){return!Bw(n,"ftyp",4)||(n[8]&96)===0?null:kw(n)}function kw(n){switch(Dw(n,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function Dw(n,e,t){return String.fromCharCode(...n.slice(e,t))}function Uw(n){return[...n].map(e=>e.charCodeAt(0))}function Bw(n,e,t=0){const i=Uw(e);for(let s=0;s<i.length;++s)if(i[s]!==n[s+t])return!1;return!0}const Zn=!1,fo=!0;function p0(n){const e=wo(n);return Lw(e)||jw(e)||zw(e)||Vw(e)||Fw(e)}function Fw(n){const e=new Uint8Array(n instanceof DataView?n.buffer:n),t=Pw(e);return t?{mimeType:t.mimeType,width:0,height:0}:null}function Lw(n){const e=wo(n);return e.byteLength>=24&&e.getUint32(0,Zn)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Zn),height:e.getUint32(20,Zn)}:null}function zw(n){const e=wo(n);return e.byteLength>=10&&e.getUint32(0,Zn)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,fo),height:e.getUint16(8,fo)}:null}function Vw(n){const e=wo(n);return e.byteLength>=14&&e.getUint16(0,Zn)===16973&&e.getUint32(2,fo)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,fo),height:e.getUint32(22,fo)}:null}function jw(n){const e=wo(n);if(!(e.byteLength>=3&&e.getUint16(0,Zn)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:i,sofMarkers:s}=Hw();let o=2;for(;o+9<e.byteLength;){const c=e.getUint16(o,Zn);if(s.has(c))return{mimeType:"image/jpeg",height:e.getUint16(o+5,Zn),width:e.getUint16(o+7,Zn)};if(!i.has(c))return null;o+=2,o+=e.getUint16(o,Zn)}return null}function Hw(){const n=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)n.add(t);return{tableMarkers:n,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function wo(n){if(n instanceof DataView)return n;if(ArrayBuffer.isView(n))return new DataView(n.buffer);if(n instanceof ArrayBuffer)return new DataView(n);throw new Error("toDataView")}async function Ww(n,e){const{mimeType:t}=p0(n)||{},i=globalThis.loaders?.parseImageNode;return cc(i),await i(n,t)}async function $w(n,e,t){e=e||{};const s=(e.image||{}).type||"auto",{url:o}=t||{},c=Xw(s);let u;switch(c){case"imagebitmap":u=await Ow(n,e,o);break;case"image":u=await d0(n,e,o);break;case"data":u=await Ww(n);break;default:cc(!1)}return s==="data"&&(u=Sw(u)),u}function Xw(n){switch(n){case"auto":case"data":return Tw();default:return vw(n),n}}const Yw=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],qw=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],Kw={image:{type:"auto",decode:!0}},Zw={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:mw,mimeTypes:qw,extensions:Yw,parse:$w,tests:[n=>!!p0(new DataView(n))],options:Kw},et=new xo({id:"deck"});let Qh={};function Qw(n){Qh=n}function $t(n,e,t,i){et.level>0&&Qh[n]&&Qh[n].call(null,e,t,i)}function Gw(n){const e=n[0],t=n[n.length-1];return e==="{"&&t==="}"||e==="["&&t==="]"}const Jw={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:Gw,parseTextSync:JSON.parse};function eA(){const n="9.1.14",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==n)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${n}`);return e||(et.log(1,`deck.gl ${n}`)(),globalThis.deck={...globalThis.deck,VERSION:n,version:n,log:et,_registerLoggers:Qw},XS([Jw,[Zw,{imagebitmap:{premultiplyAlpha:"none"}}]])),n}const tA=eA();function Pd(n,e){if(!n)throw new Error(e||"shadertools: assertion failed.")}const _h={number:{type:"number",validate(n,e){return Number.isFinite(n)&&typeof e=="object"&&(e.max===void 0||n<=e.max)&&(e.min===void 0||n>=e.min)}},array:{type:"array",validate(n,e){return Array.isArray(n)||ArrayBuffer.isView(n)}}};function nA(n){const e={};for(const[t,i]of Object.entries(n))e[t]=iA(i);return e}function iA(n){let e=Qy(n);if(e!=="object")return{value:n,..._h[e],type:e};if(typeof n=="object")return n?n.type!==void 0?{...n,..._h[n.type],type:n.type}:n.value===void 0?{type:"object",value:n}:(e=Qy(n.value),{...n,..._h[e],type:e}):{type:"object",value:null};throw new Error("props")}function Qy(n){return Array.isArray(n)||ArrayBuffer.isView(n)?"array":typeof n}const sA=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,rA=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,aA={vertex:sA,fragment:rA},Gy=/void\s+main\s*\([^)]*\)\s*\{\n?/,Jy=/}\n?[^{}]*$/,mh=[],nc="__LUMA_INJECT_DECLARATIONS__";function oA(n){const e={vertex:{},fragment:{}};for(const t in n){let i=n[t];const s=lA(t);typeof i=="string"&&(i={order:0,injection:i}),e[s][t]=i}return e}function lA(n){const e=n.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function hc(n,e,t,i=!1){const s=e==="vertex";for(const o in t){const c=t[o];c.sort((h,d)=>h.order-d.order),mh.length=c.length;for(let h=0,d=c.length;h<d;++h)mh[h]=c[h].injection;const u=`${mh.join(`
`)}
`;switch(o){case"vs:#decl":s&&(n=n.replace(nc,u));break;case"vs:#main-start":s&&(n=n.replace(Gy,h=>h+u));break;case"vs:#main-end":s&&(n=n.replace(Jy,h=>u+h));break;case"fs:#decl":s||(n=n.replace(nc,u));break;case"fs:#main-start":s||(n=n.replace(Gy,h=>h+u));break;case"fs:#main-end":s||(n=n.replace(Jy,h=>u+h));break;default:n=n.replace(o,h=>h+u)}}return n=n.replace(nc,""),i&&(n=n.replace(/\}\s*$/,o=>o+aA[e])),n}function dc(n){n.map(e=>cA(e))}function cA(n){if(n.instance)return;dc(n.dependencies||[]);const{propTypes:e={},deprecations:t=[],inject:i={}}=n,s={normalizedInjections:oA(i),parsedDeprecations:uA(t)};e&&(s.propValidators=nA(e)),n.instance=s;let o={};e&&(o=Object.entries(e).reduce((c,[u,h])=>{const d=h?.value;return d&&(c[u]=d),c},{})),n.defaultUniforms={...n.defaultUniforms,...o}}function g0(n,e,t){n.deprecations?.forEach(i=>{i.regex?.test(e)&&(i.deprecated?t.deprecated(i.old,i.new)():t.removed(i.old,i.new)())})}function uA(n){return n.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp(`\\b${e.old}\\(`);break;default:e.regex=new RegExp(`${e.type} ${e.old};`)}}),n}function kd(n){dc(n);const e={},t={};_0({modules:n,level:0,moduleMap:e,moduleDepth:t});const i=Object.keys(t).sort((s,o)=>t[o]-t[s]).map(s=>e[s]);return dc(i),i}function _0(n){const{modules:e,level:t,moduleMap:i,moduleDepth:s}=n;if(t>=5)throw new Error("Possible loop in shader dependency graph");for(const o of e)i[o.name]=o,(s[o.name]===void 0||s[o.name]<t)&&(s[o.name]=t);for(const o of e)o.dependencies&&_0({modules:o.dependencies,level:t+1,moduleMap:i,moduleDepth:s})}function fA(n){switch(n?.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function hA(n,e){if(Number(n.match(/^#version[ \t]+(\d+)/m)?.[1]||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return n=eb(n,dA),n;case"fragment":return n=eb(n,pA),n;default:throw new Error(e)}}const m0=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],dA=[...m0,[Gh("attribute"),"in $1"],[Gh("varying"),"out $1"]],pA=[...m0,[Gh("varying"),"in $1"]];function eb(n,e){for(const[t,i]of e)n=n.replace(t,i);return n}function Gh(n){return new RegExp(`\\b${n}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function y0(n,e){let t="";for(const i in n){const s=n[i];if(t+=`void ${s.signature} {
`,s.header&&(t+=`  ${s.header}`),e[i]){const o=e[i];o.sort((c,u)=>c.order-u.order);for(const c of o)t+=`  ${c.injection}
`}s.footer&&(t+=`  ${s.footer}`),t+=`}
`}return t}function b0(n){const e={vertex:{},fragment:{}};for(const t of n){let i,s;typeof t!="string"?(i=t,s=i.hook):(i={},s=t),s=s.trim();const[o,c]=s.split(":"),u=s.replace(/\(.+/,""),h=Object.assign(i,{signature:c});switch(o){case"vs":e.vertex[u]=h;break;case"fs":e.fragment[u]=h;break;default:throw new Error(o)}}return e}function gA(n,e){return{name:_A(n,e),language:"glsl",version:mA(n)}}function _A(n,e="unnamed"){const i=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(n);return i?i[1]:e}function mA(n){let e=100;const t=n.match(/[^\s]+/g);if(t&&t.length>=2&&t[0]==="#version"){const i=parseInt(t[1],10);Number.isFinite(i)&&(e=i)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const v0=`

${nc}
`,yA=`precision highp float;
`;function bA(n){const e=kd(n.modules||[]);return{source:TA(n.platformInfo,{...n,source:n.source,stage:"vertex",modules:e}),getUniforms:T0(e)}}function vA(n){const{vs:e,fs:t}=n,i=kd(n.modules||[]);return{vs:tb(n.platformInfo,{...n,source:e,stage:"vertex",modules:i}),fs:tb(n.platformInfo,{...n,source:t,stage:"fragment",modules:i}),getUniforms:T0(i)}}function TA(n,e){const{source:t,stage:i,modules:s,hookFunctions:o=[],inject:c={},log:u}=e;Pd(typeof t=="string","shader source must be a string");const h=t;let d="";const g=b0(o),m={},y={},T={};for(const C in c){const N=typeof c[C]=="string"?{injection:c[C],order:0}:c[C],V=/^(v|f)s:(#)?([\w-]+)$/.exec(C);if(V){const $=V[2],O=V[3];$?O==="decl"?y[C]=[N]:T[C]=[N]:m[C]=[N]}else T[C]=[N]}const w=s;for(const C of w){u&&g0(C,h,u);const N=x0(C,"wgsl");d+=N;const V=C.injections?.[i]||{};for(const $ in V){const O=/^(v|f)s:#([\w-]+)$/.exec($);if(O){const H=O[2]==="decl"?y:T;H[$]=H[$]||[],H[$].push(V[$])}else m[$]=m[$]||[],m[$].push(V[$])}}return d+=v0,d=hc(d,i,y),d+=y0(g[i],m),d+=h,d=hc(d,i,T),d}function tb(n,e){const{id:t,source:i,stage:s,language:o="glsl",modules:c,defines:u={},hookFunctions:h=[],inject:d={},prologue:g=!0,log:m}=e;Pd(typeof i=="string","shader source must be a string");const y=o==="glsl"?gA(i).version:-1,T=n.shaderLanguageVersion,w=y===100?"#version 100":"#version 300 es",N=i.split(`
`).slice(1).join(`
`),V={};c.forEach(oe=>{Object.assign(V,oe.defines)}),Object.assign(V,u);let $="";switch(o){case"wgsl":break;case"glsl":$=g?`${w}

// ----- PROLOGUE -------------------------
${xA({id:t,source:i,stage:s})}
${`#define SHADER_TYPE_${s.toUpperCase()}`}

${fA(n)}
${s==="fragment"?yA:""}

// ----- APPLICATION DEFINES -------------------------

${SA(V)}

`:`${w}
`;break}const O=b0(h),F={},H={},te={};for(const oe in d){const E=typeof d[oe]=="string"?{injection:d[oe],order:0}:d[oe],R=/^(v|f)s:(#)?([\w-]+)$/.exec(oe);if(R){const Y=R[2],ie=R[3];Y?ie==="decl"?H[oe]=[E]:te[oe]=[E]:F[oe]=[E]}else te[oe]=[E]}for(const oe of c){m&&g0(oe,N,m);const E=x0(oe,s);$+=E;const R=oe.instance?.normalizedInjections[s]||{};for(const Y in R){const ie=/^(v|f)s:#([\w-]+)$/.exec(Y);if(ie){const pe=ie[2]==="decl"?H:te;pe[Y]=pe[Y]||[],pe[Y].push(R[Y])}else F[Y]=F[Y]||[],F[Y].push(R[Y])}}return $+="// ----- MAIN SHADER SOURCE -------------------------",$+=v0,$=hc($,s,H),$+=y0(O[s],F),$+=N,$=hc($,s,te),o==="glsl"&&y!==T&&($=hA($,s)),$.trim()}function T0(n){return function(t){const i={};for(const s of n){const o=s.getUniforms?.(t,i);Object.assign(i,o)}return i}}function xA(n){const{id:e,source:t,stage:i}=n;return e&&t.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${i}`:""}function SA(n={}){let e="";for(const t in n){const i=n[t];(i||Number.isFinite(i))&&(e+=`#define ${t.toUpperCase()} ${n[t]}
`)}return e}function x0(n,e){let t;switch(e){case"vertex":t=n.vs||"";break;case"fragment":t=n.fs||"";break;case"wgsl":t=n.source||"";break;default:Pd(!1)}if(!n.name)throw new Error("Shader module must have a name");const i=n.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let s=`// ----- MODULE ${n.name} ---------------

`;return e!=="wgsl"&&(s+=`#define MODULE_${i}
`),s+=`${t}
`,s}const wA=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,AA=/^\s*\#\s*endif\s*$/;function EA(n,e){const t=n.split(`
`),i=[];let s=!0,o=null;for(const c of t){const u=c.match(wA),h=c.match(AA);u?(o=u[1],s=!!e?.defines?.[o]):h?s=!0:s&&i.push(c)}return i.join(`
`)}class Rs{static defaultShaderAssembler;_hookFunctions=[];_defaultModules=[];static getDefaultShaderAssembler(){return Rs.defaultShaderAssembler=Rs.defaultShaderAssembler||new Rs,Rs.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(t=>t.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const t=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(i=>i.name!==t)}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){const t=this._getModuleList(e.modules),i=this._hookFunctions,{source:s,getUniforms:o}=bA({...e,source:e.source,modules:t,hookFunctions:i});return{source:e.platformInfo.shaderLanguage==="wgsl"?EA(s):s,getUniforms:o,modules:t}}assembleGLSLShaderPair(e){const t=this._getModuleList(e.modules),i=this._hookFunctions;return{...vA({...e,vs:e.vs,fs:e.fs,modules:t,hookFunctions:i}),modules:t}}_getModuleList(e=[]){const t=new Array(this._defaultModules.length+e.length),i={};let s=0;for(let o=0,c=this._defaultModules.length;o<c;++o){const u=this._defaultModules[o],h=u.name;t[s++]=u,i[h]=!0}for(let o=0,c=e.length;o<c;++o){const u=e[o],h=u.name;i[h]||(t[s++]=u,i[h]=!0)}return t.length=s,dc(t),t}}const RA=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,CA=`#version 300 es
${RA}`;function S0(n){const{input:e,inputChannels:t,output:i}=n||{};if(!e)return CA;if(!t)throw new Error("inputChannels");const s=MA(t),o=OA(e,t);return`#version 300 es
in ${s} ${e};
out vec4 ${i};
void main() {
  ${i} = ${o};
}`}function MA(n){switch(n){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${n}`)}}function OA(n,e){switch(e){case 1:return`vec4(${n}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${n}, 0.0, 1.0)`;case 3:return`vec4(${n}, 1.0)`;case 4:return n;default:throw new Error(`invalid channels: ${e}`)}}class IA{stats=new Map;getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new Nc({id:e})),this.stats.get(e)}}const w0=new IA,ae=new xo({id:"luma.gl"}),yh={};function kc(n="id"){yh[n]=yh[n]||1;const e=yh[n]++;return`${n}-${e}`}let Ge=class{static defaultProps={id:"undefined",handle:void 0,userData:void 0};toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}id;props;userData={};_device;destroyed=!1;allocatedBytes=0;_attachedResources=new Set;constructor(e,t,i){if(!e)throw new Error("no device");this._device=e,this.props=NA(t,i);const s=this.props.id!=="undefined"?this.props.id:kc(this[Symbol.toStringTag]);this.props.id=s,this.id=s,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get(`${t}s Active`).decrementCount()}trackAllocatedMemory(e,t=this[Symbol.toStringTag]){const i=this._device.statsManager.getStats("Resource Counts");i.get("GPU Memory").addCount(e),i.get(`${t} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const t=this._device.statsManager.getStats("Resource Counts");t.get("GPU Memory").subtractCount(this.allocatedBytes),t.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${t}s Created`).incrementCount(),e.get(`${t}s Active`).incrementCount()}};function NA(n,e){const t={...e};for(const i in n)n[i]!==void 0&&(t[i]=n[i]);return t}class at extends Ge{static defaultProps={...Ge.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1};static MAP_READ=1;static MAP_WRITE=2;static COPY_SRC=4;static COPY_DST=8;static INDEX=16;static VERTEX=32;static UNIFORM=64;static STORAGE=128;static INDIRECT=256;static QUERY_RESOLVE=512;get[Symbol.toStringTag](){return"Buffer"}usage;indexType;updateTimestamp;constructor(e,t){const i={...t};(t.usage||0)&at.INDEX&&!t.indexType&&(t.data instanceof Uint32Array?i.indexType="uint32":t.data instanceof Uint16Array&&(i.indexType="uint16")),delete i.data,super(e,i,at.defaultProps),this.usage=i.usage||0,this.indexType=i.indexType,this.updateTimestamp=e.incrementTimestamp()}clone(e){return this.device.createBuffer({...this.props,...e})}readSyncWebGL(e,t){throw new Error("not implemented")}static DEBUG_DATA_MAX_LENGTH=32;debugData=new ArrayBuffer(0);_setDebugData(e,t,i){const s=ArrayBuffer.isView(e)?e.buffer:e,o=Math.min(e?e.byteLength:i,at.DEBUG_DATA_MAX_LENGTH);s===null?this.debugData=new ArrayBuffer(o):t===0&&i===s.byteLength?this.debugData=s.slice(0,o):this.debugData=s.slice(t,t+o)}}function A0(n){const e=nb[n],t=PA(e),i=n.includes("norm"),s=!i&&!n.startsWith("float"),o=n.startsWith("s");return{dataType:nb[n],byteLength:t,integer:s,signed:o,normalized:i}}function PA(n){return kA[n]}const nb={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},kA={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},jt="texture-compression-bc",Ze="texture-compression-astc",Xn="texture-compression-etc2",DA="texture-compression-etc1-webgl",Vl="texture-compression-pvrtc-webgl",bh="texture-compression-atc-webgl",jl="float32-renderable-webgl",vh="float16-renderable-webgl",UA="rgb9e5ufloat-renderable-webgl",Th="snorm8-renderable-webgl",to="norm16-renderable-webgl",xh="snorm16-renderable-webgl",Hl="float32-filterable",ib="float16-filterable-webgl";function E0(n){const e=BA[n];if(!e)throw new Error(`Unsupported texture format ${n}`);return e}const BA={r8unorm:{},r8snorm:{render:Th},r8uint:{},r8sint:{},rg8unorm:{},rg8snorm:{render:Th},rg8uint:{},rg8sint:{},r16uint:{},r16sint:{},r16float:{render:vh,filter:"float16-filterable-webgl"},"r16unorm-webgl":{f:to},"r16snorm-webgl":{f:xh},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},"rgb8unorm-webgl":{},"rgb8snorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},rgba8snorm:{render:Th},rgba8uint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{},rg16sint:{},rg16float:{render:vh,filter:ib},"rg16unorm-webgl":{render:to},"rg16snorm-webgl":{render:xh},r32uint:{},r32sint:{},r32float:{render:jl,filter:Hl},rgb9e5ufloat:{channels:"rgb",packed:!0,render:UA},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:jl},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},"rgb10a2uint-webgl":{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1,wgpu:!1},"rgb16unorm-webgl":{f:to},"rgb16snorm-webgl":{f:to},rg32uint:{},rg32sint:{},rg32float:{render:!1,filter:Hl},rgba16uint:{},rgba16sint:{},rgba16float:{render:vh,filter:ib},"rgba16unorm-webgl":{render:to},"rgba16snorm-webgl":{render:xh},"rgb32float-webgl":{render:jl,filter:Hl},rgba32uint:{},rgba32sint:{},rgba32float:{render:jl,filter:Hl},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0},"bc1-rgb-unorm-webgl":{f:jt},"bc1-rgb-unorm-srgb-webgl":{f:jt},"bc1-rgba-unorm":{f:jt},"bc1-rgba-unorm-srgb":{f:jt},"bc2-rgba-unorm":{f:jt},"bc2-rgba-unorm-srgb":{f:jt},"bc3-rgba-unorm":{f:jt},"bc3-rgba-unorm-srgb":{f:jt},"bc4-r-unorm":{f:jt},"bc4-r-snorm":{f:jt},"bc5-rg-unorm":{f:jt},"bc5-rg-snorm":{f:jt},"bc6h-rgb-ufloat":{f:jt},"bc6h-rgb-float":{f:jt},"bc7-rgba-unorm":{f:jt},"bc7-rgba-unorm-srgb":{f:jt},"etc2-rgb8unorm":{f:Xn},"etc2-rgb8unorm-srgb":{f:Xn},"etc2-rgb8a1unorm":{f:Xn},"etc2-rgb8a1unorm-srgb":{f:Xn},"etc2-rgba8unorm":{f:Xn},"etc2-rgba8unorm-srgb":{f:Xn},"eac-r11unorm":{f:Xn},"eac-r11snorm":{f:Xn},"eac-rg11unorm":{f:Xn},"eac-rg11snorm":{f:Xn},"astc-4x4-unorm":{f:Ze},"astc-4x4-unorm-srgb":{f:Ze},"astc-5x4-unorm":{f:Ze},"astc-5x4-unorm-srgb":{f:Ze},"astc-5x5-unorm":{f:Ze},"astc-5x5-unorm-srgb":{f:Ze},"astc-6x5-unorm":{f:Ze},"astc-6x5-unorm-srgb":{f:Ze},"astc-6x6-unorm":{f:Ze},"astc-6x6-unorm-srgb":{f:Ze},"astc-8x5-unorm":{f:Ze},"astc-8x5-unorm-srgb":{f:Ze},"astc-8x6-unorm":{f:Ze},"astc-8x6-unorm-srgb":{f:Ze},"astc-8x8-unorm":{f:Ze},"astc-8x8-unorm-srgb":{f:Ze},"astc-10x5-unorm":{f:Ze},"astc-10x5-unorm-srgb":{f:Ze},"astc-10x6-unorm":{f:Ze},"astc-10x6-unorm-srgb":{f:Ze},"astc-10x8-unorm":{f:Ze},"astc-10x8-unorm-srgb":{f:Ze},"astc-10x10-unorm":{f:Ze},"astc-10x10-unorm-srgb":{f:Ze},"astc-12x10-unorm":{f:Ze},"astc-12x10-unorm-srgb":{f:Ze},"astc-12x12-unorm":{f:Ze},"astc-12x12-unorm-srgb":{f:Ze},"pvrtc-rgb4unorm-webgl":{f:Vl},"pvrtc-rgba4unorm-webgl":{f:Vl},"pvrtc-rbg2unorm-webgl":{f:Vl},"pvrtc-rgba2unorm-webgl":{f:Vl},"etc1-rbg-unorm-webgl":{f:DA},"atc-rgb-unorm-webgl":{f:bh},"atc-rgba-unorm-webgl":{f:bh},"atc-rgbai-unorm-webgl":{f:bh}},FA=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],LA=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;function R0(n){return FA.some(e=>n.startsWith(e))}function Dd(n){let e=zA(n);if(R0(n)){e.channels="rgb",e.components=3,e.bytesPerPixel=1,e.srgb=!1,e.compressed=!0;const i=VA(n);i&&(e.blockWidth=i.blockWidth,e.blockHeight=i.blockHeight)}const t=LA.exec(n);if(t){const[,i,s,o,c,u]=t,h=`${o}${s}`,d=A0(h),g=d.byteLength*8,m=i.length,y=[g,m>=2?g:0,m>=3?g:0,m>=4?g:0];e={format:n,attachment:e.attachment,dataType:d.dataType,components:m,channels:i,integer:d.integer,signed:d.signed,normalized:d.normalized,bitsPerChannel:y,bytesPerPixel:d.byteLength*i.length,packed:e.packed,srgb:e.srgb},u==="-webgl"&&(e.webgl=!0),c==="-srgb"&&(e.srgb=!0)}return n.endsWith("-webgl")&&(e.webgl=!0),n.endsWith("-srgb")&&(e.srgb=!0),e}function zA(n){const e=E0(n),t=e.bytesPerPixel||1,i=e.bitsPerChannel||[8,8,8,8];return delete e.bitsPerChannel,delete e.bytesPerPixel,delete e.f,delete e.render,delete e.filter,delete e.blend,delete e.store,{...e,format:n,attachment:e.attachment||"color",channels:e.channels||"r",components:e.components||e.channels?.length||1,bytesPerPixel:t,bitsPerChannel:i,dataType:e.dataType||"uint8",srgb:e.srgb??!1,packed:e.packed??!1,webgl:e.webgl??!1,integer:e.integer??!1,signed:e.signed??!1,normalized:e.normalized??!1,compressed:e.compressed??!1}}function VA(n){const t=/.*-(\d+)x(\d+)-.*/.exec(n);if(t){const[,i,s]=t;return{blockWidth:Number(i),blockHeight:Number(s)}}return null}function jA(n){const e=E0(n),t={format:n,create:e.f??!0,render:e.render??!0,filter:e.filter??!0,blend:e.blend??!0,store:e.store??!0},i=Dd(n),s=n.startsWith("depth")||n.startsWith("stencil"),o=i?.signed,c=i?.integer,u=i?.webgl;return t.render&&=!o,t.filter&&=!s&&!o&&!c&&!u,t}class HA{}class WA{features;disabledFeatures;constructor(e=[],t){this.features=new Set(e),this.disabledFeatures=t||{}}*[Symbol.iterator](){yield*this.features}has(e){return!this.disabledFeatures?.[e]&&this.features.has(e)}}class es{static defaultProps={id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,onError:e=>ae.error(e.message)(),_reuseDevices:!1,_requestMaxLimits:!0,_factoryDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_resourceDefaults:{},webgl:{},debug:ae.get("debug")||void 0,debugShaders:ae.get("debug-shaders")||void 0,debugFramebuffers:!!ae.get("debug-framebuffers"),debugWebGL:!!ae.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_handle:void 0};get[Symbol.toStringTag](){return"Device"}constructor(e){this.props={...es.defaultProps,...e},this.id=this.props.id||kc(this[Symbol.toStringTag].toLowerCase())}id;props;userData={};statsManager=w0;timestamp=0;_reused=!1;_lumaData={};getTextureFormatCapabilities(e){const t=jA(e),i=c=>(typeof c=="string"?this.features.has(c):c)??!0,s=i(t.create),o={format:e,create:s,render:s&&i(t.render),filter:s&&i(t.filter),blend:s&&i(t.blend),store:s&&i(t.store)};return this._getDeviceSpecificTextureFormatCapabilities(o)}isTextureFormatSupported(e,t){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return R0(e)}loseDevice(){return!1}reportError(e){this.props.onError(e)}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}createCommandEncoder(e={}){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,t){throw new Error("not implemented")}readPixelsToBufferWebGL(e,t){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,t){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return e.createCanvasContext===!0?{}:e.createCanvasContext}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const t={...e};return(e.usage||0)&at.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?t.indexType="uint32":e.data instanceof Uint16Array?t.indexType="uint16":ae.warn("indices buffer content must be of integer type")()),t}}const $A=Ls()&&typeof document<"u",XA=()=>$A&&document.readyState==="complete",YA="set luma.log.level=1 (or higher) to trace rendering",sb="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.";class Dr{static defaultProps={...es.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0};static pageLoaded=qA().then(()=>{ae.probe(2,"DOM is loaded")()});stats=w0;log=ae;VERSION="9.1.9";spector;preregisteredAdapters=new Map;constructor(){if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw ae.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),ae.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");ae.error("This version of luma.gl has already been initialized")()}ae.log(1,`${this.VERSION} - ${YA}`)(),globalThis.luma=this}registerAdapters(e){for(const t of e)this.preregisteredAdapters.set(t.type,t)}getSupportedAdapters(e=[]){const t=this.getAdapterMap(e);return Array.from(t).map(([,i])=>i).filter(i=>i.isSupported?.()).map(i=>i.type)}getBestAvailableAdapter(e=[]){const t=this.getAdapterMap(e);return t.get("webgpu")?.isSupported?.()?"webgpu":t.get("webgl")?.isSupported?.()?"webgl":null}setDefaultDeviceProps(e){Object.assign(Dr.defaultProps,e)}async createDevice(e={}){e={...Dr.defaultProps,...e},e.waitForPageLoad&&await Dr.pageLoaded;const t=this.getAdapterMap(e.adapters);let i=e.type||"";i==="best-available"&&(i=this.getBestAvailableAdapter(e.adapters)||i);const c=await(this.getAdapterMap(e.adapters)||t).get(i)?.create?.(e);if(c)return c;throw new Error(sb)}async attachDevice(e){const t=this.getAdapterMap(e.adapters);let i="";e.handle instanceof WebGL2RenderingContext&&(i="webgl"),e.createCanvasContext&&await Dr.pageLoaded,e.handle===null&&(i="unknown");const o=await t.get(i)?.attach?.(null);if(o)return o;throw new Error(sb)}enforceWebGL2(e=!0,t=[]){const s=this.getAdapterMap(t).get("webgl");s||ae.warn("enforceWebGL2: webgl adapter not found")(),s?.enforceWebGL2?.(e)}getAdapterMap(e=[]){const t=new Map(this.preregisteredAdapters);for(const i of e)t.set(i.type,i);return t}registerDevices(e){ae.warn("luma.registerDevices() is deprecated, use luma.registerAdapters() instead");for(const t of e){const i=t.adapter;i&&this.preregisteredAdapters.set(i.type,i)}}}const Jh=new Dr;function qA(){return XA()||typeof window>"u"?Promise.resolve():new Promise(n=>{window.addEventListener("load",()=>n())})}class KA{}class Ud{static defaultProps={canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb"};id;props;canvas;htmlCanvas;offscreenCanvas;type;width=1;height=1;resizeObserver;_canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1};toString(){return`${this[Symbol.toStringTag]}(${this.id})`}constructor(e){if(this.props={...Ud.defaultProps,...e},e=this.props,!Ls()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=QA(e.canvas):this.canvas=e.canvas;else{const t=GA(e),i=ZA(e?.container||null);i.insertBefore(t,i.firstChild),this.canvas=t,e?.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(t=>{for(const i of t)i.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),t=this.canvas;return t.parentElement?[t.clientWidth*e,t.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,t]=this.getPixelSize();return e/t}cssToDeviceRatio(){try{const[e]=this.getDrawingBufferSize(),t=this._canvasSizeInfo.clientWidth||this.htmlCanvas?.clientWidth;return t?e/t:1}catch{return 1}}cssToDevicePixels(e,t=!0){const i=this.cssToDeviceRatio(),[s,o]=this.getDrawingBufferSize();return JA(e,i,s,o,t)}setDevicePixelRatio(e,t={}){if(!this.htmlCanvas)return;let i="width"in t?t.width:this.htmlCanvas.clientWidth,s="height"in t?t.height:this.htmlCanvas.clientHeight;(!i||!s)&&(ae.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,i=this.htmlCanvas.width||1,s=this.htmlCanvas.height||1);const o=this._canvasSizeInfo;if(o.clientWidth!==i||o.clientHeight!==s||o.devicePixelRatio!==e){let c=e;const u=Math.floor(i*c),h=Math.floor(s*c);if(this.htmlCanvas.width=u,this.htmlCanvas.height=h,this.device.gl){const[g,m]=this.getDrawingBufferSize();(g!==u||m!==h)&&(c=Math.min(g/i,m/s),this.htmlCanvas.width=Math.floor(i*c),this.htmlCanvas.height=Math.floor(s*c),ae.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=i,this._canvasSizeInfo.clientHeight=s,this._canvasSizeInfo.devicePixelRatio=e}}}getDrawingBufferSize(){const e=this.device.gl;return e?[e.drawingBufferWidth,e.drawingBufferHeight]:this.getPixelSize()}_setAutoCreatedCanvasId(e){this.htmlCanvas?.id==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}}function ZA(n){if(typeof n=="string"){const e=document.getElementById(n);if(!e)throw new Error(`${n} is not an HTML element`);return e}else if(n)return n;return document.body}function QA(n){const e=document.getElementById(n);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function GA(n){const{width:e,height:t}=n,i=document.createElement("canvas");return i.id=kc("lumagl-auto-created-canvas"),i.width=e||1,i.height=t||1,i.style.width=Number.isFinite(e)?`${e}px`:"100%",i.style.height=Number.isFinite(t)?`${t}px`:"100%",i}function JA(n,e,t,i,s){const o=n,c=rb(o[0],e,t);let u=ab(o[1],e,i,s),h=rb(o[0]+1,e,t);const d=h===t-1?h:h-1;h=ab(o[1]+1,e,i,s);let g;return s?(h=h===0?h:h+1,g=u,u=h):g=h===i-1?h:h-1,{x:c,y:u,width:Math.max(d-c+1,1),height:Math.max(g-u+1,1)}}function rb(n,e,t){return Math.min(Math.round(n*e),t-1)}function ab(n,e,t,i){return i?Math.max(0,t-1-Math.round(n*e)):Math.min(Math.round(n*e),t-1)}class Qe extends Ge{static COPY_SRC=1;static COPY_DST=2;static TEXTURE=4;static STORAGE=8;static RENDER_ATTACHMENT=16;static CubeFaces=["+X","-X","+Y","-Y","+Z","-Z"];static defaultProps={...Ge.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!1,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,sampler:{},view:void 0,flipY:void 0};get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}dimension;format;width;height;depth;mipLevels;updateTimestamp;constructor(e,t){if(t=Qe.normalizeProps(e,t),super(e,t,Qe.defaultProps),this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.props.width===void 0||this.props.height===void 0){const i=Qe.getTextureDataSize(this.props.data);this.width=i?.width||1,this.height=i?.height||1}this.props.mipmaps&&this.props.mipLevels===void 0&&(this.props.mipLevels="pyramid"),this.mipLevels=this.props.mipLevels==="pyramid"?Qe.getMipLevelCount(this.width,this.height):this.props.mipLevels||1,this.updateTimestamp=e.incrementTimestamp()}clone(e){return this.device.createTexture({...this.props,...e})}static isExternalImage(e){return typeof ImageData<"u"&&e instanceof ImageData||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement||typeof VideoFrame<"u"&&e instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas}static getExternalImageSize(e){if(typeof ImageData<"u"&&e instanceof ImageData||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height};if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement)return{width:e.naturalWidth,height:e.naturalHeight};if(typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement)return{width:e.videoWidth,height:e.videoHeight};if(typeof VideoFrame<"u"&&e instanceof VideoFrame)return{width:e.displayWidth,height:e.displayHeight};throw new Error("Unknown image type")}static isTextureLevelData(e){const t=e?.data;return ArrayBuffer.isView(t)}static getTextureDataSize(e){if(!e||ArrayBuffer.isView(e))return null;if(Array.isArray(e))return Qe.getTextureDataSize(e[0]);if(Qe.isExternalImage(e))return Qe.getExternalImageSize(e);if(e&&typeof e=="object"&&e.constructor===Object){const i=Object.values(e)[0];return{width:i.width,height:i.height}}throw new Error("texture size deduction failed")}static normalizeTextureData(e,t){let i;return ArrayBuffer.isView(e)?i=[{data:e,width:t.width,height:t.height}]:Array.isArray(e)?i=e:i=[e],i}static getMipLevelCount(e,t){return Math.floor(Math.log2(Math.max(e,t)))+1}static getCubeFaceDepth(e){switch(e){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(e)}}static defaultCopyExternalImageOptions={image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1};static normalizeProps(e,t){const i={...t},s=e?.props?._resourceDefaults?.texture||{};Object.assign(i,s);const{width:o,height:c}=i;return typeof o=="number"&&(i.width=Math.max(1,Math.ceil(o))),typeof c=="number"&&(i.height=Math.max(1,Math.ceil(c))),i}}class Dc extends Ge{static defaultProps={...Ge.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0};get[Symbol.toStringTag](){return"TextureView"}constructor(e,t){super(e,t,Dc.defaultProps)}}function eE(n,e,t){let i="";const s=e.split(/\r?\n/),o=n.slice().sort((c,u)=>c.lineNum-u.lineNum);switch(t?.showSourceCode||"no"){case"all":let c=0;for(let u=1;u<=s.length;u++)for(i+=C0(s[u-1],u,t);o.length>c&&o[c].lineNum===u;){const h=o[c++];i+=ob(h,s,h.lineNum,{...t,inlineSource:!1})}return i;case"issues":case"no":for(const u of n)i+=ob(u,s,u.lineNum,{inlineSource:t?.showSourceCode!=="no"});return i}}function ob(n,e,t,i){if(i?.inlineSource){const o=tE(e,t),c=n.linePos>0?`${" ".repeat(n.linePos+5)}^^^
`:"";return`
${o}${c}${n.type.toUpperCase()}: ${n.message}

`}const s=n.type==="error"?"red":"#8B4000";return i?.html?`<div class='luma-compiler-log-error' style="color:${s};"><b> ${n.type.toUpperCase()}: ${n.message}</b></div>`:`${n.type.toUpperCase()}: ${n.message}`}function tE(n,e,t){let i="";for(let s=e-2;s<=e;s++){const o=n[s-1];o!==void 0&&(i+=C0(o,e,t))}return i}function C0(n,e,t){const i=t?.html?iE(n):n;return`${nE(String(e),4)}: ${i}${t?.html?"<br/>":`
`}`}function nE(n,e){let t="";for(let i=n.length;i<e;++i)t+=" ";return t+n}function iE(n){return n.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}class Uc extends Ge{static defaultProps={...Ge.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0};get[Symbol.toStringTag](){return"Shader"}stage;source;compilationStatus="pending";constructor(e,t){t={...t,debugShaders:t.debugShaders||e.props.debugShaders||"errors"},super(e,{id:sE(t),...t},Uc.defaultProps),this.stage=this.props.stage,this.source=this.props.source}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const e=this.props.debugShaders;switch(e){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const t=await this.getCompilationInfo();e==="warnings"&&t?.length===0||this._displayShaderLog(t)}_displayShaderLog(e){if(typeof document>"u"||!document?.createElement)return;const t=M0(this.source),i=`${this.stage} ${t}`;let s=eE(e,this.source,{showSourceCode:"all",html:!0});const o=this.getTranslatedSource();o&&(s+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${o}</pre></code>`);const c=document.createElement("Button");c.innerHTML=`
<h1>Shader Compilation Error in ${i}</h1><br /><br />
<code style="user-select:text;"><pre>
${s}
</pre></code>`,c.style.top="10px",c.style.left="10px",c.style.position="absolute",c.style.zIndex="9999",c.style.width="100%",c.style.textAlign="left",document.body.appendChild(c),document.getElementsByClassName("luma-compiler-log-error")[0]?.scrollIntoView(),c.onclick=()=>{const h=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(h)}}}function sE(n){return M0(n.source)||n.id||kc(`unnamed ${n.stage}-shader`)}function M0(n,e="unnamed"){const i=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(n);return i?i[1]:e}class yo extends Ge{static defaultProps={...Ge.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1};get[Symbol.toStringTag](){return"Sampler"}constructor(e,t){t=yo.normalizeProps(e,t),super(e,t,yo.defaultProps)}static normalizeProps(e,t){const i=e?.props?._resourceDefaults?.sampler||{};return{...t,...i}}}class Bc extends Ge{static defaultProps={...Ge.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null};get[Symbol.toStringTag](){return"Framebuffer"}width;height;constructor(e,t={}){super(e,t,Bc.defaultProps),this.width=this.props.width,this.height=this.props.height}clone(e){const t=this.colorAttachments.map(s=>s.texture.clone(e)),i=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(e);return this.device.createFramebuffer({...this.props,colorAttachments:t,depthStencilAttachment:i})}resize(e){let t=!e;if(e){const[i,s]=Array.isArray(e)?e:[e.width,e.height];t=t||s!==this.height||i!==this.width,this.width=i,this.height=s}t&&(ae.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((t,i)=>{if(typeof t=="string"){const s=this.createColorTexture(t,i);return this.attachResource(s),s.view}return t instanceof Qe?t.view:t});const e=this.props.depthStencilAttachment;if(e)if(typeof e=="string"){const t=this.createDepthStencilTexture(e);this.attachResource(t),this.depthStencilAttachment=t.view}else e instanceof Qe?this.depthStencilAttachment=e.view:this.depthStencilAttachment=e}createColorTexture(e,t){return this.device.createTexture({id:`${this.id}-color-attachment-${t}`,usage:Qe.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(e){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:Qe.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(e,t){for(let i=0;i<this.colorAttachments.length;++i)if(this.colorAttachments[i]){const s=this.colorAttachments[i].texture.clone({width:e,height:t});this.destroyAttachedResource(this.colorAttachments[i]),this.colorAttachments[i]=s.view,this.attachResource(s.view)}if(this.depthStencilAttachment){const i=this.depthStencilAttachment.texture.clone({width:e,height:t});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=i.view,this.attachResource(i)}this.updateAttachments()}}class $r extends Ge{static defaultProps={...Ge.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}};get[Symbol.toStringTag](){return"RenderPipeline"}shaderLayout;bufferLayout;linkStatus="pending";hash="";constructor(e,t){super(e,t,$r.defaultProps),this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}setUniformsWebGL(e){throw new Error("Use uniform blocks")}}class Es extends Ge{static defaultClearColor=[0,0,0,1];static defaultClearDepth=1;static defaultClearStencil=0;static defaultProps={...Ge.defaultProps,framebuffer:null,parameters:void 0,clearColor:Es.defaultClearColor,clearColors:void 0,clearDepth:Es.defaultClearDepth,clearStencil:Es.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0};get[Symbol.toStringTag](){return"RenderPass"}constructor(e,t){t=Es.normalizeProps(e,t),super(e,t,Es.defaultProps)}static normalizeProps(e,t){return{...e.props._resourceDefaults?.renderPass,...t}}}class pc extends Ge{static defaultProps={...Ge.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0};get[Symbol.toStringTag](){return"ComputePipeline"}hash="";shaderLayout;constructor(e,t){super(e,t,pc.defaultProps),this.shaderLayout=t.shaderLayout}}class Bd extends Ge{static defaultProps={...Ge.defaultProps,measureExecutionTime:void 0};get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,t){super(e,t,Bd.defaultProps)}}class Fd extends Ge{static defaultProps={...Ge.defaultProps};get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,t){super(e,t,Fd.defaultProps)}}function rE(n){const[e,t]=oE[n],i=e==="i32"||e==="u32",s=e!=="u32",o=lE[e]*t,c=aE(e,t);return{dataType:e,components:t,defaultVertexFormat:c,byteLength:o,integer:i,signed:s}}function aE(n,e){let t;switch(n){case"f32":t="float32";break;case"i32":t="sint32";break;case"u32":t="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?t:`${t}x${e}`}const oE={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},lE={f32:4,f16:2,i32:4,u32:4};function O0(n){let e;n.endsWith("-webgl")&&(n.replace("-webgl",""),e=!0);const[t,i]=n.split("x"),s=t,o=i?parseInt(i):1,c=A0(s),u={type:s,components:o,byteLength:c.byteLength*o,integer:c.integer,signed:c.signed,normalized:c.normalized};return e&&(u.webglOnly=!0),u}function I0(n,e){const t={};for(const i of n.attributes){const s=uE(n,e,i.name);s&&(t[i.name]=s)}return t}function cE(n,e,t=16){const i=I0(n,e),s=new Array(t).fill(null);for(const o of Object.values(i))s[o.location]=o;return s}function uE(n,e,t){const i=fE(n,t),s=hE(e,t);if(!i)return null;const o=rE(i.type),c=s?.vertexFormat||o.defaultVertexFormat,u=O0(c);return{attributeName:s?.attributeName||i.name,bufferName:s?.bufferName||i.name,location:i.location,shaderType:i.type,shaderDataType:o.dataType,shaderComponents:o.components,vertexFormat:c,bufferDataType:u.type,bufferComponents:u.components,normalized:u.normalized,integer:o.integer,stepMode:s?.stepMode||i.stepMode||"vertex",byteOffset:s?.byteOffset||0,byteStride:s?.byteStride||0}}function fE(n,e){const t=n.attributes.find(i=>i.name===e);return t||ae.warn(`shader layout attribute "${e}" not present in shader`),t||null}function hE(n,e){dE(n);let t=pE(n,e);return t||(t=gE(n,e),t)?t:(ae.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function dE(n){for(const e of n)(e.attributes&&e.format||!e.attributes&&!e.format)&&ae.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function pE(n,e){for(const t of n)if(t.format&&t.name===e)return{attributeName:t.name,bufferName:e,stepMode:t.stepMode,vertexFormat:t.format,byteOffset:0,byteStride:t.byteStride||0};return null}function gE(n,e){for(const t of n){let i=t.byteStride;if(typeof t.byteStride!="number")for(const o of t.attributes||[]){const c=O0(o.format);i+=c.byteLength}const s=t.attributes?.find(o=>o.attribute===e);if(s)return{attributeName:s.attribute,bufferName:t.name,stepMode:t.stepMode,vertexFormat:s.format,byteOffset:s.byteOffset,byteStride:i}}return null}class Ld extends Ge{static defaultProps={...Ge.defaultProps,renderPipeline:null};get[Symbol.toStringTag](){return"VertexArray"}maxVertexAttributes;attributeInfos;indexBuffer=null;attributes;constructor(e,t){super(e,t,Ld.defaultProps),this.maxVertexAttributes=e.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null);const{shaderLayout:i,bufferLayout:s}=t.renderPipeline||{};if(!i||!s)throw new Error("VertexArray");this.attributeInfos=cE(i,s,this.maxVertexAttributes)}setConstantWebGL(e,t){this.device.reportError(new Error("constant attributes not supported"))}}class zd extends Ge{static defaultProps={...Ge.defaultProps,layout:void 0,buffers:{}};get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,t){super(e,t,zd.defaultProps)}}class Vd extends Ge{static defaultProps={...Ge.defaultProps,type:void 0,count:void 0};get[Symbol.toStringTag](){return"QuerySet"}constructor(e,t){super(e,t,Vd.defaultProps)}}const _E={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function mE(n){return _E[n]}function yE(n,e){switch(e){case 1:return n;case 2:return n+n%2;default:return n+(4-n%4)%4}}let Wl;function N0(n){return(!Wl||Wl.byteLength<n)&&(Wl=new ArrayBuffer(n)),Wl}function bE(n,e){const t=N0(n.BYTES_PER_ELEMENT*e);return new n(t,0,e)}function vE(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function gc(n){return Array.isArray(n)?n.length===0||typeof n[0]=="number":vE(n)}const lb=1024;class TE{layout={};byteLength;constructor(e){let t=0;for(const[s,o]of Object.entries(e)){const c=mE(o),{type:u,components:h}=c;t=yE(t,h);const d=t;t+=h,this.layout[s]={type:u,size:h,offset:d}}t+=(4-t%4)%4;const i=t*4;this.byteLength=Math.max(i,lb)}getData(e){const t=Math.max(this.byteLength,lb),i=N0(t),s={i32:new Int32Array(i),u32:new Uint32Array(i),f32:new Float32Array(i),f16:new Uint16Array(i)};for(const[o,c]of Object.entries(e)){const u=this.layout[o];if(!u){ae.warn(`Supplied uniform value ${o} not present in uniform block layout`)();continue}const{type:h,size:d,offset:g}=u,m=s[h];if(d===1){if(typeof c!="number"&&typeof c!="boolean"){ae.warn(`Supplied value for single component uniform ${o} is not a number: ${c}`)();continue}m[g]=Number(c)}else{if(!gc(c)){ae.warn(`Supplied value for multi component / array uniform ${o} is not a numeric array: ${c}`)();continue}m.set(c,g)}}return new Uint8Array(i)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function xE(n,e,t=16){if(n!==e)return!1;const i=n,s=e;if(!gc(i))return!1;if(gc(s)&&i.length===s.length){for(let o=0;o<i.length;++o)if(s[o]!==i[o])return!1}return!0}function SE(n){return gc(n)?n.slice():n}class wE{name;uniforms={};modifiedUniforms={};modified=!0;bindingLayout={};needsRedraw="initialized";constructor(e){if(this.name=e?.name||"unnamed",e?.name&&e?.shaderLayout){const t=e?.shaderLayout.bindings?.find(s=>s.type==="uniform"&&s.name===e?.name);if(!t)throw new Error(e?.name);const i=t;for(const s of i.uniforms||[])this.bindingLayout[s.name]=s}}setUniforms(e){for(const[t,i]of Object.entries(e))this._setUniform(t,i),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${t}=${i}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,t){xE(this.uniforms[e],t)||(this.uniforms[e]=SE(t),this.modifiedUniforms[e]=!0,this.modified=!0)}}class AE{uniformBlocks=new Map;uniformBufferLayouts=new Map;uniformBuffers=new Map;constructor(e){for(const[t,i]of Object.entries(e)){const s=t,o=new TE(i.uniformTypes||{});this.uniformBufferLayouts.set(s,o);const c=new wE({name:t});c.setUniforms(i.defaultUniforms||{}),this.uniformBlocks.set(s,c)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){for(const[t,i]of Object.entries(e))this.uniformBlocks.get(t)?.setUniforms(i);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e)?.byteLength||0}getUniformBufferData(e){const t=this.uniformBlocks.get(e)?.getAllUniforms()||{};return this.uniformBufferLayouts.get(e)?.getData(t)}createUniformBuffer(e,t,i){i&&this.setUniforms(i);const s=this.getUniformBufferByteLength(t),o=e.createBuffer({usage:at.UNIFORM|at.COPY_DST,byteLength:s}),c=this.getUniformBufferData(t);return o.write(c),o}getManagedUniformBuffer(e,t){if(!this.uniformBuffers.get(t)){const i=this.getUniformBufferByteLength(t),s=e.createBuffer({usage:at.UNIFORM|at.COPY_DST,byteLength:i});this.uniformBuffers.set(t,s)}return this.uniformBuffers.get(t)}updateUniformBuffers(){let e=!1;for(const t of this.uniformBlocks.keys()){const i=this.updateUniformBuffer(t);e||=i}return e&&ae.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){const t=this.uniformBlocks.get(e);let i=this.uniformBuffers.get(e),s=!1;if(i&&t?.needsRedraw){s||=t.needsRedraw;const o=this.getUniformBufferData(e);i=this.uniformBuffers.get(e),i?.write(o);const c=this.uniformBlocks.get(e)?.getAllUniforms();ae.log(4,`Writing to uniform buffer ${String(e)}`,o,c)()}return s}}function P0(n){const e=ArrayBuffer.isView(n)?n.constructor:n;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function k0(n){switch(n){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(n)}}function EE(n,e,t){if(!e||e>4)throw new Error(`size ${e}`);const i=e;let s=P0(n);if(s==="uint8"&&t&&i===1)return"unorm8-webgl";if(s==="uint8"&&t&&i===3)return"unorm8x3-webgl";if(s==="uint8"||s==="sint8"){if(i===1||i===3)throw new Error(`size: ${e}`);return t&&(s=s.replace("int","norm")),`${s}x${i}`}if(s==="uint16"||s==="sint16"){if(i===1||i===3)throw new Error(`size: ${e}`);return t&&(s=s.replace("int","norm")),`${s}x${i}`}return i===1?s:`${s}x${i}`}class Sh{bufferLayouts;constructor(e){this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(t=>t.name===e)||null}getAttributeNamesForBuffer(e){return e.attributes?e.attributes?.map(t=>t.attribute):[e.name]}mergeBufferLayouts(e,t){const i=[...e];for(const s of t){const o=i.findIndex(c=>c.name===s.name);o<0?i.push(s):i[o]=s}return i}getBufferIndex(e){const t=this.bufferLayouts.findIndex(i=>i.name===e);return t===-1&&ae.warn(`BufferLayout: Missing buffer for "${e}".`)(),t}}function RE(n,e){const t=Object.fromEntries(n.attributes.map(s=>[s.name,s.location])),i=e.slice();return i.sort((s,o)=>{const c=s.attributes?s.attributes.map(g=>g.attribute):[s.name],u=o.attributes?o.attributes.map(g=>g.attribute):[o.name],h=Math.min(...c.map(g=>t[g])),d=Math.min(...u.map(g=>t[g]));return h-d}),i}class An{constructor(e,t){this.name=e,this.attributes=t,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}get isPointer(){return!1}getTypeName(){return this.name}}class cb{constructor(e,t,i){this.name=e,this.type=t,this.attributes=i,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class Qi extends An{constructor(e,t){super(e,t),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class ts extends An{constructor(e,t){super(e,t),this.count=0,this.stride=0}get isArray(){return!0}getTypeName(){return`array<${this.format.getTypeName()}, ${this.count}>`}}class ed extends An{constructor(e,t,i){super(e,i),this.format=t}get isPointer(){return!0}getTypeName(){return`&${this.format.getTypeName()}`}}class ks extends An{constructor(e,t,i,s){super(e,i),this.format=t,this.access=s}get isTemplate(){return!0}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}var Ki;(n=>{n[n.Uniform=0]="Uniform",n[n.Storage=1]="Storage",n[n.Texture=2]="Texture",n[n.Sampler=3]="Sampler",n[n.StorageTexture=4]="StorageTexture"})(Ki||(Ki={}));class $l{constructor(e,t,i,s,o,c,u){this.name=e,this.type=t,this.group=i,this.binding=s,this.attributes=o,this.resourceType=c,this.access=u}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class CE{constructor(e,t){this.name=e,this.type=t}}class ME{constructor(e,t,i,s){this.name=e,this.type=t,this.locationType=i,this.location=s,this.interpolation=null}}class ub{constructor(e,t,i,s){this.name=e,this.type=t,this.locationType=i,this.location=s}}class OE{constructor(e,t,i,s){this.name=e,this.type=t,this.attributes=i,this.id=s}}class IE{constructor(e,t,i){this.name=e,this.type=t,this.attributes=i}}class NE{constructor(e,t=null,i){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=t,this.attributes=i}}class PE{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}function kE(n){var e=(32768&n)>>15,t=(31744&n)>>10,i=1023&n;return t==0?(e?-1:1)*Math.pow(2,-14)*(i/Math.pow(2,10)):t==31?i?NaN:1/0*(e?-1:1):(e?-1:1)*Math.pow(2,t-15)*(1+i/Math.pow(2,10))}const D0=new Float32Array(1),DE=new Int32Array(D0.buffer),Ht=new Uint16Array(1);function UE(n){D0[0]=n;const e=DE[0],t=e>>31&1;let i=e>>23&255,s=8388607&e;if(i===255)return Ht[0]=t<<15|31744|(s!==0?512:0),Ht[0];if(i===0){if(s===0)return Ht[0]=t<<15,Ht[0];s|=8388608;let o=113;for(;!(8388608&s);)s<<=1,o--;return i=127-o,s&=8388607,i>0?(s=(s>>126-i)+(s>>127-i&1),Ht[0]=t<<15|i<<10|s>>13,Ht[0]):(Ht[0]=t<<15,Ht[0])}return i=i-127+15,i>=31?(Ht[0]=t<<15|31744,Ht[0]):i<=0?i<-10?(Ht[0]=t<<15,Ht[0]):(s=(8388608|s)>>1-i,Ht[0]=t<<15|s>>13,Ht[0]):(s>>=13,Ht[0]=t<<15|i<<10|s,Ht[0])}const jd=new Uint32Array(1),U0=new Float32Array(jd.buffer,0,1);function fb(n){const e=112+(n>>6&31)<<23|(63&n)<<17;return jd[0]=e,U0[0]}function BE(n,e,t,i,s,o,c,u,h){const d=i*(c>>=s)*(o>>=s)+t*c+e*u;switch(h){case"r8unorm":return[Ve(n,d,"8unorm",1)[0]];case"r8snorm":return[Ve(n,d,"8snorm",1)[0]];case"r8uint":return[Ve(n,d,"8uint",1)[0]];case"r8sint":return[Ve(n,d,"8sint",1)[0]];case"rg8unorm":{const g=Ve(n,d,"8unorm",2);return[g[0],g[1]]}case"rg8snorm":{const g=Ve(n,d,"8snorm",2);return[g[0],g[1]]}case"rg8uint":{const g=Ve(n,d,"8uint",2);return[g[0],g[1]]}case"rg8sint":{const g=Ve(n,d,"8sint",2);return[g[0],g[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const g=Ve(n,d,"8unorm",4);return[g[0],g[1],g[2],g[3]]}case"rgba8snorm":{const g=Ve(n,d,"8snorm",4);return[g[0],g[1],g[2],g[3]]}case"rgba8uint":{const g=Ve(n,d,"8uint",4);return[g[0],g[1],g[2],g[3]]}case"rgba8sint":{const g=Ve(n,d,"8sint",4);return[g[0],g[1],g[2],g[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const g=Ve(n,d,"8unorm",4);return[g[2],g[1],g[0],g[3]]}case"r16uint":return[Ve(n,d,"16uint",1)[0]];case"r16sint":return[Ve(n,d,"16sint",1)[0]];case"r16float":return[Ve(n,d,"16float",1)[0]];case"rg16uint":{const g=Ve(n,d,"16uint",2);return[g[0],g[1]]}case"rg16sint":{const g=Ve(n,d,"16sint",2);return[g[0],g[1]]}case"rg16float":{const g=Ve(n,d,"16float",2);return[g[0],g[1]]}case"rgba16uint":{const g=Ve(n,d,"16uint",4);return[g[0],g[1],g[2],g[3]]}case"rgba16sint":{const g=Ve(n,d,"16sint",4);return[g[0],g[1],g[2],g[3]]}case"rgba16float":{const g=Ve(n,d,"16float",4);return[g[0],g[1],g[2],g[3]]}case"r32uint":return[Ve(n,d,"32uint",1)[0]];case"r32sint":return[Ve(n,d,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[Ve(n,d,"32float",1)[0]];case"rg32uint":{const g=Ve(n,d,"32uint",2);return[g[0],g[1]]}case"rg32sint":{const g=Ve(n,d,"32sint",2);return[g[0],g[1]]}case"rg32float":{const g=Ve(n,d,"32float",2);return[g[0],g[1]]}case"rgba32uint":{const g=Ve(n,d,"32uint",4);return[g[0],g[1],g[2],g[3]]}case"rgba32sint":{const g=Ve(n,d,"32sint",4);return[g[0],g[1],g[2],g[3]]}case"rgba32float":{const g=Ve(n,d,"32float",4);return[g[0],g[1],g[2],g[3]]}case"rg11b10ufloat":{const g=new Uint32Array(n.buffer,d,1)[0],m=(4192256&g)>>11,y=(4290772992&g)>>22;return[fb(2047&g),fb(m),(function(T){const w=112+(T>>5&31)<<23|(31&T)<<18;return jd[0]=w,U0[0]})(y),1]}}return null}function Ve(n,e,t,i){const s=[0,0,0,0];for(let o=0;o<i;++o)switch(t){case"8unorm":s[o]=n[e]/255,e++;break;case"8snorm":s[o]=n[e]/255*2-1,e++;break;case"8uint":s[o]=n[e],e++;break;case"8sint":s[o]=n[e]-127,e++;break;case"16uint":s[o]=n[e]|n[e+1]<<8,e+=2;break;case"16sint":s[o]=(n[e]|n[e+1]<<8)-32768,e+=2;break;case"16float":s[o]=kE(n[e]|n[e+1]<<8),e+=2;break;case"32uint":case"32sint":s[o]=n[e]|n[e+1]<<8|n[e+2]<<16|n[e+3]<<24,e+=4;break;case"32float":s[o]=new Float32Array(n.buffer,e,1)[0],e+=4}return s}function je(n,e,t,i,s){for(let o=0;o<i;++o)switch(t){case"8unorm":n[e]=255*s[o],e++;break;case"8snorm":n[e]=.5*(s[o]+1)*255,e++;break;case"8uint":n[e]=s[o],e++;break;case"8sint":n[e]=s[o]+127,e++;break;case"16uint":new Uint16Array(n.buffer,e,1)[0]=s[o],e+=2;break;case"16sint":new Int16Array(n.buffer,e,1)[0]=s[o],e+=2;break;case"16float":{const c=UE(s[o]);new Uint16Array(n.buffer,e,1)[0]=c,e+=2;break}case"32uint":new Uint32Array(n.buffer,e,1)[0]=s[o],e+=4;break;case"32sint":new Int32Array(n.buffer,e,1)[0]=s[o],e+=4;break;case"32float":new Float32Array(n.buffer,e,1)[0]=s[o],e+=4}return s}const wh={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class Mn{constructor(){this.id=Mn._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(e){e(this)}searchBlock(e,t){if(e){t(_c.instance);for(const i of e)i instanceof Array?this.searchBlock(i,t):i.search(t);t(mc.instance)}}constEvaluate(e,t){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}}Mn._id=0;class _c extends Mn{}_c.instance=new _c;class mc extends Mn{}mc.instance=new mc;const B0=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class ct extends Mn{constructor(){super()}}class bo extends ct{constructor(e,t,i,s,o,c){super(),this.calls=new Set,this.name=e,this.args=t,this.returnType=i,this.body=s,this.startLine=o,this.endLine=c}get astNodeType(){return"function"}search(e){if(this.attributes)for(const t of this.attributes)e(t);e(this);for(const t of this.args)e(t);this.searchBlock(this.body,e)}}class FE extends ct{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class F0 extends ct{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class td extends ct{constructor(e,t){super(),this.body=e,this.loopId=t}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class L0 extends ct{constructor(e,t,i,s){super(),this.init=e,this.condition=t,this.increment=i,this.body=s}get astNodeType(){return"for"}search(e){var t,i,s;(t=this.init)===null||t===void 0||t.search(e),(i=this.condition)===null||i===void 0||i.search(e),(s=this.increment)===null||s===void 0||s.search(e),this.searchBlock(this.body,e)}}class mi extends ct{constructor(e,t,i,s,o){super(),this.attributes=null,this.name=e,this.type=t,this.storage=i,this.access=s,this.value=o}get astNodeType(){return"var"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}class Hd extends ct{constructor(e,t,i){super(),this.attributes=null,this.name=e,this.type=t,this.value=i}get astNodeType(){return"override"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class ho extends ct{constructor(e,t,i,s,o){super(),this.attributes=null,this.name=e,this.type=t,this.storage=i,this.access=s,this.value=o}get astNodeType(){return"let"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}class ic extends ct{constructor(e,t,i,s,o){super(),this.attributes=null,this.name=e,this.type=t,this.storage=i,this.access=s,this.value=o}get astNodeType(){return"const"}constEvaluate(e,t){return this.value.constEvaluate(e,t)}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}var Ur,ro,L,k;(n=>{n.increment="++",n.decrement="--"})(Ur||(Ur={})),(n=>{n.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for IncrementOperator");return n[t]}})(Ur||(Ur={}));class z0 extends ct{constructor(e,t){super(),this.operator=e,this.variable=t}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}(n=>{n.assign="=",n.addAssign="+=",n.subtractAssin="-=",n.multiplyAssign="*=",n.divideAssign="/=",n.moduloAssign="%=",n.andAssign="&=",n.orAssign="|=",n.xorAssign="^=",n.shiftLeftAssign="<<=",n.shiftRightAssign=">>="})(ro||(ro={})),(n=>{n.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for AssignOperator");return t}})(ro||(ro={}));class V0 extends ct{constructor(e,t,i){super(),this.operator=e,this.variable=t,this.value=i}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class Wd extends ct{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"call"}isBuiltin(){return B0.has(this.name)}search(e){for(const t of this.args)t.search(e);e(this)}}class j0 extends ct{constructor(e,t){super(),this.body=e,this.continuing=t}get astNodeType(){return"loop"}search(e){var t;this.searchBlock(this.body,e),(t=this.continuing)===null||t===void 0||t.search(e)}}class H0 extends ct{constructor(e,t){super(),this.condition=e,this.cases=t}get astNodeType(){return"switch"}search(e){e(this);for(const t of this.cases)t.search(e)}}class W0 extends ct{constructor(e,t,i,s){super(),this.condition=e,this.body=t,this.elseif=i,this.else=s}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class $0 extends ct{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class LE extends ct{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class zE extends ct{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class X0 extends ct{constructor(e,t){super(),this.severity=e,this.rule=t}get astNodeType(){return"diagnostic"}}class $d extends ct{constructor(e,t){super(),this.name=e,this.type=t}get astNodeType(){return"alias"}}class VE extends ct{constructor(){super()}get astNodeType(){return"discard"}}class Y0 extends ct{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}class q0 extends ct{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}}class J extends ct{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let t=e[0];if(t.name==="f32")return t;for(let i=1;i<e.length;++i){const s=J._priority.get(t.name);J._priority.get(e[i].name)<s&&(t=e[i])}return t.name==="x32"?J.i32:t}getTypeName(){return this.name}}J.x32=new J("x32"),J.f32=new J("f32"),J.i32=new J("i32"),J.u32=new J("u32"),J.f16=new J("f16"),J.bool=new J("bool"),J.void=new J("void"),J._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class hb extends J{constructor(e){super(e)}}class gi extends J{constructor(e,t,i,s){super(e),this.members=t,this.startLine=i,this.endLine=s}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let t=0;t<this.members.length;t++)if(this.members[t].name==e)return t;return-1}search(e){for(const t of this.members)e(t)}}class B extends J{constructor(e,t,i){super(e),this.format=t,this.access=i}get astNodeType(){return"template"}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}B.vec2f=new B("vec2",J.f32,null),B.vec3f=new B("vec3",J.f32,null),B.vec4f=new B("vec4",J.f32,null),B.vec2i=new B("vec2",J.i32,null),B.vec3i=new B("vec3",J.i32,null),B.vec4i=new B("vec4",J.i32,null),B.vec2u=new B("vec2",J.u32,null),B.vec3u=new B("vec3",J.u32,null),B.vec4u=new B("vec4",J.u32,null),B.vec2h=new B("vec2",J.f16,null),B.vec3h=new B("vec3",J.f16,null),B.vec4h=new B("vec4",J.f16,null),B.vec2b=new B("vec2",J.bool,null),B.vec3b=new B("vec3",J.bool,null),B.vec4b=new B("vec4",J.bool,null),B.mat2x2f=new B("mat2x2",J.f32,null),B.mat2x3f=new B("mat2x3",J.f32,null),B.mat2x4f=new B("mat2x4",J.f32,null),B.mat3x2f=new B("mat3x2",J.f32,null),B.mat3x3f=new B("mat3x3",J.f32,null),B.mat3x4f=new B("mat3x4",J.f32,null),B.mat4x2f=new B("mat4x2",J.f32,null),B.mat4x3f=new B("mat4x3",J.f32,null),B.mat4x4f=new B("mat4x4",J.f32,null),B.mat2x2h=new B("mat2x2",J.f16,null),B.mat2x3h=new B("mat2x3",J.f16,null),B.mat2x4h=new B("mat2x4",J.f16,null),B.mat3x2h=new B("mat3x2",J.f16,null),B.mat3x3h=new B("mat3x3",J.f16,null),B.mat3x4h=new B("mat3x4",J.f16,null),B.mat4x2h=new B("mat4x2",J.f16,null),B.mat4x3h=new B("mat4x3",J.f16,null),B.mat4x4h=new B("mat4x4",J.f16,null),B.mat2x2i=new B("mat2x2",J.i32,null),B.mat2x3i=new B("mat2x3",J.i32,null),B.mat2x4i=new B("mat2x4",J.i32,null),B.mat3x2i=new B("mat3x2",J.i32,null),B.mat3x3i=new B("mat3x3",J.i32,null),B.mat3x4i=new B("mat3x4",J.i32,null),B.mat4x2i=new B("mat4x2",J.i32,null),B.mat4x3i=new B("mat4x3",J.i32,null),B.mat4x4i=new B("mat4x4",J.i32,null),B.mat2x2u=new B("mat2x2",J.u32,null),B.mat2x3u=new B("mat2x3",J.u32,null),B.mat2x4u=new B("mat2x4",J.u32,null),B.mat3x2u=new B("mat3x2",J.u32,null),B.mat3x3u=new B("mat3x3",J.u32,null),B.mat3x4u=new B("mat3x4",J.u32,null),B.mat4x2u=new B("mat4x2",J.u32,null),B.mat4x3u=new B("mat4x3",J.u32,null),B.mat4x4u=new B("mat4x4",J.u32,null);class sc extends J{constructor(e,t,i,s){super(e),this.storage=t,this.type=i,this.access=s}get astNodeType(){return"pointer"}}class po extends J{constructor(e,t,i,s){super(e),this.attributes=t,this.format=i,this.count=s}get astNodeType(){return"array"}get isArray(){return!0}}class ao extends J{constructor(e,t,i){super(e),this.format=t,this.access=i}get astNodeType(){return"sampler"}}class Ln extends Mn{constructor(){super(),this.postfix=null}}class Ds extends Ln{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class qn extends Ln{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const t of this.args)t.search(e)}constEvaluate(e,t){return t&&(t[0]=this.type),e.evalExpression(this,e.context)}}class Xd extends Ln{constructor(e,t){super(),this.cachedReturnValue=null,this.name=e,this.args=t}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return B0.has(this.name)}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){for(const t of this.args)t.search(e);e(this)}}class fn extends Ln{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,t){return e.evalExpression(this,e.context)}}class K0 extends Ln{constructor(e,t){super(),this.name=e,this.initializer=t}get astNodeType(){return"constExpr"}constEvaluate(e,t){if(this.initializer){const i=e.evalExpression(this.initializer,e.context);return i!==null&&this.postfix?i.getSubData(e,this.postfix,e.context):i}return null}search(e){this.initializer.search(e)}}class Et extends Ln{constructor(e,t){super(),this.value=e,this.type=t}get astNodeType(){return"literalExpr"}constEvaluate(e,t){return t!==void 0&&(t[0]=this.type),this.value}get isScalar(){return this.value instanceof P}get isVector(){return this.value instanceof S||this.value instanceof Se}get scalarValue(){return this.value instanceof P?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof S||this.value instanceof Se?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}}class Z0 extends Ln{constructor(e,t){super(),this.type=e,this.value=t}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class Xr extends Ln{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class Q0 extends Ln{constructor(){super()}}class xt extends Q0{constructor(e,t){super(),this.operator=e,this.right=t}get astNodeType(){return"unaryOp"}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}}class Un extends Q0{constructor(e,t,i){super(),this.operator=e,this.left=t,this.right=i}get astNodeType(){return"binaryOp"}_getPromotedType(e,t){return e.name===t.name?e:e.name==="f32"||t.name==="f32"?J.f32:e.name==="u32"||t.name==="u32"?J.u32:J.i32}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}}class G0 extends Mn{constructor(e){super(),this.body=e}search(e){e(this),this.searchBlock(this.body,e)}}class rc extends Ln{constructor(){super()}get astNodeType(){return"default"}}class J0 extends G0{constructor(e,t){super(t),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class e3 extends G0{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class db extends Mn{constructor(e,t,i){super(),this.name=e,this.type=t,this.attributes=i}get astNodeType(){return"argument"}}class jE extends Mn{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class pb extends Mn{constructor(e,t,i){super(),this.name=e,this.type=t,this.attributes=i}get astNodeType(){return"member"}}class t3 extends Mn{constructor(e,t){super(),this.name=e,this.value=t}get astNodeType(){return"attribute"}}class Cn{constructor(e,t){this.parent=null,this.typeInfo=e,this.parent=t,this.id=Cn._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(e,t,i,s){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(e,t,i){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.getTypeName()}>`}}Cn._id=0;class nd extends Cn{constructor(){super(new An("void",null),null)}toString(){return"void"}}nd.void=new nd;class Ir extends Cn{constructor(e){super(new ed("pointer",e.typeInfo,null),null),this.reference=e}clone(){return this}setDataValue(e,t,i,s){this.reference.setDataValue(e,t,i,s)}getSubData(e,t,i){return t?this.reference.getSubData(e,t,i):this}toString(){return`&${this.reference.toString()}`}}class P extends Cn{constructor(e,t,i=null){super(t,i),e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array?this.data=e:this.typeInfo.name==="x32"?e-Math.floor(e)!==0?this.data=new Float32Array([e]):this.data=e>=0?new Uint32Array([e]):new Int32Array([e]):this.typeInfo.name==="i32"||this.typeInfo.name==="bool"?this.data=new Int32Array([e]):this.typeInfo.name==="u32"?this.data=new Uint32Array([e]):this.typeInfo.name==="f32"||this.typeInfo.name==="f16"?this.data=new Float32Array([e]):console.error("ScalarData2: Invalid type",t)}clone(){if(this.data instanceof Float32Array)return new P(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new P(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new P(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(e){this.data[0]=e}setDataValue(e,t,i,s){if(i)return void console.error("SetDataValue: Scalar data does not support postfix",i);if(!(t instanceof P))return void console.error("SetDataValue: Invalid value",t);let o=t.data[0];this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?o=Math.floor(o):this.typeInfo.name==="bool"&&(o=o?1:0),this.data[0]=o}getSubData(e,t,i){return t?(console.error("getSubData: Scalar data does not support postfix",t),null):this}toString(){return`${this.value}`}}function HE(n,e,t){const i=e.length;return i===2?t==="f32"?new S(new Float32Array(e),n.getTypeInfo("vec2f")):t==="i32"||t==="bool"?new S(new Int32Array(e),n.getTypeInfo("vec2i")):t==="u32"?new S(new Uint32Array(e),n.getTypeInfo("vec2u")):t==="f16"?new S(new Float32Array(e),n.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${t}`),null):i===3?t==="f32"?new S(new Float32Array(e),n.getTypeInfo("vec3f")):t==="i32"||t==="bool"?new S(new Int32Array(e),n.getTypeInfo("vec3i")):t==="u32"?new S(new Uint32Array(e),n.getTypeInfo("vec3u")):t==="f16"?new S(new Float32Array(e),n.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${t}`),null):i===4?t==="f32"?new S(new Float32Array(e),n.getTypeInfo("vec4f")):t==="i32"||t==="bool"?new S(new Int32Array(e),n.getTypeInfo("vec4i")):t==="u32"?new S(new Uint32Array(e),n.getTypeInfo("vec4u")):t==="f16"?new S(new Float32Array(e),n.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${t}`),null):(console.error(`getSubData: Invalid vector size ${e.length}`),null)}class S extends Cn{constructor(e,t,i=null){if(super(t,i),e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)this.data=e;else{const s=this.typeInfo.name;s==="vec2f"||s==="vec3f"||s==="vec4f"?this.data=new Float32Array(e):s==="vec2i"||s==="vec3i"||s==="vec4i"?this.data=new Int32Array(e):s==="vec2u"||s==="vec3u"||s==="vec4u"?this.data=new Uint32Array(e):s==="vec2h"||s==="vec3h"||s==="vec4h"?this.data=new Float32Array(e):s==="vec2b"||s==="vec3b"||s==="vec4b"?this.data=new Int32Array(e):s==="vec2"||s==="vec3"||s==="vec4"?this.data=new Float32Array(e):console.error(`VectorData: Invalid type ${s}`)}}clone(){if(this.data instanceof Float32Array)return new S(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new S(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new S(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(e,t,i,s){i instanceof Ds?console.error("TODO: Set vector postfix"):t instanceof S?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,i){if(t===null)return this;let s=e.getTypeInfo("f32");if(this.typeInfo instanceof ks)s=this.typeInfo.format||s;else{const c=this.typeInfo.name;c==="vec2f"||c==="vec3f"||c==="vec4f"?s=e.getTypeInfo("f32"):c==="vec2i"||c==="vec3i"||c==="vec4i"?s=e.getTypeInfo("i32"):c==="vec2b"||c==="vec3b"||c==="vec4b"?s=e.getTypeInfo("bool"):c==="vec2u"||c==="vec3u"||c==="vec4u"?s=e.getTypeInfo("u32"):c==="vec2h"||c==="vec3h"||c==="vec4h"?s=e.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${c}`)}let o=this;for(;t!==null&&o!==null;){if(t instanceof Xr){const c=t.index;let u=-1;if(c instanceof Et){if(!(c.value instanceof P))return console.error(`GetSubData: Invalid array index ${c.value}`),null;u=c.value.value}else{const h=e.evalExpression(c,i);if(!(h instanceof P))return console.error("GetSubData: Unknown index type",c),null;u=h.value}if(u<0||u>=o.data.length)return console.error("GetSubData: Index out of range",u),null;if(o.data instanceof Float32Array){const h=new Float32Array(o.data.buffer,o.data.byteOffset+4*u,1);return new P(h,s)}if(o.data instanceof Int32Array){const h=new Int32Array(o.data.buffer,o.data.byteOffset+4*u,1);return new P(h,s)}if(o.data instanceof Uint32Array){const h=new Uint32Array(o.data.buffer,o.data.byteOffset+4*u,1);return new P(h,s)}throw"GetSubData: Invalid data type"}if(!(t instanceof Ds))return console.error("GetSubData: Unknown postfix",t),null;{const c=t.value.toLowerCase();if(c.length===1){let h=0;if(c==="x"||c==="r")h=0;else if(c==="y"||c==="g")h=1;else if(c==="z"||c==="b")h=2;else{if(c!=="w"&&c!=="a")return console.error(`GetSubData: Unknown member ${c}`),null;h=3}if(this.data instanceof Float32Array){let d=new Float32Array(this.data.buffer,this.data.byteOffset+4*h,1);return new P(d,s,this)}if(this.data instanceof Int32Array){let d=new Int32Array(this.data.buffer,this.data.byteOffset+4*h,1);return new P(d,s,this)}if(this.data instanceof Uint32Array){let d=new Uint32Array(this.data.buffer,this.data.byteOffset+4*h,1);return new P(d,s,this)}}const u=[];for(const h of c)h==="x"||h==="r"?u.push(this.data[0]):h==="y"||h==="g"?u.push(this.data[1]):h==="z"||h==="b"?u.push(this.data[2]):h==="w"||h==="a"?u.push(this.data[3]):console.error(`GetDataValue: Unknown member ${h}`);o=HE(e,u,s.name)}t=t.postfix}return o}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class Se extends Cn{constructor(e,t,i=null){super(t,i),e instanceof Float32Array?this.data=e:this.data=new Float32Array(e)}clone(){return new Se(new Float32Array(this.data),this.typeInfo,null)}setDataValue(e,t,i,s){i instanceof Ds?console.error("TODO: Set matrix postfix"):t instanceof Se?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,i){if(t===null)return this;const s=this.typeInfo.name;if(e.getTypeInfo("f32"),this.typeInfo instanceof ks)this.typeInfo.format;else if(s.endsWith("f"))e.getTypeInfo("f32");else if(s.endsWith("i"))e.getTypeInfo("i32");else if(s.endsWith("u"))e.getTypeInfo("u32");else{if(!s.endsWith("h"))return console.error(`GetDataValue: Unknown type ${s}`),null;e.getTypeInfo("f16")}if(t instanceof Xr){const o=t.index;let c=-1;if(o instanceof Et){if(!(o.value instanceof P))return console.error(`GetDataValue: Invalid array index ${o.value}`),null;c=o.value.value}else{const d=e.evalExpression(o,i);if(!(d instanceof P))return console.error("GetDataValue: Unknown index type",o),null;c=d.value}if(c<0||c>=this.data.length)return console.error("GetDataValue: Index out of range",c),null;const u=s.endsWith("h")?"h":"f";let h;if(s==="mat2x2"||s==="mat2x2f"||s==="mat2x2h"||s==="mat3x2"||s==="mat3x2f"||s==="mat3x2h"||s==="mat4x2"||s==="mat4x2f"||s==="mat4x2h")h=new S(new Float32Array(this.data.buffer,this.data.byteOffset+2*c*4,2),e.getTypeInfo(`vec2${u}`));else if(s==="mat2x3"||s==="mat2x3f"||s==="mat2x3h"||s==="mat3x3"||s==="mat3x3f"||s==="mat3x3h"||s==="mat4x3"||s==="mat4x3f"||s==="mat4x3h")h=new S(new Float32Array(this.data.buffer,this.data.byteOffset+3*c*4,3),e.getTypeInfo(`vec3${u}`));else{if(s!=="mat2x4"&&s!=="mat2x4f"&&s!=="mat2x4h"&&s!=="mat3x4"&&s!=="mat3x4f"&&s!=="mat3x4h"&&s!=="mat4x4"&&s!=="mat4x4f"&&s!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${s}`),null;h=new S(new Float32Array(this.data.buffer,this.data.byteOffset+4*c*4,4),e.getTypeInfo(`vec4${u}`))}return t.postfix?h.getSubData(e,t.postfix,i):h}return console.error("GetDataValue: Invalid postfix",t),null}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class _t extends Cn{constructor(e,t,i=0,s=null){super(t,s),this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=i}clone(){const e=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new _t(e.buffer,this.typeInfo,0,null)}setDataValue(e,t,i,s){if(t===null)return void console.log("setDataValue: NULL data.");let o=this.offset,c=this.typeInfo;for(;i;){if(i instanceof Xr)if(c instanceof ts){const u=i.index;if(u instanceof Et){if(!(u.value instanceof P))return void console.error(`SetDataValue: Invalid index type ${u.value}`);o+=u.value.value*c.stride}else{const h=e.evalExpression(u,s);if(!(h instanceof P))return void console.error("SetDataValue: Unknown index type",u);o+=h.value*c.stride}c=c.format}else console.error(`SetDataValue: Type ${c.getTypeName()} is not an array`);else{if(!(i instanceof Ds))return void console.error("SetDataValue: Unknown postfix type",i);{const u=i.value;if(c instanceof Qi){let h=!1;for(const d of c.members)if(d.name===u){o+=d.offset,c=d.type,h=!0;break}if(!h)return void console.error(`SetDataValue: Member ${u} not found`)}else if(c instanceof An){const h=c.getTypeName();let d=0;if(u==="x"||u==="r")d=0;else if(u==="y"||u==="g")d=1;else if(u==="z"||u==="b")d=2;else{if(u!=="w"&&u!=="a")return void console.error(`SetDataValue: Unknown member ${u}`);d=3}if(!(t instanceof P))return void console.error("SetDataValue: Invalid value",t);const g=t.value;return h==="vec2f"?void(new Float32Array(this.buffer,o,2)[d]=g):h==="vec3f"?void(new Float32Array(this.buffer,o,3)[d]=g):h==="vec4f"?void(new Float32Array(this.buffer,o,4)[d]=g):h==="vec2i"?void(new Int32Array(this.buffer,o,2)[d]=g):h==="vec3i"?void(new Int32Array(this.buffer,o,3)[d]=g):h==="vec4i"?void(new Int32Array(this.buffer,o,4)[d]=g):h==="vec2u"?void(new Uint32Array(this.buffer,o,2)[d]=g):h==="vec3u"?void(new Uint32Array(this.buffer,o,3)[d]=g):h==="vec4u"?void(new Uint32Array(this.buffer,o,4)[d]=g):void console.error(`SetDataValue: Type ${h} is not a struct`)}}}i=i.postfix}this.setData(e,t,c,o,s)}setData(e,t,i,s,o){const c=i.getTypeName();if(c!=="f32"&&c!=="f16")if(c!=="i32"&&c!=="atomic<i32>"&&c!=="x32")if(c!=="u32"&&c!=="atomic<u32>")if(c!=="bool"){if(c==="vec2f"||c==="vec2h"){const u=new Float32Array(this.buffer,s,2);return void(t instanceof S?(u[0]=t.data[0],u[1]=t.data[1]):(u[0]=t[0],u[1]=t[1]))}if(c==="vec3f"||c==="vec3h"){const u=new Float32Array(this.buffer,s,3);return void(t instanceof S?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2]):(u[0]=t[0],u[1]=t[1],u[2]=t[2]))}if(c==="vec4f"||c==="vec4h"){const u=new Float32Array(this.buffer,s,4);return void(t instanceof S?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3]))}if(c==="vec2i"){const u=new Int32Array(this.buffer,s,2);return void(t instanceof S?(u[0]=t.data[0],u[1]=t.data[1]):(u[0]=t[0],u[1]=t[1]))}if(c==="vec3i"){const u=new Int32Array(this.buffer,s,3);return void(t instanceof S?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2]):(u[0]=t[0],u[1]=t[1],u[2]=t[2]))}if(c==="vec4i"){const u=new Int32Array(this.buffer,s,4);return void(t instanceof S?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3]))}if(c==="vec2u"){const u=new Uint32Array(this.buffer,s,2);return void(t instanceof S?(u[0]=t.data[0],u[1]=t.data[1]):(u[0]=t[0],u[1]=t[1]))}if(c==="vec3u"){const u=new Uint32Array(this.buffer,s,3);return void(t instanceof S?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2]):(u[0]=t[0],u[1]=t[1],u[2]=t[2]))}if(c==="vec4u"){const u=new Uint32Array(this.buffer,s,4);return void(t instanceof S?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3]))}if(c==="vec2b"){const u=new Uint32Array(this.buffer,s,2);return void(t instanceof S?(u[0]=t.data[0],u[1]=t.data[1]):(u[0]=t[0],u[1]=t[1]))}if(c==="vec3b"){const u=new Uint32Array(this.buffer,s,3);return void(t instanceof S?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2]):(u[0]=t[0],u[1]=t[1],u[2]=t[2]))}if(c==="vec4b"){const u=new Uint32Array(this.buffer,s,4);return void(t instanceof S?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3]))}if(c==="mat2x2f"||c==="mat2x2h"){const u=new Float32Array(this.buffer,s,4);return void(t instanceof Se?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3]))}if(c==="mat2x3f"||c==="mat2x3h"){const u=new Float32Array(this.buffer,s,6);return void(t instanceof Se?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3],u[4]=t.data[4],u[5]=t.data[5]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3],u[4]=t[4],u[5]=t[5]))}if(c==="mat2x4f"||c==="mat2x4h"){const u=new Float32Array(this.buffer,s,8);return void(t instanceof Se?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3],u[4]=t.data[4],u[5]=t.data[5],u[6]=t.data[6],u[7]=t.data[7]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3],u[4]=t[4],u[5]=t[5],u[6]=t[6],u[7]=t[7]))}if(c==="mat3x2f"||c==="mat3x2h"){const u=new Float32Array(this.buffer,s,6);return void(t instanceof Se?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3],u[4]=t.data[4],u[5]=t.data[5]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3],u[4]=t[4],u[5]=t[5]))}if(c==="mat3x3f"||c==="mat3x3h"){const u=new Float32Array(this.buffer,s,9);return void(t instanceof Se?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3],u[4]=t.data[4],u[5]=t.data[5],u[6]=t.data[6],u[7]=t.data[7],u[8]=t.data[8]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3],u[4]=t[4],u[5]=t[5],u[6]=t[6],u[7]=t[7],u[8]=t[8]))}if(c==="mat3x4f"||c==="mat3x4h"){const u=new Float32Array(this.buffer,s,12);return void(t instanceof Se?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3],u[4]=t.data[4],u[5]=t.data[5],u[6]=t.data[6],u[7]=t.data[7],u[8]=t.data[8],u[9]=t.data[9],u[10]=t.data[10],u[11]=t.data[11]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3],u[4]=t[4],u[5]=t[5],u[6]=t[6],u[7]=t[7],u[8]=t[8],u[9]=t[9],u[10]=t[10],u[11]=t[11]))}if(c==="mat4x2f"||c==="mat4x2h"){const u=new Float32Array(this.buffer,s,8);return void(t instanceof Se?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3],u[4]=t.data[4],u[5]=t.data[5],u[6]=t.data[6],u[7]=t.data[7]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3],u[4]=t[4],u[5]=t[5],u[6]=t[6],u[7]=t[7]))}if(c==="mat4x3f"||c==="mat4x3h"){const u=new Float32Array(this.buffer,s,12);return void(t instanceof Se?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3],u[4]=t.data[4],u[5]=t.data[5],u[6]=t.data[6],u[7]=t.data[7],u[8]=t.data[8],u[9]=t.data[9],u[10]=t.data[10],u[11]=t.data[11]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3],u[4]=t[4],u[5]=t[5],u[6]=t[6],u[7]=t[7],u[8]=t[8],u[9]=t[9],u[10]=t[10],u[11]=t[11]))}if(c==="mat4x4f"||c==="mat4x4h"){const u=new Float32Array(this.buffer,s,16);return void(t instanceof Se?(u[0]=t.data[0],u[1]=t.data[1],u[2]=t.data[2],u[3]=t.data[3],u[4]=t.data[4],u[5]=t.data[5],u[6]=t.data[6],u[7]=t.data[7],u[8]=t.data[8],u[9]=t.data[9],u[10]=t.data[10],u[11]=t.data[11],u[12]=t.data[12],u[13]=t.data[13],u[14]=t.data[14],u[15]=t.data[15]):(u[0]=t[0],u[1]=t[1],u[2]=t[2],u[3]=t[3],u[4]=t[4],u[5]=t[5],u[6]=t[6],u[7]=t[7],u[8]=t[8],u[9]=t[9],u[10]=t[10],u[11]=t[11],u[12]=t[12],u[13]=t[13],u[14]=t[14],u[15]=t[15]))}if(t instanceof _t){if(i===t.typeInfo)return void new Uint8Array(this.buffer,s,t.buffer.byteLength).set(new Uint8Array(t.buffer));console.error("SetDataValue: Type mismatch",c,t.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${c}`)}else t instanceof P&&(new Int32Array(this.buffer,s,1)[0]=t.value);else t instanceof P&&(new Uint32Array(this.buffer,s,1)[0]=t.value);else t instanceof P&&(new Int32Array(this.buffer,s,1)[0]=t.value);else t instanceof P&&(new Float32Array(this.buffer,s,1)[0]=t.value)}getSubData(e,t,i){var s,o,c;if(t===null)return this;let u=this.offset,h=this.typeInfo;for(;t;){if(t instanceof Xr){const g=t.index,m=g instanceof Ln?e.evalExpression(g,i):g;let y=0;if(m instanceof P?y=m.value:typeof m=="number"?y=m:console.error("GetDataValue: Invalid index type",g),h instanceof ts)u+=y*h.stride,h=h.format;else{const T=h.getTypeName();T==="mat4x4"||T==="mat4x4f"||T==="mat4x4h"?(u+=16*y,h=e.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${h.getTypeName()} is not an array`)}}else{if(!(t instanceof Ds))return console.error("GetDataValue: Unknown postfix type",t),null;{const g=t.value;if(h instanceof Qi){let m=!1;for(const y of h.members)if(y.name===g){u+=y.offset,h=y.type,m=!0;break}if(!m)return console.error(`GetDataValue: Member ${g} not found`),null}else if(h instanceof An){const m=h.getTypeName();if(m==="vec2f"||m==="vec3f"||m==="vec4f"||m==="vec2i"||m==="vec3i"||m==="vec4i"||m==="vec2u"||m==="vec3u"||m==="vec4u"||m==="vec2b"||m==="vec3b"||m==="vec4b"||m==="vec2h"||m==="vec3h"||m==="vec4h"||m==="vec2"||m==="vec3"||m==="vec4"){if(g.length>0&&g.length<5){let y="f";const T=[];for(let w=0;w<g.length;++w){const C=g[w].toLowerCase();let N=0;if(C==="x"||C==="r")N=0;else if(C==="y"||C==="g")N=1;else if(C==="z"||C==="b")N=2;else{if(C!=="w"&&C!=="a")return console.error(`Unknown member ${g}`),null;N=3}if(g.length===1){if(m.endsWith("f"))return this.buffer.byteLength<u+4*N+4?(console.log("Insufficient buffer data"),null):new P(new Float32Array(this.buffer,u+4*N,1),e.getTypeInfo("f32"),this);if(m.endsWith("h"))return new P(new Float32Array(this.buffer,u+4*N,1),e.getTypeInfo("f16"),this);if(m.endsWith("i"))return new P(new Int32Array(this.buffer,u+4*N,1),e.getTypeInfo("i32"),this);if(m.endsWith("b"))return new P(new Int32Array(this.buffer,u+4*N,1),e.getTypeInfo("bool"),this);if(m.endsWith("u"))return new P(new Uint32Array(this.buffer,u+4*N,1),e.getTypeInfo("i32"),this)}if(m==="vec2f")T.push(new Float32Array(this.buffer,u,2)[N]);else if(m==="vec3f"){if(u+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;const V=new Float32Array(this.buffer,u,3);T.push(V[N])}else if(m==="vec4f")T.push(new Float32Array(this.buffer,u,4)[N]);else if(m==="vec2i")y="i",T.push(new Int32Array(this.buffer,u,2)[N]);else if(m==="vec3i")y="i",T.push(new Int32Array(this.buffer,u,3)[N]);else if(m==="vec4i")y="i",T.push(new Int32Array(this.buffer,u,4)[N]);else if(m==="vec2u"){y="u";const V=new Uint32Array(this.buffer,u,2);T.push(V[N])}else m==="vec3u"?(y="u",T.push(new Uint32Array(this.buffer,u,3)[N])):m==="vec4u"&&(y="u",T.push(new Uint32Array(this.buffer,u,4)[N]))}return T.length===2?h=e.getTypeInfo(`vec2${y}`):T.length===3?h=e.getTypeInfo(`vec3${y}`):T.length===4?h=e.getTypeInfo(`vec4${y}`):console.error(`GetDataValue: Invalid vector length ${T.length}`),new S(T,h,null)}return console.error(`GetDataValue: Unknown member ${g}`),null}return console.error(`GetDataValue: Type ${m} is not a struct`),null}}}t=t.postfix}const d=h.getTypeName();return d==="f32"?new P(new Float32Array(this.buffer,u,1),h,this):d==="i32"?new P(new Int32Array(this.buffer,u,1),h,this):d==="u32"?new P(new Uint32Array(this.buffer,u,1),h,this):d==="vec2f"?new S(new Float32Array(this.buffer,u,2),h,this):d==="vec3f"?new S(new Float32Array(this.buffer,u,3),h,this):d==="vec4f"?new S(new Float32Array(this.buffer,u,4),h,this):d==="vec2i"?new S(new Int32Array(this.buffer,u,2),h,this):d==="vec3i"?new S(new Int32Array(this.buffer,u,3),h,this):d==="vec4i"?new S(new Int32Array(this.buffer,u,4),h,this):d==="vec2u"?new S(new Uint32Array(this.buffer,u,2),h,this):d==="vec3u"?new S(new Uint32Array(this.buffer,u,3),h,this):d==="vec4u"?new S(new Uint32Array(this.buffer,u,4),h,this):h instanceof ks&&h.name==="atomic"?((s=h.format)===null||s===void 0?void 0:s.name)==="u32"?new P(new Uint32Array(this.buffer,u,1)[0],h.format,this):((o=h.format)===null||o===void 0?void 0:o.name)==="i32"?new P(new Int32Array(this.buffer,u,1)[0],h.format,this):(console.error(`GetDataValue: Invalid atomic format ${(c=h.format)===null||c===void 0?void 0:c.name}`),null):new _t(this.buffer,h,u,this)}toString(){let e="";if(this.typeInfo instanceof ts)if(this.typeInfo.format.name==="f32"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let i=1;i<t.length;++i)e+=`, ${t[i]}`}else if(this.typeInfo.format.name==="i32"){const t=new Int32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let i=1;i<t.length;++i)e+=`, ${t[i]}`}else if(this.typeInfo.format.name==="u32"){const t=new Uint32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let i=1;i<t.length;++i)e+=`, ${t[i]}`}else if(this.typeInfo.format.name==="vec2f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}]`;for(let i=1;i<t.length/2;++i)e+=`, [${t[2*i]}, ${t[2*i+1]}]`}else if(this.typeInfo.format.name==="vec3f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}]`;for(let i=4;i<t.length;i+=4)e+=`, [${t[i]}, ${t[i+1]}, ${t[i+2]}]`}else if(this.typeInfo.format.name==="vec4f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}, ${t[3]}]`;for(let i=4;i<t.length;i+=4)e+=`, [${t[i]}, ${t[i+1]}, ${t[i+2]}, ${t[i+3]}]`}else e="[...]";else this.typeInfo instanceof Qi?e+="{...}":e="[...]";return e}}class _i extends Cn{constructor(e,t,i,s){super(t,null),this.data=e,this.descriptor=i,this.view=s}clone(){return new _i(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var e,t;const i=this.descriptor.size;return i instanceof Array&&i.length>0?(e=i[0])!==null&&e!==void 0?e:0:i instanceof Object&&(t=i.width)!==null&&t!==void 0?t:0}get height(){var e,t;const i=this.descriptor.size;return i instanceof Array&&i.length>1?(e=i[1])!==null&&e!==void 0?e:0:i instanceof Object&&(t=i.height)!==null&&t!==void 0?t:0}get depthOrArrayLayers(){var e,t;const i=this.descriptor.size;return i instanceof Array&&i.length>2?(e=i[2])!==null&&e!==void 0?e:0:i instanceof Object&&(t=i.depthOrArrayLayers)!==null&&t!==void 0?t:0}get format(){var e;return this.descriptor&&(e=this.descriptor.format)!==null&&e!==void 0?e:"rgba8unorm"}get sampleCount(){var e;return this.descriptor&&(e=this.descriptor.sampleCount)!==null&&e!==void 0?e:1}get mipLevelCount(){var e;return this.descriptor&&(e=this.descriptor.mipLevelCount)!==null&&e!==void 0?e:1}get dimension(){var e;return this.descriptor&&(e=this.descriptor.dimension)!==null&&e!==void 0?e:"2d"}getMipLevelSize(e){if(e>=this.mipLevelCount)return[0,0,0];const t=[this.width,this.height,this.depthOrArrayLayers];for(let i=0;i<t.length;++i)t[i]=Math.max(1,t[i]>>e);return t}get texelByteSize(){const e=this.format,t=wh[e];return t?t.isDepthStencil?4:t.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const e=this.format,t=wh[e];return!!t&&t.isDepthStencil}getGpuSize(){const e=this.format,t=wh[e],i=this.width;if(!e||i<=0||!t)return-1;const s=this.height,o=this.depthOrArrayLayers,c=this.dimension;return i/t.blockWidth*(c==="1d"?1:s/t.blockHeight)*t.bytesPerBlock*o}getPixel(e,t,i=0,s=0){const o=this.texelByteSize,c=this.bytesPerRow,u=this.height,h=this.data[s];return BE(new Uint8Array(h),e,t,i,s,u,c,o,this.format)}setPixel(e,t,i,s,o){const c=this.texelByteSize,u=this.bytesPerRow,h=this.height,d=this.data[s];(function(g,m,y,T,w,C,N,V,$,O){const F=T*(N>>=w)*(C>>=w)+y*N+m*V;switch($){case"r8unorm":return void je(g,F,"8unorm",1,O);case"r8snorm":return void je(g,F,"8snorm",1,O);case"r8uint":return void je(g,F,"8uint",1,O);case"r8sint":return void je(g,F,"8sint",1,O);case"rg8unorm":return void je(g,F,"8unorm",2,O);case"rg8snorm":return void je(g,F,"8snorm",2,O);case"rg8uint":return void je(g,F,"8uint",2,O);case"rg8sint":return void je(g,F,"8sint",2,O);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void je(g,F,"8unorm",4,O);case"rgba8snorm":return void je(g,F,"8snorm",4,O);case"rgba8uint":return void je(g,F,"8uint",4,O);case"rgba8sint":return void je(g,F,"8sint",4,O);case"r16uint":return void je(g,F,"16uint",1,O);case"r16sint":return void je(g,F,"16sint",1,O);case"r16float":return void je(g,F,"16float",1,O);case"rg16uint":return void je(g,F,"16uint",2,O);case"rg16sint":return void je(g,F,"16sint",2,O);case"rg16float":return void je(g,F,"16float",2,O);case"rgba16uint":return void je(g,F,"16uint",4,O);case"rgba16sint":return void je(g,F,"16sint",4,O);case"rgba16float":return void je(g,F,"16float",4,O);case"r32uint":return void je(g,F,"32uint",1,O);case"r32sint":return void je(g,F,"32sint",1,O);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void je(g,F,"32float",1,O);case"rg32uint":return void je(g,F,"32uint",2,O);case"rg32sint":return void je(g,F,"32sint",2,O);case"rg32float":return void je(g,F,"32float",2,O);case"rgba32uint":return void je(g,F,"32uint",4,O);case"rgba32sint":return void je(g,F,"32sint",4,O);case"rgba32float":return void je(g,F,"32float",4,O);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}})(new Uint8Array(d),e,t,i,s,h,u,c,this.format,o)}}(n=>{n[n.token=0]="token",n[n.keyword=1]="keyword",n[n.reserved=2]="reserved"})(k||(k={}));class D{constructor(e,t,i){this.name=e,this.type=t,this.rule=i}toString(){return this.name}}class x{}L=x,x.none=new D("",k.reserved,""),x.eof=new D("EOF",k.token,""),x.reserved={asm:new D("asm",k.reserved,"asm"),bf16:new D("bf16",k.reserved,"bf16"),do:new D("do",k.reserved,"do"),enum:new D("enum",k.reserved,"enum"),f16:new D("f16",k.reserved,"f16"),f64:new D("f64",k.reserved,"f64"),handle:new D("handle",k.reserved,"handle"),i8:new D("i8",k.reserved,"i8"),i16:new D("i16",k.reserved,"i16"),i64:new D("i64",k.reserved,"i64"),mat:new D("mat",k.reserved,"mat"),premerge:new D("premerge",k.reserved,"premerge"),regardless:new D("regardless",k.reserved,"regardless"),typedef:new D("typedef",k.reserved,"typedef"),u8:new D("u8",k.reserved,"u8"),u16:new D("u16",k.reserved,"u16"),u64:new D("u64",k.reserved,"u64"),unless:new D("unless",k.reserved,"unless"),using:new D("using",k.reserved,"using"),vec:new D("vec",k.reserved,"vec"),void:new D("void",k.reserved,"void")},x.keywords={array:new D("array",k.keyword,"array"),atomic:new D("atomic",k.keyword,"atomic"),bool:new D("bool",k.keyword,"bool"),f32:new D("f32",k.keyword,"f32"),i32:new D("i32",k.keyword,"i32"),mat2x2:new D("mat2x2",k.keyword,"mat2x2"),mat2x3:new D("mat2x3",k.keyword,"mat2x3"),mat2x4:new D("mat2x4",k.keyword,"mat2x4"),mat3x2:new D("mat3x2",k.keyword,"mat3x2"),mat3x3:new D("mat3x3",k.keyword,"mat3x3"),mat3x4:new D("mat3x4",k.keyword,"mat3x4"),mat4x2:new D("mat4x2",k.keyword,"mat4x2"),mat4x3:new D("mat4x3",k.keyword,"mat4x3"),mat4x4:new D("mat4x4",k.keyword,"mat4x4"),ptr:new D("ptr",k.keyword,"ptr"),sampler:new D("sampler",k.keyword,"sampler"),sampler_comparison:new D("sampler_comparison",k.keyword,"sampler_comparison"),struct:new D("struct",k.keyword,"struct"),texture_1d:new D("texture_1d",k.keyword,"texture_1d"),texture_2d:new D("texture_2d",k.keyword,"texture_2d"),texture_2d_array:new D("texture_2d_array",k.keyword,"texture_2d_array"),texture_3d:new D("texture_3d",k.keyword,"texture_3d"),texture_cube:new D("texture_cube",k.keyword,"texture_cube"),texture_cube_array:new D("texture_cube_array",k.keyword,"texture_cube_array"),texture_multisampled_2d:new D("texture_multisampled_2d",k.keyword,"texture_multisampled_2d"),texture_storage_1d:new D("texture_storage_1d",k.keyword,"texture_storage_1d"),texture_storage_2d:new D("texture_storage_2d",k.keyword,"texture_storage_2d"),texture_storage_2d_array:new D("texture_storage_2d_array",k.keyword,"texture_storage_2d_array"),texture_storage_3d:new D("texture_storage_3d",k.keyword,"texture_storage_3d"),texture_depth_2d:new D("texture_depth_2d",k.keyword,"texture_depth_2d"),texture_depth_2d_array:new D("texture_depth_2d_array",k.keyword,"texture_depth_2d_array"),texture_depth_cube:new D("texture_depth_cube",k.keyword,"texture_depth_cube"),texture_depth_cube_array:new D("texture_depth_cube_array",k.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new D("texture_depth_multisampled_2d",k.keyword,"texture_depth_multisampled_2d"),texture_external:new D("texture_external",k.keyword,"texture_external"),u32:new D("u32",k.keyword,"u32"),vec2:new D("vec2",k.keyword,"vec2"),vec3:new D("vec3",k.keyword,"vec3"),vec4:new D("vec4",k.keyword,"vec4"),bitcast:new D("bitcast",k.keyword,"bitcast"),block:new D("block",k.keyword,"block"),break:new D("break",k.keyword,"break"),case:new D("case",k.keyword,"case"),continue:new D("continue",k.keyword,"continue"),continuing:new D("continuing",k.keyword,"continuing"),default:new D("default",k.keyword,"default"),diagnostic:new D("diagnostic",k.keyword,"diagnostic"),discard:new D("discard",k.keyword,"discard"),else:new D("else",k.keyword,"else"),enable:new D("enable",k.keyword,"enable"),fallthrough:new D("fallthrough",k.keyword,"fallthrough"),false:new D("false",k.keyword,"false"),fn:new D("fn",k.keyword,"fn"),for:new D("for",k.keyword,"for"),function:new D("function",k.keyword,"function"),if:new D("if",k.keyword,"if"),let:new D("let",k.keyword,"let"),const:new D("const",k.keyword,"const"),loop:new D("loop",k.keyword,"loop"),while:new D("while",k.keyword,"while"),private:new D("private",k.keyword,"private"),read:new D("read",k.keyword,"read"),read_write:new D("read_write",k.keyword,"read_write"),return:new D("return",k.keyword,"return"),requires:new D("requires",k.keyword,"requires"),storage:new D("storage",k.keyword,"storage"),switch:new D("switch",k.keyword,"switch"),true:new D("true",k.keyword,"true"),alias:new D("alias",k.keyword,"alias"),type:new D("type",k.keyword,"type"),uniform:new D("uniform",k.keyword,"uniform"),var:new D("var",k.keyword,"var"),override:new D("override",k.keyword,"override"),workgroup:new D("workgroup",k.keyword,"workgroup"),write:new D("write",k.keyword,"write"),r8unorm:new D("r8unorm",k.keyword,"r8unorm"),r8snorm:new D("r8snorm",k.keyword,"r8snorm"),r8uint:new D("r8uint",k.keyword,"r8uint"),r8sint:new D("r8sint",k.keyword,"r8sint"),r16uint:new D("r16uint",k.keyword,"r16uint"),r16sint:new D("r16sint",k.keyword,"r16sint"),r16float:new D("r16float",k.keyword,"r16float"),rg8unorm:new D("rg8unorm",k.keyword,"rg8unorm"),rg8snorm:new D("rg8snorm",k.keyword,"rg8snorm"),rg8uint:new D("rg8uint",k.keyword,"rg8uint"),rg8sint:new D("rg8sint",k.keyword,"rg8sint"),r32uint:new D("r32uint",k.keyword,"r32uint"),r32sint:new D("r32sint",k.keyword,"r32sint"),r32float:new D("r32float",k.keyword,"r32float"),rg16uint:new D("rg16uint",k.keyword,"rg16uint"),rg16sint:new D("rg16sint",k.keyword,"rg16sint"),rg16float:new D("rg16float",k.keyword,"rg16float"),rgba8unorm:new D("rgba8unorm",k.keyword,"rgba8unorm"),rgba8unorm_srgb:new D("rgba8unorm_srgb",k.keyword,"rgba8unorm_srgb"),rgba8snorm:new D("rgba8snorm",k.keyword,"rgba8snorm"),rgba8uint:new D("rgba8uint",k.keyword,"rgba8uint"),rgba8sint:new D("rgba8sint",k.keyword,"rgba8sint"),bgra8unorm:new D("bgra8unorm",k.keyword,"bgra8unorm"),bgra8unorm_srgb:new D("bgra8unorm_srgb",k.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new D("rgb10a2unorm",k.keyword,"rgb10a2unorm"),rg11b10float:new D("rg11b10float",k.keyword,"rg11b10float"),rg32uint:new D("rg32uint",k.keyword,"rg32uint"),rg32sint:new D("rg32sint",k.keyword,"rg32sint"),rg32float:new D("rg32float",k.keyword,"rg32float"),rgba16uint:new D("rgba16uint",k.keyword,"rgba16uint"),rgba16sint:new D("rgba16sint",k.keyword,"rgba16sint"),rgba16float:new D("rgba16float",k.keyword,"rgba16float"),rgba32uint:new D("rgba32uint",k.keyword,"rgba32uint"),rgba32sint:new D("rgba32sint",k.keyword,"rgba32sint"),rgba32float:new D("rgba32float",k.keyword,"rgba32float"),static_assert:new D("static_assert",k.keyword,"static_assert")},x.tokens={decimal_float_literal:new D("decimal_float_literal",k.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new D("hex_float_literal",k.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new D("int_literal",k.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new D("uint_literal",k.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new D("name",k.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new D("ident",k.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new D("and",k.token,"&"),and_and:new D("and_and",k.token,"&&"),arrow:new D("arrow ",k.token,"->"),attr:new D("attr",k.token,"@"),forward_slash:new D("forward_slash",k.token,"/"),bang:new D("bang",k.token,"!"),bracket_left:new D("bracket_left",k.token,"["),bracket_right:new D("bracket_right",k.token,"]"),brace_left:new D("brace_left",k.token,"{"),brace_right:new D("brace_right",k.token,"}"),colon:new D("colon",k.token,":"),comma:new D("comma",k.token,","),equal:new D("equal",k.token,"="),equal_equal:new D("equal_equal",k.token,"=="),not_equal:new D("not_equal",k.token,"!="),greater_than:new D("greater_than",k.token,">"),greater_than_equal:new D("greater_than_equal",k.token,">="),shift_right:new D("shift_right",k.token,">>"),less_than:new D("less_than",k.token,"<"),less_than_equal:new D("less_than_equal",k.token,"<="),shift_left:new D("shift_left",k.token,"<<"),modulo:new D("modulo",k.token,"%"),minus:new D("minus",k.token,"-"),minus_minus:new D("minus_minus",k.token,"--"),period:new D("period",k.token,"."),plus:new D("plus",k.token,"+"),plus_plus:new D("plus_plus",k.token,"++"),or:new D("or",k.token,"|"),or_or:new D("or_or",k.token,"||"),paren_left:new D("paren_left",k.token,"("),paren_right:new D("paren_right",k.token,")"),semicolon:new D("semicolon",k.token,";"),star:new D("star",k.token,"*"),tilde:new D("tilde",k.token,"~"),underscore:new D("underscore",k.token,"_"),xor:new D("xor",k.token,"^"),plus_equal:new D("plus_equal",k.token,"+="),minus_equal:new D("minus_equal",k.token,"-="),times_equal:new D("times_equal",k.token,"*="),division_equal:new D("division_equal",k.token,"/="),modulo_equal:new D("modulo_equal",k.token,"%="),and_equal:new D("and_equal",k.token,"&="),or_equal:new D("or_equal",k.token,"|="),xor_equal:new D("xor_equal",k.token,"^="),shift_right_equal:new D("shift_right_equal",k.token,">>="),shift_left_equal:new D("shift_left_equal",k.token,"<<=")},x.simpleTokens={"@":L.tokens.attr,"{":L.tokens.brace_left,"}":L.tokens.brace_right,":":L.tokens.colon,",":L.tokens.comma,"(":L.tokens.paren_left,")":L.tokens.paren_right,";":L.tokens.semicolon},x.literalTokens={"&":L.tokens.and,"&&":L.tokens.and_and,"->":L.tokens.arrow,"/":L.tokens.forward_slash,"!":L.tokens.bang,"[":L.tokens.bracket_left,"]":L.tokens.bracket_right,"=":L.tokens.equal,"==":L.tokens.equal_equal,"!=":L.tokens.not_equal,">":L.tokens.greater_than,">=":L.tokens.greater_than_equal,">>":L.tokens.shift_right,"<":L.tokens.less_than,"<=":L.tokens.less_than_equal,"<<":L.tokens.shift_left,"%":L.tokens.modulo,"-":L.tokens.minus,"--":L.tokens.minus_minus,".":L.tokens.period,"+":L.tokens.plus,"++":L.tokens.plus_plus,"|":L.tokens.or,"||":L.tokens.or_or,"*":L.tokens.star,"~":L.tokens.tilde,_:L.tokens.underscore,"^":L.tokens.xor,"+=":L.tokens.plus_equal,"-=":L.tokens.minus_equal,"*=":L.tokens.times_equal,"/=":L.tokens.division_equal,"%=":L.tokens.modulo_equal,"&=":L.tokens.and_equal,"|=":L.tokens.or_equal,"^=":L.tokens.xor_equal,">>=":L.tokens.shift_right_equal,"<<=":L.tokens.shift_left_equal},x.regexTokens={decimal_float_literal:L.tokens.decimal_float_literal,hex_float_literal:L.tokens.hex_float_literal,int_literal:L.tokens.int_literal,uint_literal:L.tokens.uint_literal,ident:L.tokens.ident},x.storage_class=[L.keywords.function,L.keywords.private,L.keywords.workgroup,L.keywords.uniform,L.keywords.storage],x.access_mode=[L.keywords.read,L.keywords.write,L.keywords.read_write],x.sampler_type=[L.keywords.sampler,L.keywords.sampler_comparison],x.sampled_texture_type=[L.keywords.texture_1d,L.keywords.texture_2d,L.keywords.texture_2d_array,L.keywords.texture_3d,L.keywords.texture_cube,L.keywords.texture_cube_array],x.multisampled_texture_type=[L.keywords.texture_multisampled_2d],x.storage_texture_type=[L.keywords.texture_storage_1d,L.keywords.texture_storage_2d,L.keywords.texture_storage_2d_array,L.keywords.texture_storage_3d],x.depth_texture_type=[L.keywords.texture_depth_2d,L.keywords.texture_depth_2d_array,L.keywords.texture_depth_cube,L.keywords.texture_depth_cube_array,L.keywords.texture_depth_multisampled_2d],x.texture_external_type=[L.keywords.texture_external],x.any_texture_type=[...L.sampled_texture_type,...L.multisampled_texture_type,...L.storage_texture_type,...L.depth_texture_type,...L.texture_external_type],x.texel_format=[L.keywords.r8unorm,L.keywords.r8snorm,L.keywords.r8uint,L.keywords.r8sint,L.keywords.r16uint,L.keywords.r16sint,L.keywords.r16float,L.keywords.rg8unorm,L.keywords.rg8snorm,L.keywords.rg8uint,L.keywords.rg8sint,L.keywords.r32uint,L.keywords.r32sint,L.keywords.r32float,L.keywords.rg16uint,L.keywords.rg16sint,L.keywords.rg16float,L.keywords.rgba8unorm,L.keywords.rgba8unorm_srgb,L.keywords.rgba8snorm,L.keywords.rgba8uint,L.keywords.rgba8sint,L.keywords.bgra8unorm,L.keywords.bgra8unorm_srgb,L.keywords.rgb10a2unorm,L.keywords.rg11b10float,L.keywords.rg32uint,L.keywords.rg32sint,L.keywords.rg32float,L.keywords.rgba16uint,L.keywords.rgba16sint,L.keywords.rgba16float,L.keywords.rgba32uint,L.keywords.rgba32sint,L.keywords.rgba32float],x.const_literal=[L.tokens.int_literal,L.tokens.uint_literal,L.tokens.decimal_float_literal,L.tokens.hex_float_literal,L.keywords.true,L.keywords.false],x.literal_or_ident=[L.tokens.ident,L.tokens.int_literal,L.tokens.uint_literal,L.tokens.decimal_float_literal,L.tokens.hex_float_literal,L.tokens.name],x.element_count_expression=[L.tokens.int_literal,L.tokens.uint_literal,L.tokens.ident],x.template_types=[L.keywords.vec2,L.keywords.vec3,L.keywords.vec4,L.keywords.mat2x2,L.keywords.mat2x3,L.keywords.mat2x4,L.keywords.mat3x2,L.keywords.mat3x3,L.keywords.mat3x4,L.keywords.mat4x2,L.keywords.mat4x3,L.keywords.mat4x4,L.keywords.atomic,L.keywords.bitcast,...L.any_texture_type],x.attribute_name=[L.tokens.ident,L.keywords.block,L.keywords.diagnostic],x.assignment_operators=[L.tokens.equal,L.tokens.plus_equal,L.tokens.minus_equal,L.tokens.times_equal,L.tokens.division_equal,L.tokens.modulo_equal,L.tokens.and_equal,L.tokens.or_equal,L.tokens.xor_equal,L.tokens.shift_right_equal,L.tokens.shift_left_equal],x.increment_operators=[L.tokens.plus_plus,L.tokens.minus_minus];class gb{constructor(e,t,i,s,o){this.type=e,this.lexeme=t,this.line=i,this.start=s,this.end=o}toString(){return this.lexeme}isTemplateType(){return x.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==x.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class WE{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new gb(x.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let c=1;for(;c>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),c--,c==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),c++)}return!0}}const t=x.simpleTokens[e];if(t)return this._addToken(t),!0;let i=x.none;const s=this._isAlpha(e),o=e==="_";if(this._isAlphaNumeric(e)){let c=this._peekAhead();for(;this._isAlphaNumeric(c);)e+=this._advance(),c=this._peekAhead()}if(s){const c=x.keywords[e];if(c)return this._addToken(c),!0}if(s||o)return this._addToken(x.tokens.ident),!0;for(;;){let c=this._findType(e);const u=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(u=="=")return this._current++,e+=u,this._addToken(x.tokens.minus_equal),!0;if(u=="-")return this._current++,e+=u,this._addToken(x.tokens.minus_minus),!0;const h=this._tokens.length-1;if((x.literal_or_ident.indexOf(this._tokens[h].type)!=-1||this._tokens[h].type==x.tokens.paren_right)&&u!=">")return this._addToken(c),!0}if(e==">"&&(u==">"||u=="=")){let h=!1,d=this._tokens.length-1;for(let g=0;g<5&&d>=0&&x.assignment_operators.indexOf(this._tokens[d].type)===-1;++g,--d)if(this._tokens[d].type===x.tokens.less_than){d>0&&this._tokens[d-1].isArrayOrTemplateType()&&(h=!0);break}if(h)return this._addToken(c),!0}if(c===x.none){let h=e,d=0;const g=2;for(let m=0;m<g;++m)if(h+=this._peekAhead(m),c=this._findType(h),c!==x.none){d=m;break}if(c===x.none)return i!==x.none&&(this._current--,this._addToken(i),!0);e=h,this._current+=d+1}if(i=c,this._isAtEnd())break;e+=this._advance()}return i!==x.none&&(this._addToken(i),!0)}_findType(e){for(const i in x.regexTokens){const s=x.regexTokens[i];if(this._match(e,s.rule))return s}return x.literalTokens[e]||x.none}_match(e,t){const i=t.exec(e);return i&&i.index==0&&i[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return!this._isNumeric(e)&&!this._isWhitespace(e)&&e!=="_"&&e!=="."&&e!=="("&&e!==")"&&e!=="["&&e!=="]"&&e!=="{"&&e!=="}"&&e!==","&&e!==";"&&e!==":"&&e!=="="&&e!=="!"&&e!=="<"&&e!==">"&&e!=="+"&&e!=="-"&&e!=="*"&&e!=="/"&&e!=="%"&&e!=="&"&&e!=="|"&&e!=="^"&&e!=="~"&&e!=="@"&&e!=="#"&&e!=="?"&&e!=="'"&&e!=="`"&&e!=='"'&&e!=="\\"&&e!==`
`&&e!=="\r"&&e!=="	"&&e!=="\0"}_isNumeric(e){return e>="0"&&e<="9"}_isAlphaNumeric(e){return this._isAlpha(e)||this._isNumeric(e)||e==="_"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let t=this._source[this._current];return e=e||0,e++,this._current+=e,t}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const t=this._source.substring(this._start,this._current);this._tokens.push(new gb(e,t,this._line,this._start,this._current))}}function ue(n){return Array.isArray(n)||n?.buffer instanceof ArrayBuffer}const yc=new Float32Array(1),$E=new Uint32Array(yc.buffer),XE=new Uint32Array(yc.buffer),bc=new Int32Array(1),YE=new Float32Array(bc.buffer),qE=new Uint32Array(bc.buffer),vc=new Uint32Array(1),KE=new Float32Array(vc.buffer),ZE=new Int32Array(vc.buffer);function _b(n,e,t){if(e===t)return n;if(e==="f32"){if(t==="i32"||t==="x32")return yc[0]=n,$E[0];if(t==="u32")return yc[0]=n,XE[0]}else if(e==="i32"||e==="x32"){if(t==="f32")return bc[0]=n,YE[0];if(t==="u32")return bc[0]=n,qE[0]}else if(e==="u32"){if(t==="f32")return vc[0]=n,KE[0];if(t==="i32"||t==="x32")return vc[0]=n,ZE[0]}return console.error(`Unsupported cast from ${e} to ${t}`),n}class QE{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class Xl{constructor(e,t){this.align=e,this.size=t}}class Qn{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new PE,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}updateAST(e){for(const t of e)t instanceof bo&&this._functions.set(t.name,new QE(t));for(const t of e)if(t instanceof gi){const i=this.getTypeInfo(t,null);i instanceof Qi&&this.structs.push(i)}for(const t of e)if(t instanceof $d)this.aliases.push(this._getAliasInfo(t));else{if(t instanceof Hd){const i=t,s=this._getAttributeNum(i.attributes,"id",0),o=i.type!=null?this.getTypeInfo(i.type,i.attributes):null;this.overrides.push(new OE(i.name,o,i.attributes,s));continue}if(this._isUniformVar(t)){const i=t,s=this._getAttributeNum(i.attributes,"group",0),o=this._getAttributeNum(i.attributes,"binding",0),c=this.getTypeInfo(i.type,i.attributes),u=new $l(i.name,c,s,o,i.attributes,Ki.Uniform,i.access);u.access||(u.access="read"),this.uniforms.push(u);continue}if(this._isStorageVar(t)){const i=t,s=this._getAttributeNum(i.attributes,"group",0),o=this._getAttributeNum(i.attributes,"binding",0),c=this.getTypeInfo(i.type,i.attributes),u=this._isStorageTexture(c),h=new $l(i.name,c,s,o,i.attributes,u?Ki.StorageTexture:Ki.Storage,i.access);h.access||(h.access="read"),this.storage.push(h);continue}if(this._isTextureVar(t)){const i=t,s=this._getAttributeNum(i.attributes,"group",0),o=this._getAttributeNum(i.attributes,"binding",0),c=this.getTypeInfo(i.type,i.attributes),u=this._isStorageTexture(c),h=new $l(i.name,c,s,o,i.attributes,u?Ki.StorageTexture:Ki.Texture,i.access);h.access||(h.access="read"),u?this.storage.push(h):this.textures.push(h);continue}if(this._isSamplerVar(t)){const i=t,s=this._getAttributeNum(i.attributes,"group",0),o=this._getAttributeNum(i.attributes,"binding",0),c=this.getTypeInfo(i.type,i.attributes),u=new $l(i.name,c,s,o,i.attributes,Ki.Sampler,i.access);this.samplers.push(u);continue}}for(const t of e)if(t instanceof bo){const i=this._getAttribute(t,"vertex"),s=this._getAttribute(t,"fragment"),o=this._getAttribute(t,"compute"),c=i||s||o,u=new NE(t.name,c?.name,t.attributes);u.attributes=t.attributes,u.startLine=t.startLine,u.endLine=t.endLine,this.functions.push(u),this._functions.get(t.name).info=u,c&&(this._functions.get(t.name).inUse=!0,u.inUse=!0,u.resources=this._findResources(t,!!c),u.inputs=this._getInputs(t.args),u.outputs=this._getOutputs(t.returnType),this.entry[c.name].push(u)),u.arguments=t.args.map(h=>new IE(h.name,this.getTypeInfo(h.type,h.attributes),h.attributes)),u.returnType=t.returnType?this.getTypeInfo(t.returnType,t.attributes):null;continue}for(const t of this._functions.values())t.info&&(t.info.inUse=t.inUse,this._addCalls(t.node,t.info.calls));for(const t of this._functions.values())t.node.search(i=>{var s,o,c;if(i instanceof t3){if(i.value)if(ue(i.value))for(const u of i.value)for(const h of this.overrides)u===h.name&&((s=t.info)===null||s===void 0||s.overrides.push(h));else for(const u of this.overrides)i.value===u.name&&((o=t.info)===null||o===void 0||o.overrides.push(u))}else if(i instanceof fn)for(const u of this.overrides)i.name===u.name&&((c=t.info)===null||c===void 0||c.overrides.push(u))});for(const t of this.uniforms)this._markStructsInUse(t.type);for(const t of this.storage)this._markStructsInUse(t.type)}getFunctionInfo(e){for(const t of this.functions)if(t.name==e)return t;return null}getStructInfo(e){for(const t of this.structs)if(t.name==e)return t;return null}getOverrideInfo(e){for(const t of this.overrides)if(t.name==e)return t;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const t of e.members)this._markStructsInUse(t.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const t=this._getAlias(e.name);t&&this._markStructsInUse(t)}}_addCalls(e,t){var i;for(const s of e.calls){const o=(i=this._functions.get(s.name))===null||i===void 0?void 0:i.info;o&&t.add(o)}}findResource(e,t,i){if(i){for(const s of this.entry.compute)if(s.name===i){for(const o of s.resources)if(o.group==e&&o.binding==t)return o}for(const s of this.entry.vertex)if(s.name===i){for(const o of s.resources)if(o.group==e&&o.binding==t)return o}for(const s of this.entry.fragment)if(s.name===i){for(const o of s.resources)if(o.group==e&&o.binding==t)return o}}for(const s of this.uniforms)if(s.group==e&&s.binding==t)return s;for(const s of this.storage)if(s.group==e&&s.binding==t)return s;for(const s of this.textures)if(s.group==e&&s.binding==t)return s;for(const s of this.samplers)if(s.group==e&&s.binding==t)return s;return null}_findResource(e){for(const t of this.uniforms)if(t.name==e)return t;for(const t of this.storage)if(t.name==e)return t;for(const t of this.textures)if(t.name==e)return t;for(const t of this.samplers)if(t.name==e)return t;return null}_markStructsFromAST(e){const t=this.getTypeInfo(e,null);this._markStructsInUse(t)}_findResources(e,t){const i=[],s=this,o=[];return e.search(c=>{if(c instanceof _c)o.push({});else if(c instanceof mc)o.pop();else if(c instanceof mi){const u=c;t&&u.type!==null&&this._markStructsFromAST(u.type),o.length>0&&(o[o.length-1][u.name]=u)}else if(c instanceof qn){const u=c;t&&u.type!==null&&this._markStructsFromAST(u.type)}else if(c instanceof ho){const u=c;t&&u.type!==null&&this._markStructsFromAST(u.type),o.length>0&&(o[o.length-1][u.name]=u)}else if(c instanceof fn){const u=c;if(o.length>0&&o[o.length-1][u.name])return;const h=s._findResource(u.name);h&&i.push(h)}else if(c instanceof Xd){const u=c,h=s._functions.get(u.name);h&&(t&&(h.inUse=!0),e.calls.add(h.node),h.resources===null&&(h.resources=s._findResources(h.node,t)),i.push(...h.resources))}else if(c instanceof Wd){const u=c,h=s._functions.get(u.name);h&&(t&&(h.inUse=!0),e.calls.add(h.node),h.resources===null&&(h.resources=s._findResources(h.node,t)),i.push(...h.resources))}}),[...new Map(i.map(c=>[c.name,c])).values()]}getBindGroups(){const e=[];function t(i,s){i>=e.length&&(e.length=i+1),e[i]===void 0&&(e[i]=[]),s>=e[i].length&&(e[i].length=s+1)}for(const i of this.uniforms)t(i.group,i.binding),e[i.group][i.binding]=i;for(const i of this.storage)t(i.group,i.binding),e[i.group][i.binding]=i;for(const i of this.textures)t(i.group,i.binding),e[i.group][i.binding]=i;for(const i of this.samplers)t(i.group,i.binding),e[i.group][i.binding]=i;return e}_getOutputs(e,t=void 0){if(t===void 0&&(t=[]),e instanceof gi)this._getStructOutputs(e,t);else{const i=this._getOutputInfo(e);i!==null&&t.push(i)}return t}_getStructOutputs(e,t){for(const i of e.members)if(i.type instanceof gi)this._getStructOutputs(i.type,t);else{const s=this._getAttribute(i,"location")||this._getAttribute(i,"builtin");if(s!==null){const o=this.getTypeInfo(i.type,i.type.attributes),c=this._parseInt(s.value),u=new ub(i.name,o,s.name,c);t.push(u)}}}_getOutputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const i=this.getTypeInfo(e,e.attributes),s=this._parseInt(t.value);return new ub("",i,t.name,s)}return null}_getInputs(e,t=void 0){t===void 0&&(t=[]);for(const i of e)if(i.type instanceof gi)this._getStructInputs(i.type,t);else{const s=this._getInputInfo(i);s!==null&&t.push(s)}return t}_getStructInputs(e,t){for(const i of e.members)if(i.type instanceof gi)this._getStructInputs(i.type,t);else{const s=this._getInputInfo(i);s!==null&&t.push(s)}}_getInputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const i=this._getAttribute(e,"interpolation"),s=this.getTypeInfo(e.type,e.attributes),o=this._parseInt(t.value),c=new ME(e.name,s,t.name,o);return i!==null&&(c.interpolation=this._parseString(i.value)),c}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const t=parseInt(e);return isNaN(t)?e:t}_getAlias(e){for(const t of this.aliases)if(t.name==e)return t.type;return null}_getAliasInfo(e){return new CE(e.name,this.getTypeInfo(e.type,null))}getTypeInfoByName(e){for(const t of this.structs)if(t.name==e)return t;for(const t of this.aliases)if(t.name==e)return t.type;return null}getTypeInfo(e,t=null){if(this._types.has(e))return this._types.get(e);if(e instanceof sc){const s=e.type?this.getTypeInfo(e.type,e.attributes):null,o=new ed(e.name,s,t);return this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof po){const s=e,o=s.format?this.getTypeInfo(s.format,s.attributes):null,c=new ts(s.name,t);return c.format=o,c.count=s.count,this._types.set(e,c),this._updateTypeInfo(c),c}if(e instanceof gi){const s=e,o=new Qi(s.name,t);o.startLine=s.startLine,o.endLine=s.endLine;for(const c of s.members){const u=this.getTypeInfo(c.type,c.attributes);o.members.push(new cb(c.name,u,c.attributes))}return this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof ao){const s=e,o=s.format instanceof J,c=s.format?o?this.getTypeInfo(s.format,null):new An(s.format,null):null,u=new ks(s.name,c,t,s.access);return this._types.set(e,u),this._updateTypeInfo(u),u}if(e instanceof B){const s=e,o=s.format?this.getTypeInfo(s.format,null):null,c=new ks(s.name,o,t,s.access);return this._types.set(e,c),this._updateTypeInfo(c),c}const i=new An(e.name,t);return this._types.set(e,i),this._updateTypeInfo(i),i}_updateTypeInfo(e){var t,i,s;const o=this._getTypeSize(e);if(e.size=(t=o?.size)!==null&&t!==void 0?t:0,e instanceof ts&&e.format){const c=this._getTypeSize(e.format);e.stride=Math.max((i=c?.size)!==null&&i!==void 0?i:0,(s=c?.align)!==null&&s!==void 0?s:0),this._updateTypeInfo(e.format)}e instanceof ed&&this._updateTypeInfo(e.format),e instanceof Qi&&this._updateStructInfo(e)}_updateStructInfo(e){var t;let i=0,s=0,o=0,c=0;for(let u=0,h=e.members.length;u<h;++u){const d=e.members[u],g=this._getTypeSize(d);if(!g)continue;(t=this._getAlias(d.type.name))!==null&&t!==void 0||d.type;const m=g.align,y=g.size;i=this._roundUp(m,i+s),s=y,o=i,c=Math.max(c,m),d.offset=i,d.size=y,this._updateTypeInfo(d.type)}e.size=this._roundUp(c,o+s),e.align=c}_getTypeSize(e){var t,i;if(e==null)return null;const s=this._getAttributeNum(e.attributes,"size",0),o=this._getAttributeNum(e.attributes,"align",0);if(e instanceof cb&&(e=e.type),e instanceof An){const c=this._getAlias(e.name);c!==null&&(e=c)}{const c=Qn._typeInfo[e.name];if(c!==void 0){const u=((t=e.format)===null||t===void 0?void 0:t.name)==="f16"?2:1;return new Xl(Math.max(o,c.align/u),Math.max(s,c.size/u))}}{const c=Qn._typeInfo[e.name.substring(0,e.name.length-1)];if(c){const u=e.name[e.name.length-1]==="h"?2:1;return new Xl(Math.max(o,c.align/u),Math.max(s,c.size/u))}}if(e instanceof ts){let c=e,u=8,h=8;const d=this._getTypeSize(c.format);return d!==null&&(h=d.size,u=d.align),h=c.count*this._getAttributeNum((i=e?.attributes)!==null&&i!==void 0?i:null,"stride",this._roundUp(u,h)),s&&(h=s),new Xl(Math.max(o,u),Math.max(s,h))}if(e instanceof Qi){let c=0,u=0,h=0,d=0,g=0;for(const m of e.members){const y=this._getTypeSize(m.type);y!==null&&(c=Math.max(y.align,c),h=this._roundUp(y.align,h+d),d=y.size,g=h)}return u=this._roundUp(c,g+d),new Xl(Math.max(o,c),Math.max(s,u))}return null}_isUniformVar(e){return e instanceof mi&&e.storage=="uniform"}_isStorageVar(e){return e instanceof mi&&e.storage=="storage"}_isTextureVar(e){return e instanceof mi&&e.type!==null&&Qn._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof mi&&e.type!==null&&Qn._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,t){const i=e;if(!i||!i.attributes)return null;const s=i.attributes;for(let o of s)if(o.name==t)return o;return null}_getAttributeNum(e,t,i){if(e===null)return i;for(let s of e)if(s.name==t){let o=s!==null&&s.value!==null?s.value:i;return o instanceof Array&&(o=o[0]),typeof o=="number"?o:typeof o=="string"?parseInt(o):i}return i}_roundUp(e,t){return Math.ceil(t/e)*e}}Qn._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},Qn._textureTypes=x.any_texture_type.map(n=>n.name),Qn._samplerTypes=x.sampler_type.map(n=>n.name);let Yd=0;class qd{constructor(e,t,i){this.id=Yd++,this.name=e,this.value=t,this.node=i}clone(){return new qd(this.name,this.value,this.node)}}class Kd{constructor(e){this.id=Yd++,this.name=e.name,this.node=e}clone(){return new Kd(this.node)}}class Zd{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",this.id=Yd++,e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var t;return this.variables.has(e)?(t=this.variables.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var t;return this.functions.has(e)?(t=this.functions.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getFunction(e):null}createVariable(e,t,i){this.variables.set(e,new qd(e,t,i??null))}setVariable(e,t,i){const s=this.getVariable(e);s!==null?s.value=t:this.createVariable(e,t,i)}getVariableValue(e){var t;const i=this.getVariable(e);return(t=i?.value)!==null&&t!==void 0?t:null}clone(){return new Zd(this)}}class GE{evalExpression(e,t){return null}getTypeInfo(e){return null}getVariableName(e,t){return""}}class JE{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,t){const i=this.exec.evalExpression(e.args[0],t);let s=!0;if(i instanceof S)return i.data.forEach(o=>{o||(s=!1)}),new P(s?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S){const s=i.data.some(o=>o);return new P(s?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,t){const i=this.exec.evalExpression(e.args[2],t);if(!(i instanceof P))throw new Error(`Select() expects a bool condition. Line ${e.line}`);return i.value?this.exec.evalExpression(e.args[1],t):this.exec.evalExpression(e.args[0],t)}ArrayLength(e,t){let i=e.args[0];i instanceof xt&&(i=i.right);const s=this.exec.evalExpression(i,t);if(s instanceof _t&&s.typeInfo.size===0){const o=s.typeInfo,c=s.buffer.byteLength/o.stride;return new P(c,this.getTypeInfo("u32"))}return new P(s.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(o=>Math.abs(o)),i.typeInfo);const s=i;return new P(Math.abs(s.value),s.typeInfo)}Acos(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(o=>Math.acos(o)),i.typeInfo);const s=i;return new P(Math.acos(s.value),i.typeInfo)}Acosh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(o=>Math.acosh(o)),i.typeInfo);const s=i;return new P(Math.acosh(s.value),i.typeInfo)}Asin(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(o=>Math.asin(o)),i.typeInfo);const s=i;return new P(Math.asin(s.value),i.typeInfo)}Asinh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(o=>Math.asinh(o)),i.typeInfo);const s=i;return new P(Math.asinh(s.value),i.typeInfo)}Atan(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(o=>Math.atan(o)),i.typeInfo);const s=i;return new P(Math.atan(s.value),i.typeInfo)}Atanh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(o=>Math.atanh(o)),i.typeInfo);const s=i;return new P(Math.atanh(s.value),i.typeInfo)}Atan2(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof S&&s instanceof S)return new S(i.data.map((u,h)=>Math.atan2(u,s.data[h])),i.typeInfo);const o=i,c=s;return new P(Math.atan2(o.value,c.value),i.typeInfo)}Ceil(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(o=>Math.ceil(o)),i.typeInfo);const s=i;return new P(Math.ceil(s.value),i.typeInfo)}_clamp(e,t,i){return Math.min(Math.max(e,t),i)}Clamp(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),o=this.exec.evalExpression(e.args[2],t);if(i instanceof S&&s instanceof S&&o instanceof S)return new S(i.data.map((d,g)=>this._clamp(d,s.data[g],o.data[g])),i.typeInfo);const c=i,u=s,h=o;return new P(this._clamp(c.value,u.value,h.value),i.typeInfo)}Cos(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(o=>Math.cos(o)),i.typeInfo);const s=i;return new P(Math.cos(s.value),i.typeInfo)}Cosh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(o=>Math.cosh(o)),i.typeInfo);const s=i;return new P(Math.cos(s.value),i.typeInfo)}CountLeadingZeros(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(o=>Math.clz32(o)),i.typeInfo);const s=i;return new P(Math.clz32(s.value),i.typeInfo)}_countOneBits(e){let t=0;for(;e!==0;)1&e&&t++,e>>=1;return t}CountOneBits(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(o=>this._countOneBits(o)),i.typeInfo);const s=i;return new P(this._countOneBits(s.value),i.typeInfo)}_countTrailingZeros(e){if(e===0)return 32;let t=0;for(;!(1&e);)e>>=1,t++;return t}CountTrailingZeros(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(o=>this._countTrailingZeros(o)),i.typeInfo);const s=i;return new P(this._countTrailingZeros(s.value),i.typeInfo)}Cross(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof S&&s instanceof S){if(i.data.length!==3||s.data.length!==3)return console.error(`Cross() expects 3D vectors. Line ${e.line}`),null;const o=i.data,c=s.data;return new S([o[1]*c[2]-c[1]*o[2],o[2]*c[0]-c[2]*o[0],o[0]*c[1]-c[0]*o[1]],i.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${e.line}`),null}Degrees(e,t){const i=this.exec.evalExpression(e.args[0],t),s=180/Math.PI;return i instanceof S?new S(i.data.map(o=>o*s),i.typeInfo):new P(i.value*s,this.getTypeInfo("f32"))}Determinant(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof Se){const s=i.data,o=i.typeInfo.getTypeName(),c=o.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(o==="mat2x2"||o==="mat2x2f"||o==="mat2x2h")return new P(s[0]*s[3]-s[1]*s[2],c);if(o==="mat2x3"||o==="mat2x3f"||o==="mat2x3h")return new P(s[0]*(s[4]*s[8]-s[5]*s[7])-s[1]*(s[3]*s[8]-s[5]*s[6])+s[2]*(s[3]*s[7]-s[4]*s[6]),c);if(o==="mat2x4"||o==="mat2x4f"||o==="mat2x4h")console.error(`TODO: Determinant for ${o}`);else if(o==="mat3x2"||o==="mat3x2f"||o==="mat3x2h")console.error(`TODO: Determinant for ${o}`);else{if(o==="mat3x3"||o==="mat3x3f"||o==="mat3x3h")return new P(s[0]*(s[4]*s[8]-s[5]*s[7])-s[1]*(s[3]*s[8]-s[5]*s[6])+s[2]*(s[3]*s[7]-s[4]*s[6]),c);o==="mat3x4"||o==="mat3x4f"||o==="mat3x4h"||o==="mat4x2"||o==="mat4x2f"||o==="mat4x2h"||o==="mat4x3"||o==="mat4x3f"||o==="mat4x3h"?console.error(`TODO: Determinant for ${o}`):o!=="mat4x4"&&o!=="mat4x4f"&&o!=="mat4x4h"||console.error(`TODO: Determinant for ${o}`)}}return console.error(`Determinant expects a matrix argument. Line ${e.line}`),null}Distance(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof S&&s instanceof S){let u=0;for(let h=0;h<i.data.length;++h)u+=(i.data[h]-s.data[h])*(i.data[h]-s.data[h]);return new P(Math.sqrt(u),this.getTypeInfo("f32"))}const o=i,c=s;return new P(Math.abs(o.value-c.value),i.typeInfo)}_dot(e,t){let i=0;for(let s=0;s<e.length;++s)i+=t[s]*e[s];return i}Dot(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);return i instanceof S&&s instanceof S?new P(this._dot(i.data,s.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${e.line}`),null)}Dot4U8Packed(e,t){return console.error(`TODO: dot4U8Packed. Line ${e.line}`),null}Dot4I8Packed(e,t){return console.error(`TODO: dot4I8Packed. Line ${e.line}`),null}Exp(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(o=>Math.exp(o)),i.typeInfo);const s=i;return new P(Math.exp(s.value),i.typeInfo)}Exp2(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(o=>Math.pow(2,o)),i.typeInfo);const s=i;return new P(Math.pow(2,s.value),i.typeInfo)}ExtractBits(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),o=this.exec.evalExpression(e.args[2],t);if(s.typeInfo.name!=="u32"&&s.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${e.line}`),null;if(o.typeInfo.name!=="u32"&&o.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${e.line}`),null;const c=s.value,u=o.value;if(i instanceof S)return new S(i.data.map(d=>d>>c&(1<<u)-1),i.typeInfo);if(i.typeInfo.name!=="i32"&&i.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${e.line}`),null;const h=i.value;return new P(h>>c&(1<<u)-1,this.getTypeInfo("i32"))}FaceForward(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),o=this.exec.evalExpression(e.args[2],t);if(i instanceof S&&s instanceof S&&o instanceof S){const c=this._dot(s.data,o.data);return new S(c<0?Array.from(i.data):i.data.map(u=>-u),i.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${e.line}`),null}_firstLeadingBit(e){return e===0?-1:31-Math.clz32(e)}FirstLeadingBit(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(o=>this._firstLeadingBit(o)),i.typeInfo);const s=i;return new P(this._firstLeadingBit(s.value),i.typeInfo)}_firstTrailingBit(e){return e===0?-1:Math.log2(e&-e)}FirstTrailingBit(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(o=>this._firstTrailingBit(o)),i.typeInfo);const s=i;return new P(this._firstTrailingBit(s.value),i.typeInfo)}Floor(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(o=>Math.floor(o)),i.typeInfo);const s=i;return new P(Math.floor(s.value),i.typeInfo)}Fma(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),o=this.exec.evalExpression(e.args[2],t);if(i instanceof S&&s instanceof S&&o instanceof S)return i.data.length!==s.data.length||i.data.length!==o.data.length?(console.error(`Fma() expects vectors of the same length. Line ${e.line}`),null):new S(i.data.map((d,g)=>d*s.data[g]+o.data[g]),i.typeInfo);const c=i,u=s,h=o;return new P(c.value*u.value+h.value,c.typeInfo)}Fract(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(o=>o-Math.floor(o)),i.typeInfo);const s=i;return new P(s.value-Math.floor(s.value),i.typeInfo)}Frexp(e,t){return console.error(`TODO: frexp. Line ${e.line}`),null}InsertBits(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),o=this.exec.evalExpression(e.args[2],t),c=this.exec.evalExpression(e.args[3],t);if(o.typeInfo.name!=="u32"&&o.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${e.line}`),null;const u=o.value,h=(1<<c.value)-1<<u,d=~h;if(i instanceof S&&s instanceof S)return new S(i.data.map((y,T)=>y&d|s.data[T]<<u&h),i.typeInfo);const g=i.value,m=s.value;return new P(g&d|m<<u&h,i.typeInfo)}InverseSqrt(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(o=>1/Math.sqrt(o)),i.typeInfo);const s=i;return new P(1/Math.sqrt(s.value),i.typeInfo)}Ldexp(e,t){return console.error(`TODO: ldexp. Line ${e.line}`),null}Length(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S){let o=0;return i.data.forEach(c=>{o+=c*c}),new P(Math.sqrt(o),this.getTypeInfo("f32"))}const s=i;return new P(Math.abs(s.value),i.typeInfo)}Log(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(o=>Math.log(o)),i.typeInfo);const s=i;return new P(Math.log(s.value),i.typeInfo)}Log2(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(o=>Math.log2(o)),i.typeInfo);const s=i;return new P(Math.log2(s.value),i.typeInfo)}Max(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof S&&s instanceof S)return new S(i.data.map((u,h)=>Math.max(u,s.data[h])),i.typeInfo);const o=i,c=s;return new P(Math.max(o.value,c.value),i.typeInfo)}Min(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof S&&s instanceof S)return new S(i.data.map((u,h)=>Math.min(u,s.data[h])),i.typeInfo);const o=i,c=s;return new P(Math.min(o.value,c.value),i.typeInfo)}Mix(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),o=this.exec.evalExpression(e.args[2],t);if(i instanceof S&&s instanceof S&&o instanceof S)return new S(i.data.map((h,d)=>i.data[d]*(1-o.data[d])+s.data[d]*o.data[d]),i.typeInfo);const c=s,u=o;return new P(i.value*(1-u.value)+c.value*u.value,i.typeInfo)}Modf(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof S&&s instanceof S)return new S(i.data.map((c,u)=>c%s.data[u]),i.typeInfo);const o=s;return new P(i.value%o.value,i.typeInfo)}Normalize(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S){const s=this.Length(e,t).value;return new S(i.data.map(o=>o/s),i.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${e.line}`),null}Pow(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof S&&s instanceof S)return new S(i.data.map((u,h)=>Math.pow(u,s.data[h])),i.typeInfo);const o=i,c=s;return new P(Math.pow(o.value,c.value),i.typeInfo)}QuantizeToF16(e,t){const i=this.exec.evalExpression(e.args[0],t);return i instanceof S?new S(i.data.map(s=>s),i.typeInfo):new P(i.value,i.typeInfo)}Radians(e,t){const i=this.exec.evalExpression(e.args[0],t);return i instanceof S?new S(i.data.map(s=>s*Math.PI/180),i.typeInfo):new P(i.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(e,t){let i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(i instanceof S&&s instanceof S){const o=this._dot(i.data,s.data);return new S(i.data.map((c,u)=>c-2*o*s.data[u]),i.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${e.line}`),null}Refract(e,t){let i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),o=this.exec.evalExpression(e.args[2],t);if(i instanceof S&&s instanceof S&&o instanceof P){const c=this._dot(s.data,i.data);return new S(i.data.map((u,h)=>{const d=1-o.value*o.value*(1-c*c);if(d<0)return 0;const g=Math.sqrt(d);return o.value*u-(o.value*c+g)*s.data[h]}),i.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${e.line}`),null}ReverseBits(e,t){return console.error(`TODO: reverseBits. Line ${e.line}`),null}Round(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(o=>Math.round(o)),i.typeInfo);const s=i;return new P(Math.round(s.value),i.typeInfo)}Saturate(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(o=>Math.min(Math.max(o,0),1)),i.typeInfo);const s=i;return new P(Math.min(Math.max(s.value,0),1),i.typeInfo)}Sign(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(o=>Math.sign(o)),i.typeInfo);const s=i;return new P(Math.sign(s.value),i.typeInfo)}Sin(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(o=>Math.sin(o)),i.typeInfo);const s=i;return new P(Math.sin(s.value),i.typeInfo)}Sinh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(o=>Math.sinh(o)),i.typeInfo);const s=i;return new P(Math.sinh(s.value),i.typeInfo)}_smoothstep(e,t,i){const s=Math.min(Math.max((i-e)/(t-e),0),1);return s*s*(3-2*s)}SmoothStep(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),o=this.exec.evalExpression(e.args[2],t);if(o instanceof S&&i instanceof S&&s instanceof S)return new S(o.data.map((d,g)=>this._smoothstep(i.data[g],s.data[g],d)),o.typeInfo);const c=i,u=s,h=o;return new P(this._smoothstep(c.value,u.value,h.value),o.typeInfo)}Sqrt(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(o=>Math.sqrt(o)),i.typeInfo);const s=i;return new P(Math.sqrt(s.value),i.typeInfo)}Step(e,t){const i=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(s instanceof S&&i instanceof S)return new S(s.data.map((c,u)=>c<i.data[u]?0:1),s.typeInfo);const o=i;return new P(s.value<o.value?0:1,o.typeInfo)}Tan(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(o=>Math.tan(o)),i.typeInfo);const s=i;return new P(Math.tan(s.value),i.typeInfo)}Tanh(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(o=>Math.tanh(o)),i.typeInfo);const s=i;return new P(Math.tanh(s.value),i.typeInfo)}_getTransposeType(e){const t=e.getTypeName();return t==="mat2x2f"||t==="mat2x2h"?e:t==="mat2x3f"?this.getTypeInfo("mat3x2f"):t==="mat2x3h"?this.getTypeInfo("mat3x2h"):t==="mat2x4f"?this.getTypeInfo("mat4x2f"):t==="mat2x4h"?this.getTypeInfo("mat4x2h"):t==="mat3x2f"?this.getTypeInfo("mat2x3f"):t==="mat3x2h"?this.getTypeInfo("mat2x3h"):t==="mat3x3f"||t==="mat3x3h"?e:t==="mat3x4f"?this.getTypeInfo("mat4x3f"):t==="mat3x4h"?this.getTypeInfo("mat4x3h"):t==="mat4x2f"?this.getTypeInfo("mat2x4f"):t==="mat4x2h"?this.getTypeInfo("mat2x4h"):t==="mat4x3f"?this.getTypeInfo("mat3x4f"):t==="mat4x3h"?this.getTypeInfo("mat3x4h"):(t==="mat4x4f"||t==="mat4x4h"||console.error(`Invalid matrix type ${t}`),e)}Transpose(e,t){const i=this.exec.evalExpression(e.args[0],t);if(!(i instanceof Se))return console.error(`Transpose() expects a matrix argument. Line ${e.line}`),null;const s=this._getTransposeType(i.typeInfo);if(i.typeInfo.name==="mat2x2"||i.typeInfo.name==="mat2x2f"||i.typeInfo.name==="mat2x2h"){const o=i.data;return new Se([o[0],o[2],o[1],o[3]],s)}if(i.typeInfo.name==="mat2x3"||i.typeInfo.name==="mat2x3f"||i.typeInfo.name==="mat2x3h"){const o=i.data;return new Se([o[0],o[3],o[6],o[1],o[4],o[7]],s)}if(i.typeInfo.name==="mat2x4"||i.typeInfo.name==="mat2x4f"||i.typeInfo.name==="mat2x4h"){const o=i.data;return new Se([o[0],o[4],o[8],o[12],o[1],o[5],o[9],o[13]],s)}if(i.typeInfo.name==="mat3x2"||i.typeInfo.name==="mat3x2f"||i.typeInfo.name==="mat3x2h"){const o=i.data;return new Se([o[0],o[3],o[1],o[4],o[2],o[5]],s)}if(i.typeInfo.name==="mat3x3"||i.typeInfo.name==="mat3x3f"||i.typeInfo.name==="mat3x3h"){const o=i.data;return new Se([o[0],o[3],o[6],o[1],o[4],o[7],o[2],o[5],o[8]],s)}if(i.typeInfo.name==="mat3x4"||i.typeInfo.name==="mat3x4f"||i.typeInfo.name==="mat3x4h"){const o=i.data;return new Se([o[0],o[4],o[8],o[12],o[1],o[5],o[9],o[13],o[2],o[6],o[10],o[14]],s)}if(i.typeInfo.name==="mat4x2"||i.typeInfo.name==="mat4x2f"||i.typeInfo.name==="mat4x2h"){const o=i.data;return new Se([o[0],o[4],o[1],o[5],o[2],o[6]],s)}if(i.typeInfo.name==="mat4x3"||i.typeInfo.name==="mat4x3f"||i.typeInfo.name==="mat4x3h"){const o=i.data;return new Se([o[0],o[4],o[8],o[1],o[5],o[9],o[2],o[6],o[10]],s)}if(i.typeInfo.name==="mat4x4"||i.typeInfo.name==="mat4x4f"||i.typeInfo.name==="mat4x4h"){const o=i.data;return new Se([o[0],o[4],o[8],o[12],o[1],o[5],o[9],o[13],o[2],o[6],o[10],o[14],o[3],o[7],o[11],o[15]],s)}return console.error(`Invalid matrix type ${i.typeInfo.name}`),null}Trunc(e,t){const i=this.exec.evalExpression(e.args[0],t);if(i instanceof S)return new S(i.data.map(o=>Math.trunc(o)),i.typeInfo);const s=i;return new P(Math.trunc(s.value),i.typeInfo)}Dpdx(e,t){return console.error(`TODO: dpdx. Line ${e.line}`),null}DpdxCoarse(e,t){return console.error(`TODO: dpdxCoarse. Line ${e.line}`),null}DpdxFine(e,t){return console.error("TODO: dpdxFine"),null}Dpdy(e,t){return console.error("TODO: dpdy"),null}DpdyCoarse(e,t){return console.error("TODO: dpdyCoarse"),null}DpdyFine(e,t){return console.error("TODO: dpdyFine"),null}Fwidth(e,t){return console.error("TODO: fwidth"),null}FwidthCoarse(e,t){return console.error("TODO: fwidthCoarse"),null}FwidthFine(e,t){return console.error("TODO: fwidthFine"),null}TextureDimensions(e,t){const i=e.args[0],s=e.args.length>1?this.exec.evalExpression(e.args[1],t).value:0;if(i instanceof fn){const o=i.name,c=t.getVariableValue(o);if(c instanceof _i){if(s<0||s>=c.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${e.line}`),null;const u=c.getMipLevelSize(s),h=c.dimension;return h==="1d"?new P(u[0],this.getTypeInfo("u32")):h==="3d"?new S(u,this.getTypeInfo("vec3u")):h==="2d"?new S(u.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${h} not found. Line ${e.line}`),null)}return console.error(`Texture ${o} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${e.line}`),null}TextureGather(e,t){return console.error("TODO: textureGather"),null}TextureGatherCompare(e,t){return console.error("TODO: textureGatherCompare"),null}TextureLoad(e,t){const i=e.args[0],s=this.exec.evalExpression(e.args[1],t),o=e.args.length>2?this.exec.evalExpression(e.args[2],t).value:0;if(!(s instanceof S)||s.data.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${e.line}`),null;if(i instanceof fn){const c=i.name,u=t.getVariableValue(c);if(u instanceof _i){const h=Math.floor(s.data[0]),d=Math.floor(s.data[1]);if(h<0||h>=u.width||d<0||d>=u.height)return console.error(`Texture ${c} out of bounds. Line ${e.line}`),null;const g=u.getPixel(h,d,0,o);return g===null?(console.error(`Invalid texture format for textureLoad. Line ${e.line}`),null):new S(g,this.getTypeInfo("vec4f"))}return console.error(`Texture ${c} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${e.line}`),null}TextureNumLayers(e,t){const i=e.args[0];if(i instanceof fn){const s=i.name,o=t.getVariableValue(s);return o instanceof _i?new P(o.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${s} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${e.line}`),null}TextureNumLevels(e,t){const i=e.args[0];if(i instanceof fn){const s=i.name,o=t.getVariableValue(s);return o instanceof _i?new P(o.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${s} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${e.line}`),null}TextureNumSamples(e,t){const i=e.args[0];if(i instanceof fn){const s=i.name,o=t.getVariableValue(s);return o instanceof _i?new P(o.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${s} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${e.line}`),null}TextureSample(e,t){return console.error("TODO: textureSample"),null}TextureSampleBias(e,t){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(e,t){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(e,t){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(e,t){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(e,t){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(e,t){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(e,t){const i=e.args[0],s=this.exec.evalExpression(e.args[1],t),o=e.args.length===4?this.exec.evalExpression(e.args[2],t).value:0,c=e.args.length===4?this.exec.evalExpression(e.args[3],t).data:this.exec.evalExpression(e.args[2],t).data;if(c.length!==4)return console.error(`Invalid value argument for textureStore. Line ${e.line}`),null;if(!(s instanceof S)||s.data.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${e.line}`),null;if(i instanceof fn){const u=i.name,h=t.getVariableValue(u);if(h instanceof _i){const d=h.getMipLevelSize(0),g=Math.floor(s.data[0]),m=Math.floor(s.data[1]);return g<0||g>=d[0]||m<0||m>=d[1]?(console.error(`Texture ${u} out of bounds. Line ${e.line}`),null):(h.setPixel(g,m,0,o,Array.from(c)),null)}return console.error(`Texture ${u} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${e.line}`),null}AtomicLoad(e,t){let i=e.args[0];i instanceof xt&&(i=i.right);const s=this.exec.getVariableName(i,t);return t.getVariable(s).value.getSubData(this.exec,i.postfix,t)}AtomicStore(e,t){let i=e.args[0];i instanceof xt&&(i=i.right);const s=this.exec.getVariableName(i,t),o=t.getVariable(s);let c=e.args[1];const u=this.exec.evalExpression(c,t),h=o.value.getSubData(this.exec,i.postfix,t);return h instanceof P&&u instanceof P&&(h.value=u.value),o.value instanceof _t&&o.value.setDataValue(this.exec,h,i.postfix,t),null}AtomicAdd(e,t){let i=e.args[0];i instanceof xt&&(i=i.right);const s=this.exec.getVariableName(i,t),o=t.getVariable(s);let c=e.args[1];const u=this.exec.evalExpression(c,t),h=o.value.getSubData(this.exec,i.postfix,t),d=new P(h.value,h.typeInfo);return h instanceof P&&u instanceof P&&(h.value+=u.value),o.value instanceof _t&&o.value.setDataValue(this.exec,h,i.postfix,t),d}AtomicSub(e,t){let i=e.args[0];i instanceof xt&&(i=i.right);const s=this.exec.getVariableName(i,t),o=t.getVariable(s);let c=e.args[1];const u=this.exec.evalExpression(c,t),h=o.value.getSubData(this.exec,i.postfix,t),d=new P(h.value,h.typeInfo);return h instanceof P&&u instanceof P&&(h.value-=u.value),o.value instanceof _t&&o.value.setDataValue(this.exec,h,i.postfix,t),d}AtomicMax(e,t){let i=e.args[0];i instanceof xt&&(i=i.right);const s=this.exec.getVariableName(i,t),o=t.getVariable(s);let c=e.args[1];const u=this.exec.evalExpression(c,t),h=o.value.getSubData(this.exec,i.postfix,t),d=new P(h.value,h.typeInfo);return h instanceof P&&u instanceof P&&(h.value=Math.max(h.value,u.value)),o.value instanceof _t&&o.value.setDataValue(this.exec,h,i.postfix,t),d}AtomicMin(e,t){let i=e.args[0];i instanceof xt&&(i=i.right);const s=this.exec.getVariableName(i,t),o=t.getVariable(s);let c=e.args[1];const u=this.exec.evalExpression(c,t),h=o.value.getSubData(this.exec,i.postfix,t),d=new P(h.value,h.typeInfo);return h instanceof P&&u instanceof P&&(h.value=Math.min(h.value,u.value)),o.value instanceof _t&&o.value.setDataValue(this.exec,h,i.postfix,t),d}AtomicAnd(e,t){let i=e.args[0];i instanceof xt&&(i=i.right);const s=this.exec.getVariableName(i,t),o=t.getVariable(s);let c=e.args[1];const u=this.exec.evalExpression(c,t),h=o.value.getSubData(this.exec,i.postfix,t),d=new P(h.value,h.typeInfo);return h instanceof P&&u instanceof P&&(h.value=h.value&u.value),o.value instanceof _t&&o.value.setDataValue(this.exec,h,i.postfix,t),d}AtomicOr(e,t){let i=e.args[0];i instanceof xt&&(i=i.right);const s=this.exec.getVariableName(i,t),o=t.getVariable(s);let c=e.args[1];const u=this.exec.evalExpression(c,t),h=o.value.getSubData(this.exec,i.postfix,t),d=new P(h.value,h.typeInfo);return h instanceof P&&u instanceof P&&(h.value=h.value|u.value),o.value instanceof _t&&o.value.setDataValue(this.exec,h,i.postfix,t),d}AtomicXor(e,t){let i=e.args[0];i instanceof xt&&(i=i.right);const s=this.exec.getVariableName(i,t),o=t.getVariable(s);let c=e.args[1];const u=this.exec.evalExpression(c,t),h=o.value.getSubData(this.exec,i.postfix,t),d=new P(h.value,h.typeInfo);return h instanceof P&&u instanceof P&&(h.value=h.value^u.value),o.value instanceof _t&&o.value.setDataValue(this.exec,h,i.postfix,t),d}AtomicExchange(e,t){let i=e.args[0];i instanceof xt&&(i=i.right);const s=this.exec.getVariableName(i,t),o=t.getVariable(s);let c=e.args[1];const u=this.exec.evalExpression(c,t),h=o.value.getSubData(this.exec,i.postfix,t),d=new P(h.value,h.typeInfo);return h instanceof P&&u instanceof P&&(h.value=u.value),o.value instanceof _t&&o.value.setDataValue(this.exec,h,i.postfix,t),d}AtomicCompareExchangeWeak(e,t){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(e,t){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(e,t){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(e,t){return console.error("TODO: pack4xI8"),null}Pack4xU8(e,t){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(e,t){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(e,t){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(e,t){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(e,t){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(e,t){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(e,t){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(e,t){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(e,t){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(e,t){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(e,t){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(e,t){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(e,t){return console.error("TODO: unpack2x16float"),null}StorageBarrier(e,t){return null}TextureBarrier(e,t){return null}WorkgroupBarrier(e,t){return null}WorkgroupUniformLoad(e,t){return null}SubgroupAdd(e,t){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(e,t){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(e,t){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(e,t){return console.error("TODO: subgroupAll"),null}SubgroupAnd(e,t){return console.error("TODO: subgroupAnd"),null}SubgroupAny(e,t){return console.error("TODO: subgroupAny"),null}SubgroupBallot(e,t){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(e,t){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(e,t){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(e,t){return console.error("TODO: subgroupElect"),null}SubgroupMax(e,t){return console.error("TODO: subgroupMax"),null}SubgroupMin(e,t){return console.error("TODO: subgroupMin"),null}SubgroupMul(e,t){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(e,t){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(e,t){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(e,t){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(e,t){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(e,t){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(e,t){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(e,t){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(e,t){return console.error("TODO: subgroupXor"),null}QuadBroadcast(e,t){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(e,t){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(e,t){return console.error("TODO: quadSwapX"),null}QuadSwapY(e,t){return console.error("TODO: quadSwapY"),null}}const Ah={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},qt={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class Wt extends GE{constructor(e,t){var i;super(),this.ast=e??[],this.reflection=new Qn,this.reflection.updateAST(this.ast),this.context=(i=t?.clone())!==null&&i!==void 0?i:new Zd,this.builtins=new JE(this),this.typeInfo={bool:this.getTypeInfo(J.bool),i32:this.getTypeInfo(J.i32),u32:this.getTypeInfo(J.u32),f32:this.getTypeInfo(J.f32),f16:this.getTypeInfo(J.f16),vec2f:this.getTypeInfo(B.vec2f),vec2u:this.getTypeInfo(B.vec2u),vec2i:this.getTypeInfo(B.vec2i),vec2h:this.getTypeInfo(B.vec2h),vec3f:this.getTypeInfo(B.vec3f),vec3u:this.getTypeInfo(B.vec3u),vec3i:this.getTypeInfo(B.vec3i),vec3h:this.getTypeInfo(B.vec3h),vec4f:this.getTypeInfo(B.vec4f),vec4u:this.getTypeInfo(B.vec4u),vec4i:this.getTypeInfo(B.vec4i),vec4h:this.getTypeInfo(B.vec4h),mat2x2f:this.getTypeInfo(B.mat2x2f),mat2x3f:this.getTypeInfo(B.mat2x3f),mat2x4f:this.getTypeInfo(B.mat2x4f),mat3x2f:this.getTypeInfo(B.mat3x2f),mat3x3f:this.getTypeInfo(B.mat3x3f),mat3x4f:this.getTypeInfo(B.mat3x4f),mat4x2f:this.getTypeInfo(B.mat4x2f),mat4x3f:this.getTypeInfo(B.mat4x3f),mat4x4f:this.getTypeInfo(B.mat4x4f)}}getVariableValue(e){var t,i;const s=(i=(t=this.context.getVariable(e))===null||t===void 0?void 0:t.value)!==null&&i!==void 0?i:null;if(s===null)return null;if(s instanceof P)return s.value;if(s instanceof S||s instanceof Se)return Array.from(s.data);if(s instanceof _t&&s.typeInfo instanceof ts){if(s.typeInfo.format.name==="u32")return Array.from(new Uint32Array(s.buffer,s.offset,s.typeInfo.count));if(s.typeInfo.format.name==="i32")return Array.from(new Int32Array(s.buffer,s.offset,s.typeInfo.count));if(s.typeInfo.format.name==="f32")return Array.from(new Float32Array(s.buffer,s.offset,s.typeInfo.count))}return console.error(`Unsupported return variable type ${s.typeInfo.name}`),null}execute(e){(e=e??{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,t,i,s){const o=this.context.clone();(s=s??{}).constants&&this._setOverrides(s.constants,o),this._execStatements(this.ast,o);const c=o.getFunction(e);if(!c)return void console.error(`Function ${e} not found`);if(typeof t=="number")t=[t,1,1];else{if(t.length===0)return void console.error("Invalid dispatch count");t.length===1?t=[t[0],1,1]:t.length===2?t=[t[0],t[1],1]:t.length>3&&(t=[t[0],t[1],t[2]])}const u=t[0],h=t[1],d=t[2],g=this.getTypeInfo("vec3u");o.setVariable("@num_workgroups",new S(t,g));const m=this.reflection.getFunctionInfo(e);m===null&&console.error(`Function ${e} not found in reflection data`);for(const y in i)for(const T in i[y]){const w=i[y][T];o.variables.forEach(C=>{var N;const V=C.node;if(V?.attributes){let $=null,O=null;for(const F of V.attributes)F.name==="binding"?$=F.value:F.name==="group"&&(O=F.value);if(T==$&&y==O){let F=!1;for(const H of m.resources)if(H.name===C.name&&H.group===parseInt(y)&&H.binding===parseInt(T)){F=!0;break}if(F)if(w.texture!==void 0&&w.descriptor!==void 0){const H=new _i(w.texture,this.getTypeInfo(V.type),w.descriptor,(N=w.texture.view)!==null&&N!==void 0?N:null);C.value=H}else w.uniform!==void 0?C.value=new _t(w.uniform,this.getTypeInfo(V.type)):C.value=new _t(w,this.getTypeInfo(V.type))}}})}for(let y=0;y<d;++y)for(let T=0;T<h;++T)for(let w=0;w<u;++w)o.setVariable("@workgroup_id",new S([w,T,y],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(c,[w,T,y],o)}execStatement(e,t){if(e instanceof $0)return this.evalExpression(e.value,t);if(e instanceof Y0){if(e.condition){const i=this.evalExpression(e.condition,t);if(!(i instanceof P))throw new Error("Invalid break-if condition");if(!i.value)return null}return Wt._breakObj}if(e instanceof q0)return Wt._continueObj;if(e instanceof ho)this._let(e,t);else if(e instanceof mi)this._var(e,t);else if(e instanceof ic)this._const(e,t);else if(e instanceof bo)this._function(e,t);else{if(e instanceof W0)return this._if(e,t);if(e instanceof H0)return this._switch(e,t);if(e instanceof L0)return this._for(e,t);if(e instanceof F0)return this._while(e,t);if(e instanceof j0)return this._loop(e,t);if(e instanceof td){const i=t.clone();return i.currentFunctionName=t.currentFunctionName,this._execStatements(e.body,i)}if(e instanceof V0)this._assign(e,t);else if(e instanceof z0)this._increment(e,t);else{if(e instanceof gi)return null;if(e instanceof Hd){const i=e.name;t.getVariable(i)===null&&t.setVariable(i,new P(0,this.getTypeInfo("u32")))}else if(e instanceof Wd)this._call(e,t);else{if(e instanceof X0||e instanceof $d)return null;console.error("Invalid statement type.",e,`Line ${e.line}`)}}}return null}evalExpression(e,t){return e instanceof Un?this._evalBinaryOp(e,t):e instanceof Et?this._evalLiteral(e,t):e instanceof fn?this._evalVariable(e,t):e instanceof Xd?this._evalCall(e,t):e instanceof qn?this._evalCreate(e,t):e instanceof K0?this._evalConst(e,t):e instanceof Z0?this._evalBitcast(e,t):e instanceof xt?this._evalUnaryOp(e,t):(console.error("Invalid expression type",e,`Line ${e.line}`),null)}getTypeInfo(e){var t;if(e instanceof J){const s=this.reflection.getTypeInfo(e);if(s!==null)return s}let i=(t=this.typeInfo[e])!==null&&t!==void 0?t:null;return i!==null||(i=this.reflection.getTypeInfoByName(e)),i}_setOverrides(e,t){for(const i in e){const s=e[i],o=this.reflection.getOverrideInfo(i);o!==null?(o.type===null&&(o.type=this.getTypeInfo("u32")),o.type.name==="u32"||o.type.name==="i32"||o.type.name==="f32"||o.type.name==="f16"?t.setVariable(i,new P(s,o.type)):o.type.name==="bool"?t.setVariable(i,new P(s?1:0,o.type)):o.type.name==="vec2"||o.type.name==="vec3"||o.type.name==="vec4"||o.type.name==="vec2f"||o.type.name==="vec3f"||o.type.name==="vec4f"||o.type.name==="vec2i"||o.type.name==="vec3i"||o.type.name==="vec4i"||o.type.name==="vec2u"||o.type.name==="vec3u"||o.type.name==="vec4u"||o.type.name==="vec2h"||o.type.name==="vec3h"||o.type.name==="vec4h"?t.setVariable(i,new S(s,o.type)):console.error(`Invalid constant type for ${i}`)):console.error(`Override ${i} does not exist in the shader.`)}}_dispatchWorkgroup(e,t,i){const s=[1,1,1];for(const g of e.node.attributes)if(g.name==="workgroup_size"){if(g.value.length>0){const m=i.getVariableValue(g.value[0]);s[0]=m instanceof P?m.value:parseInt(g.value[0])}if(g.value.length>1){const m=i.getVariableValue(g.value[1]);s[1]=m instanceof P?m.value:parseInt(g.value[1])}if(g.value.length>2){const m=i.getVariableValue(g.value[2]);s[2]=m instanceof P?m.value:parseInt(g.value[2])}}const o=this.getTypeInfo("vec3u"),c=this.getTypeInfo("u32");i.setVariable("@workgroup_size",new S(s,o));const u=s[0],h=s[1],d=s[2];for(let g=0,m=0;g<d;++g)for(let y=0;y<h;++y)for(let T=0;T<u;++T,++m){const w=[T,y,g],C=[T+t[0]*s[0],y+t[1]*s[1],g+t[2]*s[2]];i.setVariable("@local_invocation_id",new S(w,o)),i.setVariable("@global_invocation_id",new S(C,o)),i.setVariable("@local_invocation_index",new P(m,c)),this._dispatchExec(e,i)}}_dispatchExec(e,t){for(const i of e.node.args)for(const s of i.attributes)if(s.name==="builtin"){const o=`@${s.value}`,c=t.getVariable(o);c!==void 0&&t.variables.set(i.name,c)}this._execStatements(e.node.body,t)}getVariableName(e,t){for(;e instanceof xt;)e=e.right;return e instanceof fn?e.name:(console.error("Unknown variable type",e,"Line",e.line),null)}_execStatements(e,t){for(const i of e){if(i instanceof Array){const o=t.clone(),c=this._execStatements(i,o);if(c)return c;continue}const s=this.execStatement(i,t);if(s)return s}return null}_call(e,t){const i=t.clone();i.currentFunctionName=e.name;const s=t.getFunction(e.name);if(s){for(let o=0;o<s.node.args.length;++o){const c=s.node.args[o],u=this.evalExpression(e.args[o],i);i.setVariable(c.name,u,c)}this._execStatements(s.node.body,i)}else e.isBuiltin?this._callBuiltinFunction(e,i):this.getTypeInfo(e.name)&&this._evalCreate(e,t)}_increment(e,t){const i=this.getVariableName(e.variable,t),s=t.getVariable(i);s?e.operator==="++"?s.value instanceof P?s.value.value++:console.error(`Variable ${i} is not a scalar. Line ${e.line}`):e.operator==="--"?s.value instanceof P?s.value.value--:console.error(`Variable ${i} is not a scalar. Line ${e.line}`):console.error(`Unknown increment operator ${e.operator}. Line ${e.line}`):console.error(`Variable ${i} not found. Line ${e.line}`)}_getVariableData(e,t){if(e instanceof fn){const i=this.getVariableName(e,t),s=t.getVariable(i);return s===null?(console.error(`Variable ${i} not found. Line ${e.line}`),null):s.value.getSubData(this,e.postfix,t)}if(e instanceof xt){if(e.operator==="*"){const i=this._getVariableData(e.right,t);return i instanceof Ir?i.reference.getSubData(this,e.postfix,t):(console.error(`Variable ${e.right} is not a pointer. Line ${e.line}`),null)}if(e.operator==="&"){const i=this._getVariableData(e.right,t);return new Ir(i)}}return null}_assign(e,t){let i=null,s="<var>",o=null;if(e.variable instanceof xt){const h=this._getVariableData(e.variable,t),d=this.evalExpression(e.value,t),g=e.operator;if(g==="="){if(h instanceof P||h instanceof S||h instanceof Se){if(d instanceof P||d instanceof S||d instanceof Se&&h.data.length===d.data.length)return void h.data.set(d.data);console.error(`Invalid assignment. Line ${e.line}`)}else if(h instanceof _t&&d instanceof _t&&h.buffer.byteLength-h.offset>=d.buffer.byteLength-d.offset)return void(h.buffer.byteLength%4==0?new Uint32Array(h.buffer,h.offset,h.typeInfo.size/4).set(new Uint32Array(d.buffer,d.offset,d.typeInfo.size/4)):new Uint8Array(h.buffer,h.offset,h.typeInfo.size).set(new Uint8Array(d.buffer,d.offset,d.typeInfo.size)));return console.error(`Invalid assignment. Line ${e.line}`),null}if(g==="+=")return h instanceof P||h instanceof S||h instanceof Se?d instanceof P||d instanceof S||d instanceof Se?void h.data.set(d.data.map((m,y)=>h.data[y]+m)):void console.error(`Invalid assignment . Line ${e.line}`):void console.error(`Invalid assignment. Line ${e.line}`);if(g==="-=")return(h instanceof P||h instanceof S||h instanceof Se)&&(d instanceof P||d instanceof S||d instanceof Se)?void h.data.set(d.data.map((m,y)=>h.data[y]-m)):void console.error(`Invalid assignment. Line ${e.line}`)}if(e.variable instanceof xt){if(e.variable.operator==="*"){s=this.getVariableName(e.variable.right,t);const h=t.getVariable(s);if(!(h&&h.value instanceof Ir))return void console.error(`Variable ${s} is not a pointer. Line ${e.line}`);i=h.value.reference;let d=e.variable.postfix;if(!d){let g=e.variable.right;for(;g instanceof xt;){if(g.postfix){d=g.postfix;break}g=g.right}}d&&(i=i.getSubData(this,d,t))}}else{o=e.variable.postfix,s=this.getVariableName(e.variable,t);const h=t.getVariable(s);if(h===null)return void console.error(`Variable ${s} not found. Line ${e.line}`);i=h.value}if(i instanceof Ir&&(i=i.reference),i===null)return void console.error(`Variable ${s} not found. Line ${e.line}`);const c=this.evalExpression(e.value,t),u=e.operator;if(u!=="="){const h=i.getSubData(this,o,t);if(h instanceof S&&c instanceof P){const d=h.data,g=c.value;if(u==="+=")for(let m=0;m<d.length;++m)d[m]+=g;else if(u==="-=")for(let m=0;m<d.length;++m)d[m]-=g;else if(u==="*=")for(let m=0;m<d.length;++m)d[m]*=g;else if(u==="/=")for(let m=0;m<d.length;++m)d[m]/=g;else if(u==="%=")for(let m=0;m<d.length;++m)d[m]%=g;else if(u==="&=")for(let m=0;m<d.length;++m)d[m]&=g;else if(u==="|=")for(let m=0;m<d.length;++m)d[m]|=g;else if(u==="^=")for(let m=0;m<d.length;++m)d[m]^=g;else if(u==="<<=")for(let m=0;m<d.length;++m)d[m]<<=g;else if(u===">>=")for(let m=0;m<d.length;++m)d[m]>>=g;else console.error(`Invalid operator ${u}. Line ${e.line}`)}else if(h instanceof S&&c instanceof S){const d=h.data,g=c.data;if(d.length!==g.length)return void console.error(`Vector length mismatch. Line ${e.line}`);if(u==="+=")for(let m=0;m<d.length;++m)d[m]+=g[m];else if(u==="-=")for(let m=0;m<d.length;++m)d[m]-=g[m];else if(u==="*=")for(let m=0;m<d.length;++m)d[m]*=g[m];else if(u==="/=")for(let m=0;m<d.length;++m)d[m]/=g[m];else if(u==="%=")for(let m=0;m<d.length;++m)d[m]%=g[m];else if(u==="&=")for(let m=0;m<d.length;++m)d[m]&=g[m];else if(u==="|=")for(let m=0;m<d.length;++m)d[m]|=g[m];else if(u==="^=")for(let m=0;m<d.length;++m)d[m]^=g[m];else if(u==="<<=")for(let m=0;m<d.length;++m)d[m]<<=g[m];else if(u===">>=")for(let m=0;m<d.length;++m)d[m]>>=g[m];else console.error(`Invalid operator ${u}. Line ${e.line}`)}else{if(!(h instanceof P&&c instanceof P))return void console.error(`Invalid type for ${e.operator} operator. Line ${e.line}`);u==="+="?h.value+=c.value:u==="-="?h.value-=c.value:u==="*="?h.value*=c.value:u==="/="?h.value/=c.value:u==="%="?h.value%=c.value:u==="&="?h.value&=c.value:u==="|="?h.value|=c.value:u==="^="?h.value^=c.value:u==="<<="?h.value<<=c.value:u===">>="?h.value>>=c.value:console.error(`Invalid operator ${u}. Line ${e.line}`)}return void(i instanceof _t&&i.setDataValue(this,h,o,t))}if(i instanceof _t)i.setDataValue(this,c,o,t);else if(o){if(!(i instanceof S||i instanceof Se))return void console.error(`Variable ${s} is not a vector or matrix. Line ${e.line}`);if(o instanceof Xr){const h=this.evalExpression(o.index,t).value;if(i instanceof S){if(!(c instanceof P))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[h]=c.value}else{if(!(i instanceof Se))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);{const d=this.evalExpression(o.index,t).value;if(d<0)return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);if(!(c instanceof S))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);{const g=i.typeInfo.getTypeName();if(g==="mat2x2"||g==="mat2x2f"||g==="mat2x2h"){if(!(d<2&&c.data.length===2))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[2*d]=c.data[0],i.data[2*d+1]=c.data[1]}else if(g==="mat2x3"||g==="mat2x3f"||g==="mat2x3h"){if(!(d<2&&c.data.length===3))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[3*d]=c.data[0],i.data[3*d+1]=c.data[1],i.data[3*d+2]=c.data[2]}else if(g==="mat2x4"||g==="mat2x4f"||g==="mat2x4h"){if(!(d<2&&c.data.length===4))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[4*d]=c.data[0],i.data[4*d+1]=c.data[1],i.data[4*d+2]=c.data[2],i.data[4*d+3]=c.data[3]}else if(g==="mat3x2"||g==="mat3x2f"||g==="mat3x2h"){if(!(d<3&&c.data.length===2))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[2*d]=c.data[0],i.data[2*d+1]=c.data[1]}else if(g==="mat3x3"||g==="mat3x3f"||g==="mat3x3h"){if(!(d<3&&c.data.length===3))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[3*d]=c.data[0],i.data[3*d+1]=c.data[1],i.data[3*d+2]=c.data[2]}else if(g==="mat3x4"||g==="mat3x4f"||g==="mat3x4h"){if(!(d<3&&c.data.length===4))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[4*d]=c.data[0],i.data[4*d+1]=c.data[1],i.data[4*d+2]=c.data[2],i.data[4*d+3]=c.data[3]}else if(g==="mat4x2"||g==="mat4x2f"||g==="mat4x2h"){if(!(d<4&&c.data.length===2))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[2*d]=c.data[0],i.data[2*d+1]=c.data[1]}else if(g==="mat4x3"||g==="mat4x3f"||g==="mat4x3h"){if(!(d<4&&c.data.length===3))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[3*d]=c.data[0],i.data[3*d+1]=c.data[1],i.data[3*d+2]=c.data[2]}else{if(g!=="mat4x4"&&g!=="mat4x4f"&&g!=="mat4x4h")return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);if(!(d<4&&c.data.length===4))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);i.data[4*d]=c.data[0],i.data[4*d+1]=c.data[1],i.data[4*d+2]=c.data[2],i.data[4*d+3]=c.data[3]}}}}}else if(o instanceof Ds){const h=o.value;if(!(i instanceof S))return void console.error(`Invalid assignment to ${h}. Variable ${s} is not a vector. Line ${e.line}`);if(c instanceof P){if(h.length>1)return void console.error(`Invalid assignment to ${h} for variable ${s}. Line ${e.line}`);if(h==="x")i.data[0]=c.value;else if(h==="y"){if(i.data.length<2)return void console.error(`Invalid assignment to ${h} for variable ${s}. Line ${e.line}`);i.data[1]=c.value}else if(h==="z"){if(i.data.length<3)return void console.error(`Invalid assignment to ${h} for variable ${s}. Line ${e.line}`);i.data[2]=c.value}else if(h==="w"){if(i.data.length<4)return void console.error(`Invalid assignment to ${h} for variable ${s}. Line ${e.line}`);i.data[3]=c.value}}else{if(!(c instanceof S))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);if(h.length!==c.data.length)return void console.error(`Invalid assignment to ${h} for variable ${s}. Line ${e.line}`);for(let d=0;d<h.length;++d){const g=h[d];if(g==="x"||g==="r")i.data[0]=c.data[d];else if(g==="y"||g==="g"){if(c.data.length<2)return void console.error(`Invalid assignment to ${g} for variable ${s}. Line ${e.line}`);i.data[1]=c.data[d]}else if(g==="z"||g==="b"){if(c.data.length<3)return void console.error(`Invalid assignment to ${g} for variable ${s}. Line ${e.line}`);i.data[2]=c.data[d]}else{if(g!=="w"&&g!=="a")return void console.error(`Invalid assignment to ${g} for variable ${s}. Line ${e.line}`);if(c.data.length<4)return void console.error(`Invalid assignment to ${g} for variable ${s}. Line ${e.line}`);i.data[3]=c.data[d]}}}}}else i instanceof P&&c instanceof P?i.value=c.value:i instanceof S&&c instanceof S||i instanceof Se&&c instanceof Se?i.data.set(c.data):console.error(`Invalid assignment to ${s}. Line ${e.line}`)}_function(e,t){const i=new Kd(e);t.functions.set(e.name,i)}_const(e,t){let i=null;e.value!==null&&(i=this.evalExpression(e.value,t)),t.createVariable(e.name,i,e)}_let(e,t){let i=null;if(e.value!==null){if(i=this.evalExpression(e.value,t),i===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof xt||(i=i.clone())}else{const s=e.type.name;if(s==="f32"||s==="i32"||s==="u32"||s==="bool"||s==="f16"||s==="vec2"||s==="vec3"||s==="vec4"||s==="vec2f"||s==="vec3f"||s==="vec4f"||s==="vec2i"||s==="vec3i"||s==="vec4i"||s==="vec2u"||s==="vec3u"||s==="vec4u"||s==="vec2h"||s==="vec3h"||s==="vec4h"||s==="vec2b"||s==="vec3b"||s==="vec4b"||s==="mat2x2"||s==="mat2x3"||s==="mat2x4"||s==="mat3x2"||s==="mat3x3"||s==="mat3x4"||s==="mat4x2"||s==="mat4x3"||s==="mat4x4"||s==="mat2x2f"||s==="mat2x3f"||s==="mat2x4f"||s==="mat3x2f"||s==="mat3x3f"||s==="mat3x4f"||s==="mat4x2f"||s==="mat4x3f"||s==="mat4x4f"||s==="mat2x2h"||s==="mat2x3h"||s==="mat2x4h"||s==="mat3x2h"||s==="mat3x3h"||s==="mat3x4h"||s==="mat4x2h"||s==="mat4x3h"||s==="mat4x4h"||s==="array"){const o=new qn(e.type,[]);i=this._evalCreate(o,t)}}t.createVariable(e.name,i,e)}_var(e,t){let i=null;if(e.value!==null){if(i=this.evalExpression(e.value,t),i===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof xt||(i=i.clone())}else{if(e.type===null)return void console.error(`Variable ${e.name} has no type. Line ${e.line}`);const s=e.type.name;if(s==="f32"||s==="i32"||s==="u32"||s==="bool"||s==="f16"||s==="vec2"||s==="vec3"||s==="vec4"||s==="vec2f"||s==="vec3f"||s==="vec4f"||s==="vec2i"||s==="vec3i"||s==="vec4i"||s==="vec2u"||s==="vec3u"||s==="vec4u"||s==="vec2h"||s==="vec3h"||s==="vec4h"||s==="vec2b"||s==="vec3b"||s==="vec4b"||s==="mat2x2"||s==="mat2x3"||s==="mat2x4"||s==="mat3x2"||s==="mat3x3"||s==="mat3x4"||s==="mat4x2"||s==="mat4x3"||s==="mat4x4"||s==="mat2x2f"||s==="mat2x3f"||s==="mat2x4f"||s==="mat3x2f"||s==="mat3x3f"||s==="mat3x4f"||s==="mat4x2f"||s==="mat4x3f"||s==="mat4x4f"||s==="mat2x2h"||s==="mat2x3h"||s==="mat2x4h"||s==="mat3x2h"||s==="mat3x3h"||s==="mat3x4h"||s==="mat4x2h"||s==="mat4x3h"||s==="mat4x4h"||e.type instanceof po||e.type instanceof gi||e.type instanceof B){const o=new qn(e.type,[]);i=this._evalCreate(o,t)}}t.createVariable(e.name,i,e)}_switch(e,t){t=t.clone();const i=this.evalExpression(e.condition,t);if(!(i instanceof P))return console.error(`Invalid if condition. Line ${e.line}`),null;let s=null;for(const o of e.cases)if(o instanceof J0)for(const c of o.selectors){if(c instanceof rc){s=o;continue}const u=this.evalExpression(c,t);if(!(u instanceof P))return console.error(`Invalid case selector. Line ${e.line}`),null;if(u.value===i.value)return this._execStatements(o.body,t)}else o instanceof e3&&(s=o);return s?this._execStatements(s.body,t):null}_if(e,t){t=t.clone();const i=this.evalExpression(e.condition,t);if(!(i instanceof P))return console.error(`Invalid if condition. Line ${e.line}`),null;if(i.value)return this._execStatements(e.body,t);for(const s of e.elseif){const o=this.evalExpression(s.condition,t);if(!(o instanceof P))return console.error(`Invalid if condition. Line ${e.line}`),null;if(o.value)return this._execStatements(s.body,t)}return e.else?this._execStatements(e.else,t):null}_getScalarValue(e){return e instanceof P?e.value:(console.error("Expected scalar value.",e),0)}_for(e,t){for(t=t.clone(),this.execStatement(e.init,t);this._getScalarValue(this.evalExpression(e.condition,t));){const i=this._execStatements(e.body,t);if(i===Wt._breakObj)break;if(i!==null&&i!==Wt._continueObj)return i;this.execStatement(e.increment,t)}return null}_loop(e,t){for(t=t.clone();;){const i=this._execStatements(e.body,t);if(i===Wt._breakObj)break;if(i===Wt._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,t)===Wt._breakObj)break}else if(i!==null)return i}return null}_while(e,t){for(t=t.clone();this._getScalarValue(this.evalExpression(e.condition,t));){const i=this._execStatements(e.body,t);if(i===Wt._breakObj)break;if(i!==Wt._continueObj&&i!==null)return i}return null}_evalBitcast(e,t){const i=this.evalExpression(e.value,t),s=e.type;if(i instanceof P){const o=_b(i.value,i.typeInfo.name,s.name);return new P(o,this.getTypeInfo(s))}if(i instanceof S){const o=i.typeInfo.getTypeName();let c="";if(o.endsWith("f"))c="f32";else if(o.endsWith("i"))c="i32";else if(o.endsWith("u"))c="u32";else if(o.endsWith("b"))c="bool";else{if(!o.endsWith("h"))return console.error(`Unknown vector type ${o}. Line ${e.line}`),null;c="f16"}const u=s.getTypeName();let h="";if(u.endsWith("f"))h="f32";else if(u.endsWith("i"))h="i32";else if(u.endsWith("u"))h="u32";else if(u.endsWith("b"))h="bool";else{if(!u.endsWith("h"))return console.error(`Unknown vector type ${h}. Line ${e.line}`),null;h="f16"}const d=(function(g,m,y){if(m===y)return g;const T=new Array(g.length);for(let w=0;w<g.length;w++)T[w]=_b(g[w],m,y);return T})(Array.from(i.data),c,h);return new S(d,this.getTypeInfo(s))}return console.error(`TODO: bitcast for ${i.typeInfo.name}. Line ${e.line}`),null}_evalConst(e,t){return t.getVariableValue(e.name).clone().getSubData(this,e.postfix,t)}_evalCreate(e,t){var i;if(e instanceof qn){if(e.type===null)return nd.void;switch(e.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,t);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,t);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,t)}}const s=e instanceof qn?e.type.name:e.name,o=e instanceof qn?this.getTypeInfo(e.type):this.getTypeInfo(e.name);if(o===null)return console.error(`Unknown type ${s}. Line ${e.line}`),null;if(o.size===0)return null;const c=new _t(new ArrayBuffer(o.size),o,0);if(o instanceof Qi){if(e.args)for(let u=0;u<e.args.length;++u){const h=o.members[u],d=e.args[u],g=this.evalExpression(d,t);c.setData(this,g,h.type,h.offset,t)}}else if(o instanceof ts){let u=0;if(e.args)for(let h=0;h<e.args.length;++h){const d=e.args[h],g=this.evalExpression(d,t);o.format===null&&(((i=g.typeInfo)===null||i===void 0?void 0:i.name)==="x32"?o.format=this.getTypeInfo("i32"):o.format=g.typeInfo),c.setData(this,g,o.format,u,t),u+=o.stride}}else console.error(`Unknown type "${s}". Line ${e.line}`);return e instanceof qn?c.getSubData(this,e.postfix,t):c}_evalLiteral(e,t){const i=this.getTypeInfo(e.type),s=i.name;return s==="x32"||s==="u32"||s==="f32"||s==="f16"||s==="i32"||s==="bool"?new P(e.scalarValue,i):s==="vec2"||s==="vec3"||s==="vec4"||s==="vec2f"||s==="vec3f"||s==="vec4f"||s==="vec2h"||s==="vec3h"||s==="vec4h"||s==="vec2i"||s==="vec3i"||s==="vec4i"||s==="vec2u"||s==="vec3u"||s==="vec4u"?this._callConstructorVec(e,t):s==="mat2x2"||s==="mat2x3"||s==="mat2x4"||s==="mat3x2"||s==="mat3x3"||s==="mat3x4"||s==="mat4x2"||s==="mat4x3"||s==="mat4x4"||s==="mat2x2f"||s==="mat2x3f"||s==="mat2x4f"||s==="mat3x2f"||s==="mat3x3f"||s==="mat3x4f"||s==="mat4x2f"||s==="mat4x3f"||s==="mat4x4f"||s==="mat2x2h"||s==="mat2x3h"||s==="mat2x4h"||s==="mat3x2h"||s==="mat3x3h"||s==="mat3x4h"||s==="mat4x2h"||s==="mat4x3h"||s==="mat4x4h"?this._callConstructorMatrix(e,t):e.value}_evalVariable(e,t){const i=t.getVariableValue(e.name);return i===null?i:i.getSubData(this,e.postfix,t)}_maxFormatTypeInfo(e){let t=e[0];if(t.name==="f32")return t;for(let i=1;i<e.length;++i){const s=Wt._priority.get(t.name);Wt._priority.get(e[i].name)<s&&(t=e[i])}return t.name==="x32"?this.getTypeInfo("i32"):t}_evalUnaryOp(e,t){const i=this.evalExpression(e.right,t);if(e.operator==="&")return new Ir(i);if(e.operator==="*")return i instanceof Ir?i.reference.getSubData(this,e.postfix,t):(console.error(`Invalid dereference. Line ${e.line}`),null);const s=i instanceof P?i.value:i instanceof S?Array.from(i.data):null;switch(e.operator){case"+":{if(ue(s)){const u=s.map((h,d)=>+h);return new S(u,i.typeInfo)}const o=s,c=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new P(+o,c)}case"-":{if(ue(s)){const u=s.map((h,d)=>-h);return new S(u,i.typeInfo)}const o=s,c=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new P(-o,c)}case"!":{if(ue(s)){const u=s.map((h,d)=>h?0:1);return new S(u,i.typeInfo)}const o=s,c=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new P(o?0:1,c)}case"~":{if(ue(s)){const u=s.map((h,d)=>~h);return new S(u,i.typeInfo)}const o=s,c=this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]);return new P(~o,c)}}return console.error(`Invalid unary operator ${e.operator}. Line ${e.line}`),null}_evalBinaryOp(e,t){const i=this.evalExpression(e.left,t),s=this.evalExpression(e.right,t),o=i instanceof P?i.value:i instanceof S||i instanceof Se?Array.from(i.data):null,c=s instanceof P?s.value:s instanceof S||s instanceof Se?Array.from(s.data):null;switch(e.operator){case"+":{if(ue(o)&&ue(c)){const g=o,m=c;if(g.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=g.map((T,w)=>T+m[w]);return new S(y,i.typeInfo)}if(ue(o)){const g=c,m=o.map((y,T)=>y+g);return new S(m,i.typeInfo)}if(ue(c)){const g=o,m=c.map((y,T)=>g+y);return new S(m,s.typeInfo)}const u=o,h=c,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new P(u+h,d)}case"-":{if(ue(o)&&ue(c)){const g=o,m=c;if(g.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=g.map((T,w)=>T-m[w]);return new S(y,i.typeInfo)}if(ue(o)){const g=c,m=o.map((y,T)=>y-g);return new S(m,i.typeInfo)}if(ue(c)){const g=o,m=c.map((y,T)=>g-y);return new S(m,s.typeInfo)}const u=o,h=c,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new P(u-h,d)}case"*":{if(ue(o)&&ue(c)){const g=o,m=c;if(i instanceof Se&&s instanceof Se){const y=(function(N,V,$,O){if(qt[V.name]===void 0||qt[O.name]===void 0)return null;const F=qt[V.name][0],H=qt[V.name][1],te=qt[O.name][0];if(F!==qt[O.name][1])return null;const oe=new Array(te*H);for(let E=0;E<H;E++)for(let R=0;R<te;R++){let Y=0;for(let ie=0;ie<F;ie++)Y+=N[ie*H+E]*$[R*F+ie];oe[E*te+R]=Y}return oe})(g,i.typeInfo,m,s.typeInfo);if(y===null)return console.error(`Matrix multiplication failed. Line ${e.line}.`),null;const T=qt[s.typeInfo.name][0],w=qt[i.typeInfo.name][1],C=this.getTypeInfo(`mat${T}x${w}f`);return new Se(y,C)}if(i instanceof Se&&s instanceof S){const y=(function(T,w,C,N){if(qt[w.name]===void 0||Ah[N.name]===void 0)return null;const V=qt[w.name][0],$=qt[w.name][1];if(V!==C.length)return null;const O=new Array($);for(let F=0;F<$;F++){let H=0;for(let te=0;te<V;te++)H+=T[te*$+F]*C[te];O[F]=H}return O})(g,i.typeInfo,m,s.typeInfo);return y===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new S(y,s.typeInfo)}if(i instanceof S&&s instanceof Se){const y=(function(T,w,C,N){if(Ah[w.name]===void 0||qt[N.name]===void 0)return null;const V=qt[N.name][0],$=qt[N.name][1];if($!==T.length)return null;const O=[];for(let F=0;F<V;F++){let H=0;for(let te=0;te<$;te++)H+=T[te]*C[te*V+F];O[F]=H}return O})(g,i.typeInfo,m,s.typeInfo);return y===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new S(y,i.typeInfo)}{if(g.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=g.map((T,w)=>T*m[w]);return new S(y,i.typeInfo)}}if(ue(o)){const g=c,m=o.map((y,T)=>y*g);return i instanceof Se?new Se(m,i.typeInfo):new S(m,i.typeInfo)}if(ue(c)){const g=o,m=c.map((y,T)=>g*y);return s instanceof Se?new Se(m,s.typeInfo):new S(m,s.typeInfo)}const u=o,h=c,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new P(u*h,d)}case"%":{if(ue(o)&&ue(c)){const g=o,m=c;if(g.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=g.map((T,w)=>T%m[w]);return new S(y,i.typeInfo)}if(ue(o)){const g=c,m=o.map((y,T)=>y%g);return new S(m,i.typeInfo)}if(ue(c)){const g=o,m=c.map((y,T)=>g%y);return new S(m,s.typeInfo)}const u=o,h=c,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new P(u%h,d)}case"/":{if(ue(o)&&ue(c)){const g=o,m=c;if(g.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=g.map((T,w)=>T/m[w]);return new S(y,i.typeInfo)}if(ue(o)){const g=c,m=o.map((y,T)=>y/g);return new S(m,i.typeInfo)}if(ue(c)){const g=o,m=c.map((y,T)=>g/y);return new S(m,s.typeInfo)}const u=o,h=c,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new P(u/h,d)}case"&":{if(ue(o)&&ue(c)){const g=o,m=c;if(g.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=g.map((T,w)=>T&m[w]);return new S(y,i.typeInfo)}if(ue(o)){const g=c,m=o.map((y,T)=>y&g);return new S(m,i.typeInfo)}if(ue(c)){const g=o,m=c.map((y,T)=>g&y);return new S(m,s.typeInfo)}const u=o,h=c,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new P(u&h,d)}case"|":{if(ue(o)&&ue(c)){const g=o,m=c;if(g.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=g.map((T,w)=>T|m[w]);return new S(y,i.typeInfo)}if(ue(o)){const g=c,m=o.map((y,T)=>y|g);return new S(m,i.typeInfo)}if(ue(c)){const g=o,m=c.map((y,T)=>g|y);return new S(m,s.typeInfo)}const u=o,h=c,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new P(u|h,d)}case"^":{if(ue(o)&&ue(c)){const g=o,m=c;if(g.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=g.map((T,w)=>T^m[w]);return new S(y,i.typeInfo)}if(ue(o)){const g=c,m=o.map((y,T)=>y^g);return new S(m,i.typeInfo)}if(ue(c)){const g=o,m=c.map((y,T)=>g^y);return new S(m,s.typeInfo)}const u=o,h=c,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new P(u^h,d)}case"<<":{if(ue(o)&&ue(c)){const g=o,m=c;if(g.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=g.map((T,w)=>T<<m[w]);return new S(y,i.typeInfo)}if(ue(o)){const g=c,m=o.map((y,T)=>y<<g);return new S(m,i.typeInfo)}if(ue(c)){const g=o,m=c.map((y,T)=>g<<y);return new S(m,s.typeInfo)}const u=o,h=c,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new P(u<<h,d)}case">>":{if(ue(o)&&ue(c)){const g=o,m=c;if(g.length!==m.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=g.map((T,w)=>T>>m[w]);return new S(y,i.typeInfo)}if(ue(o)){const g=c,m=o.map((y,T)=>y>>g);return new S(m,i.typeInfo)}if(ue(c)){const g=o,m=c.map((y,T)=>g>>y);return new S(m,s.typeInfo)}const u=o,h=c,d=this._maxFormatTypeInfo([i.typeInfo,s.typeInfo]);return new P(u>>h,d)}case">":if(ue(o)&&ue(c)){const u=o,h=c;if(u.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=u.map((g,m)=>g>h[m]?1:0);return new S(d,i.typeInfo)}if(ue(o)){const u=c,h=o.map((d,g)=>d>u?1:0);return new S(h,i.typeInfo)}if(ue(c)){const u=o,h=c.map((d,g)=>u>d?1:0);return new S(h,s.typeInfo)}return new P(o>c?1:0,this.getTypeInfo("bool"));case"<":if(ue(o)&&ue(c)){const u=o,h=c;if(u.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=u.map((g,m)=>g<h[m]?1:0);return new S(d,i.typeInfo)}if(ue(o)){const u=c,h=o.map((d,g)=>d<u?1:0);return new S(h,i.typeInfo)}if(ue(c)){const u=o,h=c.map((d,g)=>u<d?1:0);return new S(h,s.typeInfo)}return new P(o<c?1:0,this.getTypeInfo("bool"));case"==":if(ue(o)&&ue(c)){const u=o,h=c;if(u.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=u.map((g,m)=>g===h[m]?1:0);return new S(d,i.typeInfo)}if(ue(o)){const u=c,h=o.map((d,g)=>d==u?1:0);return new S(h,i.typeInfo)}if(ue(c)){const u=o,h=c.map((d,g)=>u==d?1:0);return new S(h,s.typeInfo)}return new P(o===c?1:0,this.getTypeInfo("bool"));case"!=":if(ue(o)&&ue(c)){const u=o,h=c;if(u.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=u.map((g,m)=>g!==h[m]?1:0);return new S(d,i.typeInfo)}if(ue(o)){const u=c,h=o.map((d,g)=>d!==u?1:0);return new S(h,i.typeInfo)}if(ue(c)){const u=o,h=c.map((d,g)=>u!==d?1:0);return new S(h,s.typeInfo)}return new P(o!==c?1:0,this.getTypeInfo("bool"));case">=":if(ue(o)&&ue(c)){const u=o,h=c;if(u.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=u.map((g,m)=>g>=h[m]?1:0);return new S(d,i.typeInfo)}if(ue(o)){const u=c,h=o.map((d,g)=>d>=u?1:0);return new S(h,i.typeInfo)}if(ue(c)){const u=o,h=c.map((d,g)=>u>=d?1:0);return new S(h,s.typeInfo)}return new P(o>=c?1:0,this.getTypeInfo("bool"));case"<=":if(ue(o)&&ue(c)){const u=o,h=c;if(u.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=u.map((g,m)=>g<=h[m]?1:0);return new S(d,i.typeInfo)}if(ue(o)){const u=c,h=o.map((d,g)=>d<=u?1:0);return new S(h,i.typeInfo)}if(ue(c)){const u=o,h=c.map((d,g)=>u<=d?1:0);return new S(h,s.typeInfo)}return new P(o<=c?1:0,this.getTypeInfo("bool"));case"&&":if(ue(o)&&ue(c)){const u=o,h=c;if(u.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=u.map((g,m)=>g&&h[m]?1:0);return new S(d,i.typeInfo)}if(ue(o)){const u=c,h=o.map((d,g)=>d&&u?1:0);return new S(h,i.typeInfo)}if(ue(c)){const u=o,h=c.map((d,g)=>u&&d?1:0);return new S(h,s.typeInfo)}return new P(o&&c?1:0,this.getTypeInfo("bool"));case"||":if(ue(o)&&ue(c)){const u=o,h=c;if(u.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const d=u.map((g,m)=>g||h[m]?1:0);return new S(d,i.typeInfo)}if(ue(o)){const u=c,h=o.map((d,g)=>d||u?1:0);return new S(h,i.typeInfo)}if(ue(c)){const u=o,h=c.map((d,g)=>u||d?1:0);return new S(h,s.typeInfo)}return new P(o||c?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${e.operator}. Line ${e.line}`),null}_evalCall(e,t){if(e.cachedReturnValue!==null)return e.cachedReturnValue;const i=t.clone();i.currentFunctionName=e.name;const s=t.getFunction(e.name);if(!s)return e.isBuiltin?this._callBuiltinFunction(e,i):this.getTypeInfo(e.name)?this._evalCreate(e,t):(console.error(`Unknown function "${e.name}". Line ${e.line}`),null);for(let o=0;o<s.node.args.length;++o){const c=s.node.args[o],u=this.evalExpression(e.args[o],i);i.createVariable(c.name,u,c)}return this._execStatements(s.node.body,i)}_callBuiltinFunction(e,t){switch(e.name){case"all":return this.builtins.All(e,t);case"any":return this.builtins.Any(e,t);case"select":return this.builtins.Select(e,t);case"arrayLength":return this.builtins.ArrayLength(e,t);case"abs":return this.builtins.Abs(e,t);case"acos":return this.builtins.Acos(e,t);case"acosh":return this.builtins.Acosh(e,t);case"asin":return this.builtins.Asin(e,t);case"asinh":return this.builtins.Asinh(e,t);case"atan":return this.builtins.Atan(e,t);case"atanh":return this.builtins.Atanh(e,t);case"atan2":return this.builtins.Atan2(e,t);case"ceil":return this.builtins.Ceil(e,t);case"clamp":return this.builtins.Clamp(e,t);case"cos":return this.builtins.Cos(e,t);case"cosh":return this.builtins.Cosh(e,t);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,t);case"countOneBits":return this.builtins.CountOneBits(e,t);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,t);case"cross":return this.builtins.Cross(e,t);case"degrees":return this.builtins.Degrees(e,t);case"determinant":return this.builtins.Determinant(e,t);case"distance":return this.builtins.Distance(e,t);case"dot":return this.builtins.Dot(e,t);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,t);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,t);case"exp":return this.builtins.Exp(e,t);case"exp2":return this.builtins.Exp2(e,t);case"extractBits":return this.builtins.ExtractBits(e,t);case"faceForward":return this.builtins.FaceForward(e,t);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,t);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,t);case"floor":return this.builtins.Floor(e,t);case"fma":return this.builtins.Fma(e,t);case"fract":return this.builtins.Fract(e,t);case"frexp":return this.builtins.Frexp(e,t);case"insertBits":return this.builtins.InsertBits(e,t);case"inverseSqrt":return this.builtins.InverseSqrt(e,t);case"ldexp":return this.builtins.Ldexp(e,t);case"length":return this.builtins.Length(e,t);case"log":return this.builtins.Log(e,t);case"log2":return this.builtins.Log2(e,t);case"max":return this.builtins.Max(e,t);case"min":return this.builtins.Min(e,t);case"mix":return this.builtins.Mix(e,t);case"modf":return this.builtins.Modf(e,t);case"normalize":return this.builtins.Normalize(e,t);case"pow":return this.builtins.Pow(e,t);case"quantizeToF16":return this.builtins.QuantizeToF16(e,t);case"radians":return this.builtins.Radians(e,t);case"reflect":return this.builtins.Reflect(e,t);case"refract":return this.builtins.Refract(e,t);case"reverseBits":return this.builtins.ReverseBits(e,t);case"round":return this.builtins.Round(e,t);case"saturate":return this.builtins.Saturate(e,t);case"sign":return this.builtins.Sign(e,t);case"sin":return this.builtins.Sin(e,t);case"sinh":return this.builtins.Sinh(e,t);case"smoothstep":return this.builtins.SmoothStep(e,t);case"sqrt":return this.builtins.Sqrt(e,t);case"step":return this.builtins.Step(e,t);case"tan":return this.builtins.Tan(e,t);case"tanh":return this.builtins.Tanh(e,t);case"transpose":return this.builtins.Transpose(e,t);case"trunc":return this.builtins.Trunc(e,t);case"dpdx":return this.builtins.Dpdx(e,t);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,t);case"dpdxFine":return this.builtins.DpdxFine(e,t);case"dpdy":return this.builtins.Dpdy(e,t);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,t);case"dpdyFine":return this.builtins.DpdyFine(e,t);case"fwidth":return this.builtins.Fwidth(e,t);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,t);case"fwidthFine":return this.builtins.FwidthFine(e,t);case"textureDimensions":return this.builtins.TextureDimensions(e,t);case"textureGather":return this.builtins.TextureGather(e,t);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,t);case"textureLoad":return this.builtins.TextureLoad(e,t);case"textureNumLayers":return this.builtins.TextureNumLayers(e,t);case"textureNumLevels":return this.builtins.TextureNumLevels(e,t);case"textureNumSamples":return this.builtins.TextureNumSamples(e,t);case"textureSample":return this.builtins.TextureSample(e,t);case"textureSampleBias":return this.builtins.TextureSampleBias(e,t);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,t);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,t);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,t);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,t);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,t);case"textureStore":return this.builtins.TextureStore(e,t);case"atomicLoad":return this.builtins.AtomicLoad(e,t);case"atomicStore":return this.builtins.AtomicStore(e,t);case"atomicAdd":return this.builtins.AtomicAdd(e,t);case"atomicSub":return this.builtins.AtomicSub(e,t);case"atomicMax":return this.builtins.AtomicMax(e,t);case"atomicMin":return this.builtins.AtomicMin(e,t);case"atomicAnd":return this.builtins.AtomicAnd(e,t);case"atomicOr":return this.builtins.AtomicOr(e,t);case"atomicXor":return this.builtins.AtomicXor(e,t);case"atomicExchange":return this.builtins.AtomicExchange(e,t);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,t);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,t);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,t);case"pack4xI8":return this.builtins.Pack4xI8(e,t);case"pack4xU8":return this.builtins.Pack4xU8(e,t);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,t);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,t);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,t);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,t);case"pack2x16float":return this.builtins.Pack2x16float(e,t);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,t);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,t);case"unpack4xI8":return this.builtins.Unpack4xI8(e,t);case"unpack4xU8":return this.builtins.Unpack4xU8(e,t);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,t);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,t);case"unpack2x16float":return this.builtins.Unpack2x16float(e,t);case"storageBarrier":return this.builtins.StorageBarrier(e,t);case"textureBarrier":return this.builtins.TextureBarrier(e,t);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,t);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,t);case"subgroupAdd":return this.builtins.SubgroupAdd(e,t);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,t);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,t);case"subgroupAll":return this.builtins.SubgroupAll(e,t);case"subgroupAnd":return this.builtins.SubgroupAnd(e,t);case"subgroupAny":return this.builtins.SubgroupAny(e,t);case"subgroupBallot":return this.builtins.SubgroupBallot(e,t);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,t);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,t);case"subgroupElect":return this.builtins.SubgroupElect(e,t);case"subgroupMax":return this.builtins.SubgroupMax(e,t);case"subgroupMin":return this.builtins.SubgroupMin(e,t);case"subgroupMul":return this.builtins.SubgroupMul(e,t);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,t);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,t);case"subgroupOr":return this.builtins.SubgroupOr(e,t);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,t);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,t);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,t);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,t);case"subgroupXor":return this.builtins.SubgroupXor(e,t);case"quadBroadcast":return this.builtins.QuadBroadcast(e,t);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,t);case"quadSwapX":return this.builtins.QuadSwapX(e,t);case"quadSwapY":return this.builtins.QuadSwapY(e,t)}const i=t.getFunction(e.name);if(i){const s=t.clone();for(let o=0;o<i.node.args.length;++o){const c=i.node.args[o],u=this.evalExpression(e.args[o],s);s.setVariable(c.name,u,c)}return this._execStatements(i.node.body,s)}return null}_callConstructorValue(e,t){if(!e.args||e.args.length===0)return new P(0,this.getTypeInfo(e.type));const i=this.evalExpression(e.args[0],t);return i.typeInfo=this.getTypeInfo(e.type),i.getSubData(this,e.postfix,t).clone()}_callConstructorVec(e,t){const i=this.getTypeInfo(e.type),s=e.type.getTypeName(),o=Ah[s];if(o===void 0)return console.error(`Invalid vec constructor ${s}. Line ${e.line}`),null;const c=[];if(e instanceof Et)if(e.isVector){const u=e.vectorValue;for(const h of u)c.push(h)}else c.push(e.scalarValue);else if(e.args)for(const u of e.args){const h=this.evalExpression(u,t);if(h instanceof S){const d=h.data;for(let g=0;g<d.length;++g){let m=d[g];c.push(m)}}else if(h instanceof P){let d=h.value;c.push(d)}}if(e.type instanceof B&&e.type.format===null&&(e.type.format=B.f32),c.length===0){const u=new Array(o).fill(0);return new S(u,i).getSubData(this,e.postfix,t)}if(c.length===1)for(;c.length<o;)c.push(c[0]);return c.length<o?(console.error(`Invalid vec constructor. Line ${e.line}`),null):new S(c.length>o?c.slice(0,o):c,i).getSubData(this,e.postfix,t)}_callConstructorMatrix(e,t){const i=this.getTypeInfo(e.type),s=e.type.getTypeName(),o=qt[s];if(o===void 0)return console.error(`Invalid matrix constructor ${s}. Line ${e.line}`),null;const c=[];if(e instanceof Et)if(e.isVector){const u=e.vectorValue;for(const h of u)c.push(h)}else c.push(e.scalarValue);else if(e.args)for(const u of e.args){const h=this.evalExpression(u,t);h instanceof S?c.push(...h.data):h instanceof P?c.push(h.value):h instanceof Se&&c.push(...h.data)}if(i instanceof ks&&i.format===null&&(i.format=this.getTypeInfo("f32")),c.length===0){const u=new Array(o[2]).fill(0);return new Se(u,i).getSubData(this,e.postfix,t)}return c.length!==o[2]?(console.error(`Invalid matrix constructor. Line ${e.line}`),null):new Se(c,i).getSubData(this,e.postfix,t)}}Wt._breakObj=new Cn(new An("BREAK",null),null),Wt._continueObj=new Cn(new An("CONTINUE",null),null),Wt._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class eR{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class tR{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new eR,this._exec=new Wt,this._forwardTypeCount=0}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const t=[];for(;!this._isAtEnd();){const i=this._global_decl_or_directive();if(!i)break;t.push(i)}if(this._deferArrayCountEval.length>0){for(const i of this._deferArrayCountEval){const s=i.arrayType,o=i.countNode;if(o instanceof fn){const c=o.name,u=this._context.constants.get(c);if(u)try{const h=u.constEvaluate(this._exec);s.count=h}catch{}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const i of t)i.search(s=>{s instanceof pb||s instanceof sc?s.type=this._forwardType(s.type):s instanceof po?s.format=this._forwardType(s.format):s instanceof mi||s instanceof ho||s instanceof ic?s.type=this._forwardType(s.type):s instanceof bo?s.returnType=this._forwardType(s.returnType):s instanceof db&&(s.type=this._forwardType(s.type))});return t}_forwardType(e){if(e instanceof hb){const t=this._getType(e.name);if(t)return t}else e instanceof sc?e.type=this._forwardType(e.type):e instanceof po&&(e.format=this._forwardType(e.format));return e}_initialize(e){if(e)if(typeof e=="string"){const t=new WE(e);this._tokens=t.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,t){return e.line=t??this._currentLine,e}_error(e,t){return{token:e,message:t,toString:()=>`${t}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==x.eof}_match(e){if(e instanceof D)return!!this._check(e)&&(this._advance(),!0);for(let t=0,i=e.length;t<i;++t){const s=e[t];if(this._check(s))return this._advance(),!0}return!1}_consume(e,t){if(this._check(e))return this._advance();throw this._error(this._peek(),`${t}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;const t=this._peek();if(e instanceof Array){const i=t.type;let s=!1;for(const o of e){if(i===o)return!0;o===x.tokens.name&&(s=!0)}if(s){const o=x.tokens.name.rule.exec(t.lexeme);if(o&&o.index==0&&o[0]==t.lexeme)return!0}return!1}if(t.type===e)return!0;if(e===x.tokens.name){const i=x.tokens.name.rule.exec(t.lexeme);return i&&i.index==0&&i[0]==t.lexeme}return!1}_advance(){var e,t;return this._currentLine=(t=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&t!==void 0?t:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(x.tokens.semicolon)&&!this._isAtEnd(););if(this._match(x.keywords.alias)){const t=this._type_alias();return this._consume(x.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(x.keywords.diagnostic)){const t=this._diagnostic();return this._consume(x.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(x.keywords.requires)){const t=this._requires_directive();return this._consume(x.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(x.keywords.enable)){const t=this._enable_directive();return this._consume(x.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}const e=this._attribute();if(this._check(x.keywords.var)){const t=this._global_variable_decl();return t!=null&&(t.attributes=e),this._consume(x.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(x.keywords.override)){const t=this._override_variable_decl();return t!=null&&(t.attributes=e),this._consume(x.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(x.keywords.let)){const t=this._global_let_decl();return t!=null&&(t.attributes=e),this._consume(x.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(x.keywords.const)){const t=this._global_const_decl();return t!=null&&(t.attributes=e),this._consume(x.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(x.keywords.struct)){const t=this._struct_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}if(this._check(x.keywords.fn)){const t=this._function_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}return null}_function_decl(){if(!this._match(x.keywords.fn))return null;const e=this._currentLine,t=this._consume(x.tokens.ident,"Expected function name.").toString();this._consume(x.tokens.paren_left,"Expected '(' for function arguments.");const i=[];if(!this._check(x.tokens.paren_right))do{if(this._check(x.tokens.paren_right))break;const u=this._attribute(),h=this._consume(x.tokens.name,"Expected argument name.").toString();this._consume(x.tokens.colon,"Expected ':' for argument type.");const d=this._attribute(),g=this._type_decl();g!=null&&(g.attributes=d,i.push(this._updateNode(new db(h,g,u))))}while(this._match(x.tokens.comma));this._consume(x.tokens.paren_right,"Expected ')' after function arguments.");let s=null;if(this._match(x.tokens.arrow)){const u=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=u)}const o=this._compound_statement(),c=this._currentLine;return this._updateNode(new bo(t,i,s,o,e,c),e)}_compound_statement(){const e=[];for(this._consume(x.tokens.brace_left,"Expected '{' for block.");!this._check(x.tokens.brace_right);){const t=this._statement();t!==null&&e.push(t)}return this._consume(x.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(x.tokens.semicolon)&&!this._isAtEnd(););if(this._check(x.tokens.attr)&&this._attribute(),this._check(x.keywords.if))return this._if_statement();if(this._check(x.keywords.switch))return this._switch_statement();if(this._check(x.keywords.loop))return this._loop_statement();if(this._check(x.keywords.for))return this._for_statement();if(this._check(x.keywords.while))return this._while_statement();if(this._check(x.keywords.continuing))return this._continuing_statement();if(this._check(x.keywords.static_assert))return this._static_assert_statement();if(this._check(x.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(x.keywords.return))e=this._return_statement();else if(this._check([x.keywords.var,x.keywords.let,x.keywords.const]))e=this._variable_statement();else if(this._match(x.keywords.discard))e=this._updateNode(new VE);else if(this._match(x.keywords.break)){const t=this._updateNode(new Y0);if(this._currentLoop.length>0){const i=this._currentLoop[this._currentLoop.length-1];t.loopId=i.id}e=t,this._check(x.keywords.if)&&(this._advance(),t.condition=this._optional_paren_expression())}else if(this._match(x.keywords.continue)){const t=this._updateNode(new q0);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${t.line}`);{const i=this._currentLoop[this._currentLoop.length-1];t.loopId=i.id}e=t}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return e!=null&&this._consume(x.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(x.keywords.static_assert))return null;const e=this._currentLine,t=this._optional_paren_expression();return this._updateNode(new FE(t),e)}_while_statement(){if(!this._match(x.keywords.while))return null;const e=this._updateNode(new F0(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(x.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){const e=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(x.keywords.continuing))return null;const t=this._currentLine,i=this._compound_statement();return this._updateNode(new td(i,e),t)}_for_statement(){if(!this._match(x.keywords.for))return null;this._consume(x.tokens.paren_left,"Expected '('.");const e=this._updateNode(new L0(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(x.tokens.semicolon)?null:this._for_init(),this._consume(x.tokens.semicolon,"Expected ';'."),e.condition=this._check(x.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(x.tokens.semicolon,"Expected ';'."),e.increment=this._check(x.tokens.paren_right)?null:this._for_increment(),this._consume(x.tokens.paren_right,"Expected ')'."),this._check(x.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(x.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let t=null;return this._match(x.tokens.equal)&&(t=this._short_circuit_or_expression()),this._updateNode(new mi(e.name,e.type,e.storage,e.access,t),e.line)}if(this._match(x.keywords.let)){const e=this._currentLine,t=this._consume(x.tokens.name,"Expected name for let.").toString();let i=null;if(this._match(x.tokens.colon)){const o=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=o)}this._consume(x.tokens.equal,"Expected '=' for let.");const s=this._short_circuit_or_expression();return this._updateNode(new ho(t,i,null,null,s),e)}if(this._match(x.keywords.const)){const e=this._currentLine,t=this._consume(x.tokens.name,"Expected name for const.").toString();let i=null;if(this._match(x.tokens.colon)){const o=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=o)}this._consume(x.tokens.equal,"Expected '=' for const.");const s=this._short_circuit_or_expression();return i===null&&s instanceof Et&&(i=s.type),this._updateNode(new ic(t,i,null,null,s),e)}return null}_increment_decrement_statement(){const e=this._current,t=this._unary_expression();if(t==null)return null;if(!this._check(x.increment_operators))return this._current=e,null;const i=this._consume(x.increment_operators,"Expected increment operator");return this._updateNode(new z0(i.type===x.tokens.plus_plus?Ur.increment:Ur.decrement,t))}_assignment_statement(){let e=null;const t=this._currentLine;if(this._check(x.tokens.brace_right))return null;let i=this._match(x.tokens.underscore);if(i||(e=this._unary_expression()),!i&&e==null)return null;const s=this._consume(x.assignment_operators,"Expected assignment operator."),o=this._short_circuit_or_expression();return this._updateNode(new V0(ro.parse(s.lexeme),e,o),t)}_func_call_statement(){if(!this._check(x.tokens.ident))return null;const e=this._currentLine,t=this._current,i=this._consume(x.tokens.ident,"Expected function name."),s=this._argument_expression_list();return s===null?(this._current=t,null):this._updateNode(new Wd(i.lexeme,s),e)}_loop_statement(){if(!this._match(x.keywords.loop))return null;this._check(x.tokens.attr)&&this._attribute(),this._consume(x.tokens.brace_left,"Expected '{' for loop.");const e=this._updateNode(new j0([],null));this._currentLoop.push(e);let t=this._statement();for(;t!==null;){if(Array.isArray(t))for(let i of t)e.body.push(i);else e.body.push(t);if(t instanceof td){e.continuing=t;break}t=this._statement()}return this._currentLoop.pop(),this._consume(x.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(x.keywords.switch))return null;const e=this._updateNode(new H0(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(x.tokens.attr)&&this._attribute(),this._consume(x.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),e.cases==null||e.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(x.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){const e=[];let t=!1;for(;this._check([x.keywords.default,x.keywords.case]);){if(this._match(x.keywords.case)){const i=this._case_selectors();for(const o of i)if(o instanceof rc){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");t=!0;break}this._match(x.tokens.colon),this._check(x.tokens.attr)&&this._attribute(),this._consume(x.tokens.brace_left,"Exected '{' for switch case.");const s=this._case_body();this._consume(x.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new J0(i,s)))}if(this._match(x.keywords.default)){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(x.tokens.colon),this._check(x.tokens.attr)&&this._attribute(),this._consume(x.tokens.brace_left,"Exected '{' for switch default.");const i=this._case_body();this._consume(x.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new e3(i)))}}return e}_case_selectors(){const e=[];for(this._match(x.keywords.default)?e.push(this._updateNode(new rc)):e.push(this._shift_expression());this._match(x.tokens.comma);)this._match(x.keywords.default)?e.push(this._updateNode(new rc)):e.push(this._shift_expression());return e}_case_body(){if(this._match(x.keywords.fallthrough))return this._consume(x.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const t=this._case_body();return t.length==0?e:[...e,t[0]]}_if_statement(){if(!this._match(x.keywords.if))return null;const e=this._currentLine,t=this._optional_paren_expression();this._check(x.tokens.attr)&&this._attribute();const i=this._compound_statement();let s=[];this._match_elseif()&&(this._check(x.tokens.attr)&&this._attribute(),s=this._elseif_statement(s));let o=null;return this._match(x.keywords.else)&&(this._check(x.tokens.attr)&&this._attribute(),o=this._compound_statement()),this._updateNode(new W0(t,i,s,o),e)}_match_elseif(){return this._tokens[this._current].type===x.keywords.else&&this._tokens[this._current+1].type===x.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){const t=this._optional_paren_expression(),i=this._compound_statement();return e.push(this._updateNode(new jE(t,i))),this._match_elseif()&&(this._check(x.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(x.keywords.return))return null;const e=this._short_circuit_or_expression();return this._updateNode(new $0(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(x.tokens.or_or);)e=this._updateNode(new Un(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(x.tokens.and_and);)e=this._updateNode(new Un(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(x.tokens.or);)e=this._updateNode(new Un(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(x.tokens.xor);)e=this._updateNode(new Un(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(x.tokens.and);)e=this._updateNode(new Un(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){const e=this._relational_expression();return this._match([x.tokens.equal_equal,x.tokens.not_equal])?this._updateNode(new Un(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([x.tokens.less_than,x.tokens.greater_than,x.tokens.less_than_equal,x.tokens.greater_than_equal]);)e=this._updateNode(new Un(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([x.tokens.shift_left,x.tokens.shift_right]);)e=this._updateNode(new Un(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([x.tokens.plus,x.tokens.minus]);)e=this._updateNode(new Un(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([x.tokens.star,x.tokens.forward_slash,x.tokens.modulo]);)e=this._updateNode(new Un(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([x.tokens.minus,x.tokens.bang,x.tokens.tilde,x.tokens.star,x.tokens.and])?this._updateNode(new xt(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),t=this._postfix_expression();return t&&(e.postfix=t),e}_postfix_expression(){if(this._match(x.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(x.tokens.bracket_right,"Expected ']'.");const t=this._updateNode(new Xr(e)),i=this._postfix_expression();return i&&(t.postfix=i),t}if(this._match(x.tokens.period)){const e=this._consume(x.tokens.name,"Expected member name."),t=this._postfix_expression(),i=this._updateNode(new Ds(e.lexeme));return t&&(i.postfix=t),i}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){const t=this._getStruct(e);if(t!==null)return t;switch(e){case"void":return J.void;case"bool":return J.bool;case"i32":return J.i32;case"u32":return J.u32;case"f32":return J.f32;case"f16":return J.f16;case"vec2f":return B.vec2f;case"vec3f":return B.vec3f;case"vec4f":return B.vec4f;case"vec2i":return B.vec2i;case"vec3i":return B.vec3i;case"vec4i":return B.vec4i;case"vec2u":return B.vec2u;case"vec3u":return B.vec3u;case"vec4u":return B.vec4u;case"vec2h":return B.vec2h;case"vec3h":return B.vec3h;case"vec4h":return B.vec4h;case"mat2x2f":return B.mat2x2f;case"mat2x3f":return B.mat2x3f;case"mat2x4f":return B.mat2x4f;case"mat3x2f":return B.mat3x2f;case"mat3x3f":return B.mat3x3f;case"mat3x4f":return B.mat3x4f;case"mat4x2f":return B.mat4x2f;case"mat4x3f":return B.mat4x3f;case"mat4x4f":return B.mat4x4f;case"mat2x2h":return B.mat2x2h;case"mat2x3h":return B.mat2x3h;case"mat2x4h":return B.mat2x4h;case"mat3x2h":return B.mat3x2h;case"mat3x3h":return B.mat3x3h;case"mat3x4h":return B.mat3x4h;case"mat4x2h":return B.mat4x2h;case"mat4x3h":return B.mat4x3h;case"mat4x4h":return B.mat4x4h;case"mat2x2i":return B.mat2x2i;case"mat2x3i":return B.mat2x3i;case"mat2x4i":return B.mat2x4i;case"mat3x2i":return B.mat3x2i;case"mat3x3i":return B.mat3x3i;case"mat3x4i":return B.mat3x4i;case"mat4x2i":return B.mat4x2i;case"mat4x3i":return B.mat4x3i;case"mat4x4i":return B.mat4x4i;case"mat2x2u":return B.mat2x2u;case"mat2x3u":return B.mat2x3u;case"mat2x4u":return B.mat2x4u;case"mat3x2u":return B.mat3x2u;case"mat3x3u":return B.mat3x3u;case"mat3x4u":return B.mat3x4u;case"mat4x2u":return B.mat4x2u;case"mat4x3u":return B.mat4x3u;case"mat4x4u":return B.mat4x4u}return null}_validateTypeRange(e,t){if(t.name==="i32"){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if(t.name==="u32"&&(e<0||e>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(x.tokens.ident)){const i=this._previous().toString();if(this._check(x.tokens.paren_left)){const s=this._argument_expression_list(),o=this._getType(i);return o!==null?this._updateNode(new qn(o,s)):this._updateNode(new Xd(i,s))}if(this._context.constants.has(i)){const s=this._context.constants.get(i);return this._updateNode(new K0(i,s.value))}return this._updateNode(new fn(i))}if(this._match(x.tokens.int_literal)){const i=this._previous().toString();let s=i.endsWith("i")||i.endsWith("i")?J.i32:i.endsWith("u")||i.endsWith("U")?J.u32:J.x32;const o=parseInt(i);return this._validateTypeRange(o,s),this._updateNode(new Et(new P(o,this._exec.getTypeInfo(s)),s))}if(this._match(x.tokens.uint_literal)){const i=parseInt(this._previous().toString());return this._validateTypeRange(i,J.u32),this._updateNode(new Et(new P(i,this._exec.getTypeInfo(J.u32)),J.u32))}if(this._match([x.tokens.decimal_float_literal,x.tokens.hex_float_literal])){let i=this._previous().toString(),s=i.endsWith("h");s&&(i=i.substring(0,i.length-1));const o=parseFloat(i);this._validateTypeRange(o,s?J.f16:J.f32);const c=s?J.f16:J.f32;return this._updateNode(new Et(new P(o,this._exec.getTypeInfo(c)),c))}if(this._match([x.keywords.true,x.keywords.false])){let i=this._previous().toString()===x.keywords.true.rule;return this._updateNode(new Et(new P(i?1:0,this._exec.getTypeInfo(J.bool)),J.bool))}if(this._check(x.tokens.paren_left))return this._paren_expression();if(this._match(x.keywords.bitcast)){this._consume(x.tokens.less_than,"Expected '<'.");const i=this._type_decl();this._consume(x.tokens.greater_than,"Expected '>'.");const s=this._paren_expression();return this._updateNode(new Z0(i,s))}const e=this._type_decl(),t=this._argument_expression_list();return this._updateNode(new qn(e,t))}_argument_expression_list(){if(!this._match(x.tokens.paren_left))return null;const e=[];do{if(this._check(x.tokens.paren_right))break;const t=this._short_circuit_or_expression();e.push(t)}while(this._match(x.tokens.comma));return this._consume(x.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(x.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(x.tokens.paren_right),e}_paren_expression(){this._consume(x.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(x.tokens.paren_right,"Expected ')'."),e}_struct_decl(){if(!this._match(x.keywords.struct))return null;const e=this._currentLine,t=this._consume(x.tokens.ident,"Expected name for struct.").toString();this._consume(x.tokens.brace_left,"Expected '{' for struct body.");const i=[];for(;!this._check(x.tokens.brace_right);){const c=this._attribute(),u=this._consume(x.tokens.name,"Expected variable name.").toString();this._consume(x.tokens.colon,"Expected ':' for struct member type.");const h=this._attribute(),d=this._type_decl();d!=null&&(d.attributes=h),this._check(x.tokens.brace_right)?this._match(x.tokens.comma):this._consume(x.tokens.comma,"Expected ',' for struct member."),i.push(this._updateNode(new pb(u,d,c)))}this._consume(x.tokens.brace_right,"Expected '}' after struct body.");const s=this._currentLine,o=this._updateNode(new gi(t,i,e,s),e);return this._context.structs.set(t,o),o}_global_variable_decl(){const e=this._variable_decl();if(!e)return null;if(this._match(x.tokens.equal)){const t=this._const_expression();e.value=t}if(e.type!==null&&e.value instanceof Et){if(e.value.type.name!=="x32"&&e.type.getTypeName()!==e.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else e.type===null&&e.value instanceof Et&&(e.type=e.value.type.name==="x32"?J.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(x.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(x.keywords.const))return null;const t=this._consume(x.tokens.name,"Expected variable name"),i=this._currentLine;let s=null;if(this._match(x.tokens.colon)){const h=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=h)}let o=null;this._consume(x.tokens.equal,"const declarations require an assignment");const c=this._short_circuit_or_expression();try{let h=[J.f32],d=c.constEvaluate(this._exec,h);d instanceof P&&this._validateTypeRange(d.value,h[0]),h[0]instanceof B&&h[0].format===null&&d.typeInfo instanceof ks&&d.typeInfo.format!==null&&(d.typeInfo.format.name==="f16"?h[0].format=J.f16:d.typeInfo.format.name==="f32"?h[0].format=J.f32:d.typeInfo.format.name==="i32"?h[0].format=J.i32:d.typeInfo.format.name==="u32"?h[0].format=J.u32:d.typeInfo.format.name==="bool"?h[0].format=J.bool:console.error(`TODO: impelement template format type ${d.typeInfo.format.name}`)),o=this._updateNode(new Et(d,h[0])),this._exec.context.setVariable(t.toString(),d)}catch{o=c}if(s!==null&&o instanceof Et){if(o.type.name!=="x32"&&s.getTypeName()!==o.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${o.type.name} to ${s.name}. Line:${this._currentLine}`);o.type=s,o.isScalar&&this._validateTypeRange(o.scalarValue,o.type)}else s===null&&o instanceof Et&&(s=(e=o?.type)!==null&&e!==void 0?e:J.f32,s===J.x32&&(s=J.i32));const u=this._updateNode(new ic(t.toString(),s,"","",o),i);return this._context.constants.set(u.name,u),u}_global_let_decl(){if(!this._match(x.keywords.let))return null;const e=this._currentLine,t=this._consume(x.tokens.name,"Expected variable name");let i=null;if(this._match(x.tokens.colon)){const o=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=o)}let s=null;if(this._match(x.tokens.equal)&&(s=this._const_expression()),i!==null&&s instanceof Et){if(s.type.name!=="x32"&&i.getTypeName()!==s.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${s.type.name} to ${i.name}. Line:${this._currentLine}`);s.type=i}else i===null&&s instanceof Et&&(i=s.type.name==="x32"?J.i32:s.type);return s instanceof Et&&s.isScalar&&this._validateTypeRange(s.scalarValue,i),this._updateNode(new ho(t.toString(),i,"","",s),e)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(x.keywords.var))return null;const e=this._currentLine;let t="",i="";this._match(x.tokens.less_than)&&(t=this._consume(x.storage_class,"Expected storage_class.").toString(),this._match(x.tokens.comma)&&(i=this._consume(x.access_mode,"Expected access_mode.").toString()),this._consume(x.tokens.greater_than,"Expected '>'."));const s=this._consume(x.tokens.name,"Expected variable name");let o=null;if(this._match(x.tokens.colon)){const c=this._attribute();o=this._type_decl(),o!=null&&(o.attributes=c)}return this._updateNode(new mi(s.toString(),o,t,i,null),e)}_override_decl(){if(!this._match(x.keywords.override))return null;const e=this._consume(x.tokens.name,"Expected variable name");let t=null;if(this._match(x.tokens.colon)){const i=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=i)}return this._updateNode(new Hd(e.toString(),t,null))}_diagnostic(){this._consume(x.tokens.paren_left,"Expected '('");const e=this._consume(x.tokens.ident,"Expected severity control name.");this._consume(x.tokens.comma,"Expected ','");let t=this._consume(x.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(x.tokens.period)&&(t+=`.${this._consume(x.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(x.tokens.paren_right,"Expected ')'"),this._updateNode(new X0(e.toString(),t))}_enable_directive(){const e=this._consume(x.tokens.ident,"identity expected.");return this._updateNode(new LE(e.toString()))}_requires_directive(){const e=[this._consume(x.tokens.ident,"identity expected.").toString()];for(;this._match(x.tokens.comma);){const t=this._consume(x.tokens.ident,"identity expected.");e.push(t.toString())}return this._updateNode(new zE(e))}_type_alias(){const e=this._consume(x.tokens.ident,"identity expected.");this._consume(x.tokens.equal,"Expected '=' for type alias.");let t=this._type_decl();if(t===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(t.name)&&(t=this._context.aliases.get(t.name).type);const i=this._updateNode(new $d(e.toString(),t));return this._context.aliases.set(i.name,i),i}_type_decl(){if(this._check([x.tokens.ident,...x.texel_format,x.keywords.bool,x.keywords.f32,x.keywords.i32,x.keywords.u32])){const i=this._advance().toString();if(this._context.structs.has(i))return this._context.structs.get(i);if(this._context.aliases.has(i))return this._context.aliases.get(i).type;if(!this._getType(i)){const s=this._updateNode(new hb(i));return this._forwardTypeCount++,s}return this._updateNode(new J(i))}let e=this._texture_sampler_types();if(e)return e;if(this._check(x.template_types)){let i=this._advance().toString(),s=null,o=null;return this._match(x.tokens.less_than)&&(s=this._type_decl(),o=null,this._match(x.tokens.comma)&&(o=this._consume(x.access_mode,"Expected access_mode for pointer").toString()),this._consume(x.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new B(i,s,o))}if(this._match(x.keywords.ptr)){let i=this._previous().toString();this._consume(x.tokens.less_than,"Expected '<' for pointer.");const s=this._consume(x.storage_class,"Expected storage_class for pointer");this._consume(x.tokens.comma,"Expected ',' for pointer.");const o=this._type_decl();let c=null;return this._match(x.tokens.comma)&&(c=this._consume(x.access_mode,"Expected access_mode for pointer").toString()),this._consume(x.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new sc(i,s.toString(),o,c))}const t=this._attribute();if(this._match(x.keywords.array)){let i=null,s=-1;const o=this._previous();let c=null;if(this._match(x.tokens.less_than)){i=this._type_decl(),this._context.aliases.has(i.name)&&(i=this._context.aliases.get(i.name).type);let h="";if(this._match(x.tokens.comma)){c=this._shift_expression();try{h=c.constEvaluate(this._exec).toString(),c=null}catch{h="1"}}this._consume(x.tokens.greater_than,"Expected '>' for array."),s=h?parseInt(h):0}const u=this._updateNode(new po(o.toString(),t,i,s));return c&&this._deferArrayCountEval.push({arrayType:u,countNode:c}),u}return null}_texture_sampler_types(){if(this._match(x.sampler_type))return this._updateNode(new ao(this._previous().toString(),null,null));if(this._match(x.depth_texture_type))return this._updateNode(new ao(this._previous().toString(),null,null));if(this._match(x.sampled_texture_type)||this._match(x.multisampled_texture_type)){const e=this._previous();this._consume(x.tokens.less_than,"Expected '<' for sampler type.");const t=this._type_decl();return this._consume(x.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new ao(e.toString(),t,null))}if(this._match(x.storage_texture_type)){const e=this._previous();this._consume(x.tokens.less_than,"Expected '<' for sampler type.");const t=this._consume(x.texel_format,"Invalid texel format.").toString();this._consume(x.tokens.comma,"Expected ',' after texel format.");const i=this._consume(x.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(x.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new ao(e.toString(),t,i))}return null}_attribute(){let e=[];for(;this._match(x.tokens.attr);){const t=this._consume(x.attribute_name,"Expected attribute name"),i=this._updateNode(new t3(t.toString(),null));if(this._match(x.tokens.paren_left)){if(i.value=this._consume(x.literal_or_ident,"Expected attribute value").toString(),this._check(x.tokens.comma)){this._advance();do{const s=this._consume(x.literal_or_ident,"Expected attribute value").toString();i.value instanceof Array||(i.value=[i.value]),i.value.push(s)}while(this._match(x.tokens.comma))}this._consume(x.tokens.paren_right,"Expected ')'")}e.push(i)}return e.length==0?null:e}}class nR extends Qn{constructor(e){super(),e&&this.update(e)}update(e){const t=new tR().parse(e);this.updateAST(t)}}function iR(n){const e={attributes:[],bindings:[]};let t;try{t=sR(n)}catch(o){return ae.error(o.message)(),e}for(const o of t.uniforms){const c=[];for(const u of o.type?.members||[])c.push({name:u.name,type:mb(u.type)});e.bindings.push({type:"uniform",name:o.name,group:o.group,location:o.binding,members:c})}for(const o of t.textures)e.bindings.push({type:"texture",name:o.name,group:o.group,location:o.binding});for(const o of t.samplers)e.bindings.push({type:"sampler",name:o.name,group:o.group,location:o.binding});const i=t.entry.vertex[0],s=i?.inputs.length||0;for(let o=0;o<s;o++){const c=i.inputs[o];if(c.locationType==="location"){const u=mb(c.type);e.attributes.push({name:c.name,location:Number(c.location),type:u})}}return e}function mb(n){return n.format?`${n.name}<${n.format.name}>`:n.name}function sR(n){try{return new nR(n)}catch(e){if(e instanceof Error)throw e;let t="WGSL parse error";throw typeof e=="object"&&e?.message&&(t+=`: ${e.message} `),typeof e=="object"&&e?.token&&(t+=e.token.line||""),new Error(t,{cause:e})}}const rR={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...rR}};const En=globalThis.mathgl.config;function aR(n,{precision:e=En.precision}={}){return n=oR(n),`${parseFloat(n.toPrecision(e))}`}function Yr(n){return Array.isArray(n)||ArrayBuffer.isView(n)&&!(n instanceof DataView)}function Gi(n,e,t){return cR(n,i=>Math.max(e,Math.min(t,i)))}function Tc(n,e,t){return Yr(n)?n.map((i,s)=>Tc(i,e[s],t)):t*e+(1-t)*n}function vo(n,e,t){const i=En.EPSILON;try{if(n===e)return!0;if(Yr(n)&&Yr(e)){if(n.length!==e.length)return!1;for(let s=0;s<n.length;++s)if(!vo(n[s],e[s]))return!1;return!0}return n&&n.equals?n.equals(e):e&&e.equals?e.equals(n):typeof n=="number"&&typeof e=="number"?Math.abs(n-e)<=En.EPSILON*Math.max(1,Math.abs(n),Math.abs(e)):!1}finally{En.EPSILON=i}}function oR(n){return Math.round(n/En.EPSILON)*En.EPSILON}function lR(n){return n.clone?n.clone():new Array(n.length)}function cR(n,e,t){if(Yr(n)){const i=n;t=t||lR(i);for(let s=0;s<t.length&&s<i.length;++s){const o=typeof n=="number"?n:n[s];t[s]=e(o,s,t)}return t}return e(n)}class n3 extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,t=0){for(let i=0;i<this.ELEMENTS;++i)this[i]=e[i+t];return this.check()}toArray(e=[],t=0){for(let i=0;i<this.ELEMENTS;++i)e[t+i]=this[i];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:Yr(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(En)}formatString(e){let t="";for(let i=0;i<this.ELEMENTS;++i)t+=(i>0?", ":"")+aR(this[i],e);return`${e.printTypes?this.constructor.name:""}[${t}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!vo(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,i){if(i===void 0)return this.lerp(this,e,t);for(let s=0;s<this.ELEMENTS;++s){const o=e[s],c=typeof t=="number"?t:t[s];this[s]=o+i*(c-o)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e[i]),t[i]);return this.check()}add(...e){for(const t of e)for(let i=0;i<this.ELEMENTS;++i)this[i]+=t[i];return this.check()}subtract(...e){for(const t of e)for(let i=0;i<this.ELEMENTS;++i)this[i]-=t[i];return this.check()}scale(e){if(typeof e=="number")for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(En.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e),t);return this.check()}get elements(){return this}}function uR(n,e){if(n.length!==e)return!1;for(let t=0;t<n.length;++t)if(!Number.isFinite(n[t]))return!1;return!0}function un(n){if(!Number.isFinite(n))throw new Error(`Invalid number ${JSON.stringify(n)}`);return n}function Eh(n,e,t=""){if(En.debug&&!uR(n,e))throw new Error(`math.gl: ${t} some fields set to invalid numbers'`);return n}function yb(n,e){if(!n)throw new Error(`math.gl assertion ${e}`)}class fR extends n3{get x(){return this[0]}set x(e){this[0]=un(e)}get y(){return this[1]}set y(e){this[1]=un(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let i=0;i<this.ELEMENTS;++i){const s=this[i]-e[i];t+=s*s}return un(t)}dot(e){let t=0;for(let i=0;i<this.ELEMENTS;++i)t+=this[i]*e[i];return un(t)}normalize(){const e=this.magnitude();if(e!==0)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(...e){for(const t of e)for(let i=0;i<this.ELEMENTS;++i)this[i]*=t[i];return this.check()}divide(...e){for(const t of e)for(let i=0;i<this.ELEMENTS;++i)this[i]/=t[i];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return yb(e>=0&&e<this.ELEMENTS,"index is out of range"),un(this[e])}setComponent(e,t){return yb(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}}const ac=1e-6;let qr=typeof Float32Array<"u"?Float32Array:Array;function hR(){const n=new qr(2);return qr!=Float32Array&&(n[0]=0,n[1]=0),n}function bb(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n}function dR(n,e){return n[0]=-e[0],n[1]=-e[1],n}function i3(n,e,t,i){const s=e[0],o=e[1];return n[0]=s+i*(t[0]-s),n[1]=o+i*(t[1]-o),n}function pR(n,e,t){const i=e[0],s=e[1];return n[0]=t[0]*i+t[4]*s+t[12],n[1]=t[1]*i+t[5]*s+t[13],n}(function(){const n=hR();return function(e,t,i,s,o,c){let u,h;for(t||(t=2),i||(i=0),s?h=Math.min(s*t+i,e.length):h=e.length,u=i;u<h;u+=t)n[0]=e[u],n[1]=e[u+1],o(n,n,c),e[u]=n[0],e[u+1]=n[1];return e}})();function gR(n,e,t){const i=e[0],s=e[1],o=t[3]*i+t[7]*s||1;return n[0]=(t[0]*i+t[4]*s)/o,n[1]=(t[1]*i+t[5]*s)/o,n}function s3(n,e,t){const i=e[0],s=e[1],o=e[2],c=t[3]*i+t[7]*s+t[11]*o||1;return n[0]=(t[0]*i+t[4]*s+t[8]*o)/c,n[1]=(t[1]*i+t[5]*s+t[9]*o)/c,n[2]=(t[2]*i+t[6]*s+t[10]*o)/c,n}function _R(n,e,t){const i=e[0],s=e[1];return n[0]=t[0]*i+t[2]*s,n[1]=t[1]*i+t[3]*s,n[2]=e[2],n}function mR(){const n=new qr(3);return qr!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function yR(n,e,t){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n}function bR(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n}function vR(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function TR(n,e,t){const i=e[0],s=e[1],o=e[2],c=t[0],u=t[1],h=t[2];return n[0]=s*h-o*u,n[1]=o*c-i*h,n[2]=i*u-s*c,n}function r3(n,e,t){const i=e[0],s=e[1],o=e[2];let c=t[3]*i+t[7]*s+t[11]*o+t[15];return c=c||1,n[0]=(t[0]*i+t[4]*s+t[8]*o+t[12])/c,n[1]=(t[1]*i+t[5]*s+t[9]*o+t[13])/c,n[2]=(t[2]*i+t[6]*s+t[10]*o+t[14])/c,n}function xR(n,e,t){const i=e[0],s=e[1],o=e[2];return n[0]=i*t[0]+s*t[3]+o*t[6],n[1]=i*t[1]+s*t[4]+o*t[7],n[2]=i*t[2]+s*t[5]+o*t[8],n}function SR(n,e,t){const i=t[0],s=t[1],o=t[2],c=t[3],u=e[0],h=e[1],d=e[2];let g=s*d-o*h,m=o*u-i*d,y=i*h-s*u,T=s*y-o*m,w=o*g-i*y,C=i*m-s*g;const N=c*2;return g*=N,m*=N,y*=N,T*=2,w*=2,C*=2,n[0]=u+g+T,n[1]=h+m+w,n[2]=d+y+C,n}function wR(n,e,t,i){const s=[],o=[];return s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],o[0]=s[0],o[1]=s[1]*Math.cos(i)-s[2]*Math.sin(i),o[2]=s[1]*Math.sin(i)+s[2]*Math.cos(i),n[0]=o[0]+t[0],n[1]=o[1]+t[1],n[2]=o[2]+t[2],n}function AR(n,e,t,i){const s=[],o=[];return s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],o[0]=s[2]*Math.sin(i)+s[0]*Math.cos(i),o[1]=s[1],o[2]=s[2]*Math.cos(i)-s[0]*Math.sin(i),n[0]=o[0]+t[0],n[1]=o[1]+t[1],n[2]=o[2]+t[2],n}function ER(n,e,t,i){const s=[],o=[];return s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],o[0]=s[0]*Math.cos(i)-s[1]*Math.sin(i),o[1]=s[0]*Math.sin(i)+s[1]*Math.cos(i),o[2]=s[2],n[0]=o[0]+t[0],n[1]=o[1]+t[1],n[2]=o[2]+t[2],n}function RR(n,e){const t=n[0],i=n[1],s=n[2],o=e[0],c=e[1],u=e[2],h=Math.sqrt((t*t+i*i+s*s)*(o*o+c*c+u*u)),d=h&&vR(n,e)/h;return Math.acos(Math.min(Math.max(d,-1),1))}const CR=yR;(function(){const n=mR();return function(e,t,i,s,o,c){let u,h;for(t||(t=3),i||(i=0),s?h=Math.min(s*t+i,e.length):h=e.length,u=i;u<h;u+=t)n[0]=e[u],n[1]=e[u+1],n[2]=e[u+2],o(n,n,c),e[u]=n[0],e[u+1]=n[1],e[u+2]=n[2];return e}})();const Rh=[0,0,0];let Yl;class Gn extends fR{static get ZERO(){return Yl||(Yl=new Gn(0,0,0),Object.freeze(Yl)),Yl}constructor(e=0,t=0,i=0){super(-0,-0,-0),arguments.length===1&&Yr(e)?this.copy(e):(En.debug&&(un(e),un(t),un(i)),this[0]=e,this[1]=t,this[2]=i)}set(e,t,i){return this[0]=e,this[1]=t,this[2]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return En.debug&&(un(e.x),un(e.y),un(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=un(e)}angle(e){return RR(this,e)}cross(e){return TR(this,this,e),this.check()}rotateX({radians:e,origin:t=Rh}){return wR(this,this,t,e),this.check()}rotateY({radians:e,origin:t=Rh}){return AR(this,this,t,e),this.check()}rotateZ({radians:e,origin:t=Rh}){return ER(this,this,t,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return r3(this,this,e),this.check()}transformAsVector(e){return s3(this,this,e),this.check()}transformByMatrix3(e){return xR(this,this,e),this.check()}transformByMatrix2(e){return _R(this,this,e),this.check()}transformByQuaternion(e){return SR(this,this,e),this.check()}}class MR extends n3{toString(){let e="[";if(En.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let i=0;i<this.RANK;++i)e+=` ${this[i*this.RANK+t]}`}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=` ${this[t]}`}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,i){return this[t*this.RANK+e]=un(i),this}getColumn(e,t=new Array(this.RANK).fill(-0)){const i=e*this.RANK;for(let s=0;s<this.RANK;++s)t[s]=this[i+s];return t}setColumn(e,t){const i=e*this.RANK;for(let s=0;s<this.RANK;++s)this[i+s]=t[s];return this}}function OR(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function IR(n,e){if(n===e){const t=e[1],i=e[2],s=e[3],o=e[6],c=e[7],u=e[11];n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=t,n[6]=e[9],n[7]=e[13],n[8]=i,n[9]=o,n[11]=e[14],n[12]=s,n[13]=c,n[14]=u}else n[0]=e[0],n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=e[1],n[5]=e[5],n[6]=e[9],n[7]=e[13],n[8]=e[2],n[9]=e[6],n[10]=e[10],n[11]=e[14],n[12]=e[3],n[13]=e[7],n[14]=e[11],n[15]=e[15];return n}function id(n,e){const t=e[0],i=e[1],s=e[2],o=e[3],c=e[4],u=e[5],h=e[6],d=e[7],g=e[8],m=e[9],y=e[10],T=e[11],w=e[12],C=e[13],N=e[14],V=e[15],$=t*u-i*c,O=t*h-s*c,F=t*d-o*c,H=i*h-s*u,te=i*d-o*u,oe=s*d-o*h,E=g*C-m*w,R=g*N-y*w,Y=g*V-T*w,ie=m*N-y*C,re=m*V-T*C,pe=y*V-T*N;let be=$*pe-O*re+F*ie+H*Y-te*R+oe*E;return be?(be=1/be,n[0]=(u*pe-h*re+d*ie)*be,n[1]=(s*re-i*pe-o*ie)*be,n[2]=(C*oe-N*te+V*H)*be,n[3]=(y*te-m*oe-T*H)*be,n[4]=(h*Y-c*pe-d*R)*be,n[5]=(t*pe-s*Y+o*R)*be,n[6]=(N*F-w*oe-V*O)*be,n[7]=(g*oe-y*F+T*O)*be,n[8]=(c*re-u*Y+d*E)*be,n[9]=(i*Y-t*re-o*E)*be,n[10]=(w*te-C*F+V*$)*be,n[11]=(m*F-g*te-T*$)*be,n[12]=(u*R-c*ie-h*E)*be,n[13]=(t*ie-i*R+s*E)*be,n[14]=(C*O-w*H-N*$)*be,n[15]=(g*H-m*O+y*$)*be,n):null}function NR(n){const e=n[0],t=n[1],i=n[2],s=n[3],o=n[4],c=n[5],u=n[6],h=n[7],d=n[8],g=n[9],m=n[10],y=n[11],T=n[12],w=n[13],C=n[14],N=n[15],V=e*c-t*o,$=e*u-i*o,O=t*u-i*c,F=d*w-g*T,H=d*C-m*T,te=g*C-m*w,oe=e*te-t*H+i*F,E=o*te-c*H+u*F,R=d*O-g*$+m*V,Y=T*O-w*$+C*V;return h*oe-s*E+N*R-y*Y}function Os(n,e,t){const i=e[0],s=e[1],o=e[2],c=e[3],u=e[4],h=e[5],d=e[6],g=e[7],m=e[8],y=e[9],T=e[10],w=e[11],C=e[12],N=e[13],V=e[14],$=e[15];let O=t[0],F=t[1],H=t[2],te=t[3];return n[0]=O*i+F*u+H*m+te*C,n[1]=O*s+F*h+H*y+te*N,n[2]=O*o+F*d+H*T+te*V,n[3]=O*c+F*g+H*w+te*$,O=t[4],F=t[5],H=t[6],te=t[7],n[4]=O*i+F*u+H*m+te*C,n[5]=O*s+F*h+H*y+te*N,n[6]=O*o+F*d+H*T+te*V,n[7]=O*c+F*g+H*w+te*$,O=t[8],F=t[9],H=t[10],te=t[11],n[8]=O*i+F*u+H*m+te*C,n[9]=O*s+F*h+H*y+te*N,n[10]=O*o+F*d+H*T+te*V,n[11]=O*c+F*g+H*w+te*$,O=t[12],F=t[13],H=t[14],te=t[15],n[12]=O*i+F*u+H*m+te*C,n[13]=O*s+F*h+H*y+te*N,n[14]=O*o+F*d+H*T+te*V,n[15]=O*c+F*g+H*w+te*$,n}function xc(n,e,t){const i=t[0],s=t[1],o=t[2];let c,u,h,d,g,m,y,T,w,C,N,V;return e===n?(n[12]=e[0]*i+e[4]*s+e[8]*o+e[12],n[13]=e[1]*i+e[5]*s+e[9]*o+e[13],n[14]=e[2]*i+e[6]*s+e[10]*o+e[14],n[15]=e[3]*i+e[7]*s+e[11]*o+e[15]):(c=e[0],u=e[1],h=e[2],d=e[3],g=e[4],m=e[5],y=e[6],T=e[7],w=e[8],C=e[9],N=e[10],V=e[11],n[0]=c,n[1]=u,n[2]=h,n[3]=d,n[4]=g,n[5]=m,n[6]=y,n[7]=T,n[8]=w,n[9]=C,n[10]=N,n[11]=V,n[12]=c*i+g*s+w*o+e[12],n[13]=u*i+m*s+C*o+e[13],n[14]=h*i+y*s+N*o+e[14],n[15]=d*i+T*s+V*o+e[15]),n}function Qd(n,e,t){const i=t[0],s=t[1],o=t[2];return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n[3]=e[3]*i,n[4]=e[4]*s,n[5]=e[5]*s,n[6]=e[6]*s,n[7]=e[7]*s,n[8]=e[8]*o,n[9]=e[9]*o,n[10]=e[10]*o,n[11]=e[11]*o,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function PR(n,e,t,i){let s=i[0],o=i[1],c=i[2],u=Math.sqrt(s*s+o*o+c*c),h,d,g,m,y,T,w,C,N,V,$,O,F,H,te,oe,E,R,Y,ie,re,pe,be,Ie;return u<ac?null:(u=1/u,s*=u,o*=u,c*=u,d=Math.sin(t),h=Math.cos(t),g=1-h,m=e[0],y=e[1],T=e[2],w=e[3],C=e[4],N=e[5],V=e[6],$=e[7],O=e[8],F=e[9],H=e[10],te=e[11],oe=s*s*g+h,E=o*s*g+c*d,R=c*s*g-o*d,Y=s*o*g-c*d,ie=o*o*g+h,re=c*o*g+s*d,pe=s*c*g+o*d,be=o*c*g-s*d,Ie=c*c*g+h,n[0]=m*oe+C*E+O*R,n[1]=y*oe+N*E+F*R,n[2]=T*oe+V*E+H*R,n[3]=w*oe+$*E+te*R,n[4]=m*Y+C*ie+O*re,n[5]=y*Y+N*ie+F*re,n[6]=T*Y+V*ie+H*re,n[7]=w*Y+$*ie+te*re,n[8]=m*pe+C*be+O*Ie,n[9]=y*pe+N*be+F*Ie,n[10]=T*pe+V*be+H*Ie,n[11]=w*pe+$*be+te*Ie,e!==n&&(n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n)}function a3(n,e,t){const i=Math.sin(t),s=Math.cos(t),o=e[4],c=e[5],u=e[6],h=e[7],d=e[8],g=e[9],m=e[10],y=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=o*s+d*i,n[5]=c*s+g*i,n[6]=u*s+m*i,n[7]=h*s+y*i,n[8]=d*s-o*i,n[9]=g*s-c*i,n[10]=m*s-u*i,n[11]=y*s-h*i,n}function kR(n,e,t){const i=Math.sin(t),s=Math.cos(t),o=e[0],c=e[1],u=e[2],h=e[3],d=e[8],g=e[9],m=e[10],y=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=o*s-d*i,n[1]=c*s-g*i,n[2]=u*s-m*i,n[3]=h*s-y*i,n[8]=o*i+d*s,n[9]=c*i+g*s,n[10]=u*i+m*s,n[11]=h*i+y*s,n}function o3(n,e,t){const i=Math.sin(t),s=Math.cos(t),o=e[0],c=e[1],u=e[2],h=e[3],d=e[4],g=e[5],m=e[6],y=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=o*s+d*i,n[1]=c*s+g*i,n[2]=u*s+m*i,n[3]=h*s+y*i,n[4]=d*s-o*i,n[5]=g*s-c*i,n[6]=m*s-u*i,n[7]=y*s-h*i,n}function DR(n,e){const t=e[0],i=e[1],s=e[2],o=e[3],c=t+t,u=i+i,h=s+s,d=t*c,g=i*c,m=i*u,y=s*c,T=s*u,w=s*h,C=o*c,N=o*u,V=o*h;return n[0]=1-m-w,n[1]=g+V,n[2]=y-N,n[3]=0,n[4]=g-V,n[5]=1-d-w,n[6]=T+C,n[7]=0,n[8]=y+N,n[9]=T-C,n[10]=1-d-m,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function UR(n,e,t,i,s,o,c){const u=1/(t-e),h=1/(s-i),d=1/(o-c);return n[0]=o*2*u,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=o*2*h,n[6]=0,n[7]=0,n[8]=(t+e)*u,n[9]=(s+i)*h,n[10]=(c+o)*d,n[11]=-1,n[12]=0,n[13]=0,n[14]=c*o*2*d,n[15]=0,n}function BR(n,e,t,i,s){const o=1/Math.tan(e/2);if(n[0]=o/t,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=o,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,s!=null&&s!==1/0){const c=1/(i-s);n[10]=(s+i)*c,n[14]=2*s*i*c}else n[10]=-1,n[14]=-2*i;return n}const FR=BR;function LR(n,e,t,i,s,o,c){const u=1/(e-t),h=1/(i-s),d=1/(o-c);return n[0]=-2*u,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*h,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*d,n[11]=0,n[12]=(e+t)*u,n[13]=(s+i)*h,n[14]=(c+o)*d,n[15]=1,n}const zR=LR;function VR(n,e,t,i){let s,o,c,u,h,d,g,m,y,T;const w=e[0],C=e[1],N=e[2],V=i[0],$=i[1],O=i[2],F=t[0],H=t[1],te=t[2];return Math.abs(w-F)<ac&&Math.abs(C-H)<ac&&Math.abs(N-te)<ac?OR(n):(m=w-F,y=C-H,T=N-te,s=1/Math.sqrt(m*m+y*y+T*T),m*=s,y*=s,T*=s,o=$*T-O*y,c=O*m-V*T,u=V*y-$*m,s=Math.sqrt(o*o+c*c+u*u),s?(s=1/s,o*=s,c*=s,u*=s):(o=0,c=0,u=0),h=y*u-T*c,d=T*o-m*u,g=m*c-y*o,s=Math.sqrt(h*h+d*d+g*g),s?(s=1/s,h*=s,d*=s,g*=s):(h=0,d=0,g=0),n[0]=o,n[1]=h,n[2]=m,n[3]=0,n[4]=c,n[5]=d,n[6]=y,n[7]=0,n[8]=u,n[9]=g,n[10]=T,n[11]=0,n[12]=-(o*w+c*C+u*N),n[13]=-(h*w+d*C+g*N),n[14]=-(m*w+y*C+T*N),n[15]=1,n)}function jR(){const n=new qr(4);return qr!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function HR(n,e,t){return n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n}function Ao(n,e,t){const i=e[0],s=e[1],o=e[2],c=e[3];return n[0]=t[0]*i+t[4]*s+t[8]*o+t[12]*c,n[1]=t[1]*i+t[5]*s+t[9]*o+t[13]*c,n[2]=t[2]*i+t[6]*s+t[10]*o+t[14]*c,n[3]=t[3]*i+t[7]*s+t[11]*o+t[15]*c,n}(function(){const n=jR();return function(e,t,i,s,o,c){let u,h;for(t||(t=4),i||(i=0),s?h=Math.min(s*t+i,e.length):h=e.length,u=i;u<h;u+=t)n[0]=e[u],n[1]=e[u+1],n[2]=e[u+2],n[3]=e[u+3],o(n,n,c),e[u]=n[0],e[u+1]=n[1],e[u+2]=n[2],e[u+3]=n[3];return e}})();var sd;(function(n){n[n.COL0ROW0=0]="COL0ROW0",n[n.COL0ROW1=1]="COL0ROW1",n[n.COL0ROW2=2]="COL0ROW2",n[n.COL0ROW3=3]="COL0ROW3",n[n.COL1ROW0=4]="COL1ROW0",n[n.COL1ROW1=5]="COL1ROW1",n[n.COL1ROW2=6]="COL1ROW2",n[n.COL1ROW3=7]="COL1ROW3",n[n.COL2ROW0=8]="COL2ROW0",n[n.COL2ROW1=9]="COL2ROW1",n[n.COL2ROW2=10]="COL2ROW2",n[n.COL2ROW3=11]="COL2ROW3",n[n.COL3ROW0=12]="COL3ROW0",n[n.COL3ROW1=13]="COL3ROW1",n[n.COL3ROW2=14]="COL3ROW2",n[n.COL3ROW3=15]="COL3ROW3"})(sd||(sd={}));const WR=45*Math.PI/180,$R=1,Ch=.1,Mh=500,XR=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Jn extends MR{static get IDENTITY(){return qR()}static get ZERO(){return YR()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return sd}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,i,s,o,c,u,h,d,g,m,y,T,w,C,N){return this[0]=e,this[1]=t,this[2]=i,this[3]=s,this[4]=o,this[5]=c,this[6]=u,this[7]=h,this[8]=d,this[9]=g,this[10]=m,this[11]=y,this[12]=T,this[13]=w,this[14]=C,this[15]=N,this.check()}setRowMajor(e,t,i,s,o,c,u,h,d,g,m,y,T,w,C,N){return this[0]=e,this[1]=o,this[2]=d,this[3]=T,this[4]=t,this[5]=c,this[6]=g,this[7]=w,this[8]=i,this[9]=u,this[10]=m,this[11]=C,this[12]=s,this[13]=h,this[14]=y,this[15]=N,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(XR)}fromObject(e){return this.check()}fromQuaternion(e){return DR(this,e),this.check()}frustum(e){const{left:t,right:i,bottom:s,top:o,near:c=Ch,far:u=Mh}=e;return u===1/0?KR(this,t,i,s,o,c):UR(this,t,i,s,o,c,u),this.check()}lookAt(e){const{eye:t,center:i=[0,0,0],up:s=[0,1,0]}=e;return VR(this,t,i,s),this.check()}ortho(e){const{left:t,right:i,bottom:s,top:o,near:c=Ch,far:u=Mh}=e;return zR(this,t,i,s,o,c,u),this.check()}orthographic(e){const{fovy:t=WR,aspect:i=$R,focalDistance:s=1,near:o=Ch,far:c=Mh}=e;vb(t);const u=t/2,h=s*Math.tan(u),d=h*i;return this.ortho({left:-d,right:d,bottom:-h,top:h,near:o,far:c})}perspective(e){const{fovy:t=45*Math.PI/180,aspect:i=1,near:s=.1,far:o=500}=e;return vb(t),FR(this,t,i,s,o),this.check()}determinant(){return NR(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const i=this.getScale(t),s=1/i[0],o=1/i[1],c=1/i[2];return e[0]=this[0]*s,e[1]=this[1]*o,e[2]=this[2]*c,e[3]=0,e[4]=this[4]*s,e[5]=this[5]*o,e[6]=this[6]*c,e[7]=0,e[8]=this[8]*s,e[9]=this[9]*o,e[10]=this[10]*c,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const i=this.getScale(t),s=1/i[0],o=1/i[1],c=1/i[2];return e[0]=this[0]*s,e[1]=this[1]*o,e[2]=this[2]*c,e[3]=this[4]*s,e[4]=this[5]*o,e[5]=this[6]*c,e[6]=this[8]*s,e[7]=this[9]*o,e[8]=this[10]*c,e}transpose(){return IR(this,this),this.check()}invert(){return id(this,this),this.check()}multiplyLeft(e){return Os(this,e,this),this.check()}multiplyRight(e){return Os(this,this,e),this.check()}rotateX(e){return a3(this,this,e),this.check()}rotateY(e){return kR(this,this,e),this.check()}rotateZ(e){return o3(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return PR(this,this,e,t),this.check()}scale(e){return Qd(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return xc(this,this,e),this.check()}transform(e,t){return e.length===4?(t=Ao(t||[-0,-0,-0,-0],e,this),Eh(t,4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){const{length:i}=e;let s;switch(i){case 2:s=pR(t||[-0,-0],e,this);break;case 3:s=r3(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Eh(s,e.length),s}transformAsVector(e,t){let i;switch(e.length){case 2:i=gR(t||[-0,-0],e,this);break;case 3:i=s3(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Eh(i,e.length),i}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,i){return this.identity().translate([e,t,i])}}let ql,Kl;function YR(){return ql||(ql=new Jn([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(ql)),ql}function qR(){return Kl||(Kl=new Jn,Object.freeze(Kl)),Kl}function vb(n){if(n>Math.PI*2)throw Error("expected radians")}function KR(n,e,t,i,s,o){const c=2*o/(t-e),u=2*o/(s-i),h=(t+e)/(t-e),d=(s+i)/(s-i),g=-1,m=-1,y=-2*o;return n[0]=c,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=u,n[6]=0,n[7]=0,n[8]=h,n[9]=d,n[10]=g,n[11]=m,n[12]=0,n[13]=0,n[14]=y,n[15]=0,n}function l3(n,e=[],t=0){const i=Math.fround(n),s=n-i;return e[t]=i,e[t+1]=s,e}function ZR(n){return n-Math.fround(n)}function QR(n){const e=new Float32Array(32);for(let t=0;t<4;++t)for(let i=0;i<4;++i){const s=t*4+i;l3(n[i*4+t],e,s*2)}return e}const GR=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,JR={name:"fp32",vs:GR},eC=`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,tC={ONE:1},nC={name:"fp64arithmetic",vs:eC,defaultUniforms:tC,uniformTypes:{ONE:"f32"},fp64ify:l3,fp64LowPart:ZR,fp64ifyMatrix4:QR},iC=[0,1,1,1],sC=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,rC=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,Tb={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:iC},vs:sC,fs:rC,getUniforms:aC};function aC(n={},e){const t={};if(n.highlightedObjectColor!==void 0)if(n.highlightedObjectColor===null)t.isHighlightActive=!1;else{t.isHighlightActive=!0;const i=n.highlightedObjectColor.slice(0,3);t.highlightedObjectColor=i}if(n.highlightColor){const i=Array.from(n.highlightColor,s=>s/255);Number.isFinite(i[3])||(i[3]=1),t.highlightColor=i}return n.isActive!==void 0&&(t.isActive=!!n.isActive,t.isAttribute=!!n.isAttribute),n.useFloatColors!==void 0&&(t.useFloatColors=!!n.useFloatColors),t}const xb=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,oC={name:"layer",vs:xb,fs:xb,getUniforms:n=>({opacity:Math.pow(n.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},lC=`const SMOOTH_EDGE_RADIUS: f32 = 0.5;

struct VertexGeometry {
  position: vec4<f32>,
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

var<private> geometry_: VertexGeometry = VertexGeometry(
  vec4<f32>(0.0, 0.0, 1.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec2<f32>(0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0)
);

struct FragmentGeometry {
  uv: vec2<f32>,
};

var<private> fragmentGeometry: FragmentGeometry;

fn smoothedge(edge: f32, x: f32) -> f32 {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,c3="#define SMOOTH_EDGE_RADIUS 0.5",cC=`${c3}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,uC=`${c3}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,u3={name:"geometry",source:lC,vs:cC,fs:uC},fC=25;var St;(function(n){n[n.Start=1]="Start",n[n.Move=2]="Move",n[n.End=4]="End",n[n.Cancel=8]="Cancel"})(St||(St={}));var Rt;(function(n){n[n.None=0]="None",n[n.Left=1]="Left",n[n.Right=2]="Right",n[n.Up=4]="Up",n[n.Down=8]="Down",n[n.Horizontal=3]="Horizontal",n[n.Vertical=12]="Vertical",n[n.All=15]="All"})(Rt||(Rt={}));var Ee;(function(n){n[n.Possible=1]="Possible",n[n.Began=2]="Began",n[n.Changed=4]="Changed",n[n.Ended=8]="Ended",n[n.Recognized=8]="Recognized",n[n.Cancelled=16]="Cancelled",n[n.Failed=32]="Failed"})(Ee||(Ee={}));const hC="compute",dC="auto",rd="manipulation",oc="none",ad="pan-x",od="pan-y";function pC(n){if(n.includes(oc))return oc;const e=n.includes(ad),t=n.includes(od);return e&&t?oc:e||t?e?ad:od:n.includes(rd)?rd:dC}class gC{constructor(e,t){this.actions="",this.manager=e,this.set(t)}set(e){e===hC&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(const t of this.manager.recognizers)t.options.enable&&(e=e.concat(t.getTouchAction()));return pC(e.join(" "))}}function Sc(n){return n.trim().split(/\s+/g)}function Oh(n,e,t){if(n)for(const i of Sc(e))n.addEventListener(i,t,!1)}function Ih(n,e,t){if(n)for(const i of Sc(e))n.removeEventListener(i,t,!1)}function Sb(n){return(n.ownerDocument||n).defaultView}function _C(n,e){let t=n;for(;t;){if(t===e)return!0;t=t.parentNode}return!1}function f3(n){const e=n.length;if(e===1)return{x:Math.round(n[0].clientX),y:Math.round(n[0].clientY)};let t=0,i=0,s=0;for(;s<e;)t+=n[s].clientX,i+=n[s].clientY,s++;return{x:Math.round(t/e),y:Math.round(i/e)}}function wb(n){const e=[];let t=0;for(;t<n.pointers.length;)e[t]={clientX:Math.round(n.pointers[t].clientX),clientY:Math.round(n.pointers[t].clientY)},t++;return{timeStamp:Date.now(),pointers:e,center:f3(e),deltaX:n.deltaX,deltaY:n.deltaY}}function h3(n,e){const t=e.x-n.x,i=e.y-n.y;return Math.sqrt(t*t+i*i)}function Ab(n,e){const t=e.clientX-n.clientX,i=e.clientY-n.clientY;return Math.sqrt(t*t+i*i)}function mC(n,e){const t=e.x-n.x,i=e.y-n.y;return Math.atan2(i,t)*180/Math.PI}function Eb(n,e){const t=e.clientX-n.clientX,i=e.clientY-n.clientY;return Math.atan2(i,t)*180/Math.PI}function d3(n,e){return n===e?Rt.None:Math.abs(n)>=Math.abs(e)?n<0?Rt.Left:Rt.Right:e<0?Rt.Up:Rt.Down}function yC(n,e){const t=e.center;let i=n.offsetDelta,s=n.prevDelta;const o=n.prevInput;return(e.eventType===St.Start||o?.eventType===St.End)&&(s=n.prevDelta={x:o?.deltaX||0,y:o?.deltaY||0},i=n.offsetDelta={x:t.x,y:t.y}),{deltaX:s.x+(t.x-i.x),deltaY:s.y+(t.y-i.y)}}function p3(n,e,t){return{x:e/n||0,y:t/n||0}}function bC(n,e){return Ab(e[0],e[1])/Ab(n[0],n[1])}function vC(n,e){return Eb(e[1],e[0])-Eb(n[1],n[0])}function TC(n,e){const t=n.lastInterval||e,i=e.timeStamp-t.timeStamp;let s,o,c,u;if(e.eventType!==St.Cancel&&(i>fC||t.velocity===void 0)){const h=e.deltaX-t.deltaX,d=e.deltaY-t.deltaY,g=p3(i,h,d);o=g.x,c=g.y,s=Math.abs(g.x)>Math.abs(g.y)?g.x:g.y,u=d3(h,d),n.lastInterval=e}else s=t.velocity,o=t.velocityX,c=t.velocityY,u=t.direction;e.velocity=s,e.velocityX=o,e.velocityY=c,e.direction=u}function xC(n,e){const{session:t}=n,{pointers:i}=e,{length:s}=i;t.firstInput||(t.firstInput=wb(e)),s>1&&!t.firstMultiple?t.firstMultiple=wb(e):s===1&&(t.firstMultiple=!1);const{firstInput:o,firstMultiple:c}=t,u=c?c.center:o.center,h=e.center=f3(i);e.timeStamp=Date.now(),e.deltaTime=e.timeStamp-o.timeStamp,e.angle=mC(u,h),e.distance=h3(u,h);const{deltaX:d,deltaY:g}=yC(t,e);e.deltaX=d,e.deltaY=g,e.offsetDirection=d3(e.deltaX,e.deltaY);const m=p3(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=m.x,e.overallVelocityY=m.y,e.overallVelocity=Math.abs(m.x)>Math.abs(m.y)?m.x:m.y,e.scale=c?bC(c.pointers,i):1,e.rotation=c?vC(c.pointers,i):0,e.maxPointers=t.prevInput?e.pointers.length>t.prevInput.maxPointers?e.pointers.length:t.prevInput.maxPointers:e.pointers.length;let y=n.element;return _C(e.srcEvent.target,y)&&(y=e.srcEvent.target),e.target=y,TC(t,e),e}function SC(n,e,t){const i=t.pointers.length,s=t.changedPointers.length,o=e&St.Start&&i-s===0,c=e&(St.End|St.Cancel)&&i-s===0;t.isFirst=!!o,t.isFinal=!!c,o&&(n.session={}),t.eventType=e;const u=xC(n,t);n.emit("hammer.input",u),n.recognize(u),n.session.prevInput=u}let wC=class{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=t=>{this.manager.options.enable&&this.handler(t)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,t){SC(this.manager,e,t)}init(){Oh(this.element,this.evEl,this.domHandler),Oh(this.target,this.evTarget,this.domHandler),Oh(Sb(this.element),this.evWin,this.domHandler)}destroy(){Ih(this.element,this.evEl,this.domHandler),Ih(this.target,this.evTarget,this.domHandler),Ih(Sb(this.element),this.evWin,this.domHandler)}};const AC={pointerdown:St.Start,pointermove:St.Move,pointerup:St.End,pointercancel:St.Cancel,pointerout:St.Cancel},EC="pointerdown",RC="pointermove pointerup pointercancel";class CC extends wC{constructor(e){super(e),this.evEl=EC,this.evWin=RC,this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){const{store:t}=this;let i=!1;const s=AC[e.type],o=e.pointerType,c=o==="touch";let u=t.findIndex(h=>h.pointerId===e.pointerId);s&St.Start&&(e.buttons||c)?u<0&&(t.push(e),u=t.length-1):s&(St.End|St.Cancel)&&(i=!0),!(u<0)&&(t[u]=e,this.callback(s,{pointers:t,changedPointers:[e],eventType:s,pointerType:o,srcEvent:e}),i&&t.splice(u,1))}}const MC=["","webkit","Moz","MS","ms","o"];function OC(n,e){const t=e[0].toUpperCase()+e.slice(1);for(const i of MC){const s=i?i+t:e;if(s in n)return s}}const IC=1,Rb=2,Cb={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class NC{constructor(e,t){this.options={...Cb,...t,cssProps:{...Cb.cssProps,...t.cssProps},inputTarget:t.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new CC(this),this.touchAction=new gC(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?Rb:IC}recognize(e){const{session:t}=this;if(t.stopped)return;this.session.prevented&&e.srcEvent.preventDefault();let i;const{recognizers:s}=this;let{curRecognizer:o}=t;(!o||o&&o.state&Ee.Recognized)&&(o=t.curRecognizer=null);let c=0;for(;c<s.length;)i=s[c],t.stopped!==Rb&&(!o||i===o||i.canRecognizeWith(o))?i.recognize(e):i.reset(),!o&&i.state&(Ee.Began|Ee.Changed|Ee.Ended)&&(o=t.curRecognizer=i),c++}get(e){const{recognizers:t}=this;for(let i=0;i<t.length;i++)if(t[i].options.event===e)return t[i];return null}add(e){if(Array.isArray(e)){for(const i of e)this.add(i);return this}const t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(const i of e)this.remove(i);return this}const t=typeof e=="string"?this.get(e):e;if(t){const{recognizers:i}=this,s=i.indexOf(t);s!==-1&&(i.splice(s,1),this.touchAction.update())}return this}on(e,t){if(!e||!t)return;const{handlers:i}=this;for(const s of Sc(e))i[s]=i[s]||[],i[s].push(t)}off(e,t){if(!e)return;const{handlers:i}=this;for(const s of Sc(e))t?i[s]&&i[s].splice(i[s].indexOf(t),1):delete i[s]}emit(e,t){const i=this.handlers[e]&&this.handlers[e].slice();if(!i||!i.length)return;const s=t;s.type=e,s.preventDefault=function(){t.srcEvent.preventDefault()};let o=0;for(;o<i.length;)i[o](s),o++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){const{element:t}=this;if(t){for(const[i,s]of Object.entries(this.options.cssProps)){const o=OC(t.style,i);e?(this.oldCssProps[o]=t.style[o],t.style[o]=s):t.style[o]=this.oldCssProps[o]||""}e||(this.oldCssProps={})}}}let PC=1;function kC(){return PC++}function Mb(n){return n&Ee.Cancelled?"cancel":n&Ee.Ended?"end":n&Ee.Changed?"move":n&Ee.Began?"start":""}class g3{constructor(e){this.options=e,this.id=kC(),this.state=Ee.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(const s of e)this.recognizeWith(s);return this}let t;if(typeof e=="string"){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{simultaneous:i}=this;return i[t.id]||(i[t.id]=t,t.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(const i of e)this.dropRecognizeWith(i);return this}let t;return typeof e=="string"?t=this.manager.get(e):t=e,t&&delete this.simultaneous[t.id],this}requireFailure(e){if(Array.isArray(e)){for(const s of e)this.requireFailure(s);return this}let t;if(typeof e=="string"){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{requireFail:i}=this;return i.indexOf(t)===-1&&(i.push(t),t.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(const i of e)this.dropRequireFailure(i);return this}let t;if(typeof e=="string"?t=this.manager.get(e):t=e,t){const i=this.requireFail.indexOf(t);i>-1&&this.requireFail.splice(i,1)}return this}hasRequireFailures(){return!!this.requireFail.find(e=>e.options.enable)}canRecognizeWith(e){return!!this.simultaneous[e.id]}emit(e){if(!e)return;const{state:t}=this;t<Ee.Ended&&this.manager.emit(this.options.event+Mb(t),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),t>=Ee.Ended&&this.manager.emit(this.options.event+Mb(t),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=Ee.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(Ee.Failed|Ee.Possible)))return!1;e++}return!0}recognize(e){const t={...e};if(!this.options.enable){this.reset(),this.state=Ee.Failed;return}this.state&(Ee.Recognized|Ee.Cancelled|Ee.Failed)&&(this.state=Ee.Possible),this.state=this.process(t),this.state&(Ee.Began|Ee.Changed|Ee.Ended|Ee.Cancelled)&&this.tryEmit(t)}getEventNames(){return[this.options.event]}reset(){}}class _3 extends g3{attrTest(e){const t=this.options.pointers;return t===0||e.pointers.length===t}process(e){const{state:t}=this,{eventType:i}=e,s=t&(Ee.Began|Ee.Changed),o=this.attrTest(e);return s&&(i&St.Cancel||!o)?t|Ee.Cancelled:s||o?i&St.End?t|Ee.Ended:t&Ee.Began?t|Ee.Changed:Ee.Began:Ee.Failed}}class Ob extends g3{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[rd]}process(e){const{options:t}=this,i=e.pointers.length===t.pointers,s=e.distance<t.threshold,o=e.deltaTime<t.time;if(this.reset(),e.eventType&St.Start&&this.count===0)return this.failTimeout();if(s&&o&&i){if(e.eventType!==St.End)return this.failTimeout();const c=this.pTime?e.timeStamp-this.pTime<t.interval:!0,u=!this.pCenter||h3(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,!u||!c?this.count=1:this.count+=1,this._input=e,this.count%t.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=Ee.Recognized,this.tryEmit(this._input)},t.interval),Ee.Began):Ee.Recognized}return Ee.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=Ee.Failed},this.options.interval),Ee.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===Ee.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}const DC=["","start","move","end","cancel","up","down","left","right"];class Ib extends _3{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:Rt.All,...e}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:e}}=this,t=[];return e&Rt.Horizontal&&t.push(od),e&Rt.Vertical&&t.push(ad),t}getEventNames(){return DC.map(e=>this.options.event+e)}directionTest(e){const{options:t}=this;let i=!0,{distance:s}=e,{direction:o}=e;const c=e.deltaX,u=e.deltaY;return o&t.direction||(t.direction&Rt.Horizontal?(o=c===0?Rt.None:c<0?Rt.Left:Rt.Right,i=c!==this.pX,s=Math.abs(e.deltaX)):(o=u===0?Rt.None:u<0?Rt.Up:Rt.Down,i=u!==this.pY,s=Math.abs(e.deltaY))),e.direction=o,i&&s>t.threshold&&!!(o&t.direction)}attrTest(e){return super.attrTest(e)&&(!!(this.state&Ee.Began)||!(this.state&Ee.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;const t=Rt[e.direction].toLowerCase();t&&(e.additionalEvent=this.options.event+t),super.emit(e)}}const UC=["","start","move","end","cancel","in","out"];class BC extends _3{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[oc]}getEventNames(){return UC.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||!!(this.state&Ee.Began))}emit(e){if(e.scale!==1){const t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}super.emit(e)}}class Fc{constructor(e,t,i){this.element=e,this.callback=t,this.options=i}}const FC=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",LC=FC.indexOf("firefox")!==-1,Nb=4.000244140625,zC=40,VC=.25;class jC extends Fc{constructor(e,t,i){super(e,t,{enable:!0,...i}),this.handleEvent=s=>{if(!this.options.enable)return;let o=s.deltaY;globalThis.WheelEvent&&(LC&&s.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(o/=globalThis.devicePixelRatio),s.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(o*=zC)),o!==0&&o%Nb===0&&(o=Math.floor(o/Nb)),s.shiftKey&&o&&(o=o*VC),this.callback({type:"wheel",center:{x:s.clientX,y:s.clientY},delta:-o,srcEvent:s,pointerType:"mouse",target:s.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,t){e==="wheel"&&(this.options.enable=t)}}const Pb=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class HC extends Fc{constructor(e,t,i){super(e,t,{enable:!0,...i}),this.handleEvent=o=>{this.handleOverEvent(o),this.handleOutEvent(o),this.handleEnterEvent(o),this.handleLeaveEvent(o),this.handleMoveEvent(o)},this.pressed=!1;const{enable:s}=this.options;this.enableMoveEvent=s,this.enableLeaveEvent=s,this.enableEnterEvent=s,this.enableOutEvent=s,this.enableOverEvent=s,Pb.forEach(o=>e.addEventListener(o,this.handleEvent))}destroy(){Pb.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){switch(e){case"pointermove":this.enableMoveEvent=t;break;case"pointerover":this.enableOverEvent=t;break;case"pointerout":this.enableOutEvent=t;break;case"pointerenter":this.enableEnterEvent=t;break;case"pointerleave":this.enableLeaveEvent=t;break}}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1;break}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}const kb=["keydown","keyup"];class WC extends Fc{constructor(e,t,i){super(e,t,{enable:!0,tabIndex:0,...i}),this.handleEvent=s=>{const o=s.target||s.srcElement;o.tagName==="INPUT"&&o.type==="text"||o.tagName==="TEXTAREA"||(this.enableDownEvent&&s.type==="keydown"&&this.callback({type:"keydown",srcEvent:s,key:s.key,target:s.target}),this.enableUpEvent&&s.type==="keyup"&&this.callback({type:"keyup",srcEvent:s,key:s.key,target:s.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",kb.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){kb.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e==="keydown"&&(this.enableDownEvent=t),e==="keyup"&&(this.enableUpEvent=t)}}class $C extends Fc{constructor(e,t,i){super(e,t,i),this.handleEvent=s=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:s.clientX,y:s.clientY},srcEvent:s,pointerType:"mouse",target:s.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){e==="contextmenu"&&(this.options.enable=t)}}const Db=1,ld=2,Ub=4,XC={pointerdown:Db,pointermove:ld,pointerup:Ub,mousedown:Db,mousemove:ld,mouseup:Ub},YC=0,qC=1,KC=2,ZC=1,QC=2,GC=4;function JC(n){const e=XC[n.srcEvent.type];if(!e)return null;const{buttons:t,button:i}=n.srcEvent;let s=!1,o=!1,c=!1;return e===ld?(s=!!(t&ZC),o=!!(t&GC),c=!!(t&QC)):(s=i===YC,o=i===qC,c=i===KC),{leftButton:s,middleButton:o,rightButton:c}}function eM(n,e){const t=n.center;if(!t)return null;const i=e.getBoundingClientRect(),s=i.width/e.offsetWidth||1,o=i.height/e.offsetHeight||1,c={x:(t.x-i.left-e.clientLeft)/s,y:(t.y-i.top-e.clientTop)/o};return{center:t,offsetCenter:c}}const tM={srcElement:"root",priority:0};class nM{constructor(e,t){this.handleEvent=i=>{if(this.isEmpty())return;const s=this._normalizeEvent(i);let o=i.srcEvent.target;for(;o&&o!==s.rootElement;){if(this._emit(s,o),s.handled)return;o=o.parentNode}this._emit(s,"root")},this.eventManager=e,this.recognizerName=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,i,s=!1,o=!1){const{handlers:c,handlersByElement:u}=this,h={...tM,...i};let d=u.get(h.srcElement);d||(d=[],u.set(h.srcElement,d));const g={type:e,handler:t,srcElement:h.srcElement,priority:h.priority};s&&(g.once=!0),o&&(g.passive=!0),c.push(g),this._active=this._active||!g.passive;let m=d.length-1;for(;m>=0&&!(d[m].priority>=g.priority);)m--;d.splice(m+1,0,g)}remove(e,t){const{handlers:i,handlersByElement:s}=this;for(let o=i.length-1;o>=0;o--){const c=i[o];if(c.type===e&&c.handler===t){i.splice(o,1);const u=s.get(c.srcElement);u.splice(u.indexOf(c),1),u.length===0&&s.delete(c.srcElement)}}this._active=i.some(o=>!o.passive)}_emit(e,t){const i=this.handlersByElement.get(t);if(i){let s=!1;const o=()=>{e.handled=!0},c=()=>{e.handled=!0,s=!0},u=[];for(let h=0;h<i.length;h++){const{type:d,handler:g,once:m}=i[h];if(g({...e,type:d,stopPropagation:o,stopImmediatePropagation:c}),m&&u.push(i[h]),s)break}for(let h=0;h<u.length;h++){const{type:d,handler:g}=u[h];this.remove(d,g)}}}_normalizeEvent(e){const t=this.eventManager.getElement();return{...e,...JC(e),...eM(e,t),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}}function iM(n){if("recognizer"in n)return n;let e;const t=Array.isArray(n)?[...n]:[n];if(typeof t[0]=="function"){const i=t.shift(),s=t.shift()||{};e=new i(s)}else e=t.shift();return{recognizer:e,recognizeWith:typeof t[0]=="string"?[t[0]]:t[0],requireFailure:typeof t[1]=="string"?[t[1]]:t[1]}}class sM{constructor(e=null,t={}){if(this._onBasicInput=i=>{this.manager.emit(i.srcEvent.type,i)},this._onOtherEvent=i=>{this.manager.emit(i.type,i)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...t},this.events=new Map,this.element=e,!!e){this.manager=new NC(e,this.options);for(const i of this.options.recognizers){const{recognizer:s,recognizeWith:o,requireFailure:c}=iM(i);this.manager.add(s),o&&s.recognizeWith(o),c&&s.requireFailure(c)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new jC(e,this._onOtherEvent,{enable:!1}),this.moveInput=new HC(e,this._onOtherEvent,{enable:!1}),this.keyInput=new WC(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new $C(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,t,i){this._addEventHandler(e,t,i,!1)}once(e,t,i){this._addEventHandler(e,t,i,!0)}watch(e,t,i){this._addEventHandler(e,t,i,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){const{manager:i}=this;if(!i)return;const s=i.get(e);s&&(s.set({enable:t}),i.touchAction.update()),this.wheelInput?.enableEventType(e,t),this.moveInput?.enableEventType(e,t),this.keyInput?.enableEventType(e,t),this.contextmenuInput?.enableEventType(e,t)}_addEventHandler(e,t,i,s,o){if(typeof e!="string"){i=t;for(const[d,g]of Object.entries(e))this._addEventHandler(d,g,i,s,o);return}const{manager:c,events:u}=this;if(!c)return;let h=u.get(e);if(!h){const d=this._getRecognizerName(e)||e;h=new nM(this,d),u.set(e,h),c&&c.on(e,h.handleEvent)}h.add(e,t,i,s,o),h.isEmpty()||this._toggleRecognizer(h.recognizerName,!0)}_removeEventHandler(e,t){if(typeof e!="string"){for(const[o,c]of Object.entries(e))this._removeEventHandler(o,c);return}const{events:i}=this,s=i.get(e);if(s&&(s.remove(e,t),s.isEmpty())){const{recognizerName:o}=s;let c=!1;for(const u of i.values())if(u.recognizerName===o&&!u.isEmpty()){c=!0;break}c||this._toggleRecognizer(o,!1)}}_getRecognizerName(e){return this.manager.recognizers.find(t=>t.getEventNames().includes(e))?.options.event}}const Ue={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(Ue,"IDENTITY",{get:()=>(et.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const wn={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Us={common:0,meters:1,pixels:2},cd={click:"onClick",dblclick:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},Bb={multipan:[Ib,{threshold:10,direction:Rt.Vertical,pointers:2}],pinch:[BC,{},null,["multipan"]],pan:[Ib,{threshold:1},["pinch"],["multipan"]],dblclick:[Ob,{event:"dblclick",taps:2}],click:[Ob,{event:"click"},null,["dblclick"]]};function rM(n,e){if(n===e)return!0;if(Array.isArray(n)){const t=n.length;if(!e||e.length!==t)return!1;for(let i=0;i<t;i++)if(n[i]!==e[i])return!1;return!0}return!1}function Eo(n){let e={},t;return i=>{for(const s in i)if(!rM(i[s],e[s])){t=n(i),e=i;break}return t}}const Fb=[0,0,0,0],aM=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],m3=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],oM=[0,0,0],y3=[0,0,0],lM=Eo(fM);function b3(n,e,t=y3){t.length<3&&(t=[t[0],t[1],0]);let i=t,s,o=!0;switch(e===Ue.LNGLAT_OFFSETS||e===Ue.METER_OFFSETS?s=t:s=n.isGeospatial?[Math.fround(n.longitude),Math.fround(n.latitude),0]:null,n.projectionMode){case wn.WEB_MERCATOR:(e===Ue.LNGLAT||e===Ue.CARTESIAN)&&(s=[0,0,0],o=!1);break;case wn.WEB_MERCATOR_AUTO_OFFSET:e===Ue.LNGLAT?i=s:e===Ue.CARTESIAN&&(i=[Math.fround(n.center[0]),Math.fround(n.center[1]),0],s=n.unprojectPosition(i),i[0]-=t[0],i[1]-=t[1],i[2]-=t[2]);break;case wn.IDENTITY:i=n.position.map(Math.fround),i[2]=i[2]||0;break;case wn.GLOBE:o=!1,s=null;break;default:o=!1}return{geospatialOrigin:s,shaderCoordinateOrigin:i,offsetMode:o}}function cM(n,e,t){const{viewMatrixUncentered:i,projectionMatrix:s}=n;let{viewMatrix:o,viewProjectionMatrix:c}=n,u=Fb,h=Fb,d=n.cameraPosition;const{geospatialOrigin:g,shaderCoordinateOrigin:m,offsetMode:y}=b3(n,e,t);return y&&(h=n.projectPosition(g||m),d=[d[0]-h[0],d[1]-h[1],d[2]-h[2]],h[3]=1,u=Ao([],h,c),o=i||o,c=Os([],s,o),c=Os([],c,aM)),{viewMatrix:o,viewProjectionMatrix:c,projectionCenter:u,originCommon:h,cameraPosCommon:d,shaderCoordinateOrigin:m,geospatialOrigin:g}}function uM({viewport:n,devicePixelRatio:e=1,modelMatrix:t=null,coordinateSystem:i=Ue.DEFAULT,coordinateOrigin:s=y3,autoWrapLongitude:o=!1}){i===Ue.DEFAULT&&(i=n.isGeospatial?Ue.LNGLAT:Ue.CARTESIAN);const c=lM({viewport:n,devicePixelRatio:e,coordinateSystem:i,coordinateOrigin:s});return c.wrapLongitude=o,c.modelMatrix=t||m3,c}function fM({viewport:n,devicePixelRatio:e,coordinateSystem:t,coordinateOrigin:i}){const{projectionCenter:s,viewProjectionMatrix:o,originCommon:c,cameraPosCommon:u,shaderCoordinateOrigin:h,geospatialOrigin:d}=cM(n,t,i),g=n.getDistanceScales(),m=[n.width*e,n.height*e],y=Ao([],[0,0,-n.focalDistance,1],n.projectionMatrix)[3]||1,T={coordinateSystem:t,projectionMode:n.projectionMode,coordinateOrigin:h,commonOrigin:c.slice(0,3),center:s,pseudoMeters:!!n._pseudoMeters,viewportSize:m,devicePixelRatio:e,focalDistance:y,commonUnitsPerMeter:g.unitsPerMeter,commonUnitsPerWorldUnit:g.unitsPerMeter,commonUnitsPerWorldUnit2:oM,scale:n.scale,wrapLongitude:!1,viewProjectionMatrix:o,modelMatrix:m3,cameraPosition:u};if(d){const w=n.getDistanceScales(d);switch(t){case Ue.METER_OFFSETS:T.commonUnitsPerWorldUnit=w.unitsPerMeter,T.commonUnitsPerWorldUnit2=w.unitsPerMeter2;break;case Ue.LNGLAT:case Ue.LNGLAT_OFFSETS:n._pseudoMeters||(T.commonUnitsPerMeter=w.unitsPerMeter),T.commonUnitsPerWorldUnit=w.unitsPerDegree,T.commonUnitsPerWorldUnit2=w.unitsPerDegree2;break;case Ue.CARTESIAN:T.commonUnitsPerWorldUnit=[1,1,w.unitsPerMeter[2]],T.commonUnitsPerWorldUnit2=[0,0,w.unitsPerMeter2[2]];break}}return T}const hM=Object.keys(Ue).map(n=>`const COORDINATE_SYSTEM_${n}: i32 = ${Ue[n]};`).join(""),dM=Object.keys(wn).map(n=>`const PROJECTION_MODE_${n}: i32 = ${wn[n]};`).join(""),pM=Object.keys(Us).map(n=>`const UNIT_${n.toUpperCase()}: i32 = ${Us[n]};`).join(""),gM=`${hM}
${dM}
${pM}

const TILE_SIZE: f32 = 512.0;
const PI: f32 = 3.1415926536;
const WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);
const ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);
const EARTH_RADIUS: f32 = 6370972.0; // meters
const GLOBE_RADIUS: f32 = 256.0;

// -----------------------------------------------------------------------------
// Uniform block (converted from GLSL uniform block)
// -----------------------------------------------------------------------------
struct ProjectUniforms {
  wrapLongitude: i32,
  coordinateSystem: i32,
  commonUnitsPerMeter: vec3<f32>,
  projectionMode: i32,
  scale: f32,
  commonUnitsPerWorldUnit: vec3<f32>,
  commonUnitsPerWorldUnit2: vec3<f32>,
  center: vec4<f32>,
  modelMatrix: mat4x4<f32>,
  viewProjectionMatrix: mat4x4<f32>,
  viewportSize: vec2<f32>,
  devicePixelRatio: f32,
  focalDistance: f32,
  cameraPosition: vec3<f32>,
  coordinateOrigin: vec3<f32>,
  commonOrigin: vec3<f32>,
  pseudoMeters: i32,
};

@group(0) @binding(0)
var<uniform> project: ProjectUniforms;

// -----------------------------------------------------------------------------
// Geometry data
// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,
// you might supply this via vertex attributes or a uniform. Here we define a
// uniform struct for demonstration.)
// -----------------------------------------------------------------------------

// Structure to carry additional geometry data used by deck.gl filters.
struct Geometry {
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  position: vec4<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

// @group(0) @binding(1)
var<private> geometry: Geometry;
`,_M=`${gM}

// -----------------------------------------------------------------------------
// Functions
// -----------------------------------------------------------------------------

// Returns an adjustment factor for commonUnitsPerMeter
fn _project_size_at_latitude(lat: f32) -> f32 {
  let y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

// Overloaded version: scales a value in meters at a given latitude.
fn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);
}

// Computes a non-linear scale factor based on geometry.
// (Note: This function relies on "geometry" being provided.)
fn project_size() -> f32 {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
      project.pseudoMeters == 0) {
    if (geometry.position.w == 0.0) {
      return _project_size_at_latitude(geometry.worldPosition.y);
    }
    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    let y2 = y * y;
    let y4 = y2 * y2;
    let y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

// Overloads to scale offsets (meters to world units)
fn project_size_float(meters: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * project_size();
}

fn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {
  return meters * project.commonUnitsPerMeter.xy * project_size();
}

fn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {
  return meters * project.commonUnitsPerMeter * project_size();
}

fn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {
  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);
}

// Returns a rotation matrix aligning the z‑axis with the given up vector.
fn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {
  let uz = normalize(up);
  let ux = select(
    vec3<f32>(1.0, 0.0, 0.0),
    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),
    abs(uz.z) == 1.0
  );
  let uy = cross(uz, ux);
  return mat3x3<f32>(ux, uy, uz);
}

// Since WGSL does not support "out" parameters, we return a struct.
struct RotationResult {
  needsRotation: bool,
  transform: mat3x3<f32>,
};

fn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    return RotationResult(true, project_get_orientation_matrix(commonPosition));
  } else {
    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed
  };
}

// Projects a normal vector from the current coordinate system to world space.
fn project_normal(vector: vec3<f32>) -> vec3<f32> {
  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);
  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
  let rotResult = project_needs_rotation(geometry.position.xyz);
  if (rotResult.needsRotation) {
    n = rotResult.transform * n;
  }
  return n;
}

// Applies a scale offset based on y-offset (dy)
fn project_offset_(offset: vec4<f32>) -> vec4<f32> {
  let dy: f32 = offset.y;
  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

// Projects lng/lat coordinates to a unit tile [0,1]
fn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {
  var x = lnglat.x;
  if (project.wrapLongitude != 0) {
    x = ((x + 180.0) % 360.0) - 180.0;
  }
  let y = clamp(lnglat.y, -89.9, 89.9);
  return vec2<f32>(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// Projects lng/lat/z coordinates for a globe projection.
fn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {
  let lambda = radians(lnglatz.x);
  let phi = radians(lnglatz.y);
  let cosPhi = cos(phi);
  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
  return vec3<f32>(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

// Projects positions (with an optional 64-bit low part) from the input
// coordinate system to the common space.
fn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {
  var position_world = project.modelMatrix * position;

  // Work around for a Mac+NVIDIA bug:
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_mercator_(position_world.xy),
        _project_size_at_latitude_m(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);
    }
  }
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
        return vec4<f32>(
          project_mercator_(position_world.xy) - project.commonOrigin.xy,
          project_size_float(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);
  }

  return project_offset_(position_world) +
         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));
}

// Overloaded versions for different input types.
fn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {
  return project_position_vec4_f64(position, ZERO_64_LOW);
}

fn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);
  return projected_position.xyz;
}

fn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

fn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

// Transforms a common space position to clip space.
fn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {
  return viewProjectionMatrix * position + center;
}

// Uses the project viewProjectionMatrix and center.
fn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {
  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);
}

// Returns a clip space offset corresponding to a given number of screen pixels.
fn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {
  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
  return offset * project.focalDistance;
}

fn project_meter_size_to_pixel(meters: f32) -> f32 {
  return project_size_float(meters) * project.scale;
}

fn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {
  if (unit == UNIT_METERS) {
    return project_meter_size_to_pixel(size);
  } else if (unit == UNIT_COMMON) {
    return size * project.scale;
  }
  // UNIT_PIXELS: no scaling applied.
  return size;
}

fn project_pixel_size_float(pixels: f32) -> f32 {
  return pixels / project.scale;
}

fn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {
  return pixels / project.scale;
}
`,mM=Object.keys(Ue).map(n=>`const int COORDINATE_SYSTEM_${n} = ${Ue[n]};`).join(""),yM=Object.keys(wn).map(n=>`const int PROJECTION_MODE_${n} = ${wn[n]};`).join(""),bM=Object.keys(Us).map(n=>`const int UNIT_${n.toUpperCase()} = ${Us[n]};`).join(""),vM=`${mM}
${yM}
${bM}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`,TM={};function xM(n=TM){return"viewport"in n?uM(n):{}}const Gd={name:"project",dependencies:[JR,u3],source:_M,vs:vM,getUniforms:xM,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},SM=`// Define a structure to hold both the clip-space position and the common position.
struct ProjectResult {
  clipPosition: vec4<f32>,
  commonPosition: vec4<f32>,
};

// This function mimics the GLSL version with the 'out' parameter by returning both values.
fn project_position_to_clipspace_and_commonspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> ProjectResult {
  // Compute the projected position.
  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);

  // Start with the provided offset.
  var finalOffset: vec3<f32> = offset;

  // Get whether a rotation is needed and the rotation matrix.
  let rotationResult = project_needs_rotation(projectedPosition);

  // If rotation is needed, update the offset.
  if (rotationResult.needsRotation) {
    finalOffset = rotationResult.transform * offset;
  }

  // Compute the common position.
  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);

  // Convert to clip-space.
  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);

  return ProjectResult(clipPosition, commonPosition);
}

// A convenience overload that returns only the clip-space position.
fn project_position_to_clipspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> vec4<f32> {
  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;
}
`,wM=`vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,Lc={name:"project32",dependencies:[Gd],source:SM,vs:wM};function AM(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function jr(n,e){const t=Ao([],e,n);return HR(t,t,1/t[3]),t}function Lb(n,e){const t=n%e;return t<0?e+t:t}function ud(n,e,t){return n<e?e:n>t?t:n}function EM(n){return Math.log(n)*Math.LOG2E}const Jd=Math.log2||EM;function yi(n,e){if(!n)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const Bn=Math.PI,v3=Bn/4,Rn=Bn/180,fd=180/Bn,Kr=512,wc=4003e4,Zl=85.051129,RM=1.5;function CM(n){return Jd(n)}function Ac(n){const[e,t]=n;yi(Number.isFinite(e)),yi(Number.isFinite(t)&&t>=-90&&t<=90,"invalid latitude");const i=e*Rn,s=t*Rn,o=Kr*(i+Bn)/(2*Bn),c=Kr*(Bn+Math.log(Math.tan(v3+s*.5)))/(2*Bn);return[o,c]}function Zr(n){const[e,t]=n,i=e/Kr*(2*Bn)-Bn,s=2*(Math.atan(Math.exp(t/Kr*(2*Bn)-Bn))-v3);return[i*fd,s*fd]}function MM(n){const{latitude:e}=n;yi(Number.isFinite(e));const t=Math.cos(e*Rn);return CM(wc*t)-9}function Nh(n){const e=Math.cos(n*Rn);return Kr/wc/e}function hd(n){const{latitude:e,longitude:t,highPrecision:i=!1}=n;yi(Number.isFinite(e)&&Number.isFinite(t));const s=Kr,o=Math.cos(e*Rn),c=s/360,u=c/o,h=s/wc/o,d={unitsPerMeter:[h,h,h],metersPerUnit:[1/h,1/h,1/h],unitsPerDegree:[c,u,h],degreesPerUnit:[1/c,1/u,1/h]};if(i){const g=Rn*Math.tan(e*Rn)/o,m=c*g/2,y=s/wc*g,T=y/u*h;d.unitsPerDegree2=[0,m,y],d.unitsPerMeter2=[T,0,T]}return d}function T3(n,e){const[t,i,s]=n,[o,c,u]=e,{unitsPerMeter:h,unitsPerMeter2:d}=hd({longitude:t,latitude:i,highPrecision:!0}),g=Ac(n);g[0]+=o*(h[0]+d[0]*c),g[1]+=c*(h[1]+d[1]*c);const m=Zr(g),y=(s||0)+(u||0);return Number.isFinite(s)||Number.isFinite(u)?[m[0],m[1],y]:m}function OM(n){const{height:e,pitch:t,bearing:i,altitude:s,scale:o,center:c}=n,u=AM();xc(u,u,[0,0,-s]),a3(u,u,-t*Rn),o3(u,u,i*Rn);const h=o/e;return Qd(u,u,[h,h,h]),c&&xc(u,u,bR([],c)),u}function IM(n){const{width:e,height:t,altitude:i,pitch:s=0,offset:o,center:c,scale:u,nearZMultiplier:h=1,farZMultiplier:d=1}=n;let{fovy:g=Ec(RM)}=n;i!==void 0&&(g=Ec(i));const m=g*Rn,y=s*Rn,T=x3(g);let w=T;c&&(w+=c[2]*u/Math.cos(y)/t);const C=m*(.5+(o?o[1]:0)/t),N=Math.sin(C)*w/Math.sin(ud(Math.PI/2-y-C,.01,Math.PI-.01)),V=Math.sin(y)*N+w,$=w*10,O=Math.min(V*d,$);return{fov:m,aspect:e/t,focalDistance:T,near:h,far:O}}function Ec(n){return 2*Math.atan(.5/n)*fd}function x3(n){return .5/Math.tan(.5*n*Rn)}function S3(n,e){const[t,i,s=0]=n;return yi(Number.isFinite(t)&&Number.isFinite(i)&&Number.isFinite(s)),jr(e,[t,i,s,1])}function ep(n,e,t=0){const[i,s,o]=n;if(yi(Number.isFinite(i)&&Number.isFinite(s),"invalid pixel coordinate"),Number.isFinite(o))return jr(e,[i,s,o,1]);const c=jr(e,[i,s,0,1]),u=jr(e,[i,s,1,1]),h=c[2],d=u[2],g=h===d?0:((t||0)-h)/(d-h);return i3([],c,u,g)}function NM(n){const{width:e,height:t,bounds:i,minExtent:s=0,maxZoom:o=24,offset:c=[0,0]}=n,[[u,h],[d,g]]=i,m=PM(n.padding),y=Ac([u,ud(g,-Zl,Zl)]),T=Ac([d,ud(h,-Zl,Zl)]),w=[Math.max(Math.abs(T[0]-y[0]),s),Math.max(Math.abs(T[1]-y[1]),s)],C=[e-m.left-m.right-Math.abs(c[0])*2,t-m.top-m.bottom-Math.abs(c[1])*2];yi(C[0]>0&&C[1]>0);const N=C[0]/w[0],V=C[1]/w[1],$=(m.right-m.left)/2/N,O=(m.top-m.bottom)/2/V,F=[(T[0]+y[0])/2+$,(T[1]+y[1])/2+O],H=Zr(F),te=Math.min(o,Jd(Math.abs(Math.min(N,V))));return yi(Number.isFinite(te)),{longitude:H[0],latitude:H[1],zoom:te}}function PM(n=0){return typeof n=="number"?{top:n,bottom:n,left:n,right:n}:(yi(Number.isFinite(n.top)&&Number.isFinite(n.bottom)&&Number.isFinite(n.left)&&Number.isFinite(n.right)),n)}const zb=Math.PI/180;function kM(n,e=0){const{width:t,height:i,unproject:s}=n,o={targetZ:e},c=s([0,i],o),u=s([t,i],o);let h,d;const g=n.fovy?.5*n.fovy*zb:Math.atan(.5/n.altitude),m=(90-n.pitch)*zb;return g>m-.01?(h=Vb(n,0,e),d=Vb(n,t,e)):(h=s([0,0],o),d=s([t,0],o)),[c,u,d,h]}function Vb(n,e,t){const{pixelUnprojectionMatrix:i}=n,s=jr(i,[e,0,1,1]),o=jr(i,[e,n.height,1,1]),u=(t*n.distanceScales.unitsPerMeter[2]-s[2])/(o[2]-s[2]),h=i3([],s,o,u),d=Zr(h);return d.push(t),d}const jb=512;function DM(n){const{width:e,height:t,pitch:i=0}=n;let{longitude:s,latitude:o,zoom:c,bearing:u=0}=n;(s<-180||s>180)&&(s=Lb(s+180,360)-180),(u<-180||u>180)&&(u=Lb(u+180,360)-180);const h=Jd(t/jb);if(c<=h)c=h,o=0;else{const d=t/2/Math.pow(2,c),g=Zr([0,d])[1];if(o<g)o=g;else{const m=Zr([0,jb-d])[1];o>m&&(o=m)}}return{width:e,height:t,longitude:s,latitude:o,zoom:c,pitch:i,bearing:u}}const w3=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,UM=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,BM=`
${w3}
${UM}
`,FM=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,LM=`
${w3}
${FM}
`,zM=Eo($M),VM=Eo(XM),jM=[0,0,0,1],HM=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function WM(n,e){const[t,i,s]=n,o=ep([t,i,s],e);return Number.isFinite(s)?o:[o[0],o[1],0]}function $M({viewport:n,center:e}){return new Jn(n.viewProjectionMatrix).invert().transform(e)}function XM({viewport:n,shadowMatrices:e}){const t=[],i=n.pixelUnprojectionMatrix,s=n.isGeospatial?void 0:1,o=[[0,0,s],[n.width,0,s],[0,n.height,s],[n.width,n.height,s],[0,0,-1],[n.width,0,-1],[0,n.height,-1],[n.width,n.height,-1]].map(c=>WM(c,i));for(const c of e){const u=c.clone().translate(new Gn(n.center).negate()),h=o.map(g=>u.transform(g)),d=new Jn().ortho({left:Math.min(...h.map(g=>g[0])),right:Math.max(...h.map(g=>g[0])),bottom:Math.min(...h.map(g=>g[1])),top:Math.max(...h.map(g=>g[1])),near:Math.min(...h.map(g=>-g[2])),far:Math.max(...h.map(g=>-g[2]))});t.push(d.multiplyRight(c))}return t}function YM(n){const{shadowEnabled:e=!0,project:t}=n;if(!e||!t||!n.shadowMatrices||!n.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:n.dummyShadowMap,shadow_uShadowMap1:n.dummyShadowMap};const i=Gd.getUniforms(t),s=zM({viewport:t.viewport,center:i.center}),o=[],c=VM({shadowMatrices:n.shadowMatrices,viewport:t.viewport}).slice();for(let h=0;h<n.shadowMatrices.length;h++){const d=c[h],g=d.clone().translate(new Gn(t.viewport.center).negate());i.coordinateSystem===Ue.LNGLAT&&i.projectionMode===wn.WEB_MERCATOR?(c[h]=g,o[h]=s):(c[h]=d.clone().multiplyRight(HM),o[h]=g.transform(s))}const u={drawShadowMap:!!n.drawToShadowMap,useShadowMap:n.shadowMaps?n.shadowMaps.length>0:!1,color:n.shadowColor||jM,lightId:n.shadowLightId||0,lightCount:n.shadowMatrices.length,shadow_uShadowMap0:n.dummyShadowMap,shadow_uShadowMap1:n.dummyShadowMap};for(let h=0;h<c.length;h++)u[`viewProjectionMatrix${h}`]=c[h],u[`projectCenter${h}`]=o[h];for(let h=0;h<2;h++)u[`shadow_uShadowMap${h}`]=n.shadowMaps&&n.shadowMaps[h]||n.dummyShadowMap;return u}const Hb={name:"shadow",dependencies:[Gd],vs:BM,fs:LM,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:YM,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},A3={...Tb,defaultUniforms:{...Tb.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},qM=[u3],KM=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],ZM=[];function QM(n){const e=Rs.getDefaultShaderAssembler();for(const i of qM)e.addDefaultModule(i);const t=n==="glsl"?KM:ZM;for(const i of t)e.addShaderHook(i);return e}const GM=[255,255,255],JM=1;let eO=0;class tO{constructor(e={}){this.type="ambient";const{color:t=GM}=e,{intensity:i=JM}=e;this.id=e.id||`ambient-${eO++}`,this.color=t,this.intensity=i}}const nO=[255,255,255],iO=1,sO=[0,0,-1];let rO=0;class Wb{constructor(e={}){this.type="directional";const{color:t=nO}=e,{intensity:i=iO}=e,{direction:s=sO}=e,{_shadow:o=!1}=e;this.id=e.id||`directional-${rO++}`,this.color=t,this.intensity=i,this.type="directional",this.direction=new Gn(s).normalize().toArray(),this.shadow=o}getProjectedLight(e){return this}}class aO{constructor(e,t={id:"pass"}){const{id:i}=t;this.id=i,this.device=e,this.props={...t}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class tp extends aO{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[t,i]=this.device.canvasContext.getDrawingBufferSize(),s=e.clearCanvas??!0,o=e.clearColor??(s?[0,0,0,0]:!1),c=s?1:!1,u=s?0:!1,h=e.colorMask??15,d={viewport:[0,0,t,i]};e.colorMask&&(d.colorMask=h),e.scissorRect&&(d.scissorRect=e.scissorRect);const g=this.device.beginRenderPass({framebuffer:e.target,parameters:d,clearColor:o,clearDepth:c,clearStencil:u});try{return this._drawLayers(g,e)}finally{g.end(),this.device.submit()}}_drawLayers(e,t){const{target:i,shaderModuleProps:s,viewports:o,views:c,onViewportActive:u,clearStack:h=!0}=t;t.pass=t.pass||"unknown",h&&(this._lastRenderIndex=-1);const d=[];for(const g of o){const m=c&&c[g.id];u?.(g);const y=this._getDrawLayerParams(g,t),T=g.subViewports||[g];for(const w of T){const C=this._drawLayersInViewport(e,{target:i,shaderModuleProps:s,viewport:w,view:m,pass:t.pass,layers:t.layers},y);d.push(C)}}return d}_getDrawLayerParams(e,{layers:t,pass:i,isPicking:s=!1,layerFilter:o,cullRect:c,effects:u,shaderModuleProps:h},d=!1){const g=[],m=E3(this._lastRenderIndex+1),y={layer:t[0],viewport:e,isPicking:s,renderPass:i,cullRect:c},T={};for(let w=0;w<t.length;w++){const C=t[w],N=this._shouldDrawLayer(C,y,o,T),V={shouldDrawLayer:N};N&&!d&&(V.shouldDrawLayer=!0,V.layerRenderIndex=m(C,N),V.shaderModuleProps=this._getShaderModuleProps(C,u,i,h),V.layerParameters={...C.context.deck?.props.parameters,...this.getLayerParameters(C,w,e)}),g[w]=V}return g}_drawLayersInViewport(e,{layers:t,shaderModuleProps:i,pass:s,target:o,viewport:c,view:u},h){const d=oO(this.device,{shaderModuleProps:i,target:o,viewport:c});if(u&&u.props.clear){const m=u.props.clear===!0?{color:!0,depth:!0}:u.props.clear;this.device.beginRenderPass({framebuffer:o,parameters:{viewport:d,scissorRect:d},clearColor:m.color?[0,0,0,0]:!1,clearDepth:m.depth?1:!1}).end()}const g={totalCount:t.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:d});for(let m=0;m<t.length;m++){const y=t[m],T=h[m],{shouldDrawLayer:w}=T;if(w&&y.props.pickable&&g.pickableCount++,y.isComposite&&g.compositeCount++,y.isDrawable&&T.shouldDrawLayer){const{layerRenderIndex:C,shaderModuleProps:N,layerParameters:V}=T;g.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,C),N.project&&(N.project.viewport=c),y.context.renderPass=e;try{y._drawLayer({renderPass:e,shaderModuleProps:N,uniforms:{layerIndex:C},parameters:V})}catch($){y.raiseError($,`drawing ${y} to ${s}`)}}}return g}shouldDrawLayer(e){return!0}getShaderModuleProps(e,t,i){return null}getLayerParameters(e,t,i){return e.props.parameters}_shouldDrawLayer(e,t,i,s){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;t.layer=e;let c=e.parent;for(;c;){if(!c.props.visible||!c.filterSubLayer(t))return!1;t.layer=c,c=c.parent}if(i){const u=t.layer.id;if(u in s||(s[u]=i(t)),!s[u])return!1}return e.activateViewport(t.viewport),!0}_getShaderModuleProps(e,t,i,s){const o=this.device.canvasContext.cssToDeviceRatio(),c=e.internalState?.propsInTransition||e.props,u={layer:c,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:o,modelMatrix:c.modelMatrix,coordinateSystem:c.coordinateSystem,coordinateOrigin:c.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(t)for(const h of t)$b(u,h.getShaderModuleProps?.(e,u));return $b(u,this.getShaderModuleProps(e,t,u),s)}}function E3(n=0,e={}){const t={},i=(s,o)=>{const c=s.props._offset,u=s.id,h=s.parent&&s.parent.id;let d;if(h&&!(h in e)&&i(s.parent,!1),h in t){const g=t[h]=t[h]||E3(e[h],e);d=g(s,o),t[u]=g}else Number.isFinite(c)?(d=c+(e[h]||0),t[u]=null):d=n;return o&&d>=n&&(n=d+1),e[u]=d,d};return i}function oO(n,{shaderModuleProps:e,target:t,viewport:i}){const s=e?.project?.devicePixelRatio??n.canvasContext.cssToDeviceRatio(),[,o]=n.canvasContext.getDrawingBufferSize(),c=t?t.height:o,u=i;return[u.x*s,c-(u.y+u.height)*s,u.width*s,u.height*s]}function $b(n,...e){for(const t of e)if(t)for(const i in t)n[i]?Object.assign(n[i],t[i]):n[i]=t[i];return n}class lO extends tp{constructor(e,t){super(e,t);const i=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},mipmaps:!0}),s=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[i],depthStencilAttachment:s})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){const t=this.fbo,i=this.device.canvasContext.cssToDeviceRatio(),s=e.viewports[0],o=s.width*i,c=s.height*i,u=[1,1,1,1];(o!==t.width||c!==t.height)&&t.resize({width:o,height:c}),super.render({...e,clearColor:u,target:t,pass:"shadow"})}getLayerParameters(e,t,i){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getShaderModuleProps(e,t,i){return{shadow:{project:i.project,drawToShadowMap:!0}}}}const cO={color:[255,255,255],intensity:1},Xb=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],uO=[0,0,0,200/255];class R3{constructor(e={}){this.id="lighting-effect",this.shadowColor=uO,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:t,deck:i}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(t),i._addDefaultShaderModule(Hb),this.dummyShadowMap=t.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const t in e){const i=e[t];switch(i.type){case"ambient":this.ambientLight=i;break;case"directional":this.directionalLights.push(i);break;case"point":this.pointLights.push(i);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(t=>t.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:t,viewports:i,onViewportActive:s,views:o}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let c=0;c<this.shadowPasses.length;c++)this.shadowPasses[c].render({layers:e,layerFilter:t,viewports:i,onViewportActive:s,views:o,shaderModuleProps:{shadow:{shadowLightId:c,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(e,t){const i=this.shadow?{project:t.project,shadowMaps:this.shadowPasses.map(c=>c.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},s={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(c=>c.getProjectedLight({layer:e})),pointLights:this.pointLights.map(c=>c.getProjectedLight({layer:e}))},o=e.props.material;return{shadow:i,lighting:s,phongMaterial:o,gouraudMaterial:o}}cleanup(e){for(const t of this.shadowPasses)t.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(Hb))}_calculateMatrices(){const e=[];for(const t of this.directionalLights){const i=new Jn().lookAt({eye:new Gn(t.direction).negate()});e.push(i)}return e}_createShadowPasses(e){for(let t=0;t<this.directionalLights.length;t++){const i=new lO(e);this.shadowPasses[t]=i}}_applyDefaultLights(){const{ambientLight:e,pointLights:t,directionalLights:i}=this;!e&&t.length===0&&i.length===0&&(this.ambientLight=new tO(cO),this.directionalLights.push(new Wb(Xb[0]),new Wb(Xb[1])))}}class fO{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,t,{size:i=1,type:s,padding:o=0,copy:c=!1,initialize:u=!1,maxCount:h}){const d=s||e&&e.constructor||Float32Array,g=t*i+o;if(ArrayBuffer.isView(e)){if(g<=e.length)return e;if(g*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new d(e.buffer,0,g)}let m=1/0;h&&(m=h*i+o);const y=this._allocate(d,g,u,m);return e&&c?y.set(e):u||y.fill(0,0,4),this._release(e),y}release(e){this._release(e)}_allocate(e,t,i,s){let o=Math.max(Math.ceil(t*this.opts.overAlloc),1);o>s&&(o=s);const c=this._pool,u=e.BYTES_PER_ELEMENT*o,h=c.findIndex(d=>d.byteLength>=u);if(h>=0){const d=new e(c.splice(h,1)[0],0,o);return i&&d.fill(0),d}return new e(o)}_release(e){if(!ArrayBuffer.isView(e))return;const t=this._pool,{buffer:i}=e,{byteLength:s}=i,o=t.findIndex(c=>c.byteLength>=s);o<0?t.push(i):(o>0||t.length<this.opts.poolSize)&&t.splice(o,0,i),t.length>this.opts.poolSize&&t.shift()}}const To=new fO;function oo(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function hO(n){return[n[12],n[13],n[14]]}function dO(n){return{left:Nr(n[3]+n[0],n[7]+n[4],n[11]+n[8],n[15]+n[12]),right:Nr(n[3]-n[0],n[7]-n[4],n[11]-n[8],n[15]-n[12]),bottom:Nr(n[3]+n[1],n[7]+n[5],n[11]+n[9],n[15]+n[13]),top:Nr(n[3]-n[1],n[7]-n[5],n[11]-n[9],n[15]-n[13]),near:Nr(n[3]+n[2],n[7]+n[6],n[11]+n[10],n[15]+n[14]),far:Nr(n[3]-n[2],n[7]-n[6],n[11]-n[10],n[15]-n[14])}}const Yb=new Gn;function Nr(n,e,t,i){Yb.set(n,e,t);const s=Yb.len();return{distance:i/s,normal:new Gn(-n/s,-e/s,-t/s)}}function pO(n){return n-Math.fround(n)}let no;function Ph(n,e){const{size:t=1,startIndex:i=0}=e,s=e.endIndex!==void 0?e.endIndex:n.length,o=(s-i)/t;no=To.allocate(no,o,{type:Float32Array,size:t*2});let c=i,u=0;for(;c<s;){for(let h=0;h<t;h++){const d=n[c++];no[u+h]=d,no[u+h+t]=pO(d)}u+=t*2}return no.subarray(0,o*t*2)}function gO(n){let e=null,t=!1;for(const i of n)i&&(e?(t||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],t=!0),e[0][0]=Math.min(e[0][0],i[0][0]),e[0][1]=Math.min(e[0][1],i[0][1]),e[1][0]=Math.max(e[1][0],i[1][0]),e[1][1]=Math.max(e[1][1],i[1][1])):e=i);return e}const _O=Math.PI/180,mO=oo(),qb=[0,0,0],yO={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function bO({width:n,height:e,orthographic:t,fovyRadians:i,focalDistance:s,padding:o,near:c,far:u}){const h=n/e,d=t?new Jn().orthographic({fovy:i,aspect:h,focalDistance:s,near:c,far:u}):new Jn().perspective({fovy:i,aspect:h,near:c,far:u});if(o){const{left:g=0,right:m=0,top:y=0,bottom:T=0}=o,w=Gi((g+n-m)/2,0,n)-n/2,C=Gi((y+e-T)/2,0,e)-e/2;d[8]-=w*2/n,d[9]+=C*2/e}return d}class Ro{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||yO,this.focalDistance=e.focalDistance||1,this.position=e.position||qb,this.modelMatrix=e.modelMatrix||null;const{longitude:t,latitude:i}=e;this.isGeospatial=Number.isFinite(i)&&Number.isFinite(t),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?wn.WEB_MERCATOR:wn.WEB_MERCATOR_AUTO_OFFSET:wn.IDENTITY}equals(e){return e instanceof Ro?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&vo(e.projectionMatrix,this.projectionMatrix)&&vo(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:t=!0}={}){const i=this.projectPosition(e),s=S3(i,this.pixelProjectionMatrix),[o,c]=s,u=t?c:this.height-c;return e.length===2?[o,u]:[o,u,s[2]]}unproject(e,{topLeft:t=!0,targetZ:i}={}){const[s,o,c]=e,u=t?o:this.height-o,h=i&&i*this.distanceScales.unitsPerMeter[2],d=ep([s,u,c],this.pixelUnprojectionMatrix,h),[g,m,y]=this.unprojectPosition(d);return Number.isFinite(c)?[g,m,y]:Number.isFinite(i)?[g,m,i]:[g,m]}projectPosition(e){const[t,i]=this.projectFlat(e),s=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[t,i,s]}unprojectPosition(e){const[t,i]=this.unprojectFlat(e),s=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[t,i,s]}projectFlat(e){if(this.isGeospatial){const t=Ac(e);return t[1]=Gi(t[1],-318,830),t}return e}unprojectFlat(e){return this.isGeospatial?Zr(e):e}getBounds(e={}){const t={targetZ:e.z||0},i=this.unproject([0,0],t),s=this.unproject([this.width,0],t),o=this.unproject([0,this.height],t),c=this.unproject([this.width,this.height],t);return[Math.min(i[0],s[0],o[0],c[0]),Math.min(i[1],s[1],o[1],c[1]),Math.max(i[0],s[0],o[0],c[0]),Math.max(i[1],s[1],o[1],c[1])]}getDistanceScales(e){return e&&this.isGeospatial?hd({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:t,width:i=1,height:s=1}){return e<this.x+this.width&&this.x<e+i&&t<this.y+this.height&&this.y<t+s}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,dO(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,t){return null}_initProps(e){const t=e.longitude,i=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=MM({latitude:i})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||hd({latitude:i,longitude:t}));const s=Math.pow(2,this.zoom);this.scale=s;const{position:o,modelMatrix:c}=e;let u=qb;if(o&&(u=c?new Jn(c).transformAsVector(o,[]):o),this.isGeospatial){const h=this.projectPosition([t,i,0]);this.center=new Gn(u).scale(this.distanceScales.unitsPerMeter).add(h)}else this.center=this.projectPosition(u)}_initMatrices(e){const{viewMatrix:t=mO,projectionMatrix:i=null,orthographic:s=!1,fovyRadians:o,fovy:c=75,near:u=.1,far:h=1e3,padding:d=null,focalDistance:g=1}=e;this.viewMatrixUncentered=t,this.viewMatrix=new Jn().multiplyRight(t).translate(new Gn(this.center).negate()),this.projectionMatrix=i||bO({width:this.width,height:this.height,orthographic:s,fovyRadians:o||c*_O,focalDistance:g,padding:d,near:u,far:h});const m=oo();Os(m,m,this.projectionMatrix),Os(m,m,this.viewMatrix),this.viewProjectionMatrix=m,this.viewMatrixInverse=id([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=hO(this.viewMatrixInverse);const y=oo(),T=oo();Qd(y,y,[this.width/2,-this.height/2,1]),xc(y,y,[1,-1,0]),Os(T,y,this.viewProjectionMatrix),this.pixelProjectionMatrix=T,this.pixelUnprojectionMatrix=id(oo(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||et.warn("Pixel project matrix not invertible")()}}Ro.displayName="Viewport";class Qr extends Ro{constructor(e={}){const{latitude:t=0,longitude:i=0,zoom:s=0,pitch:o=0,bearing:c=0,nearZMultiplier:u=.1,farZMultiplier:h=1.01,nearZ:d,farZ:g,orthographic:m=!1,projectionMatrix:y,repeat:T=!1,worldOffset:w=0,position:C,padding:N,legacyMeterSizes:V=!1}=e;let{width:$,height:O,altitude:F=1.5}=e;const H=Math.pow(2,s);$=$||1,O=O||1;let te,oe=null;if(y)F=y[5]/2,te=Ec(F);else{e.fovy?(te=e.fovy,F=x3(te)):te=Ec(F);let R;if(N){const{top:Y=0,bottom:ie=0}=N;R=[0,Gi((Y+O-ie)/2,0,O)-O/2]}oe=IM({width:$,height:O,scale:H,center:C&&[0,0,C[2]*Nh(t)],offset:R,pitch:o,fovy:te,nearZMultiplier:u,farZMultiplier:h}),Number.isFinite(d)&&(oe.near=d),Number.isFinite(g)&&(oe.far=g)}let E=OM({height:O,pitch:o,bearing:c,scale:H,altitude:F});w&&(E=new Jn().translate([512*w,0,0]).multiplyLeft(E)),super({...e,width:$,height:O,viewMatrix:E,longitude:i,latitude:t,zoom:s,...oe,fovy:te,focalDistance:F}),this.latitude=t,this.longitude=i,this.zoom=s,this.pitch=o,this.bearing=c,this.altitude=F,this.fovy=te,this.orthographic=m,this._subViewports=T?[]:null,this._pseudoMeters=V,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),t=Math.floor((e[0]+180)/360),i=Math.ceil((e[2]-180)/360);for(let s=t;s<=i;s++){const o=s?new Qr({...this,worldOffset:s}):this;this._subViewports.push(o)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[t,i]=this.projectFlat(e),s=(e[2]||0)*Nh(e[1]);return[t,i,s]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[t,i]=this.unprojectFlat(e),s=(e[2]||0)/Nh(i);return[t,i,s]}addMetersToLngLat(e,t){return T3(e,t)}panByPosition(e,t){const i=ep(t,this.pixelUnprojectionMatrix),s=this.projectFlat(e),o=bb([],s,dR([],i)),c=bb([],this.center,o),[u,h]=this.unprojectFlat(c);return{longitude:u,latitude:h}}getBounds(e={}){const t=kM(this,e.z||0);return[Math.min(t[0][0],t[1][0],t[2][0],t[3][0]),Math.min(t[0][1],t[1][1],t[2][1],t[3][1]),Math.max(t[0][0],t[1][0],t[2][0],t[3][0]),Math.max(t[0][1],t[1][1],t[2][1],t[3][1])]}fitBounds(e,t={}){const{width:i,height:s}=this,{longitude:o,latitude:c,zoom:u}=NM({width:i,height:s,bounds:e,...t});return new Qr({width:i,height:s,longitude:o,latitude:c,zoom:u})}}Qr.displayName="WebMercatorViewport";const Kb=[0,0,0];function kh(n,e,t=!1){const i=e.projectPosition(n);if(t&&e instanceof Qr){const[s,o,c=0]=n,u=e.getDistanceScales([s,o]);i[2]=c*u.unitsPerMeter[2]}return i}function vO(n){const{viewport:e,modelMatrix:t,coordinateOrigin:i}=n;let{coordinateSystem:s,fromCoordinateSystem:o,fromCoordinateOrigin:c}=n;return s===Ue.DEFAULT&&(s=e.isGeospatial?Ue.LNGLAT:Ue.CARTESIAN),o===void 0&&(o=s),c===void 0&&(c=i),{viewport:e,coordinateSystem:s,coordinateOrigin:i,modelMatrix:t,fromCoordinateSystem:o,fromCoordinateOrigin:c}}function C3(n,{viewport:e,modelMatrix:t,coordinateSystem:i,coordinateOrigin:s,offsetMode:o}){let[c,u,h=0]=n;switch(t&&([c,u,h]=Ao([],[c,u,h,1],t)),i){case Ue.LNGLAT:return kh([c,u,h],e,o);case Ue.LNGLAT_OFFSETS:return kh([c+s[0],u+s[1],h+(s[2]||0)],e,o);case Ue.METER_OFFSETS:return kh(T3(s,[c,u,h]),e,o);case Ue.CARTESIAN:default:return e.isGeospatial?[c+s[0],u+s[1],h+s[2]]:e.projectPosition([c,u,h])}}function TO(n,e){const{viewport:t,coordinateSystem:i,coordinateOrigin:s,modelMatrix:o,fromCoordinateSystem:c,fromCoordinateOrigin:u}=vO(e),{autoOffset:h=!0}=e,{geospatialOrigin:d=Kb,shaderCoordinateOrigin:g=Kb,offsetMode:m=!1}=h?b3(t,i,s):{},y=C3(n,{viewport:t,modelMatrix:o,coordinateSystem:c,coordinateOrigin:u,offsetMode:m});if(m){const T=t.projectPosition(d||g);CR(y,y,T)}return y}let xO=1,SO=1;class M3{time=0;channels=new Map;animations=new Map;playing=!1;lastEngineTime=-1;constructor(){}addChannel(e){const{delay:t=0,duration:i=Number.POSITIVE_INFINITY,rate:s=1,repeat:o=1}=e,c=xO++,u={time:0,delay:t,duration:i,rate:s,repeat:o};return this._setChannelTime(u,this.time),this.channels.set(c,u),c}removeChannel(e){this.channels.delete(e);for(const[t,i]of this.animations)i.channel===e&&this.detachAnimation(t)}isFinished(e){const t=this.channels.get(e);return t===void 0?!1:this.time>=t.delay+t.duration*t.repeat}getTime(e){if(e===void 0)return this.time;const t=this.channels.get(e);return t===void 0?-1:t.time}setTime(e){this.time=Math.max(0,e);const t=this.channels.values();for(const s of t)this._setChannelTime(s,this.time);const i=this.animations.values();for(const s of i){const{animation:o,channel:c}=s;o.setTime(this.getTime(c))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){const i=SO++;return this.animations.set(i,{animation:e,channel:t}),e.setTime(this.getTime(t)),i}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){const i=t-e.delay,s=e.duration*e.repeat;i>=s?e.time=e.duration*e.rate:(e.time=Math.max(0,i)%e.duration,e.time*=e.rate)}}function wO(n){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(n):setTimeout(n,1e3/60)}function AO(n){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(n):clearTimeout(n)}let EO=0;const RO={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:n=>console.error(n),stats:Jh.stats.get(`animation-loop-${EO++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class CO{device=null;canvas=null;props;animationProps=null;timeline=null;stats;cpuTime;gpuTime;frameRate;display;needsRedraw="initialized";_initialized=!1;_running=!1;_animationFrameId=null;_nextFramePromise=null;_resolveNextFrame=null;_cpuStartTime=0;_error=null;constructor(e){if(this.props={...RO,...e},e=this.props,!e.device)throw new Error("No device provided");const{useDevicePixels:t=!0}=this.props;this.stats=e.stats||new Nc({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:t}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setError(e){if(this.props.onError(e),this._error=Error(),this.device?.canvasContext?.canvas instanceof HTMLCanvasElement){const i=document.createElement("h1");i.innerHTML=e.message,i.style.position="absolute",i.style.top="20%",i.style.left="10px",i.style.color="black",i.style.backgroundColor="red",document.body.appendChild(i)}}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const t=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(t),t}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){return this.device?.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=wO(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(AO(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),this.device?.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){const e=this.device?.canvasContext?.canvas;if(!this.device||!e)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:e,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:t,aspect:i}=this._getSizeAndAspect();(e!==this.animationProps.width||t!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),i!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=i,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=this.device.canvasContext?.canvas||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(t);const i=this.props.onAddHTML(t);i&&(t.innerHTML=i)}}_getSizeAndAspect(){if(!this.device)return{width:1,height:1,aspect:1};const[e,t]=this.device?.canvasContext?.getPixelSize()||[1,1];let i=1;const s=this.device?.canvasContext?.canvas;return s&&s.clientHeight?i=s.clientWidth/s.clientHeight:e>0&&t>0&&(i=e/t),{width:e,height:t,aspect:i}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.props.autoResizeDrawingBuffer&&this.device?.canvasContext?.resize({useDevicePixels:this.props.useDevicePixels})}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}const Dh={};function zc(n="id"){Dh[n]=Dh[n]||1;const e=Dh[n]++;return`${n}-${e}`}class Zb{id;userData={};topology;bufferLayout=[];vertexCount;indices;attributes;constructor(e){if(this.id=e.id||zc("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&at.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){this.indices?.destroy();for(const e of Object.values(this.attributes))e.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}function MO(n,e){if(e instanceof Zb)return e;const t=OO(n,e),{attributes:i,bufferLayout:s}=IO(n,e);return new Zb({topology:e.topology||"triangle-list",bufferLayout:s,vertexCount:e.vertexCount,indices:t,attributes:i})}function OO(n,e){if(!e.indices)return;const t=e.indices.value;return n.createBuffer({usage:at.INDEX,data:t})}function IO(n,e){const t=[],i={};for(const[o,c]of Object.entries(e.attributes)){let u=o;switch(o){case"POSITION":u="positions";break;case"NORMAL":u="normals";break;case"TEXCOORD_0":u="texCoords";break;case"COLOR_0":u="colors";break}if(c){i[u]=n.createBuffer({data:c.value,id:`${o}-buffer`});const{value:h,size:d,normalized:g}=c;t.push({name:u,format:EE(h,d,g)})}}const s=e._calculateVertexCount(e.attributes,e.indices);return{attributes:i,bufferLayout:t,vertexCount:s}}class np{static defaultProps={...$r.defaultProps};static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new np(e),e._lumaData.defaultPipelineFactory}device;destroyPolicy;_hashCounter=0;_hashes={};_renderPipelineCache={};_computePipelineCache={};constructor(e){this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}createRenderPipeline(e){const t={...$r.defaultProps,...e},i=this._hashRenderPipeline(t);if(!this._renderPipelineCache[i]){const s=this.device.createRenderPipeline({...t,id:t.id?`${t.id}-cached`:void 0});s.hash=i,this._renderPipelineCache[i]={pipeline:s,useCount:0}}return this._renderPipelineCache[i].useCount++,this._renderPipelineCache[i].pipeline}createComputePipeline(e){const t={...pc.defaultProps,...e},i=this._hashComputePipeline(t);if(!this._computePipelineCache[i]){const s=this.device.createComputePipeline({...t,id:t.id?`${t.id}-cached`:void 0});s.hash=i,this._computePipelineCache[i]={pipeline:s,useCount:0}}return this._computePipelineCache[i].useCount++,this._computePipelineCache[i].pipeline}release(e){const t=e.hash,i=e instanceof pc?this._computePipelineCache:this._renderPipelineCache;i[t].useCount--,i[t].useCount===0&&this.destroyPolicy==="unused"&&(i[t].pipeline.destroy(),delete i[t])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const t=e.vs?this._getHash(e.vs.source):0,i=e.fs?this._getHash(e.fs.source):0,s="-",o=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${t}/${i}V${s}BL${o}`;default:const c=this._getHash(JSON.stringify(e.parameters));return`${t}/${i}V${s}T${e.topology}P${c}BL${o}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}}class ip{static defaultProps={...Uc.defaultProps};static getDefaultShaderFactory(e){return e._lumaData.defaultShaderFactory||=new ip(e),e._lumaData.defaultShaderFactory}device;destroyPolicy;_cache={};constructor(e){this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}createShader(e){const t=this._hashShader(e);let i=this._cache[t];if(!i){const s=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[t]=i={shader:s,useCount:0}}return i.useCount++,i.shader}release(e){const t=this._hashShader(e),i=this._cache[t];i&&(i.useCount--,i.useCount===0&&this.destroyPolicy==="unused"&&(delete this._cache[t],i.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}}function NO(n,e){const t={},i="Values";if(n.attributes.length===0&&!n.varyings?.length)return{"No attributes or varyings":{[i]:"N/A"}};for(const s of n.attributes)if(s){const o=`${s.location} ${s.name}: ${s.type}`;t[`in ${o}`]={[i]:s.stepMode||"vertex"}}for(const s of n.varyings||[]){const o=`${s.location} ${s.name}`;t[`out ${o}`]={[i]:JSON.stringify(s)}}return t}let kt=null,Uh=null;function PO(n,{id:e,minimap:t,opaque:i,top:s="0",left:o="0",rgbaScale:c=1}){kt||(kt=document.createElement("canvas"),kt.id=e,kt.title=e,kt.style.zIndex="100",kt.style.position="absolute",kt.style.top=s,kt.style.left=o,kt.style.border="blue 5px solid",kt.style.transform="scaleY(-1)",document.body.appendChild(kt),Uh=kt.getContext("2d")),(kt.width!==n.width||kt.height!==n.height)&&(kt.width=n.width/2,kt.height=n.height/2,kt.style.width="400px",kt.style.height="400px");const u=n.device.readPixelsToArrayWebGL(n),h=Uh?.createImageData(n.width,n.height);if(h){for(let g=0;g<u.length;g+=4)h.data[0+g+0]=u[g+0]*c,h.data[0+g+1]=u[g+1]*c,h.data[0+g+2]=u[g+2]*c,h.data[0+g+3]=i?255:u[g+3]*c;Uh?.putImageData(h,0,0)}}function dd(n,e,t){if(n===e)return!0;if(!t||!n||!e)return!1;if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let i=0;i<n.length;i++)if(!dd(n[i],e[i],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof n=="object"&&typeof e=="object"){const i=Object.keys(n),s=Object.keys(e);if(i.length!==s.length)return!1;for(const o of i)if(!e.hasOwnProperty(o)||!dd(n[o],e[o],t-1))return!1;return!0}return!1}function kO(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function DO(n){return Array.isArray(n)?n.length===0||typeof n[0]=="number":!1}function O3(n){return kO(n)||DO(n)}function UO(n){return O3(n)||typeof n=="number"||typeof n=="boolean"}function I3(n){const e={bindings:{},uniforms:{}};return Object.keys(n).forEach(t=>{const i=n[t];UO(i)?e.uniforms[t]=i:e.bindings[t]=i}),e}class BO{options={disableWarnings:!1};modules;moduleUniforms;moduleBindings;constructor(e,t){Object.assign(this.options,t);const i=kd(Object.values(e).filter(s=>s.dependencies));for(const s of i)e[s.name]=s;ae.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[s,o]of Object.entries(e))this._addModule(o),o.name&&s!==o.name&&!this.options.disableWarnings&&ae.warn(`Module name: ${s} vs ${o.name}`)()}destroy(){}setProps(e){for(const t of Object.keys(e)){const i=t,s=e[i]||{},o=this.modules[i];if(!o){this.options.disableWarnings||ae.warn(`Module ${t} not found`)();continue}const c=this.moduleUniforms[i],u=this.moduleBindings[i],h=o.getUniforms?.(s,c)||s,{uniforms:d,bindings:g}=I3(h);this.moduleUniforms[i]={...c,...d},this.moduleBindings[i]={...u,...g}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const e={};for(const t of Object.values(this.moduleBindings))Object.assign(e,t);return e}getDebugTable(){const e={};for(const[t,i]of Object.entries(this.moduleUniforms))for(const[s,o]of Object.entries(i))e[`${t}.${s}`]={type:this.modules[t].uniformTypes?.[s],value:String(o)};return e}_addModule(e){const t=e.name;this.moduleUniforms[t]=e.defaultUniforms||{},this.moduleBindings[t]={}}}let FO="";async function LO(n,e){const t=new Image;return t.crossOrigin="anonymous",t.src=n.startsWith("http")?n:FO+n,await t.decode(),e?await createImageBitmap(t,e):await createImageBitmap(t)}class Bh{device;id;texture;sampler;view;ready;isReady=!1;destroyed=!1;resolveReady=()=>{};rejectReady=()=>{};get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}constructor(e,t){this.device=e,this.id=t.id||zc("async-texture"),typeof t?.data=="string"&&t.dimension==="2d"&&(t={...t,data:LO(t.data)}),this.ready=new Promise((i,s)=>{this.resolveReady=()=>{this.isReady=!0,i()},this.rejectReady=s}),this.initAsync(t)}async initAsync(e){const t=e.data;let i;try{i=await N3(t)}catch(o){this.rejectReady(o)}if(this.destroyed)return;const s={...e,data:i};this.texture=this.device.createTexture(s),this.sampler=this.texture.sampler,this.view=this.texture.view,this.isReady=!0,this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){const t=this.texture;this.texture=t.clone(e),t.destroy()}return!0}}async function N3(n){if(n=await n,Array.isArray(n))return await Promise.all(n.map(N3));if(n&&typeof n=="object"&&n.constructor===Object){const e=n,t=await Promise.all(Object.values(e)),i=Object.keys(e),s={};for(let o=0;o<i.length;o++)s[i[o]]=t[o];return s}return n}const ws=2,zO=1e4;class ss{static defaultProps={...$r.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:Rs.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0};device;id;source;vs;fs;pipelineFactory;shaderFactory;userData={};parameters;topology;bufferLayout;isInstanced=void 0;instanceCount=0;vertexCount;indexBuffer=null;bufferAttributes={};constantAttributes={};bindings={};uniforms={};vertexArray;transformFeedback=null;pipeline;shaderInputs;_uniformStore;_attributeInfos={};_gpuGeometry=null;_getModuleUniforms;props;_pipelineNeedsUpdate="newly created";_needsRedraw="initializing";_destroyed=!1;_lastDrawTimestamp=-1;get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}constructor(e,t){this.props={...ss.defaultProps,...t},t=this.props,this.id=t.id||zc("model"),this.device=e,Object.assign(this.userData,t.userData);const i=Object.fromEntries(this.props.modules?.map(h=>[h.name,h])||[]),s=t.shaderInputs||new BO(i,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(s);const o=jO(e),c=(this.props.modules?.length>0?this.props.modules:this.shaderInputs?.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){const{source:h,getUniforms:d}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:o,...this.props,modules:c});this.source=h,this._getModuleUniforms=d,this.props.shaderLayout||=iR(this.source)}else{const{vs:h,fs:d,getUniforms:g}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:o,...this.props,modules:c});this.vs=h,this.fs=d,this._getModuleUniforms=g}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,t.geometry&&this.setGeometry(t.geometry),this.pipelineFactory=t.pipelineFactory||np.getDefaultPipelineFactory(this.device),this.shaderFactory=t.shaderFactory||ip.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in t&&(this.isInstanced=t.isInstanced),t.instanceCount&&this.setInstanceCount(t.instanceCount),t.vertexCount&&this.setVertexCount(t.vertexCount),t.indexBuffer&&this.setIndexBuffer(t.indexBuffer),t.attributes&&this.setAttributes(t.attributes),t.constantAttributes&&this.setConstantAttributes(t.constantAttributes),t.bindings&&this.setBindings(t.bindings),t.uniforms&&this.setUniformsWebGL(t.uniforms),t.moduleSettings&&this.updateModuleSettingsWebGL(t.moduleSettings),t.transformFeedback&&(this.transformFeedback=t.transformFeedback),Object.seal(this)}destroy(){this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),this._gpuGeometry?.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||=e}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){const t=this._areBindingsLoading();if(t)return ae.info(ws,`>>> DRAWING ABORTED ${this.id}: ${t} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let i;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const s=this._getBindings();this.pipeline.setBindings(s,{disableWarnings:this.props.disableWarnings}),pd(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:o}=this.vertexArray,c=o?o.byteLength/(o.indexType==="uint32"?4:2):void 0;i=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:c,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),i?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",i}setGeometry(e){this._gpuGeometry?.destroy();const t=e&&MO(this.device,e);if(t){this.setTopology(t.topology||"triangle-list");const i=new Sh(this.bufferLayout);this.bufferLayout=i.mergeBufferLayouts(t.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(t)}this._gpuGeometry=t}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){const t=new Sh(this.bufferLayout);this.bufferLayout=this._gpuGeometry?t.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){dd(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new AE(this.shaderInputs.modules);for(const[t,i]of Object.entries(this.shaderInputs.modules))if(VO(i)){const s=this._uniformStore.getManagedUniformBuffer(this.device,t);this.bindings[`${t}Uniforms`]=s}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,t){const i=t?.disableWarnings??this.props.disableWarnings;e.indices&&ae.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)(),this.bufferLayout=RE(this.pipeline.shaderLayout,this.bufferLayout);const s=new Sh(this.bufferLayout);for(const[o,c]of Object.entries(e)){const u=s.getBufferLayout(o);if(!u){i||ae.warn(`Model(${this.id}): Missing layout for buffer "${o}".`)();continue}const h=s.getAttributeNamesForBuffer(u);let d=!1;for(const g of h){const m=this._attributeInfos[g];if(m){const y=this.device.type==="webgpu"?s.getBufferIndex(m.bufferName):m.location;this.vertexArray.setBuffer(y,c),d=!0}}!d&&!i&&ae.warn(`Model(${this.id}): Ignoring buffer "${c.id}" for unknown attribute "${o}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,t){for(const[i,s]of Object.entries(e)){const o=this._attributeInfos[i];o?this.vertexArray.setConstantWebGL(o.location,s):(t?.disableWarnings??this.props.disableWarnings)||ae.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${i}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){this.setUniformsWebGL(e)}setUniformsWebGL(e){pd(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettingsWebGL(e){const{bindings:t,uniforms:i}=I3(this._getModuleUniforms(e));Object.assign(this.bindings,t),Object.assign(this.uniforms,i),this.setNeedsRedraw("moduleSettings")}_areBindingsLoading(){for(const e of Object.values(this.bindings))if(e instanceof Bh&&!e.isReady)return e.id;return!1}_getBindings(){const e={};for(const[t,i]of Object.entries(this.bindings))i instanceof Bh?i.isReady&&(e[t]=i.texture):e[t]=i;return e}_getBindingsUpdateTimestamp(){let e=0;for(const t of Object.values(this.bindings))t instanceof Dc?e=Math.max(e,t.texture.updateTimestamp):t instanceof at||t instanceof Qe?e=Math.max(e,t.updateTimestamp):t instanceof Bh?e=t.texture?Math.max(e,t.texture.updateTimestamp):1/0:t instanceof yo||(e=Math.max(e,t.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const t={...e.attributes};for(const[i]of Object.entries(t))!this.pipeline.shaderLayout.attributes.find(s=>s.name===i)&&i!=="positions"&&delete t[i];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(t,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||=e,this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,t=null;this.pipeline&&(ae.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,t=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const i=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let s=null;this.source?s=i:this.fs&&(s=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:i,fs:s}),this._attributeInfos=I0(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),t&&this.shaderFactory.release(t)}return this.pipeline}_lastLogTime=0;_logOpen=!1;_logDrawCallStart(){const e=ae.level>3?0:zO;ae.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,ae.group(ws,`>>> DRAWING MODEL ${this.id}`,{collapsed:ae.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=NO(this.pipeline.shaderLayout,this.id);ae.table(ws,e)();const t=this.shaderInputs.getDebugTable();for(const[s,o]of Object.entries(this.uniforms))t[s]={value:o};ae.table(ws,t)();const i=this._getAttributeDebugTable();ae.table(ws,this._attributeInfos)(),ae.table(ws,i)(),ae.groupEnd(ws)(),this._logOpen=!1}}_drawCount=0;_logFramebuffer(e){const t=this.device.props.debugFramebuffers;if(this._drawCount++,!t)return;const i=e.props.framebuffer;i&&PO(i,{id:i.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[t,i]of Object.entries(this._attributeInfos)){const s=this.vertexArray.attributes[i.location];e[i.location]={name:t,type:i.shaderType,values:s?this._getBufferOrConstantValues(s,i.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:t}=this.vertexArray,i=t.indexType==="uint32"?new Uint32Array(t.debugData):new Uint16Array(t.debugData);e.indices={name:"indices",type:t.indexType,values:i.toString()}}return e}_getBufferOrConstantValues(e,t){const i=k0(t);return(e instanceof at?new i(e.debugData):e).toString()}}function VO(n){return!!(n.uniformTypes&&!pd(n.uniformTypes))}function jO(n){return{type:n.type,shaderLanguage:n.info.shadingLanguage,shaderLanguageVersion:n.info.shadingLanguageVersion,gpu:n.info.gpu,features:n.features}}function pd(n){for(const e in n)return!1;return!0}class Gr{device;model;transformFeedback;static defaultProps={...ss.defaultProps,outputs:void 0,feedbackBuffers:void 0};static isSupported(e){return e?.info?.type==="webgl"}constructor(e,t=Gr.defaultProps){if(!Gr.isSupported(e))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new ss(this.device,{id:t.id||"buffer-transform-model",fs:t.fs||S0(),topology:t.topology||"point-list",varyings:t.outputs||t.varyings,...t}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:t.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){e?.inputBuffers&&this.model.setAttributes(e.inputBuffers),e?.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);const t=this.device.beginRenderPass(e);this.model.draw(t),t.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const t=this.getBuffer(e);if(!t)throw new Error("BufferTransform#getBuffer");if(t instanceof at)return t.readAsync();const{buffer:i,byteOffset:s=0,byteLength:o=i.byteLength}=t;return i.readAsync(s,o)}}const HO="transform_output";class Qb{device;model;sampler;currentIndex=0;samplerTextureMap=null;bindings=[];resources={};constructor(e,t){this.device=e,this.sampler=e.createSampler({addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",minFilter:"nearest",magFilter:"nearest",mipmapFilter:"nearest"}),this.model=new ss(this.device,{id:t.id||"texture-transform-model",fs:t.fs||S0({input:t.targetTextureVarying,inputChannels:t.targetTextureChannels,output:HO}),vertexCount:t.vertexCount,...t}),this._initialize(t),Object.seal(this)}destroy(){this.model.destroy();for(const e of this.bindings)e.framebuffer?.destroy()}delete(){this.destroy()}run(e){const{framebuffer:t}=this.bindings[this.currentIndex],i=this.device.beginRenderPass({framebuffer:t,...e});this.model.draw(i),i.end()}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}_initialize(e){this._updateBindings(e)}_updateBindings(e){this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e)}_updateBinding(e,{sourceBuffers:t,sourceTextures:i,targetTexture:s}){if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,i),Object.assign(e.sourceBuffers,t),s){e.targetTexture=s;const{width:o,height:c}=s;e.framebuffer&&e.framebuffer.destroy(),e.framebuffer=this.device.createFramebuffer({id:"transform-framebuffer",width:o,height:c,colorAttachments:[s]}),e.framebuffer.resize({width:o,height:c})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:t}=this.bindings[e];for(const i in t)t[i].sampler=this.sampler}}class P3{id;topology;vertexCount;indices;attributes;userData={};constructor(e){const{attributes:t={},indices:i=null,vertexCount:s=null}=e;this.id=e.id||zc("geometry"),this.topology=e.topology,i&&(this.indices=ArrayBuffer.isView(i)?{value:i,size:1}:i),this.attributes={};for(const[o,c]of Object.entries(t)){const u=ArrayBuffer.isView(c)?{value:c}:c;if(!ArrayBuffer.isView(u.value))throw new Error(`${this._print(o)}: must be typed array or object with value as typed array`);if((o==="POSITION"||o==="positions")&&!u.size&&(u.size=3),o==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=u}else this.attributes[o]=u}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=s||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,t){return this}_calculateVertexCount(e,t){if(t)return t.value.length;let i=1/0;for(const s of Object.values(e)){const{value:o,size:c,constant:u}=s;!u&&o&&c!==void 0&&c>=1&&(i=Math.min(i,o.length/c))}return i}}const WO={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class k3 extends tp{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:t,views:i,viewports:s,onViewportActive:o,pickingFBO:c,deviceRect:{x:u,y:h,width:d,height:g},cullRect:m,effects:y,pass:T="picking",pickZ:w,shaderModuleProps:C}){this.pickZ=w;const N=this._resetColorEncoder(w),V=[u,h,d,g],$=super.render({target:c,layers:e,layerFilter:t,views:i,viewports:s,onViewportActive:o,cullRect:m,effects:y?.filter(F=>F.useInPicking),pass:T,isPicking:!0,shaderModuleProps:C,clearColor:[0,0,0,0],colorMask:15,scissorRect:V});return this._colorEncoderState=null,{decodePickingColor:N&&XO.bind(null,N),stats:$}}shouldDrawLayer(e){const{pickable:t,operation:i}=e.props;return t&&i.includes("draw")||i.includes("terrain")||i.includes("mask")}getShaderModuleProps(e,t,i){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,t,i){const s={...e.props.parameters},{pickable:o,operation:c}=e.props;return!this._colorEncoderState||c.includes("terrain")?s.blend=!1:o&&c.includes("draw")&&(Object.assign(s,WO),s.blend=!0,s.blendColor=$O(this._colorEncoderState,e,i)),s}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function $O(n,e,t){const{byLayer:i,byAlpha:s}=n;let o,c=i.get(e);return c?(c.viewports.push(t),o=c.a):(o=i.size+1,o<=255?(c={a:o,layer:e,viewports:[t]},i.set(e,c),s[o]=c):(et.warn("Too many pickable layers, only picking the first 255")(),o=0)),[0,0,0,o/255]}function XO(n,e){const t=n.byAlpha[e[3]];return t&&{pickedLayer:t.layer,pickedViewports:t.viewports,pickedObjectIndex:t.layer.decodePickingColor(e)}}const kr={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},Rc=Symbol.for("component"),ns=Symbol.for("propTypes"),Fh=Symbol.for("deprecatedProps"),Hr=Symbol.for("asyncPropDefaults"),Bs=Symbol.for("asyncPropOriginal"),Ji=Symbol.for("asyncPropResolved");function sp(n,e=()=>!0){return Array.isArray(n)?D3(n,e,[]):e(n)?[n]:[]}function D3(n,e,t){let i=-1;for(;++i<n.length;){const s=n[i];Array.isArray(s)?D3(s,e,t):e(s)&&t.push(s)}return t}function YO({target:n,source:e,start:t=0,count:i=1}){const s=e.length,o=i*s;let c=0;for(let u=t;c<s;c++)n[u++]=e[c];for(;c<o;)c<o-c?(n.copyWithin(t+c,t,t+c),c*=2):(n.copyWithin(t+c,t,t+o-c),c=o);return n}class qO{constructor(e,t,i){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=i,this.setData(t)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,t){if(e===this._data&&!t)return;this._data=e;const i=++this._loadCount;let s=e;typeof e=="string"&&(s=Yh(e)),s instanceof Promise?(this.isLoaded=!1,this._loader=s.then(o=>{this._loadCount===i&&(this.isLoaded=!0,this._error=void 0,this._content=o)}).catch(o=>{this._loadCount===i&&(this.isLoaded=!0,this._error=o||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const o of this._subscribers)o.onChange(this.getData())}}class KO{constructor(e){this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:e.device?.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:t,forceUpdate:i=!1,persistent:s=!0}){let o=this._resources[e];o?o.setData(t,i):(o=new qO(e,t,this._context),this._resources[e]=o),o.persistent=s}remove(e){const t=this._resources[e];t&&(t.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const t=this._consumers[e];if(t){for(const i in t){const s=t[i],o=this._resources[s.resourceId];o&&o.unsubscribe(s)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:t,consumerId:i,requestId:s="default"}){const{_resources:o,protocol:c}=this;e.startsWith(c)&&(e=e.replace(c,""),o[e]||this.add({resourceId:e,data:null,persistent:!1}));const u=o[e];if(this._track(i,s,u,t),u)return u.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,t,i,s){const o=this._consumers,c=o[e]=o[e]||{};let u=c[t];const h=u&&u.resourceId&&this._resources[u.resourceId];h&&(h.unsubscribe(u),this.prune()),i&&(u?(u.onChange=s,u.resourceId=i.id):u={onChange:s,resourceId:i.id},c[t]=u,i.subscribe(u))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const t=this._resources[e];!t.persistent&&!t.inUse()&&(t.delete(),delete this._resources[e])}}}const ZO="layerManager.setLayers",QO="layerManager.activateViewport";class GO{constructor(e,t){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=u=>{$t(QO,this,u),u&&(this.context.viewport=u)};const{deck:i,stats:s,viewport:o,timeline:c}=t||{};this.layers=[],this.resourceManager=new KO({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e?.gl,deck:i,shaderAssembler:QM(e?.info?.shadingLanguage||"glsl"),defaultShaderModules:[oC],renderPass:void 0,stats:s||new Nc({id:"deck.gl"}),viewport:o||new Ro({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:c||new M3,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const i of this.layers){const s=i.getNeedsRedraw(e);t=t||s}return t}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(t=>e.find(i=>t.id.indexOf(i)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,t){$t(ZO,this,t,e),this._lastRenderedLayers=e;const i=sp(e,Boolean);for(const s of i)s.context=this.context;this._updateLayers(this.layers,i)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:t}=this.context;t.find(i=>i.name===e.name)||(t.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:t}=this.context,i=t.findIndex(s=>s.name===e.name);i>=0&&(t.splice(i,1),this._defaultShaderModulesChanged=!0)}_handleError(e,t,i){i.raiseError(t,`${e} of ${i}`)}_updateLayers(e,t){const i={};for(const c of e)i[c.id]?et.warn(`Multiple old layers with same id ${c.id}`)():i[c.id]=c;if(this._defaultShaderModulesChanged){for(const c of e)c.setNeedsUpdate(),c.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const s=[];this._updateSublayersRecursively(t,i,s),this._finalizeOldLayers(i);let o=!1;for(const c of s)if(c.hasUniformTransition()){o=`Uniform transition in ${c}`;break}this._needsUpdate=o,this.layers=s}_updateSublayersRecursively(e,t,i){for(const s of e){s.context=this.context;const o=t[s.id];o===null&&et.warn(`Multiple new layers with same id ${s.id}`)(),t[s.id]=null;let c=null;try{this._debug&&o!==s&&s.validateProps(),o?(this._transferLayerState(o,s),this._updateLayer(s)):this._initializeLayer(s),i.push(s),c=s.isComposite?s.getSubLayers():null}catch(u){this._handleError("matching",u,s)}c&&this._updateSublayersRecursively(c,t,i)}}_finalizeOldLayers(e){for(const t in e){const i=e[t];i&&this._finalizeLayer(i)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=kr.INITIALIZED}catch(t){this._handleError("initialization",t,e)}}_transferLayerState(e,t){t._transferState(e),t.lifecycle=kr.MATCHED,t!==e&&(e.lifecycle=kr.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(t){this._handleError("update",t,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=kr.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=kr.FINALIZED}catch(t){this._handleError("finalization",t,e)}}}function Fn(n,e,t){if(n===e)return!0;if(!t||!n||!e)return!1;if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let i=0;i<n.length;i++)if(!Fn(n[i],e[i],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof n=="object"&&typeof e=="object"){const i=Object.keys(n),s=Object.keys(e);if(i.length!==s.length)return!1;for(const o of i)if(!e.hasOwnProperty(o)||!Fn(n[o],e[o],t-1))return!1;return!0}return!1}class JO{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const t=this.controllers[e];t&&t.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const t=this.controllers[e];t&&t.updateTransition()}}getViewports(e){return e?this._viewports.filter(t=>t.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(t=>{e[t.id]=t}),e}getView(e){return this.views.find(t=>t.id===e)}getViewState(e){const t=typeof e=="string"?this.getView(e):e,i=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(i):i}getViewport(e){return this._viewportMap[e]}unproject(e,t){const i=this.getViewports(),s={x:e[0],y:e[1]};for(let o=i.length-1;o>=0;--o){const c=i[o];if(c.containsPixel(s)){const u=e.slice();return u[0]-=c.x,u[1]-=c.y,c.unproject(u,t)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){(e!==this.width||t!==this.height)&&(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=sp(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!Fn(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):et.warn("missing `viewState` or `initialViewState`")()}_createController(e,t){const i=t.type;return new i({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:o=>this.getView(e.id)?.makeViewport({viewState:o,width:this.width,height:this.height})})}_updateController(e,t,i,s){const o=e.controller;if(o&&i){const c={...t,...o,id:e.id,x:i.x,y:i.y,width:i.width,height:i.height};return(!s||s.constructor!==o.type)&&(s=this._createController(e,c)),s&&s.setProps(c),s}return null}_rebuildViewports(){const{views:e}=this,t=this.controllers;this._viewports=[],this.controllers={};let i=!1;for(let s=e.length;s--;){const o=e[s],c=this.getViewState(o),u=o.makeViewport({viewState:c,width:this.width,height:this.height});let h=t[o.id];const d=!!o.controller;d&&!h&&(i=!0),(i||!d)&&h&&(h.finalize(),h=null),this.controllers[o.id]=this._updateController(o,c,u,h),u&&this._viewports.unshift(u)}for(const s in t){const o=t[s];o&&!this.controllers[s]&&o.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,t){return e.length!==t.length?!0:e.some((i,s)=>!e[s].equals(t[s]))}}const e4=/([0-9]+\.?[0-9]*)(%|px)/;function $i(n){switch(typeof n){case"number":return{position:n,relative:!1};case"string":const e=e4.exec(n);if(e&&e.length>=3){const t=e[2]==="%",i=parseFloat(e[1]);return{position:t?i/100:i,relative:t}}default:throw new Error(`Could not parse position string ${n}`)}}function Xi(n,e){return n.relative?Math.round(n.position*e):n.position}class Jr{constructor(e){const{id:t,x:i=0,y:s=0,width:o="100%",height:c="100%",padding:u=null}=e;this.id=t||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=$i(i),this._y=$i(s),this._width=$i(o),this._height=$i(c),this._padding=u&&{left:$i(u.left||0),right:$i(u.right||0),top:$i(u.top||0),bottom:$i(u.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.constructor===e.constructor&&Fn(this.props,e.props,2)}makeViewport({width:e,height:t,viewState:i}){i=this.filterViewState(i);const s=this.getDimensions({width:e,height:t});if(!s.height||!s.width)return null;const o=this.getViewportType(i);return new o({...i,...this.props,...s})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:e?.id||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const t={...e};for(const i in this.props.viewState)i!=="id"&&(t[i]=this.props.viewState[i]);return t}return e}getDimensions({width:e,height:t}){const i={x:Xi(this._x,e),y:Xi(this._y,t),width:Xi(this._width,e),height:Xi(this._height,t)};return this._padding&&(i.padding={left:Xi(this._padding.left,e),top:Xi(this._padding.top,t),right:Xi(this._padding.right,e),bottom:Xi(this._padding.bottom,t)}),i}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class Vc{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){this.cancel(),this.settings=e,this._inProgress=!0,this.settings.onStart?.(this)}end(){this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,this.settings.onEnd?.(this))}cancel(){this._inProgress&&(this.settings.onInterrupt?.(this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:e,settings:t}=this;this._handle=e.addChannel({delay:e.getTime(),duration:t.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),this.settings.onUpdate?.(this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const Gb=()=>{},gd={BREAK:1,SNAP_TO_END:2,IGNORE:3},t4=n=>n,n4=gd.BREAK;class i4{constructor(e){this._onTransitionUpdate=t=>{const{time:i,settings:{interpolator:s,startProps:o,endProps:c,duration:u,easing:h}}=t,d=h(i/u),g=s.interpolateProps(o,c,d);this.propsInTransition=this.getControllerState({...this.props,...g}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new Vc(e.timeline),this.onViewStateChange=e.onViewStateChange||Gb,this.onStateChange=e.onStateChange||Gb}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1;const i=this.props;if(this.props=e,!i||this._shouldIgnoreViewportChange(i,e))return!1;if(this._isTransitionEnabled(e)){let s=i;if(this.transition.inProgress){const{interruption:o,endProps:c}=this.transition.settings;s={...i,...o===gd.SNAP_TO_END?c:this.propsInTransition||i}}this._triggerTransition(s,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:t,transitionInterpolator:i}=e;return(t>0||t==="auto")&&!!i}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,t){return this.transition.inProgress?this.transition.settings.interruption===gd.IGNORE||this._isUpdateDueToCurrentTransition(t):this._isTransitionEnabled(t)?t.transitionInterpolator.arePropsEqual(e,t):!0}_triggerTransition(e,t){const i=this.getControllerState(e),s=this.getControllerState(t).shortestPathFrom(i),o=t.transitionInterpolator,c=o.getDuration?o.getDuration(e,t):t.transitionDuration;if(c===0)return;const u=o.initializeProps(e,s);this.propsInTransition={};const h={duration:c,easing:t.transitionEasing||t4,interpolator:o,interruption:t.transitionInterruption||n4,startProps:u.start,endProps:u.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(h),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e?.(t)}}}function Xt(n,e){if(!n)throw new Error(e||"deck.gl: assertion failed.")}class s4{constructor(e){const{compare:t,extract:i,required:s}=e;this._propsToCompare=t,this._propsToExtract=i||t,this._requiredProps=s}arePropsEqual(e,t){for(const i of this._propsToCompare)if(!(i in e)||!(i in t)||!vo(e[i],t[i]))return!1;return!0}initializeProps(e,t){const i={},s={};for(const o of this._propsToExtract)(o in e||o in t)&&(i[o]=e[o],s[o]=t[o]);return this._checkRequiredProps(i),this._checkRequiredProps(s),{start:i,end:s}}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(t=>{const i=e[t];Xt(Number.isFinite(i)||Array.isArray(i),`${t} is required for transition`)})}}const r4=["longitude","latitude","zoom","bearing","pitch"],a4=["longitude","latitude","zoom"];class U3 extends s4{constructor(e={}){const t=Array.isArray(e)?e:e.transitionProps,i=Array.isArray(e)?{}:e;i.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:r4,required:a4},super(i.transitionProps),this.opts=i}initializeProps(e,t){const i=super.initializeProps(e,t),{makeViewport:s,around:o}=this.opts;if(s&&o){const c=s(e),u=s(t),h=c.unproject(o);i.start.around=o,Object.assign(i.end,{around:u.project(h),aroundPosition:h,width:t.width,height:t.height})}return i}interpolateProps(e,t,i){const s={};for(const o of this._propsToExtract)s[o]=Tc(e[o]||0,t[o]||0,i);if(t.aroundPosition&&this.opts.makeViewport){const o=this.opts.makeViewport({...t,...s});Object.assign(s,o.panByPosition(t.aroundPosition,Tc(e.around,t.around,i)))}return s}}const Yi={transitionDuration:0},o4=300,Ql=n=>1-(1-n)*(1-n),Pr={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},As={};class l4{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new i4({...e,getControllerState:t=>new this.ControllerState(t),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const e in this._events)this._events[e]&&this.eventManager?.off(e,this.handleEvent);this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const t=this._eventStartBlocked;switch(e.type){case"panstart":return t?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return t?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return t?!1:this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:t,y:i}=this.props,{offsetCenter:s}=e;return[s.x-t,s.y-i]}isPointInBounds(e,t){const{width:i,height:s}=this.props;if(t&&t.handled)return!1;const o=e[0]>=0&&e[0]<=i&&e[1]>=0&&e[1]<=s;return o&&t&&t.stopPropagation(),o}isFunctionKeyPressed(e){const{srcEvent:t}=e;return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const t=setTimeout(()=>{this._eventStartBlocked===t&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=t}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:t}=e;this.inertia=Number.isFinite(t)?t:t===!0?o4:0;const{scrollZoom:i=!0,dragPan:s=!0,dragRotate:o=!0,doubleClickZoom:c=!0,touchZoom:u=!0,touchRotate:h=!1,keyboard:d=!0}=e,g=!!this.onViewStateChange;this.toggleEvents(Pr.WHEEL,g&&i),this.toggleEvents(Pr.PAN,g),this.toggleEvents(Pr.PINCH,g&&(u||h)),this.toggleEvents(Pr.MULTI_PAN,g&&h),this.toggleEvents(Pr.DOUBLE_CLICK,g&&c),this.toggleEvents(Pr.KEYBOARD,g&&d),this.scrollZoom=i,this.dragPan=s,this.dragRotate=o,this.doubleClickZoom=c,this.touchZoom=u,this.touchRotate=h,this.keyboard=d}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,t){this.eventManager&&e.forEach(i=>{this._events[i]!==t&&(this._events[i]=t,t?this.eventManager.on(i,this.handleEvent):this.eventManager.off(i,this.handleEvent))})}updateViewport(e,t=null,i={}){const s={...e.getViewportProps(),...t},o=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(i),o){const c=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:s,interactionState:this._interactionState,oldViewState:c,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let i=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(i=!i);const s=this.controllerState[i?"panStart":"rotateStart"]({pos:t});return this._panMove=i,this.updateViewport(s,Yi,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const t=this.getCenter(e),i=this.controllerState.pan({pos:t});return this.updateViewport(i,Yi,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:t}=this;if(this.dragPan&&t&&e.velocity){const i=this.getCenter(e),s=[i[0]+e.velocityX*t/2,i[1]+e.velocityY*t/2],o=this.controllerState.pan({pos:s}).panEnd();this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:Ql},{isDragging:!1,isPanning:!0})}else{const i=this.controllerState.panEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const t=this.getCenter(e),i=this.controllerState.rotate({pos:t});return this.updateViewport(i,Yi,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:t}=this;if(this.dragRotate&&t&&e.velocity){const i=this.getCenter(e),s=[i[0]+e.velocityX*t/2,i[1]+e.velocityY*t/2],o=this.controllerState.rotate({pos:s}).rotateEnd();this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:Ql},{isDragging:!1,isRotating:!0})}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;e.srcEvent.preventDefault();const{speed:i=.01,smooth:s=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:o}=e;let c=2/(1+Math.exp(-Math.abs(o*i)));o<0&&c!==0&&(c=1/c);const u=this.controllerState.zoom({pos:t,scale:c});return this.updateViewport(u,{...this._getTransitionProps({around:t}),transitionDuration:s?250:1},{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const i=this.controllerState.rotateStart({pos:t});return this.updateViewport(i,Yi,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate||!this.isDragging())return!1;const t=this.getCenter(e);t[0]-=e.deltaX;const i=this.controllerState.rotate({pos:t});return this.updateViewport(i,Yi,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this;if(this.touchRotate&&t&&e.velocityY){const i=this.getCenter(e),s=[i[0],i[1]+=e.velocityY*t/2],o=this.controllerState.rotate({pos:s});this.updateViewport(o,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:Ql},{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{const i=this.controllerState.rotateEnd();this.updateViewport(i,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const i=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return As._startPinchRotation=e.rotation,As._lastPinchEvent=e,this.updateViewport(i,Yi,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let t=this.controllerState;if(this.touchZoom){const{scale:i}=e,s=this.getCenter(e);t=t.zoom({pos:s,scale:i})}if(this.touchRotate){const{rotation:i}=e;t=t.rotate({deltaAngleX:As._startPinchRotation-i})}return this.updateViewport(t,Yi,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),As._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this,{_lastPinchEvent:i}=As;if(this.touchZoom&&t&&i&&e.scale!==i.scale){const s=this.getCenter(e);let o=this.controllerState.rotateEnd();const c=Math.log2(e.scale),u=(c-Math.log2(i.scale))/(e.deltaTime-i.deltaTime),h=Math.pow(2,c+u*t/2);o=o.zoom({pos:s,scale:h}).zoomEnd(),this.updateViewport(o,{...this._getTransitionProps({around:s}),transitionDuration:t,transitionEasing:Ql},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(t)}else{const s=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(s,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return As._startPinchRotation=null,As._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const i=this.isFunctionKeyPressed(e),s=this.controllerState.zoom({pos:t,scale:i?.5:2});return this.updateViewport(s,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const t=this.isFunctionKeyPressed(e),{zoomSpeed:i,moveSpeed:s,rotateSpeedX:o,rotateSpeedY:c}=this.keyboard===!0?{}:this.keyboard,{controllerState:u}=this;let h;const d={};switch(e.srcEvent.code){case"Minus":h=t?u.zoomOut(i).zoomOut(i):u.zoomOut(i),d.isZooming=!0;break;case"Equal":h=t?u.zoomIn(i).zoomIn(i):u.zoomIn(i),d.isZooming=!0;break;case"ArrowLeft":t?(h=u.rotateLeft(o),d.isRotating=!0):(h=u.moveLeft(s),d.isPanning=!0);break;case"ArrowRight":t?(h=u.rotateRight(o),d.isRotating=!0):(h=u.moveRight(s),d.isPanning=!0);break;case"ArrowUp":t?(h=u.rotateUp(c),d.isRotating=!0):(h=u.moveUp(s),d.isPanning=!0);break;case"ArrowDown":t?(h=u.rotateDown(c),d.isRotating=!0):(h=u.moveDown(s),d.isPanning=!0);break;default:return!1}return this.updateViewport(h,this._getTransitionProps(),d),!0}_getTransitionProps(e){const{transition:t}=this;return!t||!t.transitionInterpolator?Yi:e?{...t,transitionInterpolator:new U3({...e,...t.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:t}}class c4{constructor(e,t){this._viewportProps=this.applyConstraints(e),this._state=t}getViewportProps(){return this._viewportProps}getState(){return this._state}}const Jb=5,u4=1.2;class f4 extends c4{constructor(e){const{width:t,height:i,latitude:s,longitude:o,zoom:c,bearing:u=0,pitch:h=0,altitude:d=1.5,position:g=[0,0,0],maxZoom:m=20,minZoom:y=0,maxPitch:T=60,minPitch:w=0,startPanLngLat:C,startZoomLngLat:N,startRotatePos:V,startBearing:$,startPitch:O,startZoom:F,normalize:H=!0}=e;Xt(Number.isFinite(o)),Xt(Number.isFinite(s)),Xt(Number.isFinite(c)),super({width:t,height:i,latitude:s,longitude:o,zoom:c,bearing:u,pitch:h,altitude:d,maxZoom:m,minZoom:y,maxPitch:T,minPitch:w,normalize:H,position:g},{startPanLngLat:C,startZoomLngLat:N,startRotatePos:V,startBearing:$,startPitch:O,startZoom:F}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:t}){const i=this.getState().startPanLngLat||this._unproject(t);if(!i)return this;const o=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(o)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:i=0}){const{startRotatePos:s,startBearing:o,startPitch:c}=this.getState();if(!s||o===void 0||c===void 0)return this;let u;return e?u=this._getNewRotation(e,s,c,o):u={bearing:o+t,pitch:c+i},this._getUpdatedState(u)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:t,scale:i}){let{startZoom:s,startZoomLngLat:o}=this.getState();if(o||(s=this.getViewportProps().zoom,o=this._unproject(t)||this._unproject(e)),!o)return this;const{maxZoom:c,minZoom:u}=this.getViewportProps();let h=s+Math.log2(i);h=Gi(h,u,c);const d=this.makeViewport({...this.getViewportProps(),zoom:h});return this._getUpdatedState({zoom:h,...d.panByPosition(o,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const t=e.getViewportProps(),i={...this.getViewportProps()},{bearing:s,longitude:o}=i;return Math.abs(s-t.bearing)>180&&(i.bearing=s<0?s+360:s-360),Math.abs(o-t.longitude)>180&&(i.longitude=o<0?o+360:o-360),i}applyConstraints(e){const{maxZoom:t,minZoom:i,zoom:s}=e;e.zoom=Gi(s,i,t);const{maxPitch:o,minPitch:c,pitch:u}=e;e.pitch=Gi(u,c,o);const{normalize:h=!0}=e;return h&&Object.assign(e,DM(e)),e}_zoomFromCenter(e){const{width:t,height:i}=this.getViewportProps();return this.zoom({pos:[t/2,i/2],scale:e})}_panFromCenter(e){const{width:t,height:i}=this.getViewportProps();return this.pan({startPos:[t/2,i/2],pos:[t/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_getNewRotation(e,t,i,s){const o=e[0]-t[0],c=e[1]-t[1],u=e[1],h=t[1],{width:d,height:g}=this.getViewportProps(),m=o/d;let y=0;c>0?Math.abs(g-h)>Jb&&(y=c/(h-g)*u4):c<0&&h>Jb&&(y=1-u/h),y=Gi(y,-1,1);const{minPitch:T,maxPitch:w}=this.getViewportProps(),C=s+180*m;let N=i;return y>0?N=i+y*(w-i):y<0&&(N=i-y*(T-i)),{pitch:N,bearing:C}}}class h4 extends l4{constructor(){super(...arguments),this.ControllerState=f4,this.transition={transitionDuration:300,transitionInterpolator:new U3({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const t=this.props;super.setProps(e),(!t||t.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}let B3=class extends Jr{constructor(e={}){super(e)}getViewportType(){return Qr}get ControllerType(){return h4}};B3.displayName="MapView";const d4=new R3;function p4(n,e){const t=n.order??1/0,i=e.order??1/0;return t-i}class g4{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const t=this._defaultEffects;if(!t.find(i=>i.id===e.id)){const i=t.findIndex(s=>p4(s,e)>0);i<0?t.push(e):t.splice(i,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(Fn(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._resolvedEffects}_setEffects(e){const t={};for(const s of this.effects)t[s.id]=s;const i=[];for(const s of e){const o=t[s.id];let c=s;o&&o!==s?o.setProps?(o.setProps(s.props),c=o):o.cleanup(this._context):o||s.setup(this._context),i.push(c),delete t[s.id]}for(const s in t)t[s].cleanup(this._context);this.effects=i,this._resolvedEffects=i.concat(this._defaultEffects),e.some(s=>s instanceof R3)||this._resolvedEffects.push(d4),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class _4 extends tp{shouldDrawLayer(e){const{operation:t}=e.props;return t.includes("draw")||t.includes("terrain")}}const m4="deckRenderer.renderLayers";class y4{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new _4(e),this.pickLayersPass=new k3(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,i={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};i.effects&&this._preRender(i.effects,i);const s=this.lastPostProcessEffect?this.renderBuffers[0]:i.target;this.lastPostProcessEffect&&(i.clearColor=[0,0,0,0],i.clearCanvas=!0);const o=t.render({...i,target:s});i.effects&&this._postRender(i.effects,i),this.renderCount++,$t(m4,this,o,e)}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}finalize(){const{renderBuffers:e}=this;for(const t of e)t.delete();e.length=0}_preRender(e,t){this.lastPostProcessEffect=null,t.preRenderStats=t.preRenderStats||{};for(const i of e)t.preRenderStats[i.id]=i.preRender(t),i.postRender&&(this.lastPostProcessEffect=i.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,t=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(i=>{const s=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${i}`,colorAttachments:[s]}))});for(const i of e)i.resize(t)}_postRender(e,t){const{renderBuffers:i}=this,s={...t,inputBuffer:i[0],swapBuffer:i[1]};for(const o of e)if(o.postRender){s.target=o.id===this.lastPostProcessEffect?t.target:void 0;const c=o.postRender(s);s.inputBuffer=c,s.swapBuffer=c===i[0]?i[1]:i[0]}}}const b4={pickedColor:null,pickedObjectIndex:-1};function v4({pickedColors:n,decodePickingColor:e,deviceX:t,deviceY:i,deviceRadius:s,deviceRect:o}){const{x:c,y:u,width:h,height:d}=o;let g=s*s,m=-1,y=0;for(let T=0;T<d;T++){const w=T+u-i,C=w*w;if(C>g)y+=4*h;else for(let N=0;N<h;N++){if(n[y+3]-1>=0){const $=N+c-t,O=$*$+C;O<=g&&(g=O,m=y)}y+=4}}if(m>=0){const T=n.slice(m,m+4),w=e(T);if(w){const C=Math.floor(m/4/h),N=m/4-C*h;return{...w,pickedColor:T,pickedX:c+N,pickedY:u+C}}et.error("Picked non-existent layer. Is picking buffer corrupt?")()}return b4}function T4({pickedColors:n,decodePickingColor:e}){const t=new Map;if(n){for(let i=0;i<n.length;i+=4)if(n[i+3]-1>=0){const o=n.slice(i,i+4),c=o.join(",");if(!t.has(c)){const u=e(o);u?t.set(c,{...u,color:o}):et.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(t.values())}function F3({pickInfo:n,viewports:e,pixelRatio:t,x:i,y:s,z:o}){let c=e[0];e.length>1&&(c=S4(n?.pickedViewports||e,{x:i,y:s}));let u;if(c){const h=[i-c.x,s-c.y];o!==void 0&&(h[2]=o),u=c.unproject(h)}return{color:null,layer:null,viewport:c,index:-1,picked:!1,x:i,y:s,pixel:[i,s],coordinate:u,devicePixel:n&&"pickedX"in n?[n.pickedX,n.pickedY]:void 0,pixelRatio:t}}function x4(n){const{pickInfo:e,lastPickedInfo:t,mode:i,layers:s}=n,{pickedColor:o,pickedLayer:c,pickedObjectIndex:u}=e,h=c?[c]:[];if(i==="hover"){const m=t.index,y=t.layerId,T=c?c.props.id:null;if(T!==y||u!==m){if(T!==y){const w=s.find(C=>C.props.id===y);w&&h.unshift(w)}t.layerId=T,t.index=u,t.info=null}}const d=F3(n),g=new Map;return g.set(null,d),h.forEach(m=>{let y={...d};m===c&&(y.color=o,y.index=u,y.picked=!0),y=L3({layer:m,info:y,mode:i});const T=y.layer;m===c&&i==="hover"&&(t.info=y),g.set(T.id,y),i==="hover"&&T.updateAutoHighlight(y)}),g}function L3({layer:n,info:e,mode:t}){for(;n&&e;){const i=e.layer||null;e.sourceLayer=i,e.layer=n,e=n.getPickingInfo({info:e,mode:t,sourceLayer:i}),n=n.parent}return e}function S4(n,e){for(let t=n.length-1;t>=0;t--){const i=n[t];if(i.containsPixel(e))return i}return n[0]}class w4{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new k3(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:t,layers:i,viewports:s},o=this.lastPickedInfo.info){const c=o&&o.layer&&o.layer.id,u=o&&o.viewport&&o.viewport.id,h=c?i.find(y=>y.id===c):null,d=u&&s.find(y=>y.id===u)||s[0],g=d&&d.unproject([e-d.x,t-d.y]);return{...o,...{x:e,y:t,viewport:d,coordinate:g,layer:h}}}_resizeBuffer(){if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const t=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=t}const{canvas:e}=this.device.getDefaultCanvasContext();this.pickingFBO?.resize({width:e.width,height:e.height}),this.depthFBO?.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const t=e.filter(i=>this.pickLayersPass.shouldDrawLayer(i)&&!i.isComposite);return t.length?t:null}_pickClosestObject({layers:e,views:t,viewports:i,x:s,y:o,radius:c=0,depth:u=1,mode:h="query",unproject3D:d,onViewportActive:g,effects:m}){const y=this.device.canvasContext.cssToDeviceRatio(),T=this._getPickable(e);if(!T||i.length===0)return{result:[],emptyInfo:F3({viewports:i,x:s,y:o,pixelRatio:y})};this._resizeBuffer();const w=this.device.canvasContext.cssToDevicePixels([s,o],!0),C=[w.x+Math.floor(w.width/2),w.y+Math.floor(w.height/2)],N=Math.round(c*y),{width:V,height:$}=this.pickingFBO,O=this._getPickingRect({deviceX:C[0],deviceY:C[1],deviceRadius:N,deviceWidth:V,deviceHeight:$}),F={x:s-c,y:o-c,width:c*2+1,height:c*2+1};let H;const te=[],oe=new Set;for(let E=0;E<u;E++){let R;if(O){const ie=this._drawAndSample({layers:T,views:t,viewports:i,onViewportActive:g,deviceRect:O,cullRect:F,effects:m,pass:`picking:${h}`});R=v4({...ie,deviceX:C[0],deviceY:C[1],deviceRadius:N,deviceRect:O})}else R={pickedColor:null,pickedObjectIndex:-1};let Y;if(R.pickedLayer&&d&&this.depthFBO){const{pickedColors:ie}=this._drawAndSample({layers:[R.pickedLayer],views:t,viewports:i,onViewportActive:g,deviceRect:{x:R.pickedX,y:R.pickedY,width:1,height:1},cullRect:F,effects:m,pass:`picking:${h}:z`},!0);ie[3]&&(Y=ie[0])}R.pickedLayer&&E+1<u&&(oe.add(R.pickedLayer),R.pickedLayer.disablePickingIndex(R.pickedObjectIndex)),H=x4({pickInfo:R,lastPickedInfo:this.lastPickedInfo,mode:h,layers:T,viewports:i,x:s,y:o,z:Y,pixelRatio:y});for(const ie of H.values())ie.layer&&te.push(ie);if(!R.pickedColor)break}for(const E of oe)E.restorePickingColors();return{result:te,emptyInfo:H.get(null)}}_pickVisibleObjects({layers:e,views:t,viewports:i,x:s,y:o,width:c=1,height:u=1,mode:h="query",maxObjects:d=null,onViewportActive:g,effects:m}){const y=this._getPickable(e);if(!y||i.length===0)return[];this._resizeBuffer();const T=this.device.canvasContext.cssToDeviceRatio(),w=this.device.canvasContext.cssToDevicePixels([s,o],!0),C=w.x,N=w.y+w.height,V=this.device.canvasContext.cssToDevicePixels([s+c,o+u],!0),$=V.x+V.width,O=V.y,F={x:C,y:O,width:$-C,height:N-O},H=this._drawAndSample({layers:y,views:t,viewports:i,onViewportActive:g,deviceRect:F,cullRect:{x:s,y:o,width:c,height:u},effects:m,pass:`picking:${h}`}),te=T4(H),oe=new Map,E=[],R=Number.isFinite(d);for(let Y=0;Y<te.length&&!(R&&E.length>=d);Y++){const ie=te[Y];let re={color:ie.pickedColor,layer:null,index:ie.pickedObjectIndex,picked:!0,x:s,y:o,pixelRatio:T};re=L3({layer:ie.pickedLayer,info:re,mode:h});const pe=re.layer.id;oe.has(pe)||oe.set(pe,new Set);const be=oe.get(pe),Ie=re.object??re.index;be.has(Ie)||(be.add(Ie),E.push(re))}return E}_drawAndSample({layers:e,views:t,viewports:i,onViewportActive:s,deviceRect:o,cullRect:c,effects:u,pass:h},d=!1){const g=d?this.depthFBO:this.pickingFBO,m={layers:e,layerFilter:this.layerFilter,views:t,viewports:i,onViewportActive:s,pickingFBO:g,deviceRect:o,cullRect:c,effects:u,pass:h,pickZ:d,preRenderStats:{},isPicking:!0};for(const $ of u)$.useInPicking&&(m.preRenderStats[$.id]=$.preRender(m));const{decodePickingColor:y}=this.pickLayersPass.render(m),{x:T,y:w,width:C,height:N}=o,V=new(d?Float32Array:Uint8Array)(C*N*4);return this.device.readPixelsToArrayWebGL(g,{sourceX:T,sourceY:w,sourceWidth:C,sourceHeight:N,target:V}),{pickedColors:V,decodePickingColor:y}}_getPickingRect({deviceX:e,deviceY:t,deviceRadius:i,deviceWidth:s,deviceHeight:o}){const c=Math.max(0,e-i),u=Math.max(0,t-i),h=Math.min(s,e+i+1)-c,d=Math.min(o,t+i+1)-u;return h<=0||d<=0?null:{x:c,y:u,width:h,height:d}}}const A4={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},E4="top-left",ev="__root";class R4{constructor({deck:e,parentElement:t}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=t}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!Fn(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(t=>t.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const t={};for(const i of this.resolvedWidgets)t[i.id]=i;this.resolvedWidgets.length=0;for(const i of this.defaultWidgets)t[i.id]=null,this.resolvedWidgets.push(i);for(let i of e){const s=t[i.id];s?s.viewId!==i.viewId||s.placement!==i.placement?(this._remove(s),this._add(i)):i!==s&&(s.setProps(i.props),i=s):this._add(i),t[i.id]=null,this.resolvedWidgets.push(i)}for(const i in t){const s=t[i];s&&this._remove(s)}this.widgets=e}_add(e){const{viewId:t=null,placement:i=E4}=e,s=e.onAdd({deck:this.deck,viewId:t});s&&this._getContainer(t,i).append(s),e._element=s}_remove(e){e.onRemove?.(),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,t){const i=e||ev;let s=this.containers[i];s||(s=document.createElement("div"),s.style.pointerEvents="none",s.style.position="absolute",s.style.overflow="hidden",this.parentElement?.append(s),this.containers[i]=s);let o=s.querySelector(`.${t}`);return o||(o=document.createElement("div"),o.className=t,o.style.position="absolute",o.style.zIndex="2",Object.assign(o.style,A4[t]),s.append(o)),o}_updateContainers(){const e=this.deck.width,t=this.deck.height;for(const i in this.containers){const s=this.lastViewports[i]||null,o=i===ev||s,c=this.containers[i];o?(c.style.display="block",c.style.left=`${s?s.x:0}px`,c.style.top=`${s?s.y:0}px`,c.style.width=`${s?s.width:e}px`,c.style.height=`${s?s.height:t}px`):c.style.display="none"}}onRedraw({viewports:e,layers:t}){const i=e.reduce((s,o)=>(s[o.id]=o,s),{});for(const s of this.getWidgets()){const{viewId:o}=s;if(o){const c=i[o];c&&(s.onViewportChange&&s.onViewportChange(c),s.onRedraw?.({viewports:[c],layers:t}))}else{if(s.onViewportChange)for(const c of e)s.onViewportChange(c);s.onRedraw?.({viewports:e,layers:t})}}this.lastViewports=i,this._updateContainers()}onHover(e,t){for(const i of this.getWidgets()){const{viewId:s}=i;(!s||s===e.viewport?.id)&&i.onHover?.(e,t)}}onEvent(e,t){const i=cd[t.type];if(i)for(const s of this.getWidgets()){const{viewId:o}=s;(!o||o===e.viewport?.id)&&s[i]?.(e,t)}}}const C4={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class M4{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){const t=document.createElement("div");return t.className="deck-tooltip",Object.assign(t.style,C4),this.deck=e,this.element=t,t}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){this.isVisible&&e.id===this.lastViewport?.id&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:t}=this,i=t&&t.props.getTooltip;if(!i)return;const s=i(e);this.lastViewport=e.viewport,this.setTooltip(s,e.x,e.y)}setTooltip(e,t,i){const s=this.element;if(s){if(typeof e=="string")s.innerText=e;else if(e)e.text&&(s.innerText=e.text),e.html&&(s.innerHTML=e.html),e.className&&(s.className=e.className);else{this.isVisible=!1,s.style.display="none";return}this.isVisible=!0,s.style.display="block",s.style.transform=`translate(${t}px, ${i}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(s.style,e.style)}}}var Br;(function(n){n[n.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",n[n.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",n[n.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",n[n.POINTS=0]="POINTS",n[n.LINES=1]="LINES",n[n.LINE_LOOP=2]="LINE_LOOP",n[n.LINE_STRIP=3]="LINE_STRIP",n[n.TRIANGLES=4]="TRIANGLES",n[n.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",n[n.TRIANGLE_FAN=6]="TRIANGLE_FAN",n[n.ZERO=0]="ZERO",n[n.ONE=1]="ONE",n[n.SRC_COLOR=768]="SRC_COLOR",n[n.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",n[n.SRC_ALPHA=770]="SRC_ALPHA",n[n.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",n[n.DST_ALPHA=772]="DST_ALPHA",n[n.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",n[n.DST_COLOR=774]="DST_COLOR",n[n.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",n[n.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",n[n.CONSTANT_COLOR=32769]="CONSTANT_COLOR",n[n.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",n[n.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",n[n.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",n[n.FUNC_ADD=32774]="FUNC_ADD",n[n.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",n[n.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",n[n.BLEND_EQUATION=32777]="BLEND_EQUATION",n[n.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",n[n.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",n[n.BLEND_DST_RGB=32968]="BLEND_DST_RGB",n[n.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",n[n.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",n[n.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",n[n.BLEND_COLOR=32773]="BLEND_COLOR",n[n.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",n[n.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",n[n.LINE_WIDTH=2849]="LINE_WIDTH",n[n.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",n[n.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",n[n.CULL_FACE_MODE=2885]="CULL_FACE_MODE",n[n.FRONT_FACE=2886]="FRONT_FACE",n[n.DEPTH_RANGE=2928]="DEPTH_RANGE",n[n.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",n[n.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",n[n.DEPTH_FUNC=2932]="DEPTH_FUNC",n[n.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",n[n.STENCIL_FUNC=2962]="STENCIL_FUNC",n[n.STENCIL_FAIL=2964]="STENCIL_FAIL",n[n.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",n[n.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",n[n.STENCIL_REF=2967]="STENCIL_REF",n[n.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",n[n.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",n[n.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",n[n.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",n[n.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",n[n.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",n[n.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",n[n.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",n[n.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",n[n.VIEWPORT=2978]="VIEWPORT",n[n.SCISSOR_BOX=3088]="SCISSOR_BOX",n[n.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",n[n.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",n[n.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",n[n.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",n[n.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",n[n.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",n[n.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",n[n.RED_BITS=3410]="RED_BITS",n[n.GREEN_BITS=3411]="GREEN_BITS",n[n.BLUE_BITS=3412]="BLUE_BITS",n[n.ALPHA_BITS=3413]="ALPHA_BITS",n[n.DEPTH_BITS=3414]="DEPTH_BITS",n[n.STENCIL_BITS=3415]="STENCIL_BITS",n[n.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",n[n.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",n[n.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",n[n.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",n[n.SAMPLES=32937]="SAMPLES",n[n.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",n[n.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",n[n.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",n[n.VENDOR=7936]="VENDOR",n[n.RENDERER=7937]="RENDERER",n[n.VERSION=7938]="VERSION",n[n.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",n[n.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",n[n.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",n[n.STATIC_DRAW=35044]="STATIC_DRAW",n[n.STREAM_DRAW=35040]="STREAM_DRAW",n[n.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",n[n.ARRAY_BUFFER=34962]="ARRAY_BUFFER",n[n.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",n[n.BUFFER_SIZE=34660]="BUFFER_SIZE",n[n.BUFFER_USAGE=34661]="BUFFER_USAGE",n[n.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",n[n.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",n[n.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",n[n.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",n[n.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",n[n.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",n[n.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",n[n.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",n[n.CULL_FACE=2884]="CULL_FACE",n[n.FRONT=1028]="FRONT",n[n.BACK=1029]="BACK",n[n.FRONT_AND_BACK=1032]="FRONT_AND_BACK",n[n.BLEND=3042]="BLEND",n[n.DEPTH_TEST=2929]="DEPTH_TEST",n[n.DITHER=3024]="DITHER",n[n.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",n[n.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",n[n.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",n[n.SCISSOR_TEST=3089]="SCISSOR_TEST",n[n.STENCIL_TEST=2960]="STENCIL_TEST",n[n.NO_ERROR=0]="NO_ERROR",n[n.INVALID_ENUM=1280]="INVALID_ENUM",n[n.INVALID_VALUE=1281]="INVALID_VALUE",n[n.INVALID_OPERATION=1282]="INVALID_OPERATION",n[n.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",n[n.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",n[n.CW=2304]="CW",n[n.CCW=2305]="CCW",n[n.DONT_CARE=4352]="DONT_CARE",n[n.FASTEST=4353]="FASTEST",n[n.NICEST=4354]="NICEST",n[n.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",n[n.BYTE=5120]="BYTE",n[n.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",n[n.SHORT=5122]="SHORT",n[n.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",n[n.INT=5124]="INT",n[n.UNSIGNED_INT=5125]="UNSIGNED_INT",n[n.FLOAT=5126]="FLOAT",n[n.DOUBLE=5130]="DOUBLE",n[n.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",n[n.ALPHA=6406]="ALPHA",n[n.RGB=6407]="RGB",n[n.RGBA=6408]="RGBA",n[n.LUMINANCE=6409]="LUMINANCE",n[n.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",n[n.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",n[n.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",n[n.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",n[n.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",n[n.VERTEX_SHADER=35633]="VERTEX_SHADER",n[n.COMPILE_STATUS=35713]="COMPILE_STATUS",n[n.DELETE_STATUS=35712]="DELETE_STATUS",n[n.LINK_STATUS=35714]="LINK_STATUS",n[n.VALIDATE_STATUS=35715]="VALIDATE_STATUS",n[n.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",n[n.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",n[n.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",n[n.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",n[n.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",n[n.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",n[n.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",n[n.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",n[n.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",n[n.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",n[n.SHADER_TYPE=35663]="SHADER_TYPE",n[n.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",n[n.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",n[n.NEVER=512]="NEVER",n[n.LESS=513]="LESS",n[n.EQUAL=514]="EQUAL",n[n.LEQUAL=515]="LEQUAL",n[n.GREATER=516]="GREATER",n[n.NOTEQUAL=517]="NOTEQUAL",n[n.GEQUAL=518]="GEQUAL",n[n.ALWAYS=519]="ALWAYS",n[n.KEEP=7680]="KEEP",n[n.REPLACE=7681]="REPLACE",n[n.INCR=7682]="INCR",n[n.DECR=7683]="DECR",n[n.INVERT=5386]="INVERT",n[n.INCR_WRAP=34055]="INCR_WRAP",n[n.DECR_WRAP=34056]="DECR_WRAP",n[n.NEAREST=9728]="NEAREST",n[n.LINEAR=9729]="LINEAR",n[n.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",n[n.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",n[n.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",n[n.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",n[n.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",n[n.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",n[n.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",n[n.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",n[n.TEXTURE_2D=3553]="TEXTURE_2D",n[n.TEXTURE=5890]="TEXTURE",n[n.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",n[n.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",n[n.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",n[n.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",n[n.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",n[n.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",n[n.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",n[n.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",n[n.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",n[n.TEXTURE0=33984]="TEXTURE0",n[n.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",n[n.REPEAT=10497]="REPEAT",n[n.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",n[n.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",n[n.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",n[n.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",n[n.FLOAT_VEC2=35664]="FLOAT_VEC2",n[n.FLOAT_VEC3=35665]="FLOAT_VEC3",n[n.FLOAT_VEC4=35666]="FLOAT_VEC4",n[n.INT_VEC2=35667]="INT_VEC2",n[n.INT_VEC3=35668]="INT_VEC3",n[n.INT_VEC4=35669]="INT_VEC4",n[n.BOOL=35670]="BOOL",n[n.BOOL_VEC2=35671]="BOOL_VEC2",n[n.BOOL_VEC3=35672]="BOOL_VEC3",n[n.BOOL_VEC4=35673]="BOOL_VEC4",n[n.FLOAT_MAT2=35674]="FLOAT_MAT2",n[n.FLOAT_MAT3=35675]="FLOAT_MAT3",n[n.FLOAT_MAT4=35676]="FLOAT_MAT4",n[n.SAMPLER_2D=35678]="SAMPLER_2D",n[n.SAMPLER_CUBE=35680]="SAMPLER_CUBE",n[n.LOW_FLOAT=36336]="LOW_FLOAT",n[n.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",n[n.HIGH_FLOAT=36338]="HIGH_FLOAT",n[n.LOW_INT=36339]="LOW_INT",n[n.MEDIUM_INT=36340]="MEDIUM_INT",n[n.HIGH_INT=36341]="HIGH_INT",n[n.FRAMEBUFFER=36160]="FRAMEBUFFER",n[n.RENDERBUFFER=36161]="RENDERBUFFER",n[n.RGBA4=32854]="RGBA4",n[n.RGB5_A1=32855]="RGB5_A1",n[n.RGB565=36194]="RGB565",n[n.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",n[n.STENCIL_INDEX=6401]="STENCIL_INDEX",n[n.STENCIL_INDEX8=36168]="STENCIL_INDEX8",n[n.DEPTH_STENCIL=34041]="DEPTH_STENCIL",n[n.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",n[n.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",n[n.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",n[n.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",n[n.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",n[n.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",n[n.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",n[n.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",n[n.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",n[n.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",n[n.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",n[n.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",n[n.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",n[n.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",n[n.NONE=0]="NONE",n[n.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",n[n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",n[n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",n[n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",n[n.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",n[n.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",n[n.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",n[n.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",n[n.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",n[n.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",n[n.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",n[n.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",n[n.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",n[n.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",n[n.READ_BUFFER=3074]="READ_BUFFER",n[n.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",n[n.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",n[n.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",n[n.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",n[n.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",n[n.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",n[n.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",n[n.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",n[n.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",n[n.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",n[n.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",n[n.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",n[n.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",n[n.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",n[n.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",n[n.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",n[n.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",n[n.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",n[n.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",n[n.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",n[n.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",n[n.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",n[n.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",n[n.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",n[n.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",n[n.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",n[n.RED=6403]="RED",n[n.RGB8=32849]="RGB8",n[n.RGBA8=32856]="RGBA8",n[n.RGB10_A2=32857]="RGB10_A2",n[n.TEXTURE_3D=32879]="TEXTURE_3D",n[n.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",n[n.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",n[n.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",n[n.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",n[n.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",n[n.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",n[n.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",n[n.SRGB=35904]="SRGB",n[n.SRGB8=35905]="SRGB8",n[n.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",n[n.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",n[n.RGBA32F=34836]="RGBA32F",n[n.RGB32F=34837]="RGB32F",n[n.RGBA16F=34842]="RGBA16F",n[n.RGB16F=34843]="RGB16F",n[n.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",n[n.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",n[n.R11F_G11F_B10F=35898]="R11F_G11F_B10F",n[n.RGB9_E5=35901]="RGB9_E5",n[n.RGBA32UI=36208]="RGBA32UI",n[n.RGB32UI=36209]="RGB32UI",n[n.RGBA16UI=36214]="RGBA16UI",n[n.RGB16UI=36215]="RGB16UI",n[n.RGBA8UI=36220]="RGBA8UI",n[n.RGB8UI=36221]="RGB8UI",n[n.RGBA32I=36226]="RGBA32I",n[n.RGB32I=36227]="RGB32I",n[n.RGBA16I=36232]="RGBA16I",n[n.RGB16I=36233]="RGB16I",n[n.RGBA8I=36238]="RGBA8I",n[n.RGB8I=36239]="RGB8I",n[n.RED_INTEGER=36244]="RED_INTEGER",n[n.RGB_INTEGER=36248]="RGB_INTEGER",n[n.RGBA_INTEGER=36249]="RGBA_INTEGER",n[n.R8=33321]="R8",n[n.RG8=33323]="RG8",n[n.R16F=33325]="R16F",n[n.R32F=33326]="R32F",n[n.RG16F=33327]="RG16F",n[n.RG32F=33328]="RG32F",n[n.R8I=33329]="R8I",n[n.R8UI=33330]="R8UI",n[n.R16I=33331]="R16I",n[n.R16UI=33332]="R16UI",n[n.R32I=33333]="R32I",n[n.R32UI=33334]="R32UI",n[n.RG8I=33335]="RG8I",n[n.RG8UI=33336]="RG8UI",n[n.RG16I=33337]="RG16I",n[n.RG16UI=33338]="RG16UI",n[n.RG32I=33339]="RG32I",n[n.RG32UI=33340]="RG32UI",n[n.R8_SNORM=36756]="R8_SNORM",n[n.RG8_SNORM=36757]="RG8_SNORM",n[n.RGB8_SNORM=36758]="RGB8_SNORM",n[n.RGBA8_SNORM=36759]="RGBA8_SNORM",n[n.RGB10_A2UI=36975]="RGB10_A2UI",n[n.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",n[n.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",n[n.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",n[n.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",n[n.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",n[n.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",n[n.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",n[n.HALF_FLOAT=5131]="HALF_FLOAT",n[n.RG=33319]="RG",n[n.RG_INTEGER=33320]="RG_INTEGER",n[n.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",n[n.CURRENT_QUERY=34917]="CURRENT_QUERY",n[n.QUERY_RESULT=34918]="QUERY_RESULT",n[n.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",n[n.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",n[n.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",n[n.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",n[n.DRAW_BUFFER0=34853]="DRAW_BUFFER0",n[n.DRAW_BUFFER1=34854]="DRAW_BUFFER1",n[n.DRAW_BUFFER2=34855]="DRAW_BUFFER2",n[n.DRAW_BUFFER3=34856]="DRAW_BUFFER3",n[n.DRAW_BUFFER4=34857]="DRAW_BUFFER4",n[n.DRAW_BUFFER5=34858]="DRAW_BUFFER5",n[n.DRAW_BUFFER6=34859]="DRAW_BUFFER6",n[n.DRAW_BUFFER7=34860]="DRAW_BUFFER7",n[n.DRAW_BUFFER8=34861]="DRAW_BUFFER8",n[n.DRAW_BUFFER9=34862]="DRAW_BUFFER9",n[n.DRAW_BUFFER10=34863]="DRAW_BUFFER10",n[n.DRAW_BUFFER11=34864]="DRAW_BUFFER11",n[n.DRAW_BUFFER12=34865]="DRAW_BUFFER12",n[n.DRAW_BUFFER13=34866]="DRAW_BUFFER13",n[n.DRAW_BUFFER14=34867]="DRAW_BUFFER14",n[n.DRAW_BUFFER15=34868]="DRAW_BUFFER15",n[n.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",n[n.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",n[n.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",n[n.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",n[n.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",n[n.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",n[n.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",n[n.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",n[n.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",n[n.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",n[n.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",n[n.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",n[n.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",n[n.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",n[n.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",n[n.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",n[n.SAMPLER_3D=35679]="SAMPLER_3D",n[n.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",n[n.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",n[n.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",n[n.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",n[n.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",n[n.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",n[n.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",n[n.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",n[n.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",n[n.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",n[n.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",n[n.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",n[n.MAX_SAMPLES=36183]="MAX_SAMPLES",n[n.SAMPLER_BINDING=35097]="SAMPLER_BINDING",n[n.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",n[n.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",n[n.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",n[n.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",n[n.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",n[n.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",n[n.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",n[n.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",n[n.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",n[n.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",n[n.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",n[n.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",n[n.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",n[n.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",n[n.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",n[n.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",n[n.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",n[n.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",n[n.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",n[n.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",n[n.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",n[n.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",n[n.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",n[n.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",n[n.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",n[n.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",n[n.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",n[n.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",n[n.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",n[n.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",n[n.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",n[n.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",n[n.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",n[n.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",n[n.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",n[n.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",n[n.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",n[n.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",n[n.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",n[n.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",n[n.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",n[n.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",n[n.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",n[n.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",n[n.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",n[n.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",n[n.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",n[n.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",n[n.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",n[n.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",n[n.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",n[n.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",n[n.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",n[n.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",n[n.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",n[n.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",n[n.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",n[n.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",n[n.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",n[n.UNIFORM_TYPE=35383]="UNIFORM_TYPE",n[n.UNIFORM_SIZE=35384]="UNIFORM_SIZE",n[n.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",n[n.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",n[n.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",n[n.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",n[n.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",n[n.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",n[n.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",n[n.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",n[n.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",n[n.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",n[n.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",n[n.OBJECT_TYPE=37138]="OBJECT_TYPE",n[n.SYNC_CONDITION=37139]="SYNC_CONDITION",n[n.SYNC_STATUS=37140]="SYNC_STATUS",n[n.SYNC_FLAGS=37141]="SYNC_FLAGS",n[n.SYNC_FENCE=37142]="SYNC_FENCE",n[n.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",n[n.UNSIGNALED=37144]="UNSIGNALED",n[n.SIGNALED=37145]="SIGNALED",n[n.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",n[n.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",n[n.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",n[n.WAIT_FAILED=37149]="WAIT_FAILED",n[n.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",n[n.COLOR=6144]="COLOR",n[n.DEPTH=6145]="DEPTH",n[n.STENCIL=6146]="STENCIL",n[n.MIN=32775]="MIN",n[n.MAX=32776]="MAX",n[n.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",n[n.STREAM_READ=35041]="STREAM_READ",n[n.STREAM_COPY=35042]="STREAM_COPY",n[n.STATIC_READ=35045]="STATIC_READ",n[n.STATIC_COPY=35046]="STATIC_COPY",n[n.DYNAMIC_READ=35049]="DYNAMIC_READ",n[n.DYNAMIC_COPY=35050]="DYNAMIC_COPY",n[n.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",n[n.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",n[n.INVALID_INDEX=4294967295]="INVALID_INDEX",n[n.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",n[n.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",n[n.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",n[n.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",n[n.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",n[n.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",n[n.R16_EXT=33322]="R16_EXT",n[n.RG16_EXT=33324]="RG16_EXT",n[n.RGB16_EXT=32852]="RGB16_EXT",n[n.RGBA16_EXT=32859]="RGBA16_EXT",n[n.R16_SNORM_EXT=36760]="R16_SNORM_EXT",n[n.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",n[n.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",n[n.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",n[n.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",n[n.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",n[n.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",n[n.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",n[n.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",n[n.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",n[n.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",n[n.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",n[n.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",n[n.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",n[n.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",n[n.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",n[n.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",n[n.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",n[n.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",n[n.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",n[n.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",n[n.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",n[n.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",n[n.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",n[n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",n[n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",n[n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",n[n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",n[n.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",n[n.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",n[n.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",n[n.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",n[n.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",n[n.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",n[n.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",n[n.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",n[n.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",n[n.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",n[n.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",n[n.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",n[n.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",n[n.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",n[n.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",n[n.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",n[n.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",n[n.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",n[n.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",n[n.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",n[n.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",n[n.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",n[n.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",n[n.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",n[n.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",n[n.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",n[n.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",n[n.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",n[n.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",n[n.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",n[n.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",n[n.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",n[n.LINE_WEBGL=6913]="LINE_WEBGL",n[n.FILL_WEBGL=6914]="FILL_WEBGL",n[n.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",n[n.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",n[n.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",n[n.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",n[n.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",n[n.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",n[n.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",n[n.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",n[n.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",n[n.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",n[n.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",n[n.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",n[n.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",n[n.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",n[n.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",n[n.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",n[n.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",n[n.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",n[n.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",n[n.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",n[n.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",n[n.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",n[n.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",n[n.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(Br||(Br={}));const rp={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},Tt=(n,e,t)=>e?n.enable(t):n.disable(t),tv=(n,e,t)=>n.hint(t,e),ln=(n,e,t)=>n.pixelStorei(t,e),nv=(n,e,t)=>{const i=t===36006?36009:36008;return n.bindFramebuffer(i,e)},io=(n,e,t)=>{const s={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[t];n.bindBuffer(s,e)};function Lh(n){return Array.isArray(n)||ArrayBuffer.isView(n)&&!(n instanceof DataView)}const O4={3042:Tt,32773:(n,e)=>n.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(n,e)=>n.clearColor(...e),3107:(n,e)=>n.colorMask(...e),2884:Tt,2885:(n,e)=>n.cullFace(e),2929:Tt,2931:(n,e)=>n.clearDepth(e),2932:(n,e)=>n.depthFunc(e),2928:(n,e)=>n.depthRange(...e),2930:(n,e)=>n.depthMask(e),3024:Tt,35723:tv,35725:(n,e)=>n.useProgram(e),36007:(n,e)=>n.bindRenderbuffer(36161,e),36389:(n,e)=>n.bindTransformFeedback?.(36386,e),34229:(n,e)=>n.bindVertexArray(e),36006:nv,36010:nv,34964:io,36662:io,36663:io,35053:io,35055:io,2886:(n,e)=>n.frontFace(e),33170:tv,2849:(n,e)=>n.lineWidth(e),32823:Tt,32824:"polygonOffset",10752:"polygonOffset",35977:Tt,32926:Tt,32928:Tt,32938:"sampleCoverage",32939:"sampleCoverage",3089:Tt,3088:(n,e)=>n.scissor(...e),2960:Tt,2961:(n,e)=>n.clearStencil(e),2968:(n,e)=>n.stencilMaskSeparate(1028,e),36005:(n,e)=>n.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(n,e)=>n.viewport(...e),34383:Tt,10754:Tt,12288:Tt,12289:Tt,12290:Tt,12291:Tt,12292:Tt,12293:Tt,12294:Tt,12295:Tt,3333:ln,3317:ln,37440:ln,37441:ln,37443:ln,3330:ln,3332:ln,3331:ln,3314:ln,32878:ln,3316:ln,3315:ln,32877:ln,framebuffer:(n,e)=>{const t=e&&"handle"in e?e.handle:e;return n.bindFramebuffer(36160,t)},blend:(n,e)=>e?n.enable(3042):n.disable(3042),blendColor:(n,e)=>n.blendColor(...e),blendEquation:(n,e)=>{const t=typeof e=="number"?[e,e]:e;n.blendEquationSeparate(...t)},blendFunc:(n,e)=>{const t=e?.length===2?[...e,...e]:e;n.blendFuncSeparate(...t)},clearColor:(n,e)=>n.clearColor(...e),clearDepth:(n,e)=>n.clearDepth(e),clearStencil:(n,e)=>n.clearStencil(e),colorMask:(n,e)=>n.colorMask(...e),cull:(n,e)=>e?n.enable(2884):n.disable(2884),cullFace:(n,e)=>n.cullFace(e),depthTest:(n,e)=>e?n.enable(2929):n.disable(2929),depthFunc:(n,e)=>n.depthFunc(e),depthMask:(n,e)=>n.depthMask(e),depthRange:(n,e)=>n.depthRange(...e),dither:(n,e)=>e?n.enable(3024):n.disable(3024),derivativeHint:(n,e)=>{n.hint(35723,e)},frontFace:(n,e)=>n.frontFace(e),mipmapHint:(n,e)=>n.hint(33170,e),lineWidth:(n,e)=>n.lineWidth(e),polygonOffsetFill:(n,e)=>e?n.enable(32823):n.disable(32823),polygonOffset:(n,e)=>n.polygonOffset(...e),sampleCoverage:(n,e)=>n.sampleCoverage(e[0],e[1]||!1),scissorTest:(n,e)=>e?n.enable(3089):n.disable(3089),scissor:(n,e)=>n.scissor(...e),stencilTest:(n,e)=>e?n.enable(2960):n.disable(2960),stencilMask:(n,e)=>{e=Lh(e)?e:[e,e];const[t,i]=e;n.stencilMaskSeparate(1028,t),n.stencilMaskSeparate(1029,i)},stencilFunc:(n,e)=>{e=Lh(e)&&e.length===3?[...e,...e]:e;const[t,i,s,o,c,u]=e;n.stencilFuncSeparate(1028,t,i,s),n.stencilFuncSeparate(1029,o,c,u)},stencilOp:(n,e)=>{e=Lh(e)&&e.length===3?[...e,...e]:e;const[t,i,s,o,c,u]=e;n.stencilOpSeparate(1028,t,i,s),n.stencilOpSeparate(1029,o,c,u)},viewport:(n,e)=>n.viewport(...e)};function gt(n,e,t){return e[n]!==void 0?e[n]:t[n]}const I4={blendEquation:(n,e,t)=>n.blendEquationSeparate(gt(32777,e,t),gt(34877,e,t)),blendFunc:(n,e,t)=>n.blendFuncSeparate(gt(32969,e,t),gt(32968,e,t),gt(32971,e,t),gt(32970,e,t)),polygonOffset:(n,e,t)=>n.polygonOffset(gt(32824,e,t),gt(10752,e,t)),sampleCoverage:(n,e,t)=>n.sampleCoverage(gt(32938,e,t),gt(32939,e,t)),stencilFuncFront:(n,e,t)=>n.stencilFuncSeparate(1028,gt(2962,e,t),gt(2967,e,t),gt(2963,e,t)),stencilFuncBack:(n,e,t)=>n.stencilFuncSeparate(1029,gt(34816,e,t),gt(36003,e,t),gt(36004,e,t)),stencilOpFront:(n,e,t)=>n.stencilOpSeparate(1028,gt(2964,e,t),gt(2965,e,t),gt(2966,e,t)),stencilOpBack:(n,e,t)=>n.stencilOpSeparate(1029,gt(34817,e,t),gt(34818,e,t),gt(34819,e,t))},iv={enable:(n,e)=>n({[e]:!0}),disable:(n,e)=>n({[e]:!1}),pixelStorei:(n,e,t)=>n({[e]:t}),hint:(n,e,t)=>n({[e]:t}),useProgram:(n,e)=>n({35725:e}),bindRenderbuffer:(n,e,t)=>n({36007:t}),bindTransformFeedback:(n,e,t)=>n({36389:t}),bindVertexArray:(n,e)=>n({34229:e}),bindFramebuffer:(n,e,t)=>{switch(e){case 36160:return n({36006:t,36010:t});case 36009:return n({36006:t});case 36008:return n({36010:t});default:return null}},bindBuffer:(n,e,t)=>{const i={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return i?n({[i]:t}):{valueChanged:!0}},blendColor:(n,e,t,i,s)=>n({32773:new Float32Array([e,t,i,s])}),blendEquation:(n,e)=>n({32777:e,34877:e}),blendEquationSeparate:(n,e,t)=>n({32777:e,34877:t}),blendFunc:(n,e,t)=>n({32969:e,32968:t,32971:e,32970:t}),blendFuncSeparate:(n,e,t,i,s)=>n({32969:e,32968:t,32971:i,32970:s}),clearColor:(n,e,t,i,s)=>n({3106:new Float32Array([e,t,i,s])}),clearDepth:(n,e)=>n({2931:e}),clearStencil:(n,e)=>n({2961:e}),colorMask:(n,e,t,i,s)=>n({3107:[e,t,i,s]}),cullFace:(n,e)=>n({2885:e}),depthFunc:(n,e)=>n({2932:e}),depthRange:(n,e,t)=>n({2928:new Float32Array([e,t])}),depthMask:(n,e)=>n({2930:e}),frontFace:(n,e)=>n({2886:e}),lineWidth:(n,e)=>n({2849:e}),polygonOffset:(n,e,t)=>n({32824:e,10752:t}),sampleCoverage:(n,e,t)=>n({32938:e,32939:t}),scissor:(n,e,t,i,s)=>n({3088:new Int32Array([e,t,i,s])}),stencilMask:(n,e)=>n({2968:e,36005:e}),stencilMaskSeparate:(n,e,t)=>n({[e===1028?2968:36005]:t}),stencilFunc:(n,e,t,i)=>n({2962:e,2967:t,2963:i,34816:e,36003:t,36004:i}),stencilFuncSeparate:(n,e,t,i,s)=>n({[e===1028?2962:34816]:t,[e===1028?2967:36003]:i,[e===1028?2963:36004]:s}),stencilOp:(n,e,t,i)=>n({2964:e,2965:t,2966:i,34817:e,34818:t,34819:i}),stencilOpSeparate:(n,e,t,i,s)=>n({[e===1028?2964:34817]:t,[e===1028?2965:34818]:i,[e===1028?2966:34819]:s}),viewport:(n,e,t,i,s)=>n({2978:[e,t,i,s]})},Yn=(n,e)=>n.isEnabled(e),sv={3042:Yn,2884:Yn,2929:Yn,3024:Yn,32823:Yn,32926:Yn,32928:Yn,3089:Yn,2960:Yn,35977:Yn},N4=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function na(n,e){if(k4(e))return;const t={};for(const s in e){const o=Number(s),c=O4[s];c&&(typeof c=="string"?t[c]=!0:c(n,e[s],o))}const i=n.state&&n.state.cache;if(i)for(const s in t){const o=I4[s];o(n,e,i)}}function z3(n,e=rp){if(typeof e=="number"){const s=e,o=sv[s];return o?o(n,s):n.getParameter(s)}const t=Array.isArray(e)?e:Object.keys(e),i={};for(const s of t){const o=sv[s];i[s]=o?o(n,Number(s)):n.getParameter(Number(s))}return i}function P4(n){na(n,rp)}function k4(n){for(const e in n)return!1;return!0}function D4(n,e){if(n===e)return!0;const t=Array.isArray(n)||ArrayBuffer.isView(n),i=Array.isArray(e)||ArrayBuffer.isView(e);if(t&&i&&n.length===e.length){for(let s=0;s<n.length;++s)if(n[s]!==e[s])return!1;return!0}return!1}class Is{static get(e){return e.state}gl;program=null;stateStack=[];enable=!0;cache=null;log;initialized=!1;constructor(e,t){this.gl=e,this.log=t?.log||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e={}){this.stateStack.push({})}pop(){const e=this.stateStack[this.stateStack.length-1];na(this.gl,e),this.stateStack.pop()}trackState(e,t){if(this.cache=t.copyState?z3(e):Object.assign({},rp),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,B4(e);for(const i in iv){const s=iv[i];U4(e,i,s)}rv(e,"getParameter"),rv(e,"isEnabled")}_updateCache(e){let t=!1,i;const s=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const o in e){const c=e[o],u=this.cache[o];D4(c,u)||(t=!0,i=u,s&&!(o in s)&&(s[o]=u),this.cache[o]=c)}return{valueChanged:t,oldValue:i}}}function rv(n,e){const t=n[e].bind(n);n[e]=function(s){if(s===void 0||N4.has(s))return t(s);const o=Is.get(n);return s in o.cache||(o.cache[s]=t(s)),o.enable?o.cache[s]:t(s)},Object.defineProperty(n[e],"name",{value:`${e}-from-cache`,configurable:!1})}function U4(n,e,t){if(!n[e])return;const i=n[e].bind(n);n[e]=function(...o){const c=Is.get(n),{valueChanged:u,oldValue:h}=t(c._updateCache,...o);return u&&i(...o),h},Object.defineProperty(n[e],"name",{value:`${e}-to-cache`,configurable:!1})}function B4(n){const e=n.useProgram.bind(n);n.useProgram=function(i){const s=Is.get(n);s.program!==i&&(e(i),s.program=i)}}function F4(n,e,t){let i="";const s={preserveDrawingBuffer:!0,...t};let o=null;if(o||=n.getContext("webgl2",s),s.failIfMajorPerformanceCaveat&&(i||="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow."),!o&&!t.failIfMajorPerformanceCaveat&&(s.failIfMajorPerformanceCaveat=!1,o=n.getContext("webgl2",s),o.luma||={},o.luma.softwareRenderer=!0),o||(o=n.getContext("webgl",{}),o&&(o=null,i||="Your browser only supports WebGL1")),!o)throw i||="Your browser does not support WebGL",new Error(`Failed to create WebGL context: ${i}`);const{onContextLost:c,onContextRestored:u}=e;return n.addEventListener("webglcontextlost",h=>c(h),!1),n.addEventListener("webglcontextrestored",h=>u(h),!1),o.luma||={},o}function ea(n,e,t){return t[e]===void 0&&(t[e]=n.getExtension(e)||null),t[e]}function L4(n,e){const t=n.getParameter(7936),i=n.getParameter(7937);ea(n,"WEBGL_debug_renderer_info",e);const s=e.WEBGL_debug_renderer_info,o=n.getParameter(s?s.UNMASKED_VENDOR_WEBGL:7936),c=n.getParameter(s?s.UNMASKED_RENDERER_WEBGL:7937),u=o||t,h=c||i,d=n.getParameter(7938),g=V3(u,h),m=z4(u,h),y=V4(u,h);return{type:"webgl",gpu:g,gpuType:y,gpuBackend:m,vendor:u,renderer:h,version:d,shadingLanguage:"glsl",shadingLanguageVersion:300}}function V3(n,e){return/NVIDIA/i.exec(n)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(n)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(n)||/Apple/i.exec(e)?"apple":/AMD/i.exec(n)||/AMD/i.exec(e)||/ATI/i.exec(n)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(n)||/SwiftShader/i.exec(e)?"software":"unknown"}function z4(n,e){return/Metal/i.exec(n)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(n)||/ANGLE/i.exec(e)?"opengl":"unknown"}function V4(n,e){if(/SwiftShader/i.exec(n)||/SwiftShader/i.exec(e))return"cpu";switch(V3(n,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function j3(n){switch(n){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(n))}const lo="WEBGL_compressed_texture_s3tc",co="WEBGL_compressed_texture_s3tc_srgb",Fr="EXT_texture_compression_rgtc",Lr="EXT_texture_compression_bptc",j4="WEBGL_compressed_texture_etc",H4="WEBGL_compressed_texture_astc",W4="WEBGL_compressed_texture_etc1",$4="WEBGL_compressed_texture_pvrtc",X4="WEBGL_compressed_texture_atc",av="EXT_texture_norm16",ov="EXT_render_snorm",Y4="EXT_color_buffer_float",ap={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[ov],"norm16-renderable-webgl":[av],"snorm16-renderable-webgl":[av,ov],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[lo,co,Fr,Lr],"texture-compression-bc5-webgl":[Fr],"texture-compression-bc7-webgl":[Lr],"texture-compression-etc2":[j4],"texture-compression-astc":[H4],"texture-compression-etc1-webgl":[W4],"texture-compression-pvrtc-webgl":[$4],"texture-compression-atc-webgl":[X4]};function q4(n){return n in ap}function K4(n,e,t){return(ap[e]||[]).every(s=>ea(n,s,t))}const op={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},"r16unorm-webgl":{gl:33322,rb:!0},"r16snorm-webgl":{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},"rg16unorm-webgl":{gl:33324},"rg16snorm-webgl":{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},"rgb10a2uint-webgl":{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},"rgba16unorm-webgl":{gl:32859,rb:!0},"rgba16snorm-webgl":{gl:36763},"rgb32float-webgl":{gl:34837,x:Y4,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:lo},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:co},"bc1-rgba-unorm":{gl:33777,x:lo},"bc1-rgba-unorm-srgb":{gl:35916,x:co},"bc2-rgba-unorm":{gl:33778,x:lo},"bc2-rgba-unorm-srgb":{gl:35918,x:co},"bc3-rgba-unorm":{gl:33779,x:lo},"bc3-rgba-unorm-srgb":{gl:35919,x:co},"bc4-r-unorm":{gl:36283,x:Fr},"bc4-r-snorm":{gl:36284,x:Fr},"bc5-rg-unorm":{gl:36285,x:Fr},"bc5-rg-snorm":{gl:36286,x:Fr},"bc6h-rgb-ufloat":{gl:36495,x:Lr},"bc6h-rgb-float":{gl:36494,x:Lr},"bc7-rgba-unorm":{gl:36492,x:Lr},"bc7-rgba-unorm-srgb":{gl:36493,x:Lr},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function Z4(n,e,t){let i=e.create;const s=op[e.format];return s?.gl===void 0&&(i=!1),s?.x&&(i=i&&!!ea(n,s.x,t)),{format:e.format,create:i&&e.create,render:i&&e.render,filter:i&&e.filter,blend:i&&e.blend,store:i&&e.store}}function H3(n){const e=op[n],t=J4(n),i=Dd(n);return{internalFormat:t,format:e?.dataFormat||G4(i.channels,i.integer,i.normalized,t),type:i.dataType?j3(i.dataType):e?.types?.[0]||5121,compressed:i.compressed||!1}}function Q4(n){switch(Dd(n).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${n}`)}}function G4(n,e,t,i){if(i===6408||i===6407)return i;switch(n){case"r":return e&&!t?36244:6403;case"rg":return e&&!t?33320:33319;case"rgb":return e&&!t?36248:6407;case"rgba":return e&&!t?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function J4(n){const t=op[n]?.gl;if(t===void 0)throw new Error(`Unsupported texture format ${n}`);return t}const lv={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class eI extends WA{gl;extensions;testedFeatures=new Set;constructor(e,t,i){super([],i),this.gl=e,this.extensions=t,ea(e,"EXT_color_buffer_float",t)}*[Symbol.iterator](){const e=this.getFeatures();for(const t of e)this.has(t)&&(yield t);return[]}has(e){return this.disabledFeatures?.[e]?!1:(this.testedFeatures.has(e)||(this.testedFeatures.add(e),q4(e)&&K4(this.gl,e,this.extensions)&&this.features.add(e),this.getWebGLFeature(e)&&this.features.add(e)),this.features.has(e))}initializeFeatures(){const e=this.getFeatures().filter(t=>t!=="polygon-mode-webgl");for(const t of e)this.has(t)}getFeatures(){return[...Object.keys(lv),...Object.keys(ap)]}getWebGLFeature(e){const t=lv[e];return typeof t=="string"?!!ea(this.gl,t,this.extensions):!!t}}class tI extends HA{get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}gl;limits={};constructor(e){super(),this.gl=e}getParameter(e){return this.limits[e]===void 0&&(this.limits[e]=this.gl.getParameter(e)),this.limits[e]||0}}class go extends Bc{device;gl;handle;colorAttachments=[];depthStencilAttachment=null;constructor(e,t){super(e,t);const i=t.handle===null;this.device=e,this.gl=e.gl,this.handle=this.props.handle||i?this.props.handle:this.gl.createFramebuffer(),i||(e.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const e=this.gl.bindFramebuffer(36160,this.handle);for(let t=0;t<this.colorAttachments.length;++t){const i=this.colorAttachments[t];if(i){const s=36064+t;this._attachTextureView(s,i)}}if(this.depthStencilAttachment){const t=Q4(this.depthStencilAttachment.props.format);this._attachTextureView(t,this.depthStencilAttachment)}if(this.device.props.debug){const t=this.gl.checkFramebufferStatus(36160);if(t!==36053)throw new Error(`Framebuffer ${iI(t)}`)}this.gl.bindFramebuffer(36160,e)}_attachTextureView(e,t){const{gl:i}=this.device,{texture:s}=t,o=t.props.baseMipLevel,c=t.props.baseArrayLayer;switch(i.bindTexture(s.glTarget,s.handle),s.glTarget){case 35866:case 32879:i.framebufferTextureLayer(36160,e,s.handle,o,c);break;case 34067:const u=nI(c);i.framebufferTexture2D(36160,e,u,s.handle,o);break;case 3553:i.framebufferTexture2D(36160,e,3553,s.handle,o);break;default:throw new Error("Illegal texture type")}i.bindTexture(s.glTarget,null)}}function nI(n){return n<34069?n+34069:n}function iI(n){switch(n){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${n}`}}class sI extends Ud{device;format="rgba8unorm";depthStencilFormat="depth24plus";presentationSize;_framebuffer=null;get[Symbol.toStringTag](){return"WebGLCanvasContext"}constructor(e,t){super(t),this.device=e,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new go(this.device,{handle:null}),this._framebuffer}update(){const e=this.getPixelSize();(e[0]!==this.presentationSize[0]||e[1]!==this.presentationSize[1])&&(this.presentationSize=e,this.resize())}resize(e){if(this.device.gl&&this.canvas){const t=this.getDevicePixelRatio(e?.useDevicePixels);this.setDevicePixelRatio(t,e);return}}commit(){}}async function W3(n,e){const t=document.getElementsByTagName("head")[0];if(!t)throw new Error("loadScript");const i=document.createElement("script");return i.setAttribute("type","text/javascript"),i.setAttribute("src",n),new Promise((s,o)=>{i.onload=s,i.onerror=c=>o(new Error(`Unable to load script '${n}': ${c}`)),t.appendChild(i)})}const rI=1;let cn=null,cv=!1;const lp={debugSpectorJS:ae.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function aI(n){if(!globalThis.SPECTOR)try{await W3(n.debugSpectorJSUrl||lp.debugSpectorJSUrl)}catch(e){ae.warn(String(e))}}function oI(n){if(n={...lp,...n},!n.debugSpectorJS)return null;if(!cn&&globalThis.SPECTOR&&!globalThis.luma?.spector){ae.probe(rI,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:e}=globalThis.SPECTOR;cn=new e,globalThis.luma&&(globalThis.luma.spector=cn)}if(!cn)return null;if(cv||(cv=!0,cn.spyCanvases(),cn?.onCaptureStarted.add(e=>ae.info("Spector capture started:",e)()),cn?.onCapture.add(e=>{ae.info("Spector capture complete:",e)(),cn?.getResultUI(),cn?.resultView.display(),cn?.resultView.addCapture(e)})),n.gl){const e=n.gl,t=e.device;cn?.startCapture(n.gl,500),e.device=t,new Promise(i=>setTimeout(i,2e3)).then(i=>{ae.info("Spector capture stopped after 2 seconds")(),cn?.stopCapture()})}return cn}const lI="https://unpkg.com/webgl-debug@2.0.1/index.js";function $3(n){return n.luma=n.luma||{},n.luma}async function cI(){Ls()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await W3(lI))}function uI(n,e={}){return e.debugWebGL||e.traceWebGL?hI(n,e):fI(n)}function fI(n){const e=$3(n);return e.realContext?e.realContext:n}function hI(n,e){if(!globalThis.WebGLDebugUtils)return ae.warn("webgl-debug not loaded")(),n;const t=$3(n);if(t.debugContext)return t.debugContext;globalThis.WebGLDebugUtils.init({...Br,...n});const i=globalThis.WebGLDebugUtils.makeDebugContext(n,dI.bind(null,e),pI.bind(null,e));for(const c in Br)!(c in i)&&typeof Br[c]=="number"&&(i[c]=Br[c]);class s{}Object.setPrototypeOf(i,Object.getPrototypeOf(n)),Object.setPrototypeOf(s,i);const o=Object.create(s);return t.realContext=n,t.debugContext=o,o.debug=!0,o}function uv(n,e){e=Array.from(e).map(i=>i===void 0?"undefined":i);let t=globalThis.WebGLDebugUtils.glFunctionArgsToString(n,e);return t=`${t.slice(0,100)}${t.length>100?"...":""}`,`gl.${n}(${t})`}function dI(n,e,t,i){i=Array.from(i).map(u=>u===void 0?"undefined":u);const s=globalThis.WebGLDebugUtils.glEnumToString(e),o=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,i),c=`${s} in gl.${t}(${o})`;ae.error(c)();debugger}function pI(n,e,t){let i="";ae.level>=1&&(i=uv(e,t),n.traceWebGL&&ae.log(1,i)());for(const s of t)if(s===void 0){i=i||uv(e,t);debugger}}const zh={};function gI(n="id"){zh[n]=zh[n]||1;const e=zh[n]++;return`${n}-${e}`}class _o extends at{device;gl;handle;glTarget;glUsage;glIndexType=5123;byteLength;bytesUsed;constructor(e,t={}){super(e,t),this.device=e,this.gl=this.device.gl;const i=typeof t=="object"?t.handle:void 0;this.handle=i||this.gl.createBuffer(),e.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=_I(this.props.usage),this.glUsage=mI(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,t.data?this._initWithData(t.data,t.byteOffset,t.byteLength):this._initWithByteLength(t.byteLength||0)}_initWithData(e,t=0,i=e.byteLength+t){const s=this.glTarget;this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,i,this.glUsage),this.gl.bufferSubData(s,t,e),this.gl.bindBuffer(s,null),this.bytesUsed=i,this.byteLength=i,this._setDebugData(e,t,i),this.trackAllocatedMemory(i)}_initWithByteLength(e){let t=e;e===0&&(t=new Float32Array(0));const i=this.glTarget;return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,t,this.glUsage),this.gl.bindBuffer(i,null),this.bytesUsed=e,this.byteLength=e,this._setDebugData(null,0,e),this.trackAllocatedMemory(e),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(e,t=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,t,e),this.gl.bindBuffer(36663,null),this._setDebugData(e,t,e.byteLength)}async readAsync(e=0,t){return this.readSyncWebGL(e,t)}readSyncWebGL(e=0,t){t=t??this.byteLength-e;const i=new Uint8Array(t),s=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,e,i,s,t),this.gl.bindBuffer(36662,null),this._setDebugData(i,e,t),i}}function _I(n){return n&at.INDEX?34963:n&at.VERTEX?34962:n&at.UNIFORM?35345:34962}function mI(n){return n&at.INDEX||n&at.VERTEX?35044:n&at.UNIFORM?35048:35044}function yI(n){const e=n.split(/\r?\n/),t=[];for(const i of e){if(i.length<=1)continue;const s=i.split(":");if(s.length===2){const[m,y]=s;t.push({message:y.trim(),type:fv(m),lineNum:0,linePos:0});continue}const[o,c,u,...h]=s;let d=parseInt(u,10);isNaN(d)&&(d=0);let g=parseInt(c,10);isNaN(g)&&(g=0),t.push({message:h.join(":").trim(),type:fv(o),lineNum:d,linePos:g})}return t}function fv(n){const e=["warning","error","info"],t=n.toLowerCase();return e.includes(t)?t:"info"}class bI extends Uc{device;handle;constructor(e,t){switch(super(e,t),this.device=e,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>this.compilationStatus)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const e=this.device.gl.getShaderInfoLog(this.handle);return e?yI(e):[]}getTranslatedSource(){return this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders?.getTranslatedShaderSource(this.handle)||null}async _compile(e){e=e.startsWith("#version ")?e:`#version 300 es
${e}`;const{gl:t}=this.device;if(t.shaderSource(this.handle,e),t.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}ae.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),ae.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const e=async s=>await new Promise(o=>setTimeout(o,s));if(!this.device.features.has("compilation-status-async-webgl")){await e(10);return}const{gl:i}=this.device;for(;;){if(i.getShaderParameter(this.handle,37297))return;await e(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function vI(n,e,t,i){if(wI(e))return i(n);const s=n;s.pushState();try{return TI(n,e),na(s.gl,t),i(n)}finally{s.popState()}}function TI(n,e){const t=n,{gl:i}=t;if(e.cullMode)switch(e.cullMode){case"none":i.disable(2884);break;case"front":i.enable(2884),i.cullFace(1028);break;case"back":i.enable(2884),i.cullFace(1029);break}if(e.frontFace&&i.frontFace(Ns("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&n.features.has("depth-clip-control")&&i.enable(34383),e.depthBias!==void 0&&(i.enable(32823),i.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&n.features.has("provoking-vertex-webgl")){const o=t.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,c=Ns("provokingVertex",e.provokingVertex,{first:36429,last:36430});o?.provokingVertexWEBGL(c)}if((e.polygonMode||e.polygonOffsetLine)&&n.features.has("polygon-mode-webgl")){if(e.polygonMode){const o=t.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,c=Ns("polygonMode",e.polygonMode,{fill:6914,line:6913});o?.polygonModeWEBGL(1028,c),o?.polygonModeWEBGL(1029,c)}e.polygonOffsetLine&&i.enable(10754)}if(n.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&i.enable(12288),e.clipDistance1&&i.enable(12289),e.clipDistance2&&i.enable(12290),e.clipDistance3&&i.enable(12291),e.clipDistance4&&i.enable(12292),e.clipDistance5&&i.enable(12293),e.clipDistance6&&i.enable(12294),e.clipDistance7&&i.enable(12295)),e.depthWriteEnabled!==void 0&&i.depthMask(SI("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?i.enable(2929):i.disable(2929),i.depthFunc(_d("depthCompare",e.depthCompare))),e.stencilWriteMask){const s=e.stencilWriteMask;i.stencilMaskSeparate(1028,s),i.stencilMaskSeparate(1029,s)}if(e.stencilReadMask&&ae.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const s=e.stencilReadMask||4294967295,o=_d("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?i.enable(2960):i.disable(2960),i.stencilFuncSeparate(1028,o,0,s),i.stencilFuncSeparate(1029,o,0,s)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const s=Vh("stencilPassOperation",e.stencilPassOperation),o=Vh("stencilFailOperation",e.stencilFailOperation),c=Vh("stencilDepthFailOperation",e.stencilDepthFailOperation);i.stencilOpSeparate(1028,o,c,s),i.stencilOpSeparate(1029,o,c,s)}switch(e.blend){case!0:i.enable(3042);break;case!1:i.disable(3042);break}if(e.blendColorOperation||e.blendAlphaOperation){const s=hv("blendColorOperation",e.blendColorOperation||"add"),o=hv("blendAlphaOperation",e.blendAlphaOperation||"add");i.blendEquationSeparate(s,o);const c=Gl("blendColorSrcFactor",e.blendColorSrcFactor||"one"),u=Gl("blendColorDstFactor",e.blendColorDstFactor||"zero"),h=Gl("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),d=Gl("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");i.blendFuncSeparate(c,u,h,d)}}function _d(n,e){return Ns(n,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function Vh(n,e){return Ns(n,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function hv(n,e){return Ns(n,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function Gl(n,e){return Ns(n,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function xI(n,e){return`Illegal parameter ${e} for ${n}`}function Ns(n,e,t){if(!(e in t))throw new Error(xI(n,e));return t[e]}function SI(n,e){return e}function wI(n){let e=!0;for(const t in n){e=!1;break}return e}function X3(n){const e={};return n.addressModeU&&(e[10242]=jh(n.addressModeU)),n.addressModeV&&(e[10243]=jh(n.addressModeV)),n.addressModeW&&(e[32882]=jh(n.addressModeW)),n.magFilter&&(e[10240]=md(n.magFilter)),(n.minFilter||n.mipmapFilter)&&(e[10241]=AI(n.minFilter||"linear",n.mipmapFilter)),n.lodMinClamp!==void 0&&(e[33082]=n.lodMinClamp),n.lodMaxClamp!==void 0&&(e[33083]=n.lodMaxClamp),n.type==="comparison-sampler"&&(e[34892]=34894),n.compare&&(e[34893]=_d("compare",n.compare)),n.maxAnisotropy&&(e[34046]=n.maxAnisotropy),e}function jh(n){switch(n){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function md(n){switch(n){case"nearest":return 9728;case"linear":return 9729}}function AI(n,e="none"){if(!e)return md(n);switch(e){case"none":return md(n);case"nearest":return n==="nearest"?9984:9986;case"linear":return n==="nearest"?9985:9987}}class yd extends yo{device;handle;parameters;constructor(e,t){super(e,t),this.device=e,this.parameters=X3(t),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(e){for(const[t,i]of Object.entries(e)){const s=Number(t);switch(s){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,s,i);break;default:this.device.gl.samplerParameteri(this.handle,s,i);break}}}}class zr extends Dc{device;gl;handle;texture;constructor(e,t){super(e,{...Qe.defaultProps,...t}),this.device=e,this.gl=this.device.gl,this.handle=null,this.texture=t.texture}}const EI="Failed to deduce GL constant from typed array";function RI(n){switch(ArrayBuffer.isView(n)?n.constructor:n){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(EI)}}function CI(n,e){const{clamped:t=!0}=e||{};switch(n){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return t?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function Y3(n){switch(n){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function MI(n){switch(n){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function Cc(n,e,t){if(OI(e))return t(n);const{nocatch:i=!0}=e,s=Is.get(n);s.push(),na(n,e);let o;if(i)o=t(n),s.pop();else try{o=t(n)}finally{s.pop()}return o}function OI(n){for(const e in n)return!1;return!0}function II(n,e,t){const{dimension:i,width:s,height:o,depth:c=0}=t,{glInternalFormat:u}=t,h=t.glTarget;switch(i){case"2d-array":case"3d":n.texStorage3D(h,e,u,s,o,c);break;default:n.texStorage2D(h,e,u,s,o)}}function dv(n,e,t,i){const{width:s,height:o}=i,{dimension:c,depth:u=0,mipLevel:h=0}=i,{x:d=0,y:g=0,z:m=0}=i,{glFormat:y,glType:T}=i,w=q3(i.glTarget,c,u),C=i.flipY?{37440:!0}:{};Cc(n,C,()=>{switch(c){case"2d-array":case"3d":n.bindTexture(w,e),n.texSubImage3D(w,h,d,g,m,s,o,u,y,T,t),n.bindTexture(w,null);break;case"2d":case"cube":n.bindTexture(w,e),n.texSubImage2D(w,h,d,g,s,o,y,T,t),n.bindTexture(w,null);break;default:throw new Error(c)}})}function pv(n,e,t){const{dimension:i,width:s,height:o,depth:c=0,mipLevel:u=0,byteOffset:h=0}=t,{x:d=0,y:g=0,z:m=0}=t,{glFormat:y,glType:T,compressed:w}=t,C=q3(t.glTarget,i,c);switch(i){case"2d-array":case"3d":w?n.compressedTexSubImage3D(C,u,d,g,m,s,o,c,y,e,h):n.texSubImage3D(C,u,d,g,m,s,o,c,y,T,e,h);break;case"2d":case"cube":w?n.compressedTexSubImage2D(C,u,d,g,s,o,y,e,h):n.texSubImage2D(C,u,d,g,s,o,y,T,e,h);break;default:throw new Error(i)}}function NI(n){switch(n){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(n)}function q3(n,e,t){return e==="cube"?34069+t:n}function PI(n,e){const{sourceX:t=0,sourceY:i=0,sourceAttachment:s=0}=e||{};let{target:o=null,sourceWidth:c,sourceHeight:u,sourceDepth:h,sourceFormat:d,sourceType:g}=e||{};const{framebuffer:m,deleteFramebuffer:y}=K3(n),{gl:T,handle:w}=m;c||=m.width,u||=m.height;const C=m.colorAttachments[s]?.texture;if(!C)throw new Error(`Invalid framebuffer attachment ${s}`);h=C?.depth||1,d||=C?.glFormat||6408,g||=C?.glType||5121,o=UI(o,g,d,c,u),g=g||RI(o);const N=T.bindFramebuffer(36160,w);return T.readBuffer(36064+s),T.readPixels(t,i,c,u,d,g,o),T.readBuffer(36064),T.bindFramebuffer(36160,N||null),y&&m.destroy(),o}function kI(n,e){const{target:t,sourceX:i=0,sourceY:s=0,sourceFormat:o=6408,targetByteOffset:c=0}=e||{};let{sourceWidth:u,sourceHeight:h,sourceType:d}=e||{};const{framebuffer:g,deleteFramebuffer:m}=K3(n);u=u||g.width,h=h||g.height;const y=g;d=d||5121;let T=t;if(!T){const C=Y3(o),N=MI(d),V=c+u*h*C*N;T=y.device.createBuffer({byteLength:V})}const w=n.device.createCommandEncoder();return w.copyTextureToBuffer({sourceTexture:n,width:u,height:h,origin:[i,s],destinationBuffer:T,byteOffset:c}),w.destroy(),m&&g.destroy(),T}function K3(n){return n instanceof Bc?{framebuffer:n,deleteFramebuffer:!1}:{framebuffer:DI(n),deleteFramebuffer:!0}}function DI(n,e){const{device:t,width:i,height:s,id:o}=n;return t.createFramebuffer({...e,id:`framebuffer-for-${o}`,width:i,height:s,colorAttachments:[n]})}function UI(n,e,t,i,s,o){if(n)return n;e||=5121;const c=CI(e,{clamped:!1}),u=Y3(t);return new c(i*s*u)}class mo extends Qe{device;gl;handle;sampler=void 0;view=void 0;mipmaps;compressed;glTarget;glFormat;glType;glInternalFormat;textureUnit=0;constructor(e,t){super(e,t);const i={...this.props};i.data=t.data,this.device=e,this.gl=this.device.gl,this.glTarget=NI(this.props.dimension);const s=H3(this.props.format);this.glInternalFormat=s.internalFormat,this.glFormat=s.format,this.glType=s.type,this.compressed=s.compressed,this.mipmaps=!!this.props.mipmaps,this._initialize(i),Object.seal(this)}_initialize(e){this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:e.data});let{width:t,height:i}=e;if(!t||!i){const s=Qe.getTextureDataSize(e.data);t=s?.width||1,i=s?.height||1}if(this.width=t,this.height=i,this.depth=e.depth,this.setSampler(e.sampler),this.view=new zr(this.device,{...this.props,texture:this}),this.bind(),II(this.gl,this.mipLevels,this),e.data)switch(e.dimension){case"1d":this.setTexture1DData(e.data);break;case"2d":this.setTexture2DData(e.data);break;case"3d":this.setTexture3DData(e.data);break;case"cube":this.setTextureCubeData(e.data);break;case"2d-array":this.setTextureArrayData(e.data);break;case"cube-array":this.setTextureCubeArrayData(e.data);break;default:throw new Error(e.dimension)}this.mipmaps&&this.generateMipmap()}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(e){return new zr(this.device,{...e,texture:this})}setSampler(e={}){let t;e instanceof yd?(this.sampler=e,t=e.props):(this.sampler=new yd(this.device,e),t=e);const i=X3(t);this._setSamplerParameters(i)}generateMipmap(e){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(ae.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!e?.force)))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(i){ae.warn(`Error generating mipmap for ${this}: ${i.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}copyExternalImage(e){const t=Qe.getExternalImageSize(e.image),i={...Qe.defaultCopyExternalImageOptions,...t,...e},{image:s,depth:o,mipLevel:c,x:u,y:h,z:d,flipY:g}=i;let{width:m,height:y}=i;const{dimension:T,glTarget:w,glFormat:C,glInternalFormat:N,glType:V}=this;if(m=Math.min(m,this.width-u),y=Math.min(y,this.height-h),e.sourceX||e.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");return dv(this.device.gl,this.handle,s,{dimension:T,mipLevel:c,x:u,y:h,z:d,width:m,height:y,depth:o,glFormat:C,glType:V,glTarget:w,flipY:g}),{width:i.width,height:i.height}}setTexture1DData(e){throw new Error("setTexture1DData not supported in WebGL.")}setTexture2DData(e,t=0){this.bind();const i=Qe.normalizeTextureData(e,this);i.length>1&&this.props.mipmaps!==!1&&ae.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let s=0;s<i.length;s++){const o=i[s];this._setMipLevel(t,s,o)}this.unbind()}setTexture3DData(e){if(this.props.dimension!=="3d")throw new Error(this.id);ArrayBuffer.isView(e)&&(this.bind(),pv(this.device.gl,e,this),this.unbind())}setTextureCubeData(e,t=0){if(this.props.dimension!=="cube")throw new Error(this.id);for(const i of Qe.CubeFaces)this.setTextureCubeFaceData(e[i],i)}setTextureArrayData(e){throw this.props.dimension!=="2d-array"?new Error(this.id):new Error("setTextureArrayData not implemented.")}setTextureCubeArrayData(e){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}setTextureCubeFaceData(e,t,i=0){Array.isArray(e)&&e.length>1&&this.props.mipmaps!==!1&&ae.warn(`${this.id} has mipmap and multiple LODs.`)();const s=Qe.CubeFaces.indexOf(t);this.setTexture2DData(e,s)}update(){throw new Error("Texture.update() not implemented. Use ExternalTexture")}setImageDataForFace(e){const{face:t,width:i,height:s,pixels:o,data:c,format:u=6408,type:h=5121}=e,{gl:d}=this,g=o||c;this.bind(),g instanceof Promise?g.then(m=>this.setImageDataForFace(Object.assign({},e,{face:t,data:m,pixels:m}))):this.width||this.height?d.texImage2D(t,0,u,i,s,0,u,h,g):d.texImage2D(t,0,u,u,h,g)}_getImageDataMap(e){for(let t=0;t<Qe.CubeFaces.length;++t){const i=Qe.CubeFaces[t];e[i]&&(e[34069+t]=e[i],delete e[i])}return e}_setSamplerParameters(e){ae.log(1,`${this.id} sampler parameters`,this.device.getGLKeys(e))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[t,i]of Object.entries(e)){const s=Number(t),o=i;switch(s){case 33082:case 33083:this.gl.texParameterf(this.glTarget,s,o);break;case 10241:this.gl.texParameteri(this.glTarget,s,o);break;case 10242:case 10243:this.gl.texParameteri(this.glTarget,s,o);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,s,o);break;default:this.gl.texParameteri(this.glTarget,s,o);break}}this.gl.bindTexture(this.glTarget,null)}_setMipLevel(e,t,i,s=this.glTarget){if(Qe.isExternalImage(i)){dv(this.device.gl,this.handle,i,{...this,depth:e,mipLevel:t,glTarget:s,flipY:this.props.flipY});return}if(Qe.isTextureLevelData(i)){pv(this.device.gl,i.data,{...this,depth:e,mipLevel:t,glTarget:s});return}throw new Error("Texture: invalid image data")}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(e){const{gl:t}=this;return e!==void 0&&(this.textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.glTarget,this.handle),e}unbind(e){const{gl:t}=this;return e!==void 0&&(this.textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.glTarget,null),e}}const BI=[1,2,4,8];class FI extends Es{device;glParameters;constructor(e,t){super(e,t),this.device=e;let i;if(!t?.parameters?.viewport)if(t?.framebuffer){const{width:o,height:c}=t.framebuffer;i=[0,0,o,c]}else{const[o,c]=e.getCanvasContext().getDrawingBufferSize();i=[0,0,o,c]}if(this.device.pushState(),this.setParameters({viewport:i,...this.props.parameters}),this.props.framebuffer?.handle)if(this.props.framebuffer){const o=this.props.framebuffer.colorAttachments.map((c,u)=>36064+u);this.device.gl.drawBuffers(o)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}setParameters(e={}){const t={...this.glParameters};t.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(t.depthMask=!this.props.depthReadOnly),t.stencilMask=this.props.stencilReadOnly?0:1,t[35977]=this.props.discard,e.viewport&&(e.viewport.length>=6?(t.viewport=e.viewport.slice(0,4),t.depthRange=[e.viewport[4],e.viewport[5]]):t.viewport=e.viewport),e.scissorRect&&(t.scissorTest=!0,t.scissor=e.scissorRect),e.blendConstant&&(t.blendColor=e.blendConstant),e.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),e[2967]=e.stencilReference),e.colorMask&&(t.colorMask=BI.map(i=>!!(i&e.colorMask))),this.glParameters=t,na(this.device.gl,t)}beginOcclusionQuery(e){this.props.occlusionQuerySet?.beginOcclusionQuery()}endOcclusionQuery(){this.props.occlusionQuerySet?.endOcclusionQuery()}clear(){const e={...this.glParameters};let t=0;this.props.clearColors&&this.props.clearColors.forEach((i,s)=>{i&&this.clearColorBuffer(s,i)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(t|=16384,e.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(t|=256,e.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(t|=1024,e.clearStencil=this.props.clearStencil),t!==0&&Cc(this.device.gl,e,()=>{this.device.gl.clear(t)})}clearColorBuffer(e=0,t=[0,0,0,0]){Cc(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(t.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,e,t);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,e,t);break;case Float32Array:this.device.gl.clearBufferfv(6144,e,t);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}function LI(n){return zI.includes(n)}const zI=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],Z3={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function Q3(n){const e=Z3[n];if(!e)throw new Error("uniform");const[t,i,,s]=e;return{format:s,components:i,glType:t}}function VI(n){const e=Z3[n];if(!e)throw new Error("attribute");const[,t,,i,s]=e;return{attributeType:i,vertexFormat:s,components:t}}function jI(n,e){const t={attributes:[],bindings:[]};t.attributes=HI(n,e);const i=XI(n,e);for(const u of i){const h=u.uniforms.map(d=>({name:d.name,format:d.format,byteOffset:d.byteOffset,byteStride:d.byteStride,arrayLength:d.arrayLength}));t.bindings.push({type:"uniform",name:u.name,group:0,location:u.location,visibility:(u.vertex?1:0)&(u.fragment?2:0),minBindingSize:u.byteLength,uniforms:h})}const s=$I(n,e);let o=0;for(const u of s)if(LI(u.type)){const{viewDimension:h,sampleType:d}=qI(u.type);t.bindings.push({type:"texture",name:u.name,group:0,location:o,viewDimension:h,sampleType:d}),u.textureUnit=o,o+=1}s.length&&(t.uniforms=s);const c=WI(n,e);return c?.length&&(t.varyings=c),t}function HI(n,e){const t=[],i=n.getProgramParameter(e,35721);for(let s=0;s<i;s++){const o=n.getActiveAttrib(e,s);if(!o)throw new Error("activeInfo");const{name:c,type:u}=o,h=n.getAttribLocation(e,c);if(h>=0){const{attributeType:d}=VI(u),g=/instance/i.test(c)?"instance":"vertex";t.push({name:c,location:h,stepMode:g,type:d})}}return t.sort((s,o)=>s.location-o.location),t}function WI(n,e){const t=[],i=n.getProgramParameter(e,35971);for(let s=0;s<i;s++){const o=n.getTransformFeedbackVarying(e,s);if(!o)throw new Error("activeInfo");const{name:c,type:u,size:h}=o,{glType:d,components:g}=Q3(u),m={location:s,name:c,type:d,size:h*g};t.push(m)}return t.sort((s,o)=>s.location-o.location),t}function $I(n,e){const t=[],i=n.getProgramParameter(e,35718);for(let s=0;s<i;s++){const o=n.getActiveUniform(e,s);if(!o)throw new Error("activeInfo");const{name:c,size:u,type:h}=o,{name:d,isArray:g}=KI(c);let m=n.getUniformLocation(e,d);const y={location:m,name:d,size:u,type:h,isArray:g};if(t.push(y),y.size>1)for(let T=0;T<y.size;T++){const w=`${d}[${T}]`;m=n.getUniformLocation(e,w);const C={...y,name:w,location:m};t.push(C)}}return t}function XI(n,e){const t=(o,c)=>n.getActiveUniformBlockParameter(e,o,c),i=[],s=n.getProgramParameter(e,35382);for(let o=0;o<s;o++){const c={name:n.getActiveUniformBlockName(e,o)||"",location:t(o,35391),byteLength:t(o,35392),vertex:t(o,35396),fragment:t(o,35398),uniformCount:t(o,35394),uniforms:[]},u=t(o,35395)||[],h=n.getActiveUniforms(e,u,35383),d=n.getActiveUniforms(e,u,35384),g=n.getActiveUniforms(e,u,35387),m=n.getActiveUniforms(e,u,35388);for(let y=0;y<c.uniformCount;++y){const T=n.getActiveUniform(e,u[y]);if(!T)throw new Error("activeInfo");c.uniforms.push({name:T.name,format:Q3(h[y]).format,type:h[y],arrayLength:d[y],byteOffset:g[y],byteStride:m[y]})}i.push(c)}return i.sort((o,c)=>o.location-c.location),i}const YI={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function qI(n){const e=YI[n];if(!e)throw new Error("sampler");const[t,i]=e;return{viewDimension:t,sampleType:i}}function KI(n){if(n[n.length-1]!=="]")return{name:n,length:1,isArray:!1};const t=/([^[]*)(\[[0-9]+\])?/.exec(n);if(!t||t.length<2)throw new Error(`Failed to parse GLSL uniform name ${n}`);return{name:t[1],length:t[2]?1:0,isArray:!!t[2]}}function ZI(n,e,t,i){const s=n;let o=i;o===!0&&(o=1),o===!1&&(o=0);const c=typeof o=="number"?[o]:o;switch(t){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof i!="number")throw new Error("samplers must be set to integers");return n.uniform1i(e,i);case 5126:return n.uniform1fv(e,c);case 35664:return n.uniform2fv(e,c);case 35665:return n.uniform3fv(e,c);case 35666:return n.uniform4fv(e,c);case 5124:return n.uniform1iv(e,c);case 35667:return n.uniform2iv(e,c);case 35668:return n.uniform3iv(e,c);case 35669:return n.uniform4iv(e,c);case 35670:return n.uniform1iv(e,c);case 35671:return n.uniform2iv(e,c);case 35672:return n.uniform3iv(e,c);case 35673:return n.uniform4iv(e,c);case 5125:return s.uniform1uiv(e,c,1);case 36294:return s.uniform2uiv(e,c,2);case 36295:return s.uniform3uiv(e,c,3);case 36296:return s.uniform4uiv(e,c,4);case 35674:return n.uniformMatrix2fv(e,!1,c);case 35675:return n.uniformMatrix3fv(e,!1,c);case 35676:return n.uniformMatrix4fv(e,!1,c);case 35685:return s.uniformMatrix2x3fv(e,!1,c);case 35686:return s.uniformMatrix2x4fv(e,!1,c);case 35687:return s.uniformMatrix3x2fv(e,!1,c);case 35688:return s.uniformMatrix3x4fv(e,!1,c);case 35689:return s.uniformMatrix4x2fv(e,!1,c);case 35690:return s.uniformMatrix4x3fv(e,!1,c)}throw new Error("Illegal uniform")}function QI(n){return O3(n)!==null||typeof n=="number"||typeof n=="boolean"}function GI(n){const e={bindings:{},uniforms:{}};return Object.keys(n).forEach(t=>{const i=n[t];QI(i)?e.uniforms[t]=i:e.bindings[t]=i}),e}function JI(n){switch(n){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(n)}}function eN(n){switch(n){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(n)}}const gv=4;class tN extends $r{device;handle;vs;fs;introspectedLayout;uniforms={};bindings={};varyings=null;_uniformCount=0;_uniformSetters={};constructor(e,t){super(e,t),this.device=e,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=t.vs,this.fs=t.fs;const{varyings:i,bufferMode:s=35981}=t;i&&i.length>0&&(this.varyings=i,this.device.gl.transformFeedbackVaryings(this.handle,i,s)),this._linkShaders(),ae.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=jI(this.device.gl,this.handle),ae.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=nN(this.introspectedLayout,t.shaderLayout)}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(e,t){for(const[i,s]of Object.entries(e)){const o=this.shaderLayout.bindings.find(c=>c.name===i)||this.shaderLayout.bindings.find(c=>c.name===`${i}Uniforms`);if(!o){const c=this.shaderLayout.bindings.map(u=>`"${u.name}"`).join(", ");t?.disableWarnings||ae.warn(`No binding "${i}" in render pipeline "${this.id}", expected one of ${c}`,s)();continue}switch(s||ae.warn(`Unsetting binding "${i}" in render pipeline "${this.id}"`)(),o.type){case"uniform":if(!(s instanceof _o)&&!(s.buffer instanceof _o))throw new Error("buffer value");break;case"texture":if(!(s instanceof zr||s instanceof mo||s instanceof go))throw new Error("texture value");break;case"sampler":ae.warn(`Ignoring sampler ${i}`)();break;default:throw new Error(o.type)}this.bindings[i]=s}}draw(e){const{renderPass:t,parameters:i=this.props.parameters,topology:s=this.props.topology,vertexArray:o,vertexCount:c,instanceCount:u,isInstanced:h=!1,firstVertex:d=0,transformFeedback:g}=e,m=JI(s),y=!!o.indexBuffer,T=o.indexBuffer?.glIndexType;if(this.linkStatus!=="success")return ae.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return ae.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),o.bindBeforeRender(t),g&&g.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const w=t;return vI(this.device,i,w.glParameters,()=>{y&&h?this.device.gl.drawElementsInstanced(m,c||0,T,d,u||0):y?this.device.gl.drawElements(m,c||0,T,d):h?this.device.gl.drawArraysInstanced(m,d,c||0,u||0):this.device.gl.drawArrays(m,d,c||0),g&&g.end()}),o.unbindAfterRender(t),!0}setUniformsWebGL(e){const{bindings:t}=GI(e);Object.keys(t).forEach(i=>{ae.warn(`Unsupported value "${JSON.stringify(t[i])}" used in setUniforms() for key ${i}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,e)}async _linkShaders(){const{gl:e}=this.device;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),ae.time(gv,`linkProgram for ${this.id}`)(),e.linkProgram(this.handle),ae.timeEnd(gv,`linkProgram for ${this.id}`)(),ae.level,!this.device.features.has("compilation-status-async-webgl")){const i=this._getLinkStatus();this._reportLinkStatus(i);return}ae.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),ae.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const t=this._getLinkStatus();this._reportLinkStatus(t)}async _reportLinkStatus(e){switch(e){case"success":return;default:switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`);case"pending":this.vs.asyncCompilationStatus.then(()=>this.vs.debugShader());break}switch(this.fs?.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`);case"pending":this.fs.asyncCompilationStatus.then(()=>this.fs.debugShader());break}const t=this.device.gl.getProgramInfoLog(this.handle);throw new Error(`Error during ${e}: ${t}`)}}_getLinkStatus(){const{gl:e}=this.device;return e.getProgramParameter(this.handle,35714)?(e.validateProgram(this.handle),e.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const e=async s=>await new Promise(o=>setTimeout(o,s));if(!this.device.features.has("compilation-status-async-webgl")){await e(10);return}const{gl:i}=this.device;for(;;){if(i.getProgramParameter(this.handle,37297))return;await e(10)}}_areTexturesRenderable(){let e=!0;for(const t of this.shaderLayout.bindings)!this.bindings[t.name]&&!this.bindings[t.name.replace(/Uniforms$/,"")]&&(ae.warn(`Binding ${t.name} not found in ${this.id}`)(),e=!1);return e}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:e}=this.device;e.useProgram(this.handle);let t=0,i=0;for(const s of this.shaderLayout.bindings){const o=this.bindings[s.name]||this.bindings[s.name.replace(/Uniforms$/,"")];if(!o)throw new Error(`No value for binding ${s.name} in ${this.id}`);switch(s.type){case"uniform":const{name:c}=s,u=e.getUniformBlockIndex(this.handle,c);if(u===4294967295)throw new Error(`Invalid uniform block name ${c}`);e.uniformBlockBinding(this.handle,i,u),o instanceof _o?e.bindBufferBase(35345,i,o.handle):e.bindBufferRange(35345,i,o.buffer.handle,o.offset||0,o.size||o.buffer.byteLength-o.offset),i+=1;break;case"texture":if(!(o instanceof zr||o instanceof mo||o instanceof go))throw new Error("texture");let h;if(o instanceof zr)h=o.texture;else if(o instanceof mo)h=o;else if(o instanceof go&&o.colorAttachments[0]instanceof zr)ae.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),h=o.colorAttachments[0].texture;else throw new Error("No texture");e.activeTexture(33984+t),e.bindTexture(h.glTarget,h.handle),t+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${s.type}' not supported in WebGL`)}}}_applyUniforms(){for(const e of this.shaderLayout.uniforms||[]){const{name:t,location:i,type:s,textureUnit:o}=e,c=this.uniforms[t]??o;c!==void 0&&ZI(this.device.gl,i,s,c)}}}function nN(n,e){const t={...n,attributes:n.attributes.map(i=>({...i}))};for(const i of e?.attributes||[]){const s=t.attributes.find(o=>o.name===i.name);s?(s.type=i.type||s.type,s.stepMode=i.stepMode||s.stepMode):ae.warn(`shader layout attribute ${i.name} not present in shader`)}return t}class iN extends Fd{device;commands=[];constructor(e){super(e,{}),this.device=e}submitCommands(e=this.commands){for(const t of e)switch(t.name){case"copy-buffer-to-buffer":sN(this.device,t.options);break;case"copy-buffer-to-texture":rN(this.device,t.options);break;case"copy-texture-to-buffer":aN(this.device,t.options);break;case"copy-texture-to-texture":oN(this.device,t.options);break;default:throw new Error(t.name)}}}function sN(n,e){const t=e.sourceBuffer,i=e.destinationBuffer;n.gl.bindBuffer(36662,t.handle),n.gl.bindBuffer(36663,i.handle),n.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),n.gl.bindBuffer(36662,null),n.gl.bindBuffer(36663,null)}function rN(n,e){throw new Error("Not implemented")}function aN(n,e){const{sourceTexture:t,mipLevel:i=0,aspect:s="all",width:o=e.sourceTexture.width,height:c=e.sourceTexture.height,depthOrArrayLayers:u=0,origin:h=[0,0],destinationBuffer:d,byteOffset:g=0,bytesPerRow:m,rowsPerImage:y}=e;if(s!=="all")throw new Error("aspect not supported in WebGL");if(i!==0||u!==0||m||y)throw new Error("not implemented");const{framebuffer:T,destroyFramebuffer:w}=G3(t);let C;try{const N=d,V=o||T.width,$=c||T.height,O=H3(T.colorAttachments[0].texture.props.format),F=O.format,H=O.type;n.gl.bindBuffer(35051,N.handle),C=n.gl.bindFramebuffer(36160,T.handle),n.gl.readPixels(h[0],h[1],V,$,F,H,g)}finally{n.gl.bindBuffer(35051,null),C!==void 0&&n.gl.bindFramebuffer(36160,C),w&&T.destroy()}}function oN(n,e){const{sourceTexture:t,destinationMipLevel:i=0,origin:s=[0,0],destinationOrigin:o=[0,0],destinationTexture:c}=e;let{width:u=e.destinationTexture.width,height:h=e.destinationTexture.height}=e;const{framebuffer:d,destroyFramebuffer:g}=G3(t),[m,y]=s,[T,w,C]=o,N=n.gl.bindFramebuffer(36160,d.handle);let V=null,$;if(c instanceof mo)V=c,u=Number.isFinite(u)?u:V.width,h=Number.isFinite(h)?h:V.height,V.bind(0),$=V.glTarget;else throw new Error("invalid destination");switch($){case 3553:case 34067:n.gl.copyTexSubImage2D($,i,T,w,m,y,u,h);break;case 35866:case 32879:n.gl.copyTexSubImage3D($,i,T,w,C,m,y,u,h);break}V&&V.unbind(),n.gl.bindFramebuffer(36160,N),g&&d.destroy()}function G3(n){if(n instanceof Qe){const{width:e,height:t,id:i}=n;return{framebuffer:n.device.createFramebuffer({id:`framebuffer-for-${i}`,width:e,height:t,colorAttachments:[n]}),destroyFramebuffer:!0}}return{framebuffer:n,destroyFramebuffer:!1}}class lN extends Bd{device;commandBuffer;constructor(e,t){super(e,t),this.device=e,this.commandBuffer=new iN(e)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(e){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:e})}copyBufferToTexture(e){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:e})}copyTextureToBuffer(e){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:e})}copyTextureToTexture(e){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:e})}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}resolveQuerySet(e,t,i){}}function cN(n){const{target:e,source:t,start:i=0,count:s=1}=n,o=t.length,c=s*o;let u=0;for(let h=i;u<o;u++)e[h++]=t[u];for(;u<c;)u<c-u?(e.copyWithin(i+u,i,i+u),u*=2):(e.copyWithin(i+u,i,i+c-u),u=c);return n.target}class cp extends Ld{get[Symbol.toStringTag](){return"VertexArray"}device;handle;buffer=null;bufferValue=null;static isConstantAttributeZeroSupported(e){return kx()==="Chrome"}constructor(e,t){super(e,t),this.device=e,this.handle=this.device.gl.createVertexArray()}destroy(){super.destroy(),this.buffer&&this.buffer?.destroy(),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(e){const t=e;if(t&&t.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,t?t.handle:null),this.indexBuffer=t,this.device.gl.bindVertexArray(null)}setBuffer(e,t){const i=t;if(i.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:s,type:o,stride:c,offset:u,normalized:h,integer:d,divisor:g}=this._getAccessor(e);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,i.handle),d?this.device.gl.vertexAttribIPointer(e,s,o,c,u):this.device.gl.vertexAttribPointer(e,s,o,h,c,u),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(e),this.device.gl.vertexAttribDivisor(e,g||0),this.attributes[e]=i,this.device.gl.bindVertexArray(null)}setConstantWebGL(e,t){this._enable(e,!1),this.attributes[e]=t}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let e=0;e<this.maxVertexAttributes;++e){const t=this.attributes[e];ArrayBuffer.isView(t)&&this.device.setConstantAttributeWebGL(e,t)}}_getAccessor(e){const t=this.attributeInfos[e];if(!t)throw new Error(`Unknown attribute location ${e}`);const i=j3(t.bufferDataType);return{size:t.bufferComponents,type:i,stride:t.byteStride,offset:t.byteOffset,normalized:t.normalized,integer:t.integer,divisor:t.stepMode==="instance"?1:0}}_enable(e,t=!0){const s=cp.isConstantAttributeZeroSupported(this.device)||e!==0;(t||s)&&(e=Number(e),this.device.gl.bindVertexArray(this.handle),t?this.device.gl.enableVertexAttribArray(e):this.device.gl.disableVertexAttribArray(e),this.device.gl.bindVertexArray(null))}getConstantBuffer(e,t){const i=uN(t),s=i.byteLength*e,o=i.length*e;if(this.buffer&&s!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${s} !== ${this.buffer.byteLength}.`);let c=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:s}),c=c||!fN(i,this.bufferValue),c){const u=bE(t.constructor,o);cN({target:u,source:i,start:0,count:o}),this.buffer.write(u),this.bufferValue=t}return this.buffer}}function uN(n){return Array.isArray(n)?new Float32Array(n):n}function fN(n,e){if(!n||!e||n.length!==e.length||n.constructor!==e.constructor)return!1;for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}class hN extends zd{device;gl;handle;layout;buffers={};unusedBuffers={};bindOnUse=!0;_bound=!1;constructor(e,t){super(e,t),this.device=e,this.gl=e.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,t.buffers&&this.setBuffers(t.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(e="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(eN(e))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(e){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const t in e)this.setBuffer(t,e[t])})}setBuffer(e,t){const i=this._getVaryingIndex(e),{buffer:s,byteLength:o,byteOffset:c}=this._getBufferRange(t);if(i<0){this.unusedBuffers[e]=s,ae.warn(`${this.id} unusedBuffers varying buffer ${e}`)();return}this.buffers[i]={buffer:s,byteLength:o,byteOffset:c},this.bindOnUse||this._bindBuffer(i,s,c,o)}getBuffer(e){if(_v(e))return this.buffers[e]||null;const t=this._getVaryingIndex(e);return t>=0?this.buffers[t]:null}bind(e=this.handle){if(typeof e!="function")return this.gl.bindTransformFeedback(36386,e),this;let t;return this._bound?t=e():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,t=e(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),t}unbind(){this.bind(null)}_getBufferRange(e){if(e instanceof _o)return{buffer:e,byteOffset:0,byteLength:e.byteLength};const{buffer:t,byteOffset:i=0,byteLength:s=e.buffer.byteLength}=e;return{buffer:t,byteOffset:i,byteLength:s}}_getVaryingIndex(e){if(_v(e))return Number(e);for(const t of this.layout.varyings)if(e===t.name)return t.location;return-1}_bindBuffers(){for(const e in this.buffers){const{buffer:t,byteLength:i,byteOffset:s}=this._getBufferRange(this.buffers[e]);this._bindBuffer(Number(e),t,s,i)}}_unbindBuffers(){for(const e in this.buffers)this.gl.bindBufferBase(35982,Number(e),null)}_bindBuffer(e,t,i=0,s){const o=t&&t.handle;!o||s===void 0?this.gl.bindBufferBase(35982,e,o):this.gl.bindBufferRange(35982,e,o,i,s)}}function _v(n){return typeof n=="number"?Number.isInteger(n):/^\d+$/.test(n)}class dN extends Vd{device;handle;target=null;_queryPending=!1;_pollingPromise=null;get[Symbol.toStringTag](){return"Query"}constructor(e,t){if(super(e,t),this.device=e,t.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(e){return this._begin(e?.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(e){this._queryPending||(this.target=e,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.device.gl.getQueryParameter(this.handle,34919);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(e=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let t=0;return this._pollingPromise=new Promise((i,s)=>{const o=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):t++>e?(s("Timed out"),this._pollingPromise=null):requestAnimationFrame(o)};requestAnimationFrame(o)}),this._pollingPromise}}class Vr extends es{type="webgl";handle;features;limits;info;canvasContext;lost;_resolveContextLost;gl;debug=!1;_canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1};_extensions={};_polyfilled=!1;spectorJS;constructor(e){super({...e,id:e.id||gI("webgl-device")});const t=es._getCanvasContextProps(e);if(!t)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let i=t.canvas?.gl?.device;if(i)throw new Error(`WebGL context already attached to device ${i.id}`);this.canvasContext=new sI(this,t),this.lost=new Promise(g=>{this._resolveContextLost=g});const s={...e.webgl};t.alphaMode==="premultiplied"&&(s.premultipliedAlpha=!0),e.powerPreference!==void 0&&(s.powerPreference=e.powerPreference);const c=this.props._handle||F4(this.canvasContext.canvas,{onContextLost:g=>this._resolveContextLost?.({reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."}),onContextRestored:g=>console.log("WebGL context restored")},s);if(!c)throw new Error("WebGL context creation failed");if(i=c.device,i){if(e._reuseDevices)return ae.log(1,`Not creating a new Device, instead returning a reference to Device ${i.id} already attached to WebGL context`,i)(),i._reused=!0,i;throw new Error(`WebGL context already attached to device ${i.id}`)}this.handle=c,this.gl=c,this.spectorJS=oI({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=L4(this.gl,this._extensions),this.limits=new tI(this.gl),this.features=new eI(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),t.autoResize!==!1&&this.canvasContext.resize(),new Is(this.gl,{log:(...g)=>ae.log(1,...g)()}).trackState(this.gl,{copyState:!1});const h=e.debugWebGL||e.debug,d=e.debugWebGL;h&&(this.gl=uI(this.gl,{debugWebGL:h,traceWebGL:d}),ae.warn("WebGL debug mode activated. Performance reduced.")(),e.debugWebGL&&(ae.level=Math.max(ae.level,1)))}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}createCanvasContext(e){throw new Error("WebGL only supports a single canvas")}createBuffer(e){const t=this._normalizeBufferProps(e);return new _o(this,t)}createTexture(e){return new mo(this,e)}createExternalTexture(e){throw new Error("createExternalTexture() not implemented")}createSampler(e){return new yd(this,e)}createShader(e){return new bI(this,e)}createFramebuffer(e){return new go(this,e)}createVertexArray(e){return new cp(this,e)}createTransformFeedback(e){return new hN(this,e)}createQuerySet(e){return new dN(this,e)}createRenderPipeline(e){return new tN(this,e)}beginRenderPass(e){return new FI(this,e)}createComputePipeline(e){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(e){throw new Error("ComputePass not supported in WebGL")}renderPass=null;createCommandEncoder(e={}){return new lN(this,e)}submit(){this.renderPass?.end(),this.renderPass=null}readPixelsToArrayWebGL(e,t){return PI(e,t)}readPixelsToBufferWebGL(e,t){return kI(e,t)}setParametersWebGL(e){na(this.gl,e)}getParametersWebGL(e){return z3(this.gl,e)}withParametersWebGL(e,t){return Cc(this.gl,e,t)}resetWebGL(){ae.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),P4(this.gl)}_getDeviceSpecificTextureFormatCapabilities(e){return Z4(this.gl,e,this._extensions)}loseDevice(){let e=!1;const i=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return i&&(e=!0,i.loseContext()),this._resolveContextLost?.({reason:"destroyed",message:"Application triggered context loss"}),e}pushState(){Is.get(this.gl).push()}popState(){Is.get(this.gl).pop()}setSpectorMetadata(e,t){e.__SPECTOR_Metadata=t}getGLKey(e,t){const i=Number(e);for(const s in this.gl)if(this.gl[s]===i)return`GL.${s}`;return t?.emptyIfUnknown?"":String(e)}getGLKeys(e){const t={emptyIfUnknown:!0};return Object.entries(e).reduce((i,[s,o])=>(i[`${s}:${this.getGLKey(s,t)}`]=`${o}:${this.getGLKey(o,t)}`,i),{})}_constants;setConstantAttributeWebGL(e,t){const i=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(i).fill(null);const s=this._constants[e];switch(s&&mN(s,t)&&ae.info(1,`setConstantAttributeWebGL(${e}) could have been skipped, value unchanged`)(),this._constants[e]=t,t.constructor){case Float32Array:pN(this,e,t);break;case Int32Array:gN(this,e,t);break;case Uint32Array:_N(this,e,t);break;default:throw new Error("constant")}}getExtension(e){return ea(this.gl,e,this._extensions),this._extensions}}function pN(n,e,t){switch(t.length){case 1:n.gl.vertexAttrib1fv(e,t);break;case 2:n.gl.vertexAttrib2fv(e,t);break;case 3:n.gl.vertexAttrib3fv(e,t);break;case 4:n.gl.vertexAttrib4fv(e,t);break}}function gN(n,e,t){n.gl.vertexAttribI4iv(e,t)}function _N(n,e,t){n.gl.vertexAttribI4uiv(e,t)}function mN(n,e){if(!n||!e||n.length!==e.length||n.constructor!==e.constructor)return!1;for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}const yN={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},bN=n=>({drawBuffersWEBGL(e){return n.drawBuffers(e)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),vN=n=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return n.createVertexArray()},deleteVertexArrayOES(e){return n.deleteVertexArray(e)},isVertexArrayOES(e){return n.isVertexArray(e)},bindVertexArrayOES(e){return n.bindVertexArray(e)}}),TN=n=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...e){return n.drawArraysInstanced(...e)},drawElementsInstancedANGLE(...e){return n.drawElementsInstanced(...e)},vertexAttribDivisorANGLE(...e){return n.vertexAttribDivisor(...e)}});function xN(n=!0){const e=HTMLCanvasElement.prototype;if(!n&&e.originalGetContext){e.getContext=e.originalGetContext,e.originalGetContext=void 0;return}e.originalGetContext=e.getContext,e.getContext=function(t,i){if(t==="webgl"||t==="experimental-webgl"){const s=this.originalGetContext("webgl2",i);return s instanceof HTMLElement&&SN(s),s}return this.originalGetContext(t,i)}}function SN(n){n.getExtension("EXT_color_buffer_float");const e={...yN,WEBGL_disjoint_timer_query:n.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:bN(n),OES_vertex_array_object:vN(n),ANGLE_instanced_arrays:TN(n)},t=n.getExtension;n.getExtension=function(s){const o=t.call(n,s);return o||(s in e?e[s]:null)};const i=n.getSupportedExtensions;n.getSupportedExtensions=function(){return(i.apply(n)||[])?.concat(Object.keys(e))}}const Jl=1;class wN extends KA{type="webgl";constructor(){super(),es.defaultProps={...es.defaultProps,...lp},Vr.adapter=this}isSupported(){return typeof WebGL2RenderingContext<"u"}enforceWebGL2(e){xN(e)}async attach(e){if(e instanceof Vr)return e;if(e?.device instanceof es)return e.device;if(!AN(e))throw new Error("Invalid WebGL2RenderingContext");return new Vr({_handle:e,createCanvasContext:{canvas:e.canvas,autoResize:!1}})}async create(e={}){ae.groupCollapsed(Jl,"WebGLDevice created")();const t=[];(e.debugWebGL||e.debug)&&t.push(cI()),e.debugSpectorJS&&t.push(aI(e));const i=await Promise.allSettled(t);for(const c of i)c.status==="rejected"&&ae.error(`Failed to initialize debug libraries ${c.reason}`)();const s=new Vr(e),o=`${s._reused?"Reusing":"Created"} device with WebGL2 ${s.debug?"debug ":""}context: ${s.info.vendor}, ${s.info.renderer} for canvas: ${s.canvasContext.id}`;return ae.probe(Jl,o)(),ae.table(Jl,s.info)(),ae.groupEnd(Jl)(),s}}function AN(n){return typeof WebGL2RenderingContext<"u"&&n instanceof WebGL2RenderingContext?!0:!!(n&&Number.isFinite(n._version))}const mv=new wN;function qi(){}const EN=({isDragging:n})=>n?"grabbing":"grab",J3={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:qi,onWebGLInitialized:qi,onResize:qi,onViewStateChange:qi,onInteractionStateChange:qi,onBeforeRender:qi,onAfterRender:qi,onLoad:qi,onError:n=>et.error(n.message,n.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:EN,getTooltip:null,debug:!1,drawPickingColors:!1};class up{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new Nc({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=i=>{const{_pickRequest:s}=this;if(i.type==="pointerleave")s.x=-1,s.y=-1,s.radius=0;else{if(i.leftButton||i.rightButton)return;{const o=i.offsetCenter;if(!o)return;s.x=o.x,s.y=o.y,s.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:s.x,y:s.y}),s.event=i},this._onEvent=i=>{const s=cd[i.type],o=i.offsetCenter;if(!s||!o||!this.layerManager)return;const c=this.layerManager.getLayers(),u=this.deckPicker.getLastPickedObject({x:o.x,y:o.y,layers:c,viewports:this.getViewports(o)},this._lastPointerDownInfo),{layer:h}=u,d=h&&(h[s]||h.props[s]),g=this.props[s];let m=!1;d&&(m=d.call(h,u,i)),m||(g?.(u,i),this.widgetManager.onEvent(u,i))},this._onPointerDown=i=>{if(this.device?.type==="webgpu")return;const s=i.offsetCenter,o=this._pick("pickObject","pickObject Time",{x:s.x,y:s.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=o.result[0]||o.emptyInfo},this.props={...J3,...e},e=this.props,e.viewState&&e.initialViewState&&et.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let t=this.device;!t&&e.gl&&(e.gl instanceof WebGLRenderingContext&&et.error("WebGL1 context not supported.")(),t=mv.attach(e.gl)),t||(t=Jh.createDevice({type:"best-available",_reuseDevices:!0,adapters:[mv],...e.deviceProps,createCanvasContext:{canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!1}})),this.animationLoop=this._createAnimationLoop(t,e),this.setProps(e),e._typedArrayManagerProps&&To.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){this.animationLoop?.stop(),this.animationLoop?.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager?.finalize(),this.layerManager=null,this.viewManager?.finalize(),this.viewManager=null,this.effectManager?.finalize(),this.effectManager=null,this.deckRenderer?.finalize(),this.deckRenderer=null,this.deckPicker?.finalize(),this.deckPicker=null,this.eventManager?.destroy(),this.eventManager=null,this.widgetManager?.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&(this.canvas.parentElement?.removeChild(this.canvas),this.canvas=null)}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&et.removed("onLayerHover","onHover")(),"onLayerClick"in e&&et.removed("onLayerClick","onClick")(),e.initialViewState&&!Fn(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const t=Object.create(this.props);Object.assign(t,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop?.setProps(t),this.layerManager&&(this.viewManager.setProps(t),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(t),this.effectManager.setProps(t),this.deckRenderer.setProps(t),this.deckPicker.setProps(t),this.widgetManager.setProps(t)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const i=this.viewManager.needsRedraw(e),s=this.layerManager.needsRedraw(e),o=this.effectManager.needsRedraw(e),c=this.deckRenderer.needsRedraw(e);return t=t||i||s||o||c,t}redraw(e){if(!this.layerManager)return;let t=this.needsRedraw({clearRedrawFlags:!0});t=e||t,t&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(t):this._drawLayers(t))}get isInitialized(){return this.viewManager!==null}getViews(){return Xt(this.viewManager),this.viewManager.views}getViewports(e){return Xt(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const t=this._pick("pickObject","pickObject Time",e).result;return t.length?t[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,t=!1){for(const i in e)this.layerManager.resourceManager.add({resourceId:i,data:e[i],forceUpdate:t})}_removeResources(e){for(const t of e)this.layerManager.resourceManager.remove(t)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){this.layerManager?.removeDefaultShaderModule(e)}_pick(e,t,i){Xt(this.deckPicker);const{stats:s}=this;s.get("Pick Count").incrementCount(),s.get(t).timeStart();const o=this.deckPicker[e]({layers:this.layerManager.getLayers(i),views:this.viewManager.getViews(),viewports:this.getViewports(i),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...i});return s.get(t).timeEnd(),o}_createCanvas(e){let t=e.canvas;return typeof t=="string"&&(t=document.getElementById(t),Xt(t)),t||(t=document.createElement("canvas"),t.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(t)),Object.assign(t.style,e.style),t}_setCanvasSize(e){if(!this.canvas)return;const{width:t,height:i}=e;if(t||t===0){const s=Number.isFinite(t)?`${t}px`:t;this.canvas.style.width=s}if(i||i===0){const s=Number.isFinite(i)?`${i}px`:i;this.canvas.style.position=e.style?.position||"absolute",this.canvas.style.height=s}}_updateCanvasSize(){const{canvas:e}=this;if(!e)return;const t=e.clientWidth??e.width,i=e.clientHeight??e.height;(t!==this.width||i!==this.height)&&(this.width=t,this.height=i,this.viewManager?.setProps({width:t,height:i}),this.layerManager?.activateViewport(this.getViewports()[0]),this.props.onResize({width:t,height:i}))}_createAnimationLoop(e,t){const{gl:i,onError:s,useDevicePixels:o}=t;return new CO({device:e,useDevicePixels:o,autoResizeDrawingBuffer:!i,autoResizeViewport:!1,onInitialize:c=>this._setDevice(c.device),onRender:this._onRenderFrame.bind(this),onError:s})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,t=Array.isArray(e)?e:e?[e]:[new B3({id:"default-view"})];return t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){if(this.device?.type==="webgpu")return;const{_pickRequest:e}=this;if(e.event){const{result:t,emptyInfo:i}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=t.length>0;let s=i,o=!1;for(const c of t)s=c,o=c.layer?.onHover(c,e.event)||o;o||(this.props.onHover?.(s,e.event),this.widgetManager.onHover(s,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=this.device.canvasContext?.canvas),this.device.type==="webgl"&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device.type==="webgl"&&this.props.onWebGLInitialized(this.device.gl);const t=new M3;t.play(),this.animationLoop.attachTimeline(t),this.eventManager=new sM(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(Bb).map(s=>{const[o,c,u,h]=Bb[s],d=this.props.eventRecognizerOptions?.[s],g={...c,...d,event:s};return{recognizer:new o(g),recognizeWith:u,requestFailure:h}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const s in cd)this.eventManager.on(s,this._onEvent);this.viewManager=new JO({timeline:t,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const i=this.viewManager.getViewports()[0];this.layerManager=new GO(this.device,{deck:this,stats:this.stats,viewport:i,timeline:t}),this.effectManager=new g4({deck:this,device:this.device}),this.deckRenderer=new y4(this.device),this.deckPicker=new w4(this.device),this.widgetManager=new R4({deck:this,parentElement:this.canvas?.parentElement}),this.widgetManager.addDefault(new M4),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,t){const{device:i,gl:s}=this.layerManager.context;this.props.onBeforeRender({device:i,gl:s});const o={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...t};this.deckRenderer?.renderLayers(o),o.pass==="screen"&&this.widgetManager.onRedraw({viewports:o.viewports,layers:o.layers}),this.props.onAfterRender({device:i,gl:s})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),et.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this.device?.type!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:t},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:t}=this;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();const i=Jh.stats.get("Memory Usage");e.bufferMemory=i.get("Buffer Memory").count,e.textureMemory=i.get("Texture Memory").count,e.renderbufferMemory=i.get("Renderbuffer Memory").count,e.gpuMemory=i.get("GPU Memory").count}}up.defaultProps=J3;up.VERSION=tA;function RN(n){switch(n){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return k0(n)}}const CN=P0;function ec(n,e,t){const i=t==="webgpu"&&e.type==="uint8"?"unorm8":e.type;return{attribute:n,format:e.size>1?`${i}x${e.size}`:e.type,byteOffset:e.offset||0}}function Cs(n){return n.stride||n.size*n.bytesPerElement}function MN(n,e){return n.type===e.type&&n.size===e.size&&Cs(n)===Cs(e)&&(n.offset||0)===(e.offset||0)}function bd(n,e){e.offset&&et.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const t=Cs(n),i=e.vertexOffset!==void 0?e.vertexOffset:n.vertexOffset||0,s=e.elementOffset||0,o=i*t+s*n.bytesPerElement+(n.offset||0);return{...e,offset:o,stride:t}}function ON(n,e){const t=bd(n,e);return{high:t,low:{...t,offset:t.offset+n.size*4}}}class IN{constructor(e,t,i){this._buffer=null,this.device=e,this.id=t.id||"",this.size=t.size||1;const s=t.logicalType||t.type,o=s==="float64";let{defaultValue:c}=t;c=Number.isFinite(c)?[c]:c||new Array(this.size).fill(0);let u;o?u="float32":!s&&t.isIndexed?u="uint32":u=s||"float32";let h=RN(s||u);this.doublePrecision=o,o&&t.fp64===!1&&(h=Float32Array),this.value=null,this.settings={...t,defaultType:h,defaultValue:c,logicalType:s,type:u,normalized:u.includes("norm"),size:this.size,bytesPerElement:h.BYTES_PER_ELEMENT},this.state={...i,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Cs(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),To.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,t=null){const i={};if(this.state.constant){const s=this.value;if(t){const o=bd(this.getAccessor(),t),c=o.offset/s.BYTES_PER_ELEMENT,u=o.size||this.size;i[e]=s.subarray(c,c+u)}else i[e]=s}else i[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?i[`${e}64Low`]=i[e]:i[`${e}64Low`]=new Float32Array(this.size)),i}_getBufferLayout(e=this.id,t=null){const i=this.getAccessor(),s=[],o={name:this.id,byteStride:Cs(i),attributes:s};if(this.doublePrecision){const c=ON(i,t||{});s.push(ec(e,{...i,...c.high},this.device.type),ec(`${e}64Low`,{...i,...c.low},this.device.type))}else if(t){const c=bd(i,t);s.push(ec(e,{...i,...c},this.device.type))}else s.push(ec(e,i,this.device.type));return o}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const t=Array.from(this.value);e=[t,t]}else{const{value:t,numInstances:i,size:s}=this,o=i*s;if(t&&o&&t.length>=o){const c=new Array(s).fill(1/0),u=new Array(s).fill(-1/0);for(let h=0;h<o;)for(let d=0;d<s;d++){const g=t[h++];g<c[d]&&(c[d]=g),g>u[d]&&(u[d]=g)}e=[c,u]}}return this.state.bounds=e,e}setData(e){const{state:t}=this;let i;ArrayBuffer.isView(e)?i={value:e}:e instanceof at?i={buffer:e}:i=e;const s={...this.settings,...i};if(ArrayBuffer.isView(i.value)){if(!i.type)if(this.doublePrecision&&i.value instanceof Float64Array)s.type="float32";else{const c=CN(i.value);s.type=s.normalized?c.replace("int","norm"):c}s.bytesPerElement=i.value.BYTES_PER_ELEMENT,s.stride=Cs(s)}if(t.bounds=null,i.constant){let o=i.value;if(o=this._normalizeValue(o,[],0),this.settings.normalized&&(o=this.normalizeConstant(o)),!(!t.constant||!this._areValuesEqual(o,this.value)))return!1;t.externalBuffer=null,t.constant=!0,this.value=ArrayBuffer.isView(o)?o:new Float32Array(o)}else if(i.buffer){const o=i.buffer;t.externalBuffer=o,t.constant=!1,this.value=i.value||null}else if(i.value){this._checkExternalBuffer(i);let o=i.value;t.externalBuffer=null,t.constant=!1,this.value=o;let{buffer:c}=this;const u=Cs(s),h=(s.vertexOffset||0)*u;if(this.doublePrecision&&o instanceof Float64Array&&(o=Ph(o,s)),this.settings.isIndexed){const g=this.settings.defaultType;o.constructor!==g&&(o=new g(o))}const d=o.byteLength+h+u*2;(!c||c.byteLength<d)&&(c=this._createBuffer(d)),c.write(o,h)}return this.setAccessor(s),!0}updateSubBuffer(e={}){this.state.bounds=null;const t=this.value,{startOffset:i=0,endOffset:s}=e;this.buffer.write(this.doublePrecision&&t instanceof Float64Array?Ph(t,{size:this.size,startIndex:i,endIndex:s}):t.subarray(i,s),i*t.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,t=!1){const{state:i}=this,s=i.allocatedValue,o=To.allocate(s,e+1,{size:this.size,type:this.settings.defaultType,copy:t});this.value=o;const{byteOffset:c}=this;let{buffer:u}=this;return(!u||u.byteLength<o.byteLength+c)&&(u=this._createBuffer(o.byteLength+c),t&&s&&u.write(s instanceof Float64Array?Ph(s,this):s,c)),i.allocatedValue=o,i.constant=!1,i.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:t}=e;if(!ArrayBuffer.isView(t))throw new Error(`Attribute ${this.id} value is not TypedArray`);const i=this.settings.defaultType;let s=!1;if(this.doublePrecision&&(s=t.BYTES_PER_ELEMENT<4),s)throw new Error(`Attribute ${this.id} does not support ${t.constructor.name}`);!(t instanceof i)&&this.settings.normalized&&!("normalized"in e)&&et.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(t=>(t+128)/255*2-1);case"snorm16":return new Float32Array(e).map(t=>(t+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(t=>t/255);case"unorm16":return new Float32Array(e).map(t=>t/65535);default:return e}}_normalizeValue(e,t,i){const{defaultValue:s,size:o}=this.settings;if(Number.isFinite(e))return t[i]=e,t;if(!e){let c=o;for(;--c>=0;)t[i+c]=s[c];return t}switch(o){case 4:t[i+3]=Number.isFinite(e[3])?e[3]:s[3];case 3:t[i+2]=Number.isFinite(e[2])?e[2]:s[2];case 2:t[i+1]=Number.isFinite(e[1])?e[1]:s[1];case 1:t[i+0]=Number.isFinite(e[0])?e[0]:s[0];break;default:let c=o;for(;--c>=0;)t[i+c]=Number.isFinite(e[c])?e[c]:s[c]}return t}_areValuesEqual(e,t){if(!e||!t)return!1;const{size:i}=this;for(let s=0;s<i;s++)if(e[s]!==t[s])return!1;return!0}_createBuffer(e){this._buffer&&this._buffer.destroy();const{isIndexed:t,type:i}=this.settings;return this._buffer=this.device.createBuffer({...this._buffer?.props,id:this.id,usage:(t?at.INDEX:at.VERTEX)|at.COPY_DST,indexType:t?i:void 0,byteLength:e}),this._buffer}}const yv=[],bv=[];function NN(n,e=0,t=1/0){let i=yv;const s={index:-1,data:n,target:[]};return n?typeof n[Symbol.iterator]=="function"?i=n:n.length>0&&(bv.length=n.length,i=bv):i=yv,(e>0||Number.isFinite(t))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(e,t),s.index=e-1),{iterable:i,objectInfo:s}}function eT(n){return n&&n[Symbol.asyncIterator]}function PN(n,e){const{size:t,stride:i,offset:s,startIndices:o,nested:c}=e,u=n.BYTES_PER_ELEMENT,h=i?i/u:t,d=s?s/u:0,g=Math.floor((n.length-d)/h);return(m,{index:y,target:T})=>{if(!o){const V=y*h+d;for(let $=0;$<t;$++)T[$]=n[V+$];return T}const w=o[y],C=o[y+1]||g;let N;if(c){N=new Array(C-w);for(let V=w;V<C;V++){const $=V*h+d;T=new Array(t);for(let O=0;O<t;O++)T[O]=n[$+O];N[V-w]=T}}else if(h===t)N=n.subarray(w*t+d,C*t+d);else{N=new n.constructor((C-w)*t);let V=0;for(let $=w;$<C;$++){const O=$*h+d;for(let F=0;F<t;F++)N[V++]=n[O+F]}}return N}}const kN=[],lc=[[0,1/0]];function DN(n,e){if(n===lc||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return n;const t=[],i=n.length;let s=0;for(let o=0;o<i;o++){const c=n[o];c[1]<e[0]?(t.push(c),s=o+1):c[0]>e[1]?t.push(c):e=[Math.min(c[0],e[0]),Math.max(c[1],e[1])]}return t.splice(s,0,e),t}const UN={interpolation:{duration:0,easing:n=>n},spring:{stiffness:.05,damping:.5}};function tT(n,e){if(!n)return null;Number.isFinite(n)&&(n={type:"interpolation",duration:n});const t=n.type||"interpolation";return{...UN[t],...e,...n,type:t}}class nT extends IN{constructor(e,t){super(e,t,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:lc}),this.constant=!1,this.settings.update=t.update||(t.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const t=this.state.needsRedraw;return this.state.needsRedraw=t&&!e,t}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var t;(t=this.state).layoutChanged||(t.layoutChanged=!MN(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:t}=this.settings,i=this.settings.transition,s=Array.isArray(t)?e[t.find(o=>e[o])]:e[t];return tT(s,i)}setNeedsUpdate(e=this.id,t){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){const{startRow:i=0,endRow:s=1/0}=t;this.state.updateRanges=DN(this.state.updateRanges,[i,s])}else this.state.updateRanges=lc}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=kN}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:t,settings:i}=this;return i.noAlloc?!1:i.update?(super.allocate(e,t.updateRanges!==lc),!0):!1}updateBuffer({numInstances:e,data:t,props:i,context:s}){if(!this.needsUpdate())return!1;const{state:{updateRanges:o},settings:{update:c,noAlloc:u}}=this;let h=!0;if(c){for(const[d,g]of o)c.call(s,this,{data:t,startRow:d,endRow:g,props:i,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[d,g]of o){const m=Number.isFinite(d)?this.getVertexOffset(d):0,y=Number.isFinite(g)?this.getVertexOffset(g):u||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:m,endOffset:y})}this._checkAttributeArray()}else h=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),h}setConstantValue(e){return this.device.type==="webgpu"||e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:t}=this;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(t.lastExternalBuffer=null,!1)}setBinaryValue(e,t=null){const{state:i,settings:s}=this;if(!e)return i.binaryValue=null,i.binaryAccessor=null,!1;if(s.noAlloc)return!1;if(i.binaryValue===e)return this.clearNeedsUpdate(),!0;if(i.binaryValue=e,this.setNeedsRedraw(),s.transform||t!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const c=e;Xt(ArrayBuffer.isView(c.value),`invalid ${s.accessor}`);const u=!!c.size&&c.size!==this.size;return i.binaryAccessor=PN(c.value,{size:c.size||this.size,stride:c.stride,offset:c.offset,startIndices:t,nested:u}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:t}=this;return(t?e<t.length?t[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,t=super.getValue();if(!e)return t;for(const i in e)Object.assign(t,super.getValue(i,e[i]));return t}getBufferLayout(e){this.state.layoutChanged=!1;const t=this.settings.shaderAttributes,i=super._getBufferLayout(),{stepMode:s}=this.settings;if(s==="dynamic"?i.stepMode=e?e.isInstanced?"instance":"vertex":"instance":i.stepMode=s??"vertex",!t)return i;for(const o in t){const c=super._getBufferLayout(o,t[o]);i.attributes.push(...c.attributes)}return i}_autoUpdater(e,{data:t,startRow:i,endRow:s,props:o,numInstances:c}){if(e.constant&&this.context.device.type!=="webgpu")return;const{settings:u,state:h,value:d,size:g,startIndices:m}=e,{accessor:y,transform:T}=u;let w=h.binaryAccessor||(typeof y=="function"?y:o[y]);typeof w!="function"&&(w=()=>w),Xt(typeof w=="function",`accessor "${y}" is not a function`);let C=e.getVertexOffset(i);const{iterable:N,objectInfo:V}=NN(t,i,s);for(const $ of N){V.index++;let O=w($,V);if(T&&(O=T.call(this,O)),m){const F=(V.index<m.length-1?m[V.index+1]:c)-m[V.index];if(O&&Array.isArray(O[0])){let H=C;for(const te of O)e._normalizeValue(te,d,H),H+=g}else O&&O.length>g?d.set(O,C):(e._normalizeValue(O,V.target,0),YO({target:d,source:V.target,start:C,count:F}));C+=F*g}else e._normalizeValue(O,d,C),C+=g}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,t=Math.min(4,this.size);if(e&&e.length>=t){let i=!0;switch(t){case 4:i=i&&Number.isFinite(e[3]);case 3:i=i&&Number.isFinite(e[2]);case 2:i=i&&Number.isFinite(e[1]);case 1:i=i&&Number.isFinite(e[0]);break;default:i=!1}if(!i)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function Hh(n){const{source:e,target:t,start:i=0,size:s,getData:o}=n,c=n.end||t.length,u=e.length,h=c-i;if(u>h){t.set(e.subarray(0,h),i);return}if(t.set(e,i),!o)return;let d=u;for(;d<h;){const g=o(d,e);for(let m=0;m<s;m++)t[i+d]=g[m]||0,d++}}function BN({source:n,target:e,size:t,getData:i,sourceStartIndices:s,targetStartIndices:o}){if(!s||!o)return Hh({source:n,target:e,size:t,getData:i}),e;let c=0,u=0;const h=i&&((g,m)=>i(g+u,m)),d=Math.min(s.length,o.length);for(let g=1;g<d;g++){const m=s[g]*t,y=o[g]*t;Hh({source:n.subarray(c,m),target:e,start:u,end:y,size:t,getData:h}),c=m,u=y}return u<e.length&&Hh({source:[],target:e,start:u,size:t,getData:h}),e}function FN(n){const{device:e,settings:t,value:i}=n,s=new nT(e,t);return s.setData({value:i instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:t.normalized}),s}function iT(n){switch(n){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${n}"`)}}function sT(n){switch(n){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function rT(n){n.push(n.shift())}function LN(n,e){const{doublePrecision:t,settings:i,value:s,size:o}=n,c=t&&s instanceof Float64Array?2:1;let u=0;const{shaderAttributes:h}=n.settings;if(h)for(const d of Object.values(h))u=Math.max(u,d.vertexOffset??0);return(i.noAlloc?s.length:(e+u)*o)*c}function aT({device:n,source:e,target:t}){return(!t||t.byteLength<e.byteLength)&&(t?.destroy(),t=n.createBuffer({byteLength:e.byteLength,usage:e.usage})),t}function oT({device:n,buffer:e,attribute:t,fromLength:i,toLength:s,fromStartIndices:o,getData:c=u=>u}){const u=t.doublePrecision&&t.value instanceof Float64Array?2:1,h=t.size*u,d=t.byteOffset,g=t.settings.bytesPerElement<4?d/t.settings.bytesPerElement*4:d,m=t.startIndices,y=o&&m,T=t.isConstant;if(!y&&e&&i>=s)return e;const w=t.value instanceof Float64Array?Float32Array:t.value.constructor,C=T?t.value:new w(t.getBuffer().readSyncWebGL(d,s*w.BYTES_PER_ELEMENT).buffer);if(t.settings.normalized&&!T){const O=c;c=(F,H)=>t.normalizeConstant(O(F,H))}const N=T?(O,F)=>c(C,F):(O,F)=>c(C.subarray(O+d,O+d+h),F),V=e?new Float32Array(e.readSyncWebGL(g,i*4).buffer):new Float32Array(0),$=new Float32Array(s);return BN({source:V,target:$,sourceStartIndices:o,targetStartIndices:m,size:h,getData:N}),(!e||e.byteLength<$.byteLength+g)&&(e?.destroy(),e=n.createBuffer({byteLength:$.byteLength+g,usage:35050})),e.write($,g),e}class lT{constructor({device:e,attribute:t,timeline:i}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new Vc(i),this.attribute=t,this.attributeInTransition=FN(t),this.currentStartIndices=t.startIndices}get inProgress(){return this.transition.inProgress}start(e,t,i=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=LN(this.attribute,t),this.transition.start({...e,duration:i})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class zN extends lT{constructor({device:e,attribute:t,timeline:i}){super({device:e,attribute:t,timeline:i}),this.type="interpolation",this.transform=WN(e,t)}start(e,t){const i=this.currentLength,s=this.currentStartIndices;if(super.start(e,t,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:o,attribute:c}=this;rT(o),o[0]=oT({device:this.device,buffer:o[0],attribute:c,fromLength:i,toLength:this.currentLength,fromStartIndices:s,getData:e.enter}),o[1]=aT({device:this.device,source:o[0],target:o[1]}),this.setBuffer(o[1]);const{transform:u}=this,h=u.model;let d=Math.floor(this.currentLength/c.size);cT(c)&&(d/=2),h.setVertexCount(d),c.isConstant?(h.setAttributes({aFrom:o[0]}),h.setConstantAttributes({aTo:c.value})):h.setAttributes({aFrom:o[0],aTo:c.getBuffer()}),u.transformFeedback.setBuffers({vCurrent:o[1]})}onUpdate(){const{duration:e,easing:t}=this.settings,{time:i}=this.transition;let s=i/e;t&&(s=t(s));const{model:o}=this.transform,c={time:s};o.shaderInputs.setProps({interpolation:c}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const VN=`uniform interpolationUniforms {
  float time;
} interpolation;
`,vv={name:"interpolation",vs:VN,uniformTypes:{time:"f32"}},jN=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,HN=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function cT(n){return n.doublePrecision&&n.value instanceof Float64Array}function WN(n,e){const t=e.size,i=iT(t),s=sT(t),o=e.getBufferLayout();return cT(e)?new Gr(n,{vs:HN,bufferLayout:[{name:"aFrom",byteStride:8*t,attributes:[{attribute:"aFrom",format:s,byteOffset:0},{attribute:"aFrom64Low",format:s,byteOffset:4*t}]},{name:"aTo",byteStride:8*t,attributes:[{attribute:"aTo",format:s,byteOffset:0},{attribute:"aTo64Low",format:s,byteOffset:4*t}]}],modules:[nC,vv],defines:{ATTRIBUTE_TYPE:i,ATTRIBUTE_SIZE:t},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new Gr(n,{vs:jN,bufferLayout:[{name:"aFrom",format:s},{name:"aTo",format:o.attributes[0].format}],modules:[vv],defines:{ATTRIBUTE_TYPE:i},varyings:["vCurrent"],disableWarnings:!0})}class $N extends lT{constructor({device:e,attribute:t,timeline:i}){super({device:e,attribute:t,timeline:i}),this.type="spring",this.texture=QN(e),this.framebuffer=GN(e,this.texture),this.transform=ZN(e,t)}start(e,t){const i=this.currentLength,s=this.currentStartIndices;super.start(e,t);const{buffers:o,attribute:c}=this;for(let h=0;h<2;h++)o[h]=oT({device:this.device,buffer:o[h],attribute:c,fromLength:i,toLength:this.currentLength,fromStartIndices:s,getData:e.enter});o[2]=aT({device:this.device,source:o[0],target:o[2]}),this.setBuffer(o[1]);const{model:u}=this.transform;u.setVertexCount(Math.floor(this.currentLength/c.size)),c.isConstant?u.setConstantAttributes({aTo:c.value}):u.setAttributes({aTo:c.getBuffer()})}onUpdate(){const{buffers:e,transform:t,framebuffer:i,transition:s}=this,o=this.settings;t.model.setAttributes({aPrev:e[0],aCur:e[1]}),t.transformFeedback.setBuffers({vNext:e[2]});const c={stiffness:o.stiffness,damping:o.damping};t.model.shaderInputs.setProps({spring:c}),t.run({framebuffer:i,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),rT(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(i)[0]>0||s.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const XN=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,YN={name:"spring",vs:XN,uniformTypes:{damping:"f32",stiffness:"f32"}},qN=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,KN=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function ZN(n,e){const t=iT(e.size),i=sT(e.size);return new Gr(n,{vs:qN,fs:KN,bufferLayout:[{name:"aPrev",format:i},{name:"aCur",format:i},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[YN],defines:{ATTRIBUTE_TYPE:t},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function QN(n){return n.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function GN(n,e){return n.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const JN={interpolation:zN,spring:$N};class eP{constructor(e,{id:t,timeline:i}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=t,this.device=e,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:t,numInstances:i}){this.numInstances=i||1;for(const s in e){const o=e[s],c=o.getTransitionSetting(t);c&&this._updateAttribute(s,o,c)}for(const s in this.transitions){const o=e[s];(!o||!o.getTransitionSetting(t))&&this._removeTransition(s)}}hasAttribute(e){const t=this.transitions[e];return t&&t.inProgress}getAttributes(){const e={};for(const t in this.transitions){const i=this.transitions[t];i.inProgress&&(e[t]=i.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const t in this.transitions)this.transitions[t].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,t,i){const s=this.transitions[e];let o=!s||s.type!==i.type;if(o){s&&this._removeTransition(e);const c=JN[i.type];c?this.transitions[e]=new c({attribute:t,timeline:this.timeline,device:this.device}):(et.error(`unsupported transition type '${i.type}'`)(),o=!1)}(o||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(i,this.numInstances))}}const Tv="attributeManager.invalidate",tP="attributeManager.updateStart",nP="attributeManager.updateEnd",iP="attribute.updateStart",sP="attribute.allocate",rP="attribute.updateEnd";class fp{constructor(e,{id:t="attribute-manager",stats:i,timeline:s}={}){this.mergeBoundsMemoized=Eo(gO),this.id=t,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=i,this.attributeTransitionManager=new eP(e,{id:`${t}-transitions`,timeline:s}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const t of e)this.attributes[t]!==void 0&&(this.attributes[t].delete(),delete this.attributes[t])}invalidate(e,t){const i=this._invalidateTrigger(e,t);$t(Tv,this,e,i)}invalidateAll(e){for(const t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);$t(Tv,this,"all")}update({data:e,numInstances:t,startIndices:i=null,transitions:s,props:o={},buffers:c={},context:u={}}){let h=!1;$t(tP,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const d in this.attributes){const g=this.attributes[d],m=g.settings.accessor;g.startIndices=i,g.numInstances=t,o[d]&&et.removed(`props.${d}`,`data.attributes.${d}`)(),g.setExternalBuffer(c[d])||g.setBinaryValue(typeof m=="string"?c[m]:void 0,e.startIndices)||typeof m=="string"&&!c[m]&&g.setConstantValue(o[m])||g.needsUpdate()&&(h=!0,this._updateAttribute({attribute:g,numInstances:t,data:e,props:o,context:u})),this.needsRedraw=this.needsRedraw||g.needsRedraw()}h&&$t(nP,this,t),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:t,transitions:s})}updateTransition(){const{attributeTransitionManager:e}=this,t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const t=e.map(i=>this.attributes[i]?.getBounds());return this.mergeBoundsMemoized(t)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:t,attributeTransitionManager:i}=this,s={...i.getAttributes()};for(const o in t){const c=t[o];c.needsRedraw(e)&&!i.hasAttribute(o)&&(s[o]=c)}return s}getBufferLayouts(e){return Object.values(this.getAttributes()).map(t=>t.getBufferLayout(e))}_add(e,t){for(const i in e){const s=e[i],o={...s,id:i,size:s.isIndexed&&1||s.size||1,...t};this.attributes[i]=new nT(this.device,o)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const t in this.attributes)this.attributes[t].getUpdateTriggers().forEach(s=>{e[s]||(e[s]=[]),e[s].push(t)});this.updateTriggers=e}_invalidateTrigger(e,t){const{attributes:i,updateTriggers:s}=this,o=s[e];return o&&o.forEach(c=>{const u=i[c];u&&u.setNeedsUpdate(u.id,t)}),o}_updateAttribute(e){const{attribute:t,numInstances:i}=e;if($t(iP,t),t.constant){t.setConstantValue(t.value);return}t.allocate(i)&&$t(sP,t,i),t.updateBuffer(e)&&(this.needsRedraw=!0,$t(rP,t,i))}}class aP extends Vc{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:t,toValue:i,duration:s,easing:o}}=this,c=o(e/s);this._value=Tc(t,i,c)}}const xv=1e-5;function Sv(n,e,t,i,s){const o=e-n,u=(t-e)*s,h=-o*i;return u+h+o+e}function oP(n,e,t,i,s){if(Array.isArray(t)){const o=[];for(let c=0;c<t.length;c++)o[c]=Sv(n[c],e[c],t[c],i,s);return o}return Sv(n,e,t,i,s)}function wv(n,e){if(Array.isArray(n)){let t=0;for(let i=0;i<n.length;i++){const s=n[i]-e[i];t+=s*s}return Math.sqrt(t)}return Math.abs(n-e)}class lP extends Vc{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:t,damping:i,stiffness:s}=this.settings,{_prevValue:o=e,_currValue:c=e}=this;let u=oP(o,c,t,i,s);const h=wv(u,t),d=wv(u,c);h<xv&&d<xv&&(u=t,this.end()),this._prevValue=c,this._currValue=u}}const cP={interpolation:aP,spring:lP};class uP{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,t,i,s){const{transitions:o}=this;if(o.has(e)){const h=o.get(e),{value:d=h.settings.fromValue}=h;t=d,this.remove(e)}if(s=tT(s),!s)return;const c=cP[s.type];if(!c){et.error(`unsupported transition type '${s.type}'`)();return}const u=new c(this.timeline);u.start({...s,fromValue:t,toValue:i}),o.set(e,u)}remove(e){const{transitions:t}=this;t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){const e={};for(const[t,i]of this.transitions)i.update(),e[t]=i.value,i.inProgress||this.remove(t);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function fP(n){const e=n[ns];for(const t in e){const i=e[t],{validate:s}=i;if(s&&!s(n[t],i))throw new Error(`Invalid prop ${t}: ${n[t]}`)}}function hP(n,e){const t=hp({newProps:n,oldProps:e,propTypes:n[ns],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=pP(n,e);let s=!1;return i||(s=gP(n,e)),{dataChanged:i,propsChanged:t,updateTriggersChanged:s,extensionsChanged:_P(n,e),transitionsChanged:dP(n,e)}}function dP(n,e){if(!n.transitions)return!1;const t={},i=n[ns];let s=!1;for(const o in n.transitions){const c=i[o],u=c&&c.type;(u==="number"||u==="color"||u==="array")&&vd(n[o],e[o],c)&&(t[o]=!0,s=!0)}return s?t:!1}function hp({newProps:n,oldProps:e,ignoreProps:t={},propTypes:i={},triggerName:s="props"}){if(e===n)return!1;if(typeof n!="object"||n===null)return`${s} changed shallowly`;if(typeof e!="object"||e===null)return`${s} changed shallowly`;for(const o of Object.keys(n))if(!(o in t)){if(!(o in e))return`${s}.${o} added`;const c=vd(n[o],e[o],i[o]);if(c)return`${s}.${o} ${c}`}for(const o of Object.keys(e))if(!(o in t)){if(!(o in n))return`${s}.${o} dropped`;if(!Object.hasOwnProperty.call(n,o)){const c=vd(n[o],e[o],i[o]);if(c)return`${s}.${o} ${c}`}}return!1}function vd(n,e,t){let i=t&&t.equal;return i&&!i(n,e,t)||!i&&(i=n&&e&&n.equals,i&&!i.call(n,e))?"changed deeply":!i&&e!==n?"changed shallowly":null}function pP(n,e){if(e===null)return"oldProps is null, initial diff";let t=!1;const{dataComparator:i,_dataDiff:s}=n;return i?i(n.data,e.data)||(t="Data comparator detected a change"):n.data!==e.data&&(t="A new data container was supplied"),t&&s&&(t=s(n.data,e.data)||t),t}function gP(n,e){if(e===null)return{all:!0};if("all"in n.updateTriggers&&Av(n,e,"all"))return{all:!0};const t={};let i=!1;for(const s in n.updateTriggers)s!=="all"&&Av(n,e,s)&&(t[s]=!0,i=!0);return i?t:!1}function _P(n,e){if(e===null)return!0;const t=e.extensions,{extensions:i}=n;if(i===t)return!1;if(!t||!i||i.length!==t.length)return!0;for(let s=0;s<i.length;s++)if(!i[s].equals(t[s]))return!0;return!1}function Av(n,e,t){let i=n.updateTriggers[t];i=i??{};let s=e.updateTriggers[t];return s=s??{},hp({oldProps:s,newProps:i,triggerName:t})}const mP="count(): argument not an object",yP="count(): argument not a container";function bP(n){if(!TP(n))throw new Error(mP);if(typeof n.count=="function")return n.count();if(Number.isFinite(n.size))return n.size;if(Number.isFinite(n.length))return n.length;if(vP(n))return Object.keys(n).length;throw new Error(yP)}function vP(n){return n!==null&&typeof n=="object"&&n.constructor===Object}function TP(n){return n!==null&&typeof n=="object"}function Ev(n,e){if(!e)return n;const t={...n,...e};if("defines"in e&&(t.defines={...n.defines,...e.defines}),"modules"in e&&(t.modules=(n.modules||[]).concat(e.modules),e.modules.some(i=>i.name==="project64"))){const i=t.modules.findIndex(s=>s.name==="project32");i>=0&&t.modules.splice(i,1)}if("inject"in e)if(!n.inject)t.inject=e.inject;else{const i={...n.inject};for(const s in e.inject)i[s]=(i[s]||"")+e.inject[s];t.inject=i}return t}const xP={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},Td={};function SP(n,e,t,i){if(t instanceof Qe)return t;t.constructor&&t.constructor.name!=="Object"&&(t={data:t});let s=null;t.compressed&&(s={minFilter:"linear",mipmapFilter:t.data.length>1?"nearest":"linear"});const o=e.createTexture({...t,sampler:{...xP,...s,...i},mipmaps:!0});return Td[o.id]=n,o}function wP(n,e){!e||!(e instanceof Qe)||Td[e.id]===n&&(e.delete(),delete Td[e.id])}const AP={boolean:{validate(n,e){return!0},equal(n,e,t){return!!n==!!e}},number:{validate(n,e){return Number.isFinite(n)&&(!("max"in e)||n<=e.max)&&(!("min"in e)||n>=e.min)}},color:{validate(n,e){return e.optional&&!n||xd(n)&&(n.length===3||n.length===4)},equal(n,e,t){return Fn(n,e,1)}},accessor:{validate(n,e){const t=Mc(n);return t==="function"||t===Mc(e.value)},equal(n,e,t){return typeof e=="function"?!0:Fn(n,e,1)}},array:{validate(n,e){return e.optional&&!n||xd(n)},equal(n,e,t){const{compare:i}=t,s=Number.isInteger(i)?i:i?1:0;return i?Fn(n,e,s):n===e}},object:{equal(n,e,t){if(t.ignore)return!0;const{compare:i}=t,s=Number.isInteger(i)?i:i?1:0;return i?Fn(n,e,s):n===e}},function:{validate(n,e){return e.optional&&!n||typeof n=="function"},equal(n,e,t){return!t.compare&&t.ignore!==!1||n===e}},data:{transform:(n,e,t)=>{if(!n)return n;const{dataTransform:i}=t.props;return i?i(n):typeof n.shape=="string"&&n.shape.endsWith("-table")&&Array.isArray(n.data)?n.data:n}},image:{transform:(n,e,t)=>{const i=t.context;return!i||!i.device?null:SP(t.id,i.device,n,{...e.parameters,...t.props.textureParameters})},release:(n,e,t)=>{wP(t.id,n)}}};function EP(n){const e={},t={},i={};for(const[s,o]of Object.entries(n)){const c=o?.deprecatedFor;if(c)i[s]=Array.isArray(c)?c:[c];else{const u=RP(s,o);e[s]=u,t[s]=u.value}}return{propTypes:e,defaultProps:t,deprecatedProps:i}}function RP(n,e){switch(Mc(e)){case"object":return so(n,e);case"array":return so(n,{type:"array",value:e,compare:!1});case"boolean":return so(n,{type:"boolean",value:e});case"number":return so(n,{type:"number",value:e});case"function":return so(n,{type:"function",value:e,compare:!0});default:return{name:n,type:"unknown",value:e}}}function so(n,e){return"type"in e?{name:n,...AP[e.type],...e}:"value"in e?{name:n,type:Mc(e.value),...e}:{name:n,type:"object",value:e}}function xd(n){return Array.isArray(n)||ArrayBuffer.isView(n)}function Mc(n){return xd(n)?"array":n===null?"null":typeof n}function CP(n,e){let t;for(let o=e.length-1;o>=0;o--){const c=e[o];"extensions"in c&&(t=c.extensions)}const i=Sd(n.constructor,t),s=Object.create(i);s[Rc]=n,s[Bs]={},s[Ji]={};for(let o=0;o<e.length;++o){const c=e[o];for(const u in c)s[u]=c[u]}return Object.freeze(s),s}const MP="_mergedDefaultProps";function Sd(n,e){if(!(n instanceof jc.constructor))return{};let t=MP;if(e)for(const s of e){const o=s.constructor;o&&(t+=`:${o.extensionName||o.name}`)}const i=uT(n,t);return i||(n[t]=OP(n,e||[]))}function OP(n,e){if(!n.prototype)return null;const i=Object.getPrototypeOf(n),s=Sd(i),o=uT(n,"defaultProps")||{},c=EP(o),u=Object.assign(Object.create(null),s,c.defaultProps),h=Object.assign(Object.create(null),s?.[ns],c.propTypes),d=Object.assign(Object.create(null),s?.[Fh],c.deprecatedProps);for(const g of e){const m=Sd(g.constructor);m&&(Object.assign(u,m),Object.assign(h,m[ns]),Object.assign(d,m[Fh]))}return IP(u,n),PP(u,h),NP(u,d),u[ns]=h,u[Fh]=d,e.length===0&&!dp(n,"_propTypes")&&(n._propTypes=h),u}function IP(n,e){const t=DP(e);Object.defineProperties(n,{id:{writable:!0,value:t}})}function NP(n,e){for(const t in e)Object.defineProperty(n,t,{enumerable:!1,set(i){const s=`${this.id}: ${t}`;for(const o of e[t])dp(this,o)||(this[o]=i);et.deprecated(s,e[t].join("/"))()}})}function PP(n,e){const t={},i={};for(const s in e){const o=e[s],{name:c,value:u}=o;o.async&&(t[c]=u,i[c]=kP(c))}n[Hr]=t,n[Bs]={},Object.defineProperties(n,i)}function kP(n){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||eT(e)?this[Bs][n]=e:this[Ji][n]=e},get(){if(this[Ji]){if(n in this[Ji])return this[Ji][n]||this[Hr][n];if(n in this[Bs]){const e=this[Rc]&&this[Rc].internalState;if(e&&e.hasAsyncProp(n))return e.getAsyncProp(n)||this[Hr][n]}}return this[Hr][n]}}}function dp(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function uT(n,e){return dp(n,e)&&n[e]}function DP(n){const e=n.componentName;return e||et.warn(`${n.name}.componentName not specified`)(),e||n.name}let UP=0;class jc{constructor(...e){this.props=CP(this,e),this.id=this.props.id,this.count=UP++}clone(e){const{props:t}=this,i={};for(const s in t[Hr])s in t[Ji]?i[s]=t[Ji][s]:s in t[Bs]&&(i[s]=t[Bs][s]);return new this.constructor({...t,...i,...e})}}jc.componentName="Component";jc.defaultProps={};const BP=Object.freeze({});class FP{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const t=this.asyncProps[e];t&&t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||BP}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){if(e){const t=this.asyncProps[e];return!!(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(const t in this.asyncProps)if(this.isAsyncPropLoading(t))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){this.component=e[Rc]||this.component;const t=e[Ji]||{},i=e[Bs]||e,s=e[Hr]||{};for(const o in t){const c=t[o];this._createAsyncPropData(o,s[o]),this._updateAsyncProp(o,c),t[o]=this.getAsyncProp(o)}for(const o in i){const c=i[o];this._createAsyncPropData(o,s[o]),this._updateAsyncProp(o,c)}}_fetch(e,t){return null}_onResolve(e,t){}_onError(e,t){}_updateAsyncProp(e,t){if(this._didAsyncInputValueChange(e,t)){if(typeof t=="string"&&(t=this._fetch(e,t)),t instanceof Promise){this._watchPromise(e,t);return}if(eT(t)){this._resolveAsyncIterable(e,t);return}this._setPropValue(e,t)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,t){const i=this.asyncProps[e];return t===i.resolvedValue||t===i.lastValue?!1:(i.lastValue=t,!0)}_setPropValue(e,t){this._freezeAsyncOldProps();const i=this.asyncProps[e];i&&(t=this._postProcessValue(i,t),i.resolvedValue=t,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount)}_setAsyncPropValue(e,t,i){const s=this.asyncProps[e];s&&i>=s.resolvedLoadCount&&t!==void 0&&(this._freezeAsyncOldProps(),s.resolvedValue=t,s.resolvedLoadCount=i,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){const i=this.asyncProps[e];if(i){i.pendingLoadCount++;const s=i.pendingLoadCount;t.then(o=>{this.component&&(o=this._postProcessValue(i,o),this._setAsyncPropValue(e,o,s),this._onResolve(e,o))}).catch(o=>{this._onError(e,o)})}}async _resolveAsyncIterable(e,t){if(e!=="data"){this._setPropValue(e,t);return}const i=this.asyncProps[e];if(!i)return;i.pendingLoadCount++;const s=i.pendingLoadCount;let o=[],c=0;for await(const u of t){if(!this.component)return;const{dataTransform:h}=this.component.props;h?o=h(u,o):o=o.concat(u),Object.defineProperty(o,"__diff",{enumerable:!1,value:[{startRow:c,endRow:o.length}]}),c=o.length,this._setAsyncPropValue(e,o,s)}this._onResolve(e,o)}_postProcessValue(e,t){const i=e.type;return i&&this.component&&(i.release&&i.release(e.resolvedValue,i,this.component),i.transform)?i.transform(t,i,this.component):t}_createAsyncPropData(e,t){if(!this.asyncProps[e]){const s=this.component&&this.component.props[ns];this.asyncProps[e]={type:s&&s[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}}class LP extends FP{constructor({attributeManager:e,layer:t}){super(t),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,t){const i=this.layer,s=i?.props.fetch;return s?s(t,{propName:e,layer:i}):super._fetch(e,t)}_onResolve(e,t){const i=this.layer;if(i){const s=i.props.onDataLoad;e==="data"&&s&&s(t,{propName:e,layer:i})}}_onError(e,t){const i=this.layer;i&&i.raiseError(t,`loading ${e} of ${this.layer}`)}}const zP="layer.changeFlag",VP="layer.initialize",jP="layer.update",HP="layer.finalize",WP="layer.matched",Rv=2**24-1,$P=Object.freeze([]),XP=Eo(({oldViewport:n,viewport:e})=>n.equals(e));let Dn=new Uint8ClampedArray(0);const YP={data:{type:"data",value:$P,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:n=>n&&n.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(n,{propName:e,layer:t,loaders:i,loadOptions:s,signal:o})=>{const{resourceManager:c}=t.context;s=s||t.getLoadOptions(),i=i||t.props.loaders,o&&(s={...s,fetch:{...s?.fetch,signal:o}});let u=c.contains(n);return!u&&!s&&(c.add({resourceId:n,data:Yh(n,i),persistent:!1}),u=!0),u?c.subscribe({resourceId:n,onChange:h=>t.internalState?.reloadAsyncProp(e,h),consumerId:t.id,requestId:e}):Yh(n,i,s)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:Ue.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:n})=>[0,-n*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class js extends jc{constructor(){super(...arguments),this.internalState=null,this.lifecycle=kr.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){Xt(this.internalState);const t=this.internalState.viewport||this.context.viewport,i=C3(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[s,o,c]=S3(i,t.pixelProjectionMatrix);return e.length===2?[s,o]:[s,o,c]}unproject(e){return Xt(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,t){Xt(this.internalState);const i=this.internalState.viewport||this.context.viewport;return TO(e,{viewport:i,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...t})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(...e){for(const t of this.getModels())t.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===Ue.DEFAULT||e===Ue.LNGLAT||e===Ue.CARTESIAN}onHover(e,t){return this.props.onHover&&this.props.onHover(e,t)||!1}onClick(e,t){return this.props.onClick&&this.props.onClick(e,t)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,t=[]){return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){Xt(e instanceof Uint8Array);const[t,i,s]=e;return t+i*256+s*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:bP(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){return this.getAttributeManager()?.getBounds(["positions","instancePositions"])}getShaders(e){e=Ev(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const t of this.props.extensions)e=Ev(e,t.getShaders.call(this,t));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const t=this.getAttributeManager(),{dataChanged:i}=e.changeFlags;if(i&&t)if(Array.isArray(i))for(const s of i)t.invalidateAll(s);else t.invalidateAll();if(t){const{props:s}=e,o=this.internalState.hasPickingBuffer,c=Number.isInteger(s.highlightedObjectIndex)||s.pickable||s.extensions.some(u=>u.getNeedsPickingBuffer.call(this,u));if(o!==c){this.internalState.hasPickingBuffer=c;const{pickingColors:u,instancePickingColors:h}=t.attributes,d=u||h;d&&(c&&d.constant&&(d.constant=!1,t.invalidate(d.id)),!d.value&&!c&&(d.constant=!0,d.value=[0,0,0]))}}}finalizeState(e){for(const i of this.getModels())i.destroy();const t=this.getAttributeManager();t&&t.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const t of this.getModels())t.draw(e.renderPass)}getPickingInfo({info:e,mode:t,sourceLayer:i}){const{index:s}=e;return s>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[s]),e}raiseError(e,t){t&&(e=new Error(`${t}: ${e.message}`,{cause:e})),this.props.onError?.(e)||this.context?.onError?.(e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){return this.internalState?.uniformTransitions.active||!1}activateViewport(e){if(!this.internalState)return;const t=this.internalState.viewport;this.internalState.viewport=e,(!t||!XP({oldViewport:t,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const t=this.getAttributeManager();t&&(e==="all"?t.invalidateAll():t.invalidate(e))}updateAttributes(e){let t=!1;for(const i in e)e[i].layoutChanged()&&(t=!0);for(const i of this.getModels())this._setModelAttributes(i,e,t)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const t=this.props,i=this.getNumInstances(),s=this.getStartIndices();e.update({data:t.data,numInstances:i,startIndices:s,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this});const o=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(o)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const t=e.update(),i=Object.create(this.props);for(const s in t)Object.defineProperty(i,s,{value:t[s]});return i}return this.props}calculateInstancePickingColors(e,{numInstances:t}){if(e.constant)return;const i=Math.floor(Dn.length/4);if(this.internalState.usesPickingColorCache=!0,i<t){t>Rv&&et.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Dn=To.allocate(Dn,t,{size:4,copy:!0,maxCount:Math.max(t,Rv)});const s=Math.floor(Dn.length/4),o=[0,0,0];for(let c=i;c<s;c++)this.encodePickingColor(c,o),Dn[c*4+0]=o[0],Dn[c*4+1]=o[1],Dn[c*4+2]=o[2],Dn[c*4+3]=0}e.value=Dn.subarray(0,t*4)}_setModelAttributes(e,t,i=!1){if(!Object.keys(t).length)return;if(i){const u=this.getAttributeManager();e.setBufferLayout(u.getBufferLayouts(e)),t=u.getAttributes()}const s=e.userData?.excludeAttributes||{},o={},c={};for(const u in t){if(s[u])continue;const h=t[u].getValue();for(const d in h){const g=h[d];g instanceof at?t[u].settings.isIndexed?e.setIndexBuffer(g):o[d]=g:g&&(c[d]=g)}}e.setAttributes(o),e.setConstantAttributes(c)}disablePickingIndex(e){const t=this.props.data;if(!("attributes"in t)){this._disablePickingIndex(e);return}const{pickingColors:i,instancePickingColors:s}=this.getAttributeManager().attributes,o=i||s,c=o&&t.attributes&&t.attributes[o.id];if(c&&c.value){const u=c.value,h=this.encodePickingColor(e);for(let d=0;d<t.length;d++){const g=o.getVertexOffset(d);u[g]===h[0]&&u[g+1]===h[1]&&u[g+2]===h[2]&&this._disablePickingIndex(d)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:t,instancePickingColors:i}=this.getAttributeManager().attributes,s=t||i;if(!s)return;const o=s.getVertexOffset(e),c=s.getVertexOffset(e+1);s.buffer.write(new Uint8Array(c-o),o)}restorePickingColors(){const{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes,i=e||t;i&&(this.internalState.usesPickingColorCache&&i.value.buffer!==Dn.buffer&&(i.value=Dn.subarray(0,i.value.length)),i.updateSubBuffer({startOffset:0}))}_initialize(){Xt(!this.internalState),Xt(Number.isFinite(this.props.coordinateSystem)),$t(VP,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new LP({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(et.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new uP(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const t of this.props.extensions)t.initializeState.call(this,this.context,t);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){$t(WP,this,this===e);const{state:t,internalState:i}=e;this!==e&&(this.internalState=i,this.state=t,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if($t(jP,this,e),!e)return;const t=this.props,i=this.context,s=this.internalState,o=i.viewport,c=this._updateUniformTransition();s.propsInTransition=c,i.viewport=s.viewport||o,this.props=c;try{const u=this._getUpdateParams(),h=this.getModels();if(i.device)this.updateState(u);else try{this.updateState(u)}catch{}for(const g of this.props.extensions)g.updateState.call(this,u,g);this.setNeedsRedraw(),this._updateAttributes();const d=this.getModels()[0]!==h[0];this._postUpdate(u,d)}finally{i.viewport=o,this.props=t,this._clearChangeFlags(),s.needsUpdate=!1,s.resetOldProps()}}_finalize(){$t(HP,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,shaderModuleProps:t=null,uniforms:i={},parameters:s={}}){this._updateAttributeTransition();const o=this.props,c=this.context;this.props=this.internalState.propsInTransition||o;try{t&&this.setShaderModuleProps(t);const{getPolygonOffset:u}=this.props,h=u&&u(i)||[0,0];c.device instanceof Vr&&c.device.setParametersWebGL({polygonOffset:h});for(const d of this.getModels())d.device.type==="webgpu"?d.setParameters({...d.parameters,...s}):d.setParameters(s);if(c.device instanceof Vr)c.device.withParametersWebGL(s,()=>{const d={renderPass:e,shaderModuleProps:t,uniforms:i,parameters:s,context:c};for(const g of this.props.extensions)g.draw.call(this,d,g);this.draw(d)});else{const d={renderPass:e,shaderModuleProps:t,uniforms:i,parameters:s,context:c};for(const g of this.props.extensions)g.draw.call(this,d,g);this.draw(d)}}finally{this.props=o}}getChangeFlags(){return this.internalState?.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:t}=this.internalState;for(const s in e)if(e[s]){let o=!1;switch(s){case"dataChanged":const c=e[s],u=t[s];c&&Array.isArray(u)&&(t.dataChanged=Array.isArray(c)?u.concat(c):c,o=!0);default:t[s]||(t[s]=e[s],o=!0)}o&&$t(zP,this,s,e)}const i=!!(t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged);t.propsOrDataChanged=i,t.somethingChanged=i||t.viewportChanged||t.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,t){const i=hP(e,t);if(i.updateTriggersChanged)for(const s in i.updateTriggersChanged)i.updateTriggersChanged[s]&&this.invalidateAttribute(s);if(i.transitionsChanged)for(const s in i.transitionsChanged)this.internalState.uniformTransitions.add(s,t[s],e[s],e.transitions?.[s]);return this.setChangeFlags(i)}validateProps(){fP(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const t={highlightedObjectColor:e.picked?e.color:null},{highlightColor:i}=this.props;e.picked&&typeof i=="function"&&(t.highlightColor=i(e)),this.setShaderModuleProps({picking:t}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new fp(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,t){const{props:i,oldProps:s}=e,o=this.state.model;o?.isInstanced&&o.setInstanceCount(this.getNumInstances());const{autoHighlight:c,highlightedObjectIndex:u,highlightColor:h}=i;if(t||s.autoHighlight!==c||s.highlightedObjectIndex!==u||s.highlightColor!==h){const d={};Array.isArray(h)&&(d.highlightColor=h),(t||s.autoHighlight!==c||u!==s.highlightedObjectIndex)&&(d.highlightedObjectColor=Number.isFinite(u)&&u>=0?this.encodePickingColor(u):null),this.setShaderModuleProps({picking:d})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=t||this.internalState.needsRedraw&&this.id;const i=this.getAttributeManager(),s=i?i.getNeedsRedraw(e):!1;if(t=t||s,t)for(const o of this.props.extensions)o.onNeedsRedraw.call(this,o);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,t}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}js.defaultProps=YP;js.layerName="Layer";const qP="compositeLayer.renderLayers";class fT extends js{get isComposite(){return!0}get isDrawable(){return!1}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:t}=e;return t&&t.__source&&t.__source.parent&&t.__source.parent.id===this.id&&(e.object=t.__source.object,e.index=t.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,t){return t&&t.length}getSubLayerClass(e,t){const{_subLayerProps:i}=this.props;return i&&i[e]&&i[e].type||t}getSubLayerRow(e,t,i){return e.__source={parent:this,object:t,index:i},e}getSubLayerAccessor(e){if(typeof e=="function"){const t={index:-1,data:this.props.data,target:[]};return(i,s)=>i&&i.__source?(t.index=i.__source.index,e(i.__source.object,t)):e(i,s)}return e}getSubLayerProps(e={}){const{opacity:t,pickable:i,visible:s,parameters:o,getPolygonOffset:c,highlightedObjectIndex:u,autoHighlight:h,highlightColor:d,coordinateSystem:g,coordinateOrigin:m,wrapLongitude:y,positionFormat:T,modelMatrix:w,extensions:C,fetch:N,operation:V,_subLayerProps:$}=this.props,O={id:"",updateTriggers:{},opacity:t,pickable:i,visible:s,parameters:o,getPolygonOffset:c,highlightedObjectIndex:u,autoHighlight:h,highlightColor:d,coordinateSystem:g,coordinateOrigin:m,wrapLongitude:y,positionFormat:T,modelMatrix:w,extensions:C,fetch:N,operation:V},F=$&&e.id&&$[e.id],H=F&&F.updateTriggers,te=e.id||"sublayer";if(F){const oe=this.props[ns],E=e.type?e.type._propTypes:{};for(const R in F){const Y=E[R]||oe[R];Y&&Y.type==="accessor"&&(F[R]=this.getSubLayerAccessor(F[R]))}}Object.assign(O,e,F),O.id=`${this.props.id}-${te}`,O.updateTriggers={all:this.props.updateTriggers?.all,...e.updateTriggers,...H};for(const oe of C){const E=oe.getSubLayerProps.call(this,oe);E&&Object.assign(O,E,{updateTriggers:Object.assign(O.updateTriggers,E.updateTriggers)})}return O}_updateAutoHighlight(e){for(const t of this.getSubLayers())t.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,t){let i=this.internalState.subLayers;const s=!i||this.needsUpdate();if(s){const o=this.renderLayers();i=sp(o,Boolean),this.internalState.subLayers=i}$t(qP,this,s,i);for(const o of i)o.parent=this}}fT.layerName="CompositeLayer";const KP=typeof window<"u"?le.useLayoutEffect:le.useEffect;function Oc(n,e){for(;n;){if(n===e)return!0;n=Object.getPrototypeOf(n)}return!1}const ZP={position:"absolute",zIndex:-1};function hT(n,e){if(typeof n=="function")return n(e);if(Array.isArray(n))return n.map(t=>hT(t,e));if(Hc(n)){if(QP(n))return e.style=ZP,le.cloneElement(n,e);if(GP(n))return le.cloneElement(n,e)}return n}function Hc(n){return n&&typeof n=="object"&&"type"in n||!1}function QP(n){return n.props?.mapStyle}function GP(n){const e=n.type;return e&&e.deckGLViewProps}function wd(n){if(typeof n=="function")return le.createElement(Jr,{},n);if(Array.isArray(n))return n.map(wd);if(Hc(n)){if(n.type===le.Fragment)return wd(n.props.children);if(Oc(n.type,Jr))return n}return n}function JP({children:n,layers:e=[],views:t=null}){const i=[],s=[],o={};return le.Children.forEach(wd(n),c=>{if(Hc(c)){const u=c.type;if(Oc(u,js)){const h=ek(u,c.props);s.push(h)}else i.push(c);if(Oc(u,Jr)&&u!==Jr&&c.props.id){const h=new u(c.props);o[h.id]=h}}else c&&i.push(c)}),Object.keys(o).length>0&&(Array.isArray(t)?t.forEach(c=>{o[c.id]=c}):t&&(o[t.id]=t),t=Object.values(o)),e=s.length>0?[...s,...e]:e,{layers:e,children:i,views:t}}function ek(n,e){const t={},i=n.defaultProps||{};for(const s in e)i[s]!==e[s]&&(t[s]=e[s]);return new n(t)}const tk=le.createContext();function nk({children:n,deck:e,ContextProvider:t=tk.Provider}){const{viewManager:i}=e||{};if(!i||!i.views.length)return[];const s={},o=i.views[0].id;for(const c of n){let u=o,h=c;Hc(c)&&Oc(c.type,Jr)&&(u=c.props.id||o,h=c.props.children);const d=i.getViewport(u),g=i.getViewState(u);if(d){g.padding=d.padding;const{x:m,y,width:T,height:w}=d;h=hT(h,{x:m,y,width:T,height:w,viewport:d,viewState:g}),s[u]||(s[u]={viewport:d,children:[]}),s[u].children.push(h)}}return Object.keys(s).map(c=>{const{viewport:u,children:h}=s[c],{x:d,y:g,width:m,height:y}=u,T={position:"absolute",left:d,top:g,width:m,height:y},w=`view-${c}`,C=le.createElement("div",{key:w,id:w,style:T},...h),N={deck:e,viewport:u,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:$=>{$.viewId=c,e._onViewStateChange($)},widgets:[]},V=`view-${c}-context`;return le.createElement(t,{key:V,value:N},C)})}const ik={mixBlendMode:null};function sk({width:n,height:e,style:t}){const i={position:"absolute",zIndex:0,left:0,top:0,width:n,height:e},s={left:0,top:0};if(t)for(const o in t)o in ik?s[o]=t[o]:i[o]=t[o];return{containerStyle:i,canvasStyle:s}}function rk(n){return{get deck(){return n.deck},pickObject:e=>n.deck.pickObject(e),pickMultipleObjects:e=>n.deck.pickMultipleObjects(e),pickObjects:e=>n.deck.pickObjects(e)}}function dT(n){n.redrawReason&&(n.deck._drawLayers(n.redrawReason),n.redrawReason=null)}function ak(n,e,t){const i=new e({...t,_customRender:t.deviceProps?.adapters?.[0]?.type==="webgpu"?void 0:s=>{n.redrawReason=s;const o=i.getViewports();n.lastRenderedViewports!==o?n.forceUpdate():dT(n)}});return i}function ok(n,e){const[t,i]=le.useState(0),o=le.useRef({control:null,version:t,forceUpdate:()=>i(H=>H+1)}).current,c=le.useRef(null),u=le.useRef(null),h=le.useMemo(()=>JP(n),[n.layers,n.views,n.children]);let d=!0;const g=H=>d&&n.viewState?(o.viewStateUpdateRequested=H,null):(o.viewStateUpdateRequested=null,n.onViewStateChange?.(H)),m=H=>{d?o.interactionStateUpdateRequested=H:(o.interactionStateUpdateRequested=null,n.onInteractionStateChange?.(H))},y=le.useMemo(()=>{const H={widgets:[],...n,style:null,width:"100%",height:"100%",parent:c.current,canvas:u.current,layers:h.layers,views:h.views,onViewStateChange:g,onInteractionStateChange:m};return delete H._customRender,o.deck&&o.deck.setProps(H),H},[n]);le.useEffect(()=>{const H=n.Deck||up;return o.deck=ak(o,H,{...y,parent:c.current,canvas:u.current}),()=>o.deck?.finalize()},[]),KP(()=>{dT(o);const{viewStateUpdateRequested:H,interactionStateUpdateRequested:te}=o;H&&g(H),te&&m(te)}),le.useImperativeHandle(e,()=>rk(o),[]);const T=o.deck&&o.deck.isInitialized?o.deck.getViewports():void 0,{ContextProvider:w,width:C="100%",height:N="100%",id:V,style:$}=n,{containerStyle:O,canvasStyle:F}=le.useMemo(()=>sk({width:C,height:N,style:$}),[C,N,$]);if(!o.viewStateUpdateRequested&&o.lastRenderedViewports===T||o.version!==t){o.lastRenderedViewports=T,o.version=t;const H=nk({children:h.children,deck:o.deck,ContextProvider:w}),te=le.createElement("canvas",{key:"canvas",id:V||"deckgl-overlay",ref:u,style:F});o.control=le.createElement("div",{id:`${V||"deckgl"}-wrapper`,ref:c,style:O},[te,H])}return d=!1,o.control}const lk=le.forwardRef(ok),ck=`struct LineUniforms {
  widthScale: f32,
  widthMinPixels: f32,
  widthMaxPixels: f32,
  useShortestPath: f32,
  widthUnits: i32,
};

@group(0) @binding(1)
var<uniform> line: LineUniforms;
`,Cv=`uniform lineUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float useShortestPath;
  highp int widthUnits;
} line;
`,uk={name:"line",source:ck,vs:Cv,fs:Cv,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",useShortestPath:"f32",widthUnits:"i32"}},fk=`// TODO(ibgreen): Hack for Layer uniforms (move to new "color" module?)
struct LayerUniforms {
  opacity: f32,
};
var<private> layer: LayerUniforms = LayerUniforms(1.0);
// @group(0) @binding(1) var<uniform> layer: LayerUniforms;

// ---------- Helper Structures & Functions ----------

// Placeholder filter functions.
fn deckgl_filter_size(offset: vec3<f32>, geometry: Geometry) -> vec3<f32> {
  return offset;
}
fn deckgl_filter_gl_position(p: vec4<f32>, geometry: Geometry) -> vec4<f32> {
  return p;
}
fn deckgl_filter_color(color: vec4<f32>, geometry: Geometry) -> vec4<f32> {
  return color;
}

// Compute an extrusion offset given a line direction (in clipspace),
// an offset direction (-1 or 1), and a width in pixels.
// Assumes a uniform "project" with a viewportSize field is available.
fn getExtrusionOffset(line_clipspace: vec2<f32>, offset_direction: f32, width: f32) -> vec2<f32> {
  // project.viewportSize should be provided as a uniform (not shown here)
  let dir_screenspace = normalize(line_clipspace * project.viewportSize);
  // Rotate by 90°: (x,y) becomes (-y,x)
  let rotated = vec2<f32>(-dir_screenspace.y, dir_screenspace.x);
  return rotated * offset_direction * width / 2.0;
}

// Splits the line between two points at a given x coordinate.
// Interpolates the y and z components.
fn splitLine(a: vec3<f32>, b: vec3<f32>, x: f32) -> vec3<f32> {
  let t: f32 = (x - a.x) / (b.x - a.x);
  return vec3<f32>(x, a.yz + t * (b.yz - a.yz));
}

// ---------- Uniforms & Global Structures ----------

// Uniforms for line, layer, and project are assumed to be defined elsewhere.
// For example:
//
// @group(0) @binding(0)
// var<uniform> line: LineUniform;
//
// struct LayerUniform {
//   opacity: f32,
// };
// @group(0) @binding(1)
// var<uniform> layer: LayerUniform;
//
// struct ProjectUniform {
//   viewportSize: vec2<f32>,
// };
// @group(0) @binding(2)
// var<uniform> project: ProjectUniform;



// ---------- Vertex Output Structure ----------

struct Varyings {
  @builtin(position) gl_Position: vec4<f32>,
  @location(0) vColor: vec4<f32>,
  @location(1) uv: vec2<f32>,
};

// ---------- Vertex Shader Entry Point ----------

@vertex
fn vertexMain(
  @location(0) positions: vec3<f32>,
  @location(1) instanceSourcePositions: vec3<f32>,
  @location(2) instanceTargetPositions: vec3<f32>,
  @location(3) instanceSourcePositions64Low: vec3<f32>,
  @location(4) instanceTargetPositions64Low: vec3<f32>,
  @location(5) instanceColors: vec4<f32>,
  @location(6) instancePickingColors: vec3<f32>,
  @location(7) instanceWidths: f32
) -> Varyings {
  var geometry: Geometry;
  geometry.worldPosition = instanceSourcePositions;
  geometry.worldPositionAlt = instanceTargetPositions;

  var source_world: vec3<f32> = instanceSourcePositions;
  var target_world: vec3<f32> = instanceTargetPositions;
  var source_world_64low: vec3<f32> = instanceSourcePositions64Low;
  var target_world_64low: vec3<f32> = instanceTargetPositions64Low;

  // Apply shortest-path adjustments if needed.
  if (line.useShortestPath > 0.5 || line.useShortestPath < -0.5) {
    source_world.x = (source_world.x + 180.0 % 360.0) - 180.0;
    target_world.x = (target_world.x + 180.0 % 360.0) - 180.0;
    let deltaLng: f32 = target_world.x - source_world.x;

    if (deltaLng * line.useShortestPath > 180.0) {
      source_world.x = source_world.x + 360.0 * line.useShortestPath;
      source_world = splitLine(source_world, target_world, 180.0 * line.useShortestPath);
      source_world_64low = vec3<f32>(0.0, 0.0, 0.0);
    } else if (deltaLng * line.useShortestPath < -180.0) {
      target_world.x = target_world.x + 360.0 * line.useShortestPath;
      target_world = splitLine(source_world, target_world, 180.0 * line.useShortestPath);
      target_world_64low = vec3<f32>(0.0, 0.0, 0.0);
    } else if (line.useShortestPath < 0.0) {
      var abortOut: Varyings;
      abortOut.gl_Position = vec4<f32>(0.0);
      abortOut.vColor = vec4<f32>(0.0);
      abortOut.uv = vec2<f32>(0.0);
      return abortOut;
    }
  }

  // Project Pos and target positions to clip space.
  let sourceResult = project_position_to_clipspace_and_commonspace(source_world, source_world_64low, vec3<f32>(0.0));
  let targetResult = project_position_to_clipspace_and_commonspace(target_world, target_world_64low, vec3<f32>(0.0));
  let sourcePos: vec4<f32> = sourceResult.clipPosition;
  let targetPos: vec4<f32> = targetResult.clipPosition;
  let source_commonspace: vec4<f32> = sourceResult.commonPosition;
  let target_commonspace: vec4<f32> = targetResult.commonPosition;

  // Interpolate along the line segment.
  let segmentIndex: f32 = positions.x;
  let p: vec4<f32> = sourcePos + segmentIndex * (targetPos - sourcePos);
  geometry.position = source_commonspace + segmentIndex * (target_commonspace - source_commonspace);
  let uv: vec2<f32> = positions.xy;
  geometry.uv = uv;
  geometry.pickingColor = instancePickingColors;

  // Determine width in pixels.
  let widthPixels: f32 = clamp(
    project_unit_size_to_pixel(instanceWidths * line.widthScale, line.widthUnits),
    line.widthMinPixels, line.widthMaxPixels
  );

  // Compute extrusion offset.
  let extrusion: vec2<f32> = getExtrusionOffset(targetPos.xy - sourcePos.xy, positions.y, widthPixels);
  let offset: vec3<f32> = vec3<f32>(extrusion, 0.0);

  // Apply deck.gl filter functions.
  let filteredOffset = deckgl_filter_size(offset, geometry);
  let filteredP = deckgl_filter_gl_position(p, geometry);

  let clipOffset: vec2<f32> = project_pixel_size_to_clipspace(filteredOffset.xy);
  let finalPosition: vec4<f32> = filteredP + vec4<f32>(clipOffset, 0.0, 0.0);

  // Compute color.
  var vColor: vec4<f32> = vec4<f32>(instanceColors.rgb, instanceColors.a * layer.opacity);
  // vColor = deckgl_filter_color(vColor, geometry);

  var output: Varyings;
  output.gl_Position = finalPosition;
  output.vColor = vColor;
  output.uv = uv;
  return output;
}

@fragment
fn fragmentMain(
  @location(0) vColor: vec4<f32>,
  @location(1) uv: vec2<f32>
) -> @location(0) vec4<f32> {
  // Create and initialize geometry with the provided uv.
  var geometry: Geometry;
  geometry.uv = uv;

  // Start with the input color.
  var fragColor: vec4<f32> = vColor;

  // Apply the deck.gl filter to the color.
  fragColor = deckgl_filter_color(fragColor, geometry);

  return fragColor;
}
`,hk=`#version 300 es
#define SHADER_NAME line-layer-vertex-shader
in vec3 positions;
in vec3 instanceSourcePositions;
in vec3 instanceTargetPositions;
in vec3 instanceSourcePositions64Low;
in vec3 instanceTargetPositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in float instanceWidths;
out vec4 vColor;
out vec2 uv;
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
vec2 dir_screenspace = normalize(line_clipspace * project.viewportSize);
dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
return dir_screenspace * offset_direction * width / 2.0;
}
vec3 splitLine(vec3 a, vec3 b, float x) {
float t = (x - a.x) / (b.x - a.x);
return vec3(x, mix(a.yz, b.yz, t));
}
void main(void) {
geometry.worldPosition = instanceSourcePositions;
geometry.worldPositionAlt = instanceTargetPositions;
vec3 source_world = instanceSourcePositions;
vec3 target_world = instanceTargetPositions;
vec3 source_world_64low = instanceSourcePositions64Low;
vec3 target_world_64low = instanceTargetPositions64Low;
if (line.useShortestPath > 0.5 || line.useShortestPath < -0.5) {
source_world.x = mod(source_world.x + 180., 360.0) - 180.;
target_world.x = mod(target_world.x + 180., 360.0) - 180.;
float deltaLng = target_world.x - source_world.x;
if (deltaLng * line.useShortestPath > 180.) {
source_world.x += 360. * line.useShortestPath;
source_world = splitLine(source_world, target_world, 180. * line.useShortestPath);
source_world_64low = vec3(0.0);
} else if (deltaLng * line.useShortestPath < -180.) {
target_world.x += 360. * line.useShortestPath;
target_world = splitLine(source_world, target_world, 180. * line.useShortestPath);
target_world_64low = vec3(0.0);
} else if (line.useShortestPath < 0.) {
gl_Position = vec4(0.);
return;
}
}
vec4 source_commonspace;
vec4 target_commonspace;
vec4 source = project_position_to_clipspace(source_world, source_world_64low, vec3(0.), source_commonspace);
vec4 target = project_position_to_clipspace(target_world, target_world_64low, vec3(0.), target_commonspace);
float segmentIndex = positions.x;
vec4 p = mix(source, target, segmentIndex);
geometry.position = mix(source_commonspace, target_commonspace, segmentIndex);
uv = positions.xy;
geometry.uv = uv;
geometry.pickingColor = instancePickingColors;
float widthPixels = clamp(
project_size_to_pixel(instanceWidths * line.widthScale, line.widthUnits),
line.widthMinPixels, line.widthMaxPixels
);
vec3 offset = vec3(
getExtrusionOffset(target.xy - source.xy, positions.y, widthPixels),
0.0);
DECKGL_FILTER_SIZE(offset, geometry);
DECKGL_FILTER_GL_POSITION(p, geometry);
gl_Position = p + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,dk=`#version 300 es
#define SHADER_NAME line-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,pk=[0,0,0,255],gk={getSourcePosition:{type:"accessor",value:n=>n.sourcePosition},getTargetPosition:{type:"accessor",value:n=>n.targetPosition},getColor:{type:"accessor",value:pk},getWidth:{type:"accessor",value:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class pp extends js{getBounds(){return this.getAttributeManager()?.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:hk,fs:dk,source:fk,modules:[Lc,A3,uk]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1}})}updateState(e){super.updateState(e),e.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{widthUnits:t,widthScale:i,widthMinPixels:s,widthMaxPixels:o,wrapLongitude:c}=this.props,u=this.state.model,h={widthUnits:Us[t],widthScale:i,widthMinPixels:s,widthMaxPixels:o,useShortestPath:c?1:0};u.shaderInputs.setProps({line:h}),u.draw(this.context.renderPass),c&&(u.shaderInputs.setProps({line:{...h,useShortestPath:-1}}),u.draw(this.context.renderPass))}_getModel(){const e=[0,-1,0,0,1,0,1,-1,0,1,1,0];return new ss(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new P3({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}}pp.layerName="LineLayer";pp.defaultProps=gk;const Mv=`uniform scatterplotUniforms {
  float radiusScale;
  float radiusMinPixels;
  float radiusMaxPixels;
  float lineWidthScale;
  float lineWidthMinPixels;
  float lineWidthMaxPixels;
  float stroked;
  float filled;
  bool antialiasing;
  bool billboard;
  highp int radiusUnits;
  highp int lineWidthUnits;
} scatterplot;
`,_k={name:"scatterplot",vs:Mv,fs:Mv,source:"",uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}},mk=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),
scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),
scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
);
outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
float edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;
if (scatterplot.billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,yk=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = scatterplot.antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (scatterplot.stroked > 0.5) {
float isLine = scatterplot.antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (scatterplot.filled > 0.5) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (scatterplot.filled < 0.5) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,bk=`// TODO(ibgreen): Hack for Layer uniforms (move to new "color" module?)

struct LayerUniforms {
  opacity: f32,
};

var<private> layer: LayerUniforms = LayerUniforms(1.0);
// @group(0) @binding(1) var<uniform> layer: LayerUniforms;

// Main shaders

struct ScatterplotUniforms {
  radiusScale: f32,
  radiusMinPixels: f32,
  radiusMaxPixels: f32,
  lineWidthScale: f32,
  lineWidthMinPixels: f32,
  lineWidthMaxPixels: f32,
  stroked: f32,
  filled: i32,
  antialiasing: i32,
  billboard: i32,
  radiusUnits: i32,
  lineWidthUnits: i32,
};

struct ConstantAttributeUniforms {
 instancePositions: vec3<f32>,
 instancePositions64Low: vec3<f32>,
 instanceRadius: f32,
 instanceLineWidths: f32,
 instanceFillColors: vec4<f32>,
 instanceLineColors: vec4<f32>,
 instancePickingColors: vec3<f32>,

 instancePositionsConstant: i32,
 instancePositions64LowConstant: i32,
 instanceRadiusConstant: i32,
 instanceLineWidthsConstant: i32,
 instanceFillColorsConstant: i32,
 instanceLineColorsConstant: i32,
 instancePickingColorsConstant: i32
};

@group(0) @binding(2) var<uniform> scatterplot: ScatterplotUniforms;

struct ConstantAttributes {
  instancePositions: vec3<f32>,
  instancePositions64Low: vec3<f32>,
  instanceRadius: f32,
  instanceLineWidths: f32,
  instanceFillColors: vec4<f32>,
  instanceLineColors: vec4<f32>,
  instancePickingColors: vec3<f32>
};

const constants = ConstantAttributes(
  vec3<f32>(0.0),
  vec3<f32>(0.0),
  0.0,
  0.0,
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec3<f32>(0.0)
);

struct Attributes {
  @builtin(instance_index) instanceIndex : u32,
  @builtin(vertex_index) vertexIndex : u32,
  @location(0) positions: vec3<f32>,
  @location(1) instancePositions: vec3<f32>,
  @location(2) instancePositions64Low: vec3<f32>,
  @location(3) instanceRadius: f32,
  @location(4) instanceLineWidths: f32,
  @location(5) instanceFillColors: vec4<f32>,
  @location(6) instanceLineColors: vec4<f32>,
  @location(7) instancePickingColors: vec3<f32>
};

struct Varyings {
  @builtin(position) position: vec4<f32>,
  @location(0) vFillColor: vec4<f32>,
  @location(1) vLineColor: vec4<f32>,
  @location(2) unitPosition: vec2<f32>,
  @location(3) innerUnitRadius: f32,
  @location(4) outerRadiusPixels: f32,
};

@vertex
fn vertexMain(attributes: Attributes) -> Varyings {
  var varyings: Varyings;

  // Draw an inline geometry constant array clip space triangle to verify that rendering works.
  // var positions = array<vec2<f32>, 3>(vec2(0.0, 0.5), vec2(-0.5, -0.5), vec2(0.5, -0.5));
  // if (attributes.instanceIndex == 0) {
  //   varyings.position = vec4<f32>(positions[attributes.vertexIndex], 0.0, 1.0);
  //   return varyings;
  // }

  // var geometry: Geometry;
  // geometry.worldPosition = instancePositions;

  // Multiply out radius and clamp to limits
  varyings.outerRadiusPixels = clamp(
    project_unit_size_to_pixel(scatterplot.radiusScale * attributes.instanceRadius, scatterplot.radiusUnits),
    scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
  );

  // Multiply out line width and clamp to limits
  let lineWidthPixels = clamp(
    project_unit_size_to_pixel(scatterplot.lineWidthScale * attributes.instanceLineWidths, scatterplot.lineWidthUnits),
    scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
  );

  // outer radius needs to offset by half stroke width
  varyings.outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
  // Expand geometry to accommodate edge smoothing
  let edgePadding = select(
    (varyings.outerRadiusPixels + SMOOTH_EDGE_RADIUS) / varyings.outerRadiusPixels,
    1.0,
    scatterplot.antialiasing != 0
  );

  // position on the containing square in [-1, 1] space
  varyings.unitPosition = edgePadding * attributes.positions.xy;
  geometry.uv = varyings.unitPosition;
  geometry.pickingColor = attributes.instancePickingColors;

  varyings.innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / varyings.outerRadiusPixels;

  if (scatterplot.billboard != 0) {
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, vec3<f32>(0.0)); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
    let offset = attributes.positions; // * edgePadding * varyings.outerRadiusPixels;
    // DECKGL_FILTER_SIZE(offset, geometry);
    let clipPixels = project_pixel_size_to_clipspace(offset.xy);
    varyings.position.x = clipPixels.x;
    varyings.position.y = clipPixels.y;
  } else {
    let offset = edgePadding * attributes.positions * project_pixel_size_float(varyings.outerRadiusPixels);
    // DECKGL_FILTER_SIZE(offset, geometry);
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, offset); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
  }

  // Apply opacity to instance color, or return instance picking color
  varyings.vFillColor = vec4<f32>(attributes.instanceFillColors.rgb, attributes.instanceFillColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vFillColor, geometry);
  varyings.vLineColor = vec4<f32>(attributes.instanceLineColors.rgb, attributes.instanceLineColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vLineColor, geometry);

  return varyings;
}

@fragment
fn fragmentMain(varyings: Varyings) -> @location(0) vec4<f32> {
  // var geometry: Geometry;
  // geometry.uv = unitPosition;

  let distToCenter = length(varyings.unitPosition) * varyings.outerRadiusPixels;
  let inCircle = select(
    smoothedge(distToCenter, varyings.outerRadiusPixels),
    step(distToCenter, varyings.outerRadiusPixels),
    scatterplot.antialiasing != 0
  );

  if (inCircle == 0.0) {
    // discard;
  }

  var fragColor: vec4<f32>;

  if (scatterplot.stroked != 0) {
    let isLine = select(
      smoothedge(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      step(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      scatterplot.antialiasing != 0
    );

    if (scatterplot.filled != 0) {
      fragColor = mix(varyings.vFillColor, varyings.vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        // discard;
      }
      fragColor = vec4<f32>(varyings.vLineColor.rgb, varyings.vLineColor.a * isLine);
    }
  } else if (scatterplot.filled == 0) {
    // discard;
  } else {
    fragColor = varyings.vFillColor;
  }

  fragColor.a *= inCircle;
  // DECKGL_FILTER_COLOR(fragColor, geometry);

  return fragColor;
  // return vec4<f32>(0, 0, 1, 1);
}
`,Ov=[0,0,0,255],vk={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:n=>n.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:Ov},getLineColor:{type:"accessor",value:Ov},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class Wc extends js{getShaders(){return super.getShaders({vs:mk,fs:yk,source:bk,modules:[Lc,A3,_k]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e),e.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{radiusUnits:t,radiusScale:i,radiusMinPixels:s,radiusMaxPixels:o,stroked:c,filled:u,billboard:h,antialiasing:d,lineWidthUnits:g,lineWidthScale:m,lineWidthMinPixels:y,lineWidthMaxPixels:T}=this.props,w={stroked:c,filled:u,billboard:h,antialiasing:d,radiusUnits:Us[t],radiusScale:i,radiusMinPixels:s,radiusMaxPixels:o,lineWidthUnits:Us[g],lineWidthScale:m,lineWidthMinPixels:y,lineWidthMaxPixels:T},C=this.state.model;C.shaderInputs.setProps({scatterplot:w}),C.draw(this.context.renderPass)}_getModel(){const e=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new ss(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new P3({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}}Wc.defaultProps=vk;Wc.layerName="ScatterplotLayer";const Tk=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]];function xk(n,e=!1,t=Float32Array){let i;if(Number.isFinite(n[0]))i=new t(n);else{i=new t(n.length*4);let s=0;for(let o=0;o<n.length;o++){const c=n[o];i[s++]=c[0],i[s++]=c[1],i[s++]=c[2],i[s++]=Number.isFinite(c[3])?c[3]:255}}if(e)for(let s=0;s<i.length;s++)i[s]/=255;return i}function Sk(n){const e=n.map(u=>u[0]),t=n.map(u=>u[1]),i=Math.min.apply(null,e),s=Math.max.apply(null,e),o=Math.min.apply(null,t),c=Math.max.apply(null,t);return[i,o,s,c]}function wk(n,e){return e[0]>=n[0]&&e[2]<=n[2]&&e[1]>=n[1]&&e[3]<=n[3]}const Iv=new Float32Array(12);function Nv(n,e=2){let t=0;for(const i of n)for(let s=0;s<e;s++)Iv[t++]=i[s]||0;return Iv}function Ak(n,e,t){const[i,s,o,c]=n,u=o-i,h=c-s;let d=u,g=h;u/h<e/t?d=e/t*h:g=t/e*u,d<e&&(d=e,g=t);const m=(o+i)/2,y=(c+s)/2;return[m-d/2,y-g/2,m+d/2,y+g/2]}function Ek(n,e){const[t,i,s,o]=e;return[(n[0]-t)/(s-t),(n[1]-i)/(o-i)]}const Rk=`#version 300 es
#define SHADER_NAME heatp-map-layer-vertex-shader
uniform sampler2D maxTexture;
in vec3 positions;
in vec2 texCoords;
out vec2 vTexCoords;
out float vIntensityMin;
out float vIntensityMax;
void main(void) {
gl_Position = project_position_to_clipspace(positions, vec3(0.0), vec3(0.0));
vTexCoords = texCoords;
vec4 maxTexture = texture(maxTexture, vec2(0.5));
float maxValue = triangle.aggregationMode < 0.5 ? maxTexture.r : maxTexture.g;
float minValue = maxValue * triangle.threshold;
if (triangle.colorDomain[1] > 0.) {
maxValue = triangle.colorDomain[1];
minValue = triangle.colorDomain[0];
}
vIntensityMax = triangle.intensity / maxValue;
vIntensityMin = triangle.intensity / minValue;
}
`,Ck=`#version 300 es
#define SHADER_NAME triangle-layer-fragment-shader
precision highp float;
uniform sampler2D weightsTexture;
uniform sampler2D colorTexture;
in vec2 vTexCoords;
in float vIntensityMin;
in float vIntensityMax;
out vec4 fragColor;
vec4 getLinearColor(float value) {
float factor = clamp(value * vIntensityMax, 0., 1.);
vec4 color = texture(colorTexture, vec2(factor, 0.5));
color.a *= min(value * vIntensityMin, 1.0);
return color;
}
void main(void) {
vec4 weights = texture(weightsTexture, vTexCoords);
float weight = weights.r;
if (triangle.aggregationMode > 0.5) {
weight /= max(1.0, weights.a);
}
if (weight <= 0.) {
discard;
}
vec4 linearColor = getLinearColor(weight);
linearColor.a *= layer.opacity;
fragColor = linearColor;
}
`,Pv=`uniform triangleUniforms {
  float aggregationMode;
  vec2 colorDomain;
  float intensity;
  float threshold;
} triangle;
`,Mk={name:"triangle",vs:Pv,fs:Pv,uniformTypes:{aggregationMode:"f32",colorDomain:"vec2<f32>",intensity:"f32",threshold:"f32"}};class pT extends js{getShaders(){return super.getShaders({vs:Rk,fs:Ck,modules:[Lc,Mk]})}initializeState({device:e}){this.setState({model:this._getModel(e)})}_getModel(e){const{vertexCount:t,data:i}=this.props;return new ss(e,{...this.getShaders(),id:this.props.id,attributes:i.attributes,bufferLayout:[{name:"positions",format:"float32x3"},{name:"texCoords",format:"float32x2"}],topology:"triangle-strip",vertexCount:t})}draw(){const{model:e}=this.state,{aggregationMode:t,colorDomain:i,intensity:s,threshold:o,colorTexture:c,maxTexture:u,weightsTexture:h}=this.props,d={aggregationMode:t,colorDomain:i,intensity:s,threshold:o,colorTexture:c,maxTexture:u,weightsTexture:h};e.shaderInputs.setProps({triangle:d}),e.draw(this.context.renderPass)}}pT.layerName="TriangleLayer";function Ok(n,e){const t={};for(const i in n)e.includes(i)||(t[i]=n[i]);return t}class gT extends fT{initializeAggregationLayer(e){super.initializeState(this.context),this.setState({ignoreProps:Ok(this.constructor._propTypes,e.data.props),dimensions:e})}updateState(e){super.updateState(e);const{changeFlags:t}=e;if(t.extensionsChanged){const i=this.getShaders({});i&&i.defines&&(i.defines.NON_INSTANCED_MODEL=1),this.updateShaders(i)}this._updateAttributes()}updateAttributes(e){this.setState({changedAttributes:e})}getAttributes(){return this.getAttributeManager().getAttributes()}getModuleSettings(){const{viewport:e,mousePosition:t,device:i}=this.context;return Object.assign(Object.create(this.props),{viewport:e,mousePosition:t,picking:{isActive:0},devicePixelRatio:i.canvasContext.cssToDeviceRatio()})}updateShaders(e){}isAggregationDirty(e,t={}){const{props:i,oldProps:s,changeFlags:o}=e,{compareAll:c=!1,dimension:u}=t,{ignoreProps:h}=this.state,{props:d,accessors:g=[]}=u,{updateTriggersChanged:m}=o;if(o.dataChanged)return!0;if(m){if(m.all)return!0;for(const y of g)if(m[y])return!0}if(c)return o.extensionsChanged?!0:hp({oldProps:s,newProps:i,ignoreProps:h,propTypes:this.constructor._propTypes});for(const y of d)if(i[y]!==s[y])return!0;return!1}isAttributeChanged(e){const{changedAttributes:t}=this.state;return e?t&&t[e]!==void 0:!Ik(t)}_getAttributeManager(){return new fp(this.context.device,{id:this.props.id,stats:this.context.stats})}}gT.layerName="AggregationLayer";function Ik(n){let e=!0;for(const t in n){e=!1;break}return e}const kv=`#version 300 es
in vec3 positions;
in vec3 positions64Low;
in float weights;
out vec4 weightsTexture;
void main()
{
weightsTexture = vec4(weights * weight.weightsScale, 0., 0., 1.);
float radiusTexels = project_pixel_size(weight.radiusPixels) * weight.textureWidth / (weight.commonBounds.z - weight.commonBounds.x);
gl_PointSize = radiusTexels * 2.;
vec3 commonPosition = project_position(positions, positions64Low);
gl_Position.xy = (commonPosition.xy - weight.commonBounds.xy) / (weight.commonBounds.zw - weight.commonBounds.xy) ;
gl_Position.xy = (gl_Position.xy * 2.) - (1.);
gl_Position.w = 1.0;
}
`,Dv=`#version 300 es
in vec4 weightsTexture;
out vec4 fragColor;
float gaussianKDE(float u){
return pow(2.71828, -u*u/0.05555)/(1.77245385*0.166666);
}
void main()
{
float dist = length(gl_PointCoord - vec2(0.5, 0.5));
if (dist > 0.5) {
discard;
}
fragColor = weightsTexture * gaussianKDE(2. * dist);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Nk=`#version 300 es
uniform sampler2D inTexture;
out vec4 outTexture;
void main()
{
int yIndex = gl_VertexID / int(maxWeight.textureSize);
int xIndex = gl_VertexID - (yIndex * int(maxWeight.textureSize));
vec2 uv = (0.5 + vec2(float(xIndex), float(yIndex))) / maxWeight.textureSize;
outTexture = texture(inTexture, uv);
gl_Position = vec4(0.0, 0.0, 0.0, 1.0);
gl_PointSize = 1.0;
}
`,Pk=`#version 300 es
in vec4 outTexture;
out vec4 fragColor;
void main() {
fragColor = outTexture;
fragColor.g = outTexture.r / max(1.0, outTexture.a);
}
`,kk=`uniform weightUniforms {
  vec4 commonBounds;
  float radiusPixels;
  float textureWidth;
  float weightsScale;
} weight;
`,Dk={name:"weight",vs:kk,uniformTypes:{commonBounds:"vec4<f32>",radiusPixels:"f32",textureWidth:"f32",weightsScale:"f32"}},Uk={name:"maxWeight",vs:`uniform maxWeightUniforms {
  float textureSize;
} maxWeight;
`,uniformTypes:{textureSize:"f32"}},Bk=2,Wh={format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}},Uv=[0,0],Fk={SUM:0,MEAN:1},Lk={getPosition:{type:"accessor",value:n=>n.position},getWeight:{type:"accessor",value:1},intensity:{type:"number",min:0,value:1},radiusPixels:{type:"number",min:1,max:100,value:50},colorRange:Tk,threshold:{type:"number",min:0,max:1,value:.05},colorDomain:{type:"array",value:null,optional:!0},aggregation:"SUM",weightsTextureSize:{type:"number",min:128,max:2048,value:2048},debounceTimeout:{type:"number",min:0,max:1e3,value:500}},zk=["float32-renderable-webgl","texture-blend-float-webgl"],Vk={data:{props:["radiusPixels"]}};class gp extends gT{getShaders(e){let t=[Lc];return e.modules&&(t=[...t,...e.modules]),super.getShaders({...e,modules:t})}initializeState(){super.initializeAggregationLayer(Vk),this.setState({colorDomain:Uv}),this._setupTextureParams(),this._setupAttributes(),this._setupResources()}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState(e){super.updateState(e),this._updateHeatmapState(e)}_updateHeatmapState(e){const{props:t,oldProps:i}=e,s=this._getChangeFlags(e);(s.dataChanged||s.viewportChanged)&&(s.boundsChanged=this._updateBounds(s.dataChanged),this._updateTextureRenderingBounds()),s.dataChanged||s.boundsChanged?(clearTimeout(this.state.updateTimer),this.setState({isWeightMapDirty:!0})):s.viewportZoomChanged&&this._debouncedUpdateWeightmap(),t.colorRange!==i.colorRange&&this._updateColorTexture(e),this.state.isWeightMapDirty&&this._updateWeightmap(),this.setState({zoom:e.context.viewport.zoom})}renderLayers(){const{weightsTexture:e,triPositionBuffer:t,triTexCoordBuffer:i,maxWeightsTexture:s,colorTexture:o,colorDomain:c}=this.state,{updateTriggers:u,intensity:h,threshold:d,aggregation:g}=this.props,m=this.getSubLayerClass("triangle",pT);return new m(this.getSubLayerProps({id:"triangle-layer",updateTriggers:u}),{coordinateSystem:Ue.DEFAULT,data:{attributes:{positions:t,texCoords:i}},vertexCount:4,maxTexture:s,colorTexture:o,aggregationMode:Fk[g]||0,weightsTexture:e,intensity:h,threshold:d,colorDomain:c})}finalizeState(e){super.finalizeState(e);const{weightsTransform:t,weightsTexture:i,maxWeightTransform:s,maxWeightsTexture:o,triPositionBuffer:c,triTexCoordBuffer:u,colorTexture:h,updateTimer:d}=this.state;t?.destroy(),i?.destroy(),s?.destroy(),o?.destroy(),c?.destroy(),u?.destroy(),h?.destroy(),d&&clearTimeout(d)}_getAttributeManager(){return new fp(this.context.device,{id:this.props.id,stats:this.context.stats})}_getChangeFlags(e){const t={},{dimensions:i}=this.state;t.dataChanged=this.isAttributeChanged()&&"attribute changed"||this.isAggregationDirty(e,{compareAll:!0,dimension:i.data})&&"aggregation is dirty",t.viewportChanged=e.changeFlags.viewportChanged;const{zoom:s}=this.state;return(!e.context.viewport||e.context.viewport.zoom!==s)&&(t.viewportZoomChanged=!0),t}_createTextures(){const{textureSize:e,format:t}=this.state;this.setState({weightsTexture:this.context.device.createTexture({...Wh,width:e,height:e,format:t}),maxWeightsTexture:this.context.device.createTexture({...Wh,width:1,height:1,format:t})})}_setupAttributes(){this.getAttributeManager().add({positions:{size:3,type:"float64",accessor:"getPosition"},weights:{size:1,accessor:"getWeight"}}),this.setState({positionAttributeName:"positions"})}_setupTextureParams(){const{device:e}=this.context,{weightsTextureSize:t}=this.props,i=Math.min(t,e.limits.maxTextureDimension2D),s=zk.every(u=>e.features.has(u)),o=s?"rgba32float":"rgba8unorm",c=s?1:1/255;this.setState({textureSize:i,format:o,weightsScale:c}),s||et.warn(`HeatmapLayer: ${this.id} rendering to float texture not supported, falling back to low precision format`)()}_createWeightsTransform(e){let{weightsTransform:t}=this.state;const{weightsTexture:i}=this.state,s=this.getAttributeManager();t?.destroy(),t=new Qb(this.context.device,{id:`${this.id}-weights-transform`,bufferLayout:s.getBufferLayouts(),vertexCount:1,targetTexture:i,parameters:{depthWriteEnabled:!1,blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"},topology:"point-list",...e,modules:[...e.modules,Dk]}),this.setState({weightsTransform:t})}_setupResources(){this._createTextures();const{device:e}=this.context,{textureSize:t,weightsTexture:i,maxWeightsTexture:s}=this.state,o=this.getShaders({vs:kv,fs:Dv});this._createWeightsTransform(o);const c=this.getShaders({vs:Nk,fs:Pk,modules:[Uk]}),u=new Qb(e,{id:`${this.id}-max-weights-transform`,targetTexture:s,...c,vertexCount:t*t,topology:"point-list",parameters:{depthWriteEnabled:!1,blendColorOperation:"max",blendAlphaOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}}),h={inTexture:i,textureSize:t};u.model.shaderInputs.setProps({maxWeight:h}),this.setState({weightsTexture:i,maxWeightsTexture:s,maxWeightTransform:u,zoom:null,triPositionBuffer:e.createBuffer({byteLength:48}),triTexCoordBuffer:e.createBuffer({byteLength:48})})}updateShaders(e){this._createWeightsTransform({vs:kv,fs:Dv,...e})}_updateMaxWeightValue(){const{maxWeightTransform:e}=this.state;e.run({parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]})}_updateBounds(e=!1){const{viewport:t}=this.context,i=[t.unproject([0,0]),t.unproject([t.width,0]),t.unproject([0,t.height]),t.unproject([t.width,t.height])].map(u=>u.map(Math.fround)),s=Sk(i),o={visibleWorldBounds:s,viewportCorners:i};let c=!1;if(e||!this.state.worldBounds||!wk(this.state.worldBounds,s)){const u=this._worldToCommonBounds(s),h=this._commonToWorldBounds(u);this.props.coordinateSystem===Ue.LNGLAT&&(h[1]=Math.max(h[1],-85.051129),h[3]=Math.min(h[3],85.051129),h[0]=Math.max(h[0],-360),h[2]=Math.min(h[2],360));const d=this._worldToCommonBounds(h);o.worldBounds=h,o.normalizedCommonBounds=d,c=!0}return this.setState(o),c}_updateTextureRenderingBounds(){const{triPositionBuffer:e,triTexCoordBuffer:t,normalizedCommonBounds:i,viewportCorners:s}=this.state,{viewport:o}=this.context;e.write(Nv(s,3));const c=s.map(u=>Ek(o.projectPosition(u),i));t.write(Nv(c,2))}_updateColorTexture(e){const{colorRange:t}=e.props;let{colorTexture:i}=this.state;const s=xk(t,!1,Uint8Array);i&&i?.width===t.length?i.setTexture2DData({data:s}):(i?.destroy(),i=this.context.device.createTexture({...Wh,data:s,width:t.length,height:1})),this.setState({colorTexture:i})}_updateWeightmap(){const{radiusPixels:e,colorDomain:t,aggregation:i}=this.props,{worldBounds:s,textureSize:o,weightsScale:c,weightsTexture:u}=this.state,h=this.state.weightsTransform;this.state.isWeightMapDirty=!1;const d=this._worldToCommonBounds(s,{useLayerCoordinateSystem:!0});if(t&&i==="SUM"){const{viewport:O}=this.context,F=O.distanceScales.metersPerUnit[2]*(d[2]-d[0])/o;this.state.colorDomain=t.map(H=>H*F*c)}else this.state.colorDomain=t||Uv;const m=this.getAttributeManager().getAttributes(),y=this.getModuleSettings();this._setModelAttributes(h.model,m),h.model.setVertexCount(this.getNumInstances());const T={radiusPixels:e,commonBounds:d,textureWidth:o,weightsScale:c,weightsTexture:u},{viewport:w,devicePixelRatio:C,coordinateSystem:N,coordinateOrigin:V}=y,{modelMatrix:$}=this.props;h.model.shaderInputs.setProps({project:{viewport:w,devicePixelRatio:C,modelMatrix:$,coordinateSystem:N,coordinateOrigin:V},weight:T}),h.run({parameters:{viewport:[0,0,o,o]},clearColor:[0,0,0,0]}),this._updateMaxWeightValue()}_debouncedUpdateWeightmap(e=!1){let{updateTimer:t}=this.state;const{debounceTimeout:i}=this.props;e?(t=null,this._updateBounds(!0),this._updateTextureRenderingBounds(),this.setState({isWeightMapDirty:!0})):(this.setState({isWeightMapDirty:!1}),clearTimeout(t),t=setTimeout(this._debouncedUpdateWeightmap.bind(this,!0),i)),this.setState({updateTimer:t})}_worldToCommonBounds(e,t={}){const{useLayerCoordinateSystem:i=!1}=t,[s,o,c,u]=e,{viewport:h}=this.context,{textureSize:d}=this.state,{coordinateSystem:g}=this.props,m=i&&(g===Ue.LNGLAT_OFFSETS||g===Ue.METER_OFFSETS),y=m?h.projectPosition(this.props.coordinateOrigin):[0,0],T=d*Bk/h.scale;let w,C;return i&&!m?(w=this.projectPosition([s,o,0]),C=this.projectPosition([c,u,0])):(w=h.projectPosition([s,o,0]),C=h.projectPosition([c,u,0])),Ak([w[0]-y[0],w[1]-y[1],C[0]-y[0],C[1]-y[1]],T,T)}_commonToWorldBounds(e){const[t,i,s,o]=e,{viewport:c}=this.context,u=c.unprojectPosition([t,i]),h=c.unprojectPosition([s,o]);return u.slice(0,2).concat(h.slice(0,2))}}gp.layerName="HeatmapLayer";gp.defaultProps=Lk;const jk=[0,255,51,204],Hk=[255,100,100,200],Wk=[100,150,255,200],$k=[255,100,100,100],Xk=[100,150,255,100];function Yk(n,e,t,i){return i?new gp({id:"heatmap",data:n,getPosition:s=>[s.lon,s.lat],getWeight:1,radiusPixels:e,intensity:t,threshold:.03,colorRange:[[0,0,255,0],[0,128,255,64],[0,255,255,128],[0,255,0,192],[255,255,0,224],[255,165,0,240],[255,0,0,255]]}):null}function qk(n,e,t,i=!1){return new pp({id:"lanes",data:n,getSourcePosition:s=>s.o,getTargetPosition:s=>s.d,getColor:s=>s.visible&&i?jk:[0,0,0,0],getWidth:3,widthMinPixels:2,widthMaxPixels:6,pickable:!0,onHover:e,onClick:t,updateTriggers:{getColor:[n.map(s=>s.visible),i],getSourcePosition:n,getTargetPosition:n}})}function Kk(n,e,t){return new Wc({id:"origin-points",data:n,getPosition:i=>[i.lon,i.lat],getRadius:8,getFillColor:e?Hk:[0,0,0,0],getLineColor:e?$k:[0,0,0,0],getLineWidth:1,radiusMinPixels:4,radiusMaxPixels:12,pickable:e,onHover:e?t:()=>{},updateTriggers:{getPosition:n,getFillColor:[n,e],getLineColor:[n,e]}})}function Zk(n,e,t){return new Wc({id:"destination-points",data:n,getPosition:i=>[i.lon,i.lat],getRadius:8,getFillColor:e?Wk:[0,0,0,0],getLineColor:e?Xk:[0,0,0,0],getLineWidth:1,radiusMinPixels:4,radiusMaxPixels:12,pickable:e,onHover:e?t:()=>{},updateTriggers:{getPosition:n,getFillColor:[n,e],getLineColor:[n,e]}})}function Qk(n,e,t,i,s,o,c,u,h,d){const g=[],m=Yk(n,i.radiusPixels,i.intensity,i.enabled);if(m&&g.push(m),g.push(qk(e,c,u,s)),t==="all"||t==="origin"){const y=t==="origin"?n:n.filter(T=>e.some(w=>w.origin_zip===T.zip));g.push(Kk(y,o,h))}if(t==="all"||t==="destination"){const y=t==="destination"?n:n.filter(T=>e.some(w=>w.destination_zip===T.zip));g.push(Zk(y,o,d))}return g}function Gk(n){return`${n.origin_zip} → ${n.destination_zip}`}function Jk(n,e){const t=Array.from(e).sort();return ce.jsxs("div",{className:"min-w-[240px] rounded-lg bg-[#121212] border border-[#333] shadow-2xl overflow-hidden",children:[ce.jsxs("div",{className:"px-3 py-2 border-b border-[#333]",children:[ce.jsxs("div",{className:"text-[#00ff33] font-medium text-sm",children:["ZIP ",n.zip]}),ce.jsxs("div",{className:"text-[#999] text-xs",children:[n.city,", ",n.state]})]}),ce.jsxs("div",{className:"p-3",children:[ce.jsxs("div",{className:"text-[#ccc] text-xs mb-2 font-medium",children:["Customers (",t.length,")"]}),ce.jsx("div",{className:"space-y-1 max-h-32 overflow-y-auto",children:t.map((i,s)=>ce.jsx("div",{className:"text-[#aaa] text-xs py-1 hover:text-[#00ff33] transition-colors cursor-default",children:i},s))})]})]})}function eD(n,e){let t;return(...i)=>{clearTimeout(t),t=setTimeout(()=>n(...i),e)}}function tD(){const{getHeatmapPoints:n,getVisibleLanes:e,originToCustomers:t,heatmap:i,lanesVisible:s,pointsVisible:o,tab:c,toggleLane:u}=ta(),[h,d]=le.useState(J1()),[g,m]=le.useState(null),y=le.useCallback(eD(O=>{m(O)},50),[]),T=le.useCallback(O=>{if(O.object&&O.x!==void 0&&O.y!==void 0){const F=Gk(O.object);y({x:O.x,y:O.y,content:ce.jsx("div",{className:"text-[#00ff33] px-3 py-2 rounded text-xs bg-[#121212] border border-[#333] font-medium",children:F})})}else y(null)},[y]),w=le.useCallback(O=>{O.object&&u(O.object.id)},[u]),C=le.useCallback(O=>{if(O.object&&O.x!==void 0&&O.y!==void 0){const F=O.object,H=t[F.zip];if(H&&H.size>0){const te=Jk(F,H);y({x:O.x,y:O.y,content:ce.jsx("div",{className:`text-white rounded-lg border border-[#333] shadow-2xl
              bg-[#121212]`,children:te})})}}else y(null)},[t,y]),N=n(),V=e(),$=Qk(N,V,c,i,s,o,T,w,C,C);return ce.jsxs("div",{className:"relative w-full h-full",children:[ce.jsx(lk,{viewState:h,onViewStateChange:({viewState:O})=>d(O),controller:!0,layers:$,style:{position:"relative"},children:ce.jsx(wx,{mapStyle:"https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json",style:{background:"#121212"}})}),g&&ce.jsx("div",{className:"absolute pointer-events-none z-10",style:{left:g.x,top:g.y,transform:"translate(-50%, -100%)"},children:g.content})]})}function nD(){const{setLanes:n,setPoints:e,setOriginToCustomers:t,setLoading:i,setError:s,isLoading:o,error:c}=ta(),[u,h]=le.useState(0),[d,g]=le.useState(!1);return le.useEffect(()=>{(async()=>{i(!0),s(null);try{const y=await ix();n(y.lanes),e(y.pointsAll,y.pointsOrigin,y.pointsDestination),t(y.originToCustomers),y.invalidZips.length>0&&(h(y.invalidZips.length),g(!0))}catch(y){s(y instanceof Error?y.message:"Failed to load data")}finally{i(!1)}})()},[n,e,t,i,s]),o?ce.jsx("div",{className:"app",style:{placeItems:"center"},children:ce.jsxs("div",{className:"text-center",children:[ce.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[var(--accent)] mx-auto mb-4"}),ce.jsx("div",{style:{color:"var(--text-0)"},children:"Loading lane data..."})]})}):c?ce.jsx("div",{className:"app",style:{placeItems:"center"},children:ce.jsxs("div",{className:"text-center max-w-md",children:[ce.jsx("div",{style:{color:"#ff4444",fontSize:"18px",marginBottom:"16px"},children:"Error Loading Data"}),ce.jsx("div",{style:{color:"var(--text-1)",marginBottom:"16px"},children:c}),ce.jsx("button",{onClick:()=>window.location.reload(),className:"btn btn-primary",children:"Retry"})]})}):ce.jsxs("div",{className:"app",children:[ce.jsx("header",{className:"header",children:ce.jsx("div",{className:"title",children:"Lane Heatmap"})}),d&&ce.jsxs("div",{className:"chip",style:{position:"fixed",top:"80px",right:"20px",zIndex:50,background:"rgba(0,255,51,0.1)",border:"1px solid rgba(0,255,51,0.35)"},children:[ce.jsxs("span",{style:{color:"var(--text-0)",fontSize:"12px"},children:["ℹ️ ",u," ZIP codes using approximate coordinates"]}),ce.jsx("button",{onClick:()=>g(!1),className:"icon-btn",style:{width:"20px",height:"20px",marginLeft:"8px"},children:ce.jsx("svg",{style:{width:"12px",height:"12px"},fill:"currentColor",viewBox:"0 0 20 20",children:ce.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),ce.jsx("div",{className:"sidebar",children:ce.jsx(cx,{})}),ce.jsx("main",{className:"main",children:ce.jsx("div",{className:"map-wrap",children:ce.jsx(tD,{})})})]})}B1.createRoot(document.getElementById("root")).render(ce.jsx(le.StrictMode,{children:ce.jsx(nD,{})}));export{Bv as g};
